# -*- eval: (setq org-download-image-dir (concat default-directory "./static/React.js å°ä¹¦/")); -*-
:PROPERTIES:
:ID:       B57F409E-9B72-44F4-B805-ADD113AF1FBE
:END:
#+LATEX_CLASS: my-article
#+TOC: listings
#+DATE: <2020-07-18 Sat 14:02>
#+TITLE: React.js å°ä¹¦

* React.js ç®€ä»‹
React.js æ˜¯ä¸€ä¸ªå¸®åŠ©ä½ æ„å»ºé¡µé¢ UI çš„åº“. å¦‚æœä½ ç†Ÿæ‚‰ MVC æ¦‚å¿µçš„è¯, é‚£ä¹ˆ React çš„ç»„ä»¶å°±
ç›¸å½“äº MVC é‡Œé¢çš„ View. å¦‚æœä½ ä¸ç†Ÿæ‚‰ä¹Ÿæ²¡å…³ç³», ä½ å¯ä»¥ç®€å•åœ°ç†è§£ä¸º,React.js å°†å¸®åŠ©
æˆ‘ä»¬å°†ç•Œé¢åˆ†æˆäº†å„ä¸ªç‹¬ç«‹çš„å°å—, æ¯ä¸€ä¸ªå—å°±æ˜¯ç»„ä»¶, è¿™äº›ç»„ä»¶ä¹‹é—´å¯ä»¥ç»„åˆ, åµŒå¥—, å°±æˆ
äº†æˆ‘ä»¬çš„é¡µé¢.

ä¸€ä¸ªç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€å’Œè¡Œä¸ºæœ‰å¯èƒ½æ˜¯ç”±æŸäº›æ•°æ®å†³å®šçš„. è€Œæ•°æ®æ˜¯å¯èƒ½å‘ç”Ÿæ”¹å˜çš„, è¿™æ—¶å€™ç»„
ä»¶çš„æ˜¾ç¤ºå½¢æ€å°±ä¼šå‘ç”Ÿç›¸åº”çš„æ”¹å˜. è€Œ React.js ä¹Ÿæä¾›äº†ä¸€ç§éå¸¸é«˜æ•ˆçš„æ–¹å¼å¸®åŠ©æˆ‘ä»¬åšåˆ°
äº†æ•°æ®å’Œç»„ä»¶æ˜¾ç¤ºå½¢æ€ä¹‹é—´çš„åŒæ­¥.

React.js ä¸æ˜¯ä¸€ä¸ªæ¡†æ¶, å®ƒåªæ˜¯ä¸€ä¸ªåº“. å®ƒåªæä¾› UI(view) å±‚é¢çš„è§£å†³æ–¹æ¡ˆ. åœ¨å®é™…çš„é¡¹
ç›®å½“ä¸­, å®ƒå¹¶ä¸èƒ½è§£å†³æˆ‘ä»¬æ‰€æœ‰çš„é—®é¢˜, éœ€è¦ç»“åˆå…¶å®ƒçš„åº“, ä¾‹å¦‚ Redux,React-router ç­‰æ¥
ååŠ©æä¾›å®Œæ•´çš„è§£å†³æ–¹æ³•.

* å‰ç«¯ç»„ä»¶åŒ–(ä¸€): ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­è®²èµ·
å¾ˆå¤šè¯¾ç¨‹ä¸€ä¸Šæ¥å°±ç»™å¤§å®¶å¦‚ä½•é…ç½®ç¯å¢ƒ, æ€ä¹ˆå†™ React.js ç»„ä»¶. ä½†æ˜¯æœ¬è¯¾ç¨‹è¿˜æ˜¯å¸Œæœ›å¤§å®¶å¯¹é—®é¢˜çš„æ ¹æºæœ‰ä¸€ä¸ªæ›´åŠ æ·±å…¥çš„äº†è§£, å…¶å®å¾ˆå¤šçš„åº“, æ¡†æ¶éƒ½æ˜¯è§£å†³ç±»ä¼¼çš„é—®é¢˜. åªæœ‰æˆ‘ä»¬å¯¹è¿™äº›åº“, æ¡†æ¶è§£å†³çš„é—®é¢˜æœ‰æ·±å…¥çš„äº†è§£å’Œæ€è€ƒä»¥å, æˆ‘ä»¬æ‰èƒ½å¾—å¿ƒåº”æ‰‹åœ°ä½¿ç”¨å®ƒä»¬, å¹¶ä¸”æœ‰æ–°çš„æ¡†æ¶å‡ºæ¥ä¹Ÿä¸ä¼šå¤ªè¿‡è¿·èŒ«â€”â€”â€”â€”å› ä¸ºå…¶å®å®ƒä»¬è§£å†³éƒ½æ˜¯åŒä¸€ä¸ªé—®é¢˜.

è¿™ä¸¤èŠ‚è¯¾æˆ‘ä»¬æ¥æ¢è®¨ä¸€ä¸‹æ˜¯ä»€ä¹ˆæ ·çš„é—®é¢˜å¯¼è‡´äº†æˆ‘ä»¬éœ€è¦å‰ç«¯é¡µé¢è¿›è¡Œç»„ä»¶åŒ–, å‰ç«¯é¡µé¢çš„ç»„ä»¶åŒ–éœ€è¦è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜. åç»­è¯¾ç¨‹æˆ‘ä»¬å†æ¥çœ‹çœ‹ React.js æ˜¯æ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜çš„.

æ‰€ä»¥è¿™å‡ èŠ‚æ‰€è®²çš„å†…å®¹å°†å’Œ React.js çš„å†…å®¹æ²¡æœ‰å¤ªå¤§çš„å…³ç³», ä½†æ˜¯å¦‚æœä½ èƒ½é¡ºåˆ©äº†è§£è¿™å‡ èŠ‚çš„å†…å®¹, é‚£ä¹ˆåé¢é‚£äº›å¯¹æ–°æ‰‹æ¥è¯´å¾ˆå¤æ‚çš„æ¦‚å¿µå¯¹ä½ æ¥è¯´å°±æ˜¯éå¸¸è‡ªç„¶çš„äº‹.

** ä¸€ä¸ªç®€å•çš„ç‚¹èµåŠŸèƒ½
 æˆ‘ä»¬ä¼šä»ä¸€ä¸ªç®€å•çš„ç‚¹èµåŠŸèƒ½è®²èµ·. å‡è®¾ç°åœ¨æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªç‚¹èµ, å–æ¶ˆç‚¹èµçš„åŠŸèƒ½.

 [[file:./static/React.js å°ä¹¦/B7575C67-64F8-4A13-9C63-4D6805FA360D.png][file:./static/React.js å°ä¹¦/B7575C67-64F8-4A13-9C63-4D6805FA360D.png]]

 å¦‚æœä½ å¯¹å‰ç«¯ç¨å¾®æœ‰ä¸€ç‚¹äº†è§£, ä½ å°±é¡ºæ‰‹æ‹ˆæ¥:

 #+BEGIN_SRC html
 <body>
     <div class='wrapper'>
         <button class='like-btn'>
             <span class='like-text'>ç‚¹èµ</span>
             <span>ğŸ‘</span>
         </button>
     </div>
 </body>
 #+END_SRC

 ä¸ºäº†æ¨¡æ‹Ÿç°å®å½“ä¸­çš„å®é™…æƒ…å†µ, æ‰€ä»¥è¿™é‡Œç‰¹æ„æŠŠè¿™ä¸ª button é‡Œé¢çš„ HTML ç»“æ„æå¾—ç¨å¾®å¤æ‚ä¸€äº›. æœ‰äº†è¿™ä¸ª HTML ç»“æ„, ç°åœ¨å°±ç»™å®ƒåŠ å…¥ä¸€äº› JavaScript çš„è¡Œä¸º:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const button = document.querySelector('.like-btn')
 const buttonText = button.querySelector('.like-text')
 let isLiked = false
 button.addEventListener('click', () => {
   isLiked = !isLiked
   if (isLiked) {
     buttonText.innerHTML = 'å–æ¶ˆ'
   } else {
     buttonText.innerHTML = 'ç‚¹èµ'
   }
 }, false)
 #+END_SRC

 åŠŸèƒ½å’Œå®ç°éƒ½å¾ˆç®€å•, æŒ‰é’®å·²ç»å¯ä»¥æä¾›ç‚¹èµå’Œå–æ¶ˆç‚¹èµçš„åŠŸèƒ½. è¿™æ—¶å€™ä½ çš„åŒäº‹è·‘è¿‡æ¥äº†, è¯´ä»–å¾ˆå–œæ¬¢ä½ çš„æŒ‰é’®, ä»–ä¹Ÿæƒ³ç”¨ä½ å†™çš„è¿™ä¸ªç‚¹èµåŠŸèƒ½. è¿™æ—¶å€™é—®é¢˜å°±æ¥äº†, ä½ å°±ä¼šå‘ç°è¿™ç§å®ç°æ–¹å¼å¾ˆè‡´å‘½: ä½ çš„åŒäº‹è¦æŠŠæ•´ä¸ª button å’Œé‡Œé¢çš„ç»“æ„å¤åˆ¶è¿‡å», è¿˜æœ‰æ•´æ®µ JavaScript ä»£ç ä¹Ÿè¦å¤åˆ¶è¿‡å». è¿™æ ·çš„å®ç°æ–¹å¼æ²¡æœ‰ä»»ä½•å¯å¤ç”¨æ€§.

** ç»“æ„å¤ç”¨
 ç°åœ¨æˆ‘ä»¬æ¥é‡æ–°ç¼–å†™è¿™ä¸ªç‚¹èµåŠŸèƒ½, è®©å®ƒå…·å¤‡ä¸€å®šçš„å¯å¤ç”¨. è¿™æ¬¡æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç±», è¿™ä¸ªç±»æœ‰ render æ–¹æ³•, è¿™ä¸ªæ–¹æ³•é‡Œé¢ç›´æ¥è¿”å›ä¸€ä¸ªè¡¨ç¤º HTML ç»“æ„çš„å­—ç¬¦ä¸²:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class LikeButton {
   render () {
     return `
           <button id='like-btn'>
               <span class='like-text'>èµ</span>
               <span>ğŸ‘</span>
           </button>
       `
   }
 }
 #+END_SRC

 ç„¶åå¯ä»¥ç”¨è¿™ä¸ªç±»æ¥æ„å»ºä¸åŒçš„ç‚¹èµåŠŸèƒ½çš„å®ä¾‹, ç„¶åæŠŠå®ƒä»¬æ’åˆ°é¡µé¢ä¸­.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const wrapper = document.querySelector('.wrapper')
 const likeButton1 = new LikeButton()
 wrapper.innerHTML = likeButton1.render()

 const likeButton2 = new LikeButton()
 wrapper.innerHTML += likeButton2.render()
 #+END_SRC

 è¿™é‡Œéå¸¸æš´åŠ›åœ°ä½¿ç”¨äº† innerHTML , æŠŠä¸¤ä¸ªæŒ‰é’®ç²—é²åœ°æ’å…¥äº† wrapper å½“ä¸­. è™½ç„¶ä½ å¯èƒ½ä¼šå¯¹è¿™ç§å®ç°æ–¹å¼éå¸¸ä¸æ»¡æ„, ä½†æˆ‘ä»¬è¿˜æ˜¯å‹‰å¼ºäº†å®ç°äº†ç»“æ„çš„å¤ç”¨. æˆ‘ä»¬åé¢å†æ¥ä¼˜åŒ–å®ƒ.

** å®ç°ç®€å•çš„ç»„ä»¶åŒ–
 ä½ ä¸€å®šä¼šå‘ç°, ç°åœ¨çš„æŒ‰é’®æ˜¯æ­»çš„, ä½ ç‚¹å‡»å®ƒå®ƒæ ¹æœ¬ä¸ä¼šæœ‰ä»€ä¹ˆååº”. å› ä¸ºæ ¹æœ¬æ²¡æœ‰å¾€ä¸Šé¢æ·»åŠ äº‹ä»¶. ä½†æ˜¯é—®é¢˜æ¥äº†, LikeButton ç±»é‡Œé¢æ˜¯è™½ç„¶è¯´æœ‰ä¸€ä¸ª button, ä½†æ˜¯è¿™ç©æ„æ ¹æœ¬å°±æ˜¯åœ¨å­—ç¬¦ä¸²é‡Œé¢çš„. ä½ æ€ä¹ˆèƒ½å¾€ä¸€ä¸ªå­—ç¬¦ä¸²é‡Œé¢æ·»åŠ äº‹ä»¶å‘¢?DOM äº‹ä»¶çš„ API åªæœ‰ DOM ç»“æ„æ‰èƒ½ç”¨.

 æˆ‘ä»¬éœ€è¦ DOM ç»“æ„, å‡†ç¡®åœ°æ¥è¯´: æˆ‘ä»¬éœ€è¦è¿™ä¸ªç‚¹èµåŠŸèƒ½çš„ HTML å­—ç¬¦ä¸²è¡¨ç¤ºçš„ DOM ç»“æ„. å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå‡½æ•° createDOMFromString, ä½ å¾€è¿™ä¸ªå‡½æ•°ä¼ å…¥ HTML å­—ç¬¦ä¸², ä½†æ˜¯å®ƒä¼šæŠŠç›¸åº”çš„ DOM å…ƒç´ è¿”å›ç»™ä½ . è¿™ä¸ªé—®é¢˜å°±å¯ä»¥è§£å†³äº†.

 #+CAPTION: createDOMFromString
 #+BEGIN_SRC javascript :results values list :exports no-eval
 // ::String => ::Document
 const createDOMFromString = (domString) => {
   const div = document.createElement('div')
   div.innerHTML = domString
   return div
 }
 #+END_SRC
 <<createDOMFromString>>

 å…ˆä¸ç”¨ç®¡è¿™ä¸ªå‡½æ•°åº”è¯¥æ€ä¹ˆå®ç°, å…ˆçŸ¥é“å®ƒæ˜¯å¹²å˜›çš„. æ‹¿æ¥ç”¨å°±å¥½, è¿™æ—¶å€™ç”¨å®ƒæ¥æ”¹å†™ä¸€ä¸‹ LikeButton ç±»:

 #+CAPTION: render
 #+BEGIN_SRC javascript :results values list :exports no-eval
 class LikeButton {
   render () {
     this.el = createDOMFromString(`
         <button class='like-button'>
             <span class='like-text'>ç‚¹èµ</span>
             <span>ğŸ‘</span>
         </button>
         `)
     this.el.addEventListener('click', () => console.log('click'), false)
     return this.el
   }
 }
 #+END_SRC
 <<render>>

 ç°åœ¨ render() è¿”å›çš„ä¸æ˜¯ä¸€ä¸ª html å­—ç¬¦ä¸²äº†, è€Œæ˜¯ä¸€ä¸ªç”±è¿™ä¸ª html å­—ç¬¦ä¸²æ‰€ç”Ÿæˆçš„ DOM. åœ¨è¿”å› DOM å…ƒç´ ä¹‹å‰ä¼šå…ˆç»™è¿™ä¸ª DOM å…ƒç´ ä¸Šæ·»åŠ äº‹ä»¶å†è¿”å›.

 å› ä¸ºç°åœ¨ render è¿”å›çš„æ˜¯ DOM å…ƒç´ , æ‰€ä»¥ä¸èƒ½ç”¨ innerHTML æš´åŠ›åœ°æ’å…¥ wrapper.
 è€Œæ˜¯è¦ç”¨ DOM API æ’è¿›å».

 #+CAPTION: DOM API
 #+BEGIN_SRC javascript :results values list :exports no-eval
 const wrapper = document.querySelector('.wrapper')

 const likeButton1 = new LikeButton()
 wrapper.appendChild(likeButton1.render())

 const likeButton2 = new LikeButton()
 wrapper.appendChild(likeButton2.render())
 #+END_SRC
 <<DOM API>>

 ç°åœ¨ä½ ç‚¹å‡»è¿™ä¸¤ä¸ªæŒ‰é’®, æ¯ä¸ªæŒ‰é’®éƒ½ä¼šåœ¨æ§åˆ¶å°æ‰“å° click, è¯´æ˜äº‹ä»¶ç»‘å®šæˆåŠŸäº†.
 ä½†æ˜¯æŒ‰é’®ä¸Šçš„æ–‡æœ¬è¿˜æ˜¯æ²¡æœ‰å‘ç”Ÿæ”¹å˜, åªè¦ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹ LikeButton çš„ä»£ç å°±å¯ä»¥å®Œæˆå®Œæ•´çš„åŠŸèƒ½:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class LikeButton {
   constructor () {
     this.state = { isLiked: false }
   }

   changeLikeText () {
     const likeText = this.el.querySelector('.like-text')
     this.state.isLiked = !this.state.isLiked
     likeText.innerHTML = this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'
   }

   render () {
     this.el = createDOMFromString(`
         <button class='like-button'>
           <span class='like-text'>ç‚¹èµ</span>
           <span>ğŸ‘</span>
         </button>
         `)
     this.el.addEventListener('click', this.changeLikeText.bind(this), false)
     return this.el
   }
 }
 #+END_SRC

 è¿™é‡Œçš„ä»£ç ç¨å¾®é•¿äº†ä¸€äº›, ä½†æ˜¯è¿˜æ˜¯å¾ˆå¥½ç†è§£.
 åªä¸è¿‡æ˜¯åœ¨ç»™ LikeButton ç±»æ·»åŠ äº†æ„é€ å‡½æ•°, è¿™ä¸ªæ„é€ å‡½æ•°ä¼šç»™æ¯ä¸€ä¸ª LikeButton çš„å®ä¾‹æ·»åŠ ä¸€ä¸ªå¯¹è±¡ state,state é‡Œé¢ä¿å­˜äº†æ¯ä¸ªæŒ‰é’®è‡ªå·±æ˜¯å¦ç‚¹èµçš„çŠ¶æ€.
 è¿˜æ”¹å†™äº†åŸæ¥çš„äº‹ä»¶ç»‘å®šå‡½æ•°: åŸæ¥åªæ‰“å° click, ç°åœ¨ç‚¹å‡»çš„æŒ‰é’®çš„æ—¶å€™ä¼šè°ƒç”¨ changeLikeText æ–¹æ³•, è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ® this.state çš„çŠ¶æ€æ”¹å˜ç‚¹èµæŒ‰é’®çš„æ–‡æœ¬.

 ç°åœ¨è¿™ä¸ªç»„ä»¶çš„å¯å¤ç”¨æ€§å·²ç»å¾ˆä¸é”™äº†, ä½ çš„åŒäº‹ä»¬åªè¦å®ä¾‹åŒ–ä¸€ä¸‹ç„¶åæ’å…¥åˆ° DOM é‡Œé¢å»å°±å¥½äº†.

 ä¸‹ä¸€èŠ‚æˆ‘ä»¬ç»§ç»­ä¼˜åŒ–è¿™ä¸ªä¾‹å­, è®©å®ƒæ›´åŠ é€šç”¨.

* å‰ç«¯ç»„ä»¶åŒ–(äºŒ): ä¼˜åŒ– DOM æ“ä½œ
çœ‹çœ‹ä¸Šä¸€èŠ‚æˆ‘ä»¬çš„ä»£ç , ä»”ç»†ç•™æ„ä¸€ä¸‹ changeLikeText å‡½æ•°, è¿™ä¸ªå‡½æ•°åŒ…å«äº† DOM æ“ä½œ, ç°åœ¨çœ‹èµ·æ¥æ¯”è¾ƒç®€å•, é‚£æ˜¯å› ä¸ºç°åœ¨åªæœ‰ isLiked ä¸€ä¸ªçŠ¶æ€.
ç”±äºæ•°æ®çŠ¶æ€æ”¹å˜ä¼šå¯¼è‡´éœ€è¦æˆ‘ä»¬å»æ›´æ–°é¡µé¢çš„å†…å®¹, æ‰€ä»¥å‡æƒ³ä¸€ä¸‹, å¦‚æœä½ çš„ç»„ä»¶ä¾èµ–äº†å¾ˆå¤šçŠ¶æ€, é‚£ä¹ˆä½ çš„ç»„ä»¶åŸºæœ¬å…¨éƒ¨éƒ½æ˜¯ DOM æ“ä½œ.

ä¸€ä¸ªç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€ç”±å¤šä¸ªçŠ¶æ€å†³å®šçš„æƒ…å†µéå¸¸å¸¸è§.
ä»£ç ä¸­æ··æ‚ç€å¯¹ DOM çš„æ“ä½œå…¶å®æ˜¯ä¸€ç§ä¸å¥½çš„å®è·µ, æ‰‹åŠ¨ç®¡ç†æ•°æ®å’Œ DOM ä¹‹é—´çš„å…³ç³»ä¼šå¯¼è‡´ä»£ç å¯ç»´æŠ¤æ€§å˜å·®, å®¹æ˜“å‡ºé”™.
æ‰€ä»¥æˆ‘ä»¬çš„ä¾‹å­è¿™é‡Œè¿˜æœ‰ä¼˜åŒ–çš„ç©ºé—´: å¦‚ä½•å°½é‡å‡å°‘è¿™ç§æ‰‹åŠ¨ DOM æ“ä½œ?

** çŠ¶æ€æ”¹å˜ -> æ„å»ºæ–°çš„ DOM å…ƒç´ æ›´æ–°é¡µé¢
 è¿™é‡Œè¦æå‡ºçš„ä¸€ç§è§£å†³æ–¹æ¡ˆ: ä¸€æ—¦çŠ¶æ€å‘ç”Ÿæ”¹å˜, å°±é‡æ–°è°ƒç”¨ render æ–¹æ³•, æ„å»ºä¸€ä¸ªæ–°çš„ DOM å…ƒç´ .
 è¿™æ ·åšçš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢? å¥½å¤„å°±æ˜¯ä½ å¯ä»¥åœ¨ render æ–¹æ³•é‡Œé¢ä½¿ç”¨æœ€æ–°çš„ this.state æ¥æ„é€ ä¸åŒ HTML ç»“æ„çš„å­—ç¬¦ä¸², å¹¶ä¸”é€šè¿‡è¿™ä¸ªå­—ç¬¦ä¸²æ„é€ ä¸åŒçš„ DOM å…ƒç´ .
 é¡µé¢å°±æ›´æ–°äº†! å¬èµ·æ¥æœ‰ç‚¹ç»•, çœ‹çœ‹ä»£ç æ€ä¹ˆå†™, ä¿®æ”¹åŸæ¥çš„ä»£ç ä¸º:

 #+BEGIN_SRC javascript
 class LikeButton {
   constructor () {
     this.state = { isLiked: false }
   }

   setState (state) {
     this.state = state
     this.el = this.render()
   }

   changeLikeText () {
     this.setState({
       isLiked: !this.state.isLiked
     })
   }

   render () {
     this.el = createDOMFromString(`
         <button class='like-btn'>
             <span class='like-text'>${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}</span>
             <span>ğŸ‘</span>
         </button>
         `)
     this.el.addEventListener('click', this.changeLikeText.bind(this), false)
     return this.el
   }
 }
 #+END_SRC

 [[createDOMFromString][See: createDOMFromString]]

 å…¶å®åªæ˜¯æ”¹äº†å‡ ä¸ªå°åœ°æ–¹:
 render å‡½æ•°é‡Œé¢çš„ HTML å­—ç¬¦ä¸²ä¼šæ ¹æ® this.state ä¸åŒè€Œä¸åŒ(è¿™é‡Œæ˜¯ç”¨äº† ES6 çš„æ¨¡ç‰ˆå­—ç¬¦ä¸², åšè¿™ç§äº‹æƒ…å¾ˆæ–¹ä¾¿).
 æ–°å¢ä¸€ä¸ª setState å‡½æ•°, è¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°, å®ƒä¼šè®¾ç½®å®ä¾‹çš„ state, ç„¶åé‡æ–°è°ƒç”¨ä¸€ä¸‹ render æ–¹æ³•.
 å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™, changeLikeText ä¼šæ„å»ºæ–°çš„ state å¯¹è±¡, è¿™ä¸ªæ–°çš„ state, ä¼ å…¥ setState å‡½æ•°å½“ä¸­.
 è¿™æ ·çš„ç»“æœå°±æ˜¯, ç”¨æˆ·æ¯æ¬¡ç‚¹å‡», changeLikeText éƒ½ä¼šè°ƒç”¨æ”¹å˜ç»„ä»¶çŠ¶æ€ç„¶åè°ƒç”¨ setState,setState ä¼šè°ƒç”¨ render,
 render æ–¹æ³•ä¼šæ ¹æ® state çš„ä¸åŒé‡æ–°æ„å»ºä¸åŒçš„ DOM å…ƒç´ .

 ä¹Ÿå°±æ˜¯è¯´, ä½ åªè¦è°ƒç”¨ setState, ç»„ä»¶å°±ä¼šé‡æ–°æ¸²æŸ“. æˆ‘ä»¬é¡ºåˆ©åœ°æ¶ˆé™¤äº†æ‰‹åŠ¨çš„ DOM æ“ä½œ.

** é‡æ–°æ’å…¥æ–°çš„ DOM å…ƒç´ 
 ä¸Šé¢çš„æ”¹è¿›ä¸ä¼šæœ‰ä»€ä¹ˆæ•ˆæœ, å› ä¸ºä½ ä»”ç»†çœ‹ä¸€ä¸‹å°±ä¼šå‘ç°, å…¶å®é‡æ–°æ¸²æŸ“çš„ DOM å…ƒç´ å¹¶æ²¡æœ‰æ’å…¥åˆ°é¡µé¢å½“ä¸­.
 æ‰€ä»¥åœ¨è¿™ä¸ªç»„ä»¶å¤–é¢, ä½ éœ€è¦çŸ¥é“è¿™ä¸ªç»„ä»¶å‘ç”Ÿäº†æ”¹å˜, å¹¶ä¸”æŠŠæ–°çš„ DOM å…ƒç´ æ›´æ–°åˆ°é¡µé¢å½“ä¸­.

 é‡æ–°ä¿®æ”¹ä¸€ä¸‹ setState æ–¹æ³•:

 #+CAPTION: setState
 #+BEGIN_SRC javascript
 ...
 setState (state) {
   const oldEl = this.el
   this.state = state
   this.el = this.render()
   if (this.onStateChange) this.onStateChange(oldEl, this.el)
 }
 ...
 #+END_SRC
 <<setState>>

 ä½¿ç”¨è¿™ä¸ªç»„ä»¶çš„æ—¶å€™:

 #+BEGIN_SRC javascript
 const likeButton = new LikeButton()
 wrapper.appendChild(likeButton.render()) // ç¬¬ä¸€æ¬¡æ’å…¥ DOM å…ƒç´ 
 likeButton.onStateChange = (oldEl, newEl) => {
   wrapper.insertBefore(newEl, oldEl) // æ’å…¥æ–°çš„å…ƒç´ 
   wrapper.removeChild(oldEl) // åˆ é™¤æ—§çš„å…ƒç´ 
 }
 #+END_SRC
 <<onStateChange>>

 è¿™é‡Œæ¯æ¬¡ setState éƒ½ä¼šè°ƒç”¨ onStateChange æ–¹æ³•, è€Œè¿™ä¸ªæ–¹æ³•æ˜¯å®ä¾‹åŒ–ä»¥åæ—¶å€™è¢«è®¾ç½®çš„, æ‰€ä»¥ä½ å¯ä»¥è‡ªå®šä¹‰ onStateChange çš„è¡Œä¸º.
 è¿™é‡Œåšçš„äº‹æ˜¯, æ¯å½“ setState ä¸­æ„é€ å®Œæ–°çš„ DOM å…ƒç´ ä»¥å, å°±ä¼šé€šè¿‡ onStateChange å‘ŠçŸ¥å¤–éƒ¨æ’å…¥æ–°çš„ DOM å…ƒç´ , ç„¶ååˆ é™¤æ—§çš„å…ƒç´ , é¡µé¢å°±æ›´æ–°äº†.
 è¿™é‡Œå·²ç»åšåˆ°äº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–äº†: ç°åœ¨ä¸éœ€è¦å†æ‰‹åŠ¨æ›´æ–°é¡µé¢äº†.

 éä¸€èˆ¬çš„æš´åŠ›, å› ä¸ºæ¯æ¬¡ setState éƒ½é‡æ–°æ„é€ , æ–°å¢, åˆ é™¤ DOM å…ƒç´ , ä¼šå¯¼è‡´æµè§ˆå™¨è¿›è¡Œå¤§é‡çš„é‡æ’, ä¸¥é‡å½±å“æ€§èƒ½.
 ä¸è¿‡æ²¡æœ‰å…³ç³», è¿™ç§æš´åŠ›è¡Œä¸ºå¯ä»¥è¢«ä¸€ç§å« Virtual-DOM çš„ç­–ç•¥è§„é¿æ‰, ä½†è¿™ä¸æ˜¯æœ¬æ–‡æ‰€è®¨è®ºçš„èŒƒå›´.

 è¿™ä¸ªç‰ˆæœ¬çš„ç‚¹èµåŠŸèƒ½å¾ˆä¸é”™, æˆ‘å¯ä»¥ç»§ç»­å¾€ä¸Šé¢åŠ åŠŸèƒ½, è€Œä¸”è¿˜ä¸éœ€è¦æ‰‹åŠ¨æ“ä½œ DOM.
 ä½†æ˜¯æœ‰ä¸€ä¸ªä¸å¥½çš„åœ°æ–¹, å¦‚æœæˆ‘è¦é‡æ–°å¦å¤–åšä¸€ä¸ªæ–°ç»„ä»¶, è­¬å¦‚è¯´è¯„è®ºç»„ä»¶, é‚£ä¹ˆé‡Œé¢çš„è¿™äº› setState æ–¹æ³•è¦é‡æ–°å†™ä¸€é, å…¶å®è¿™äº›ä¸œè¥¿éƒ½å¯ä»¥æŠ½å‡ºæ¥, å˜æˆä¸€ä¸ªé€šç”¨çš„æ¨¡å¼.
 ä¸‹ä¸€èŠ‚æˆ‘ä»¬æŠŠè¿™ä¸ªé€šç”¨æ¨¡å¼æŠ½ç¦»åˆ°ä¸€ä¸ªç±»å½“ä¸­.

* å‰ç«¯ç»„ä»¶åŒ–(ä¸‰): æŠ½è±¡å‡ºå…¬å…±ç»„ä»¶ç±»
ä¸ºäº†è®©ä»£ç æ›´çµæ´», å¯ä»¥å†™æ›´å¤šçš„ç»„ä»¶, æˆ‘ä»¬æŠŠè¿™ç§æ¨¡å¼æŠ½è±¡å‡ºæ¥, æ”¾åˆ°ä¸€ä¸ª Component ç±»å½“ä¸­:

#+CAPTION: _renderDOM
#+BEGIN_SRC javascript :results values list :exports no-eval
class Component {
  setState (state) {
    const oldEl = this.el
    this.state = state
    this._renderDOM()
    if (this.onStateChange) this.onStateChange(oldEl, this.el)
  }

  _renderDOM () {
    this.el = createDOMFromString(this.render())
    if (this.onClick) {
      this.el.addEventListener('click', this.onClick.bind(this), false)
    }
    return this.el
  }
}
#+END_SRC
<<_renderDOM>>
[[createDOMFromString][
See: createDOMFromString]]

[[è¿”å›å­—ç¬¦ä¸²çš„ render æ–¹æ³•][See: è¿”å›å­—ç¬¦ä¸²çš„ render æ–¹æ³•]]

[[setState][See: setState]]

è¿™ä¸ªæ˜¯ä¸€ä¸ªç»„ä»¶çˆ¶ç±» Component, æ‰€æœ‰çš„ç»„ä»¶éƒ½å¯ä»¥ç»§æ‰¿è¿™ä¸ªçˆ¶ç±»æ¥æ„å»º.
å®ƒå®šä¹‰çš„ä¸¤ä¸ªæ–¹æ³•, ä¸€ä¸ªæ˜¯æˆ‘ä»¬å·²ç»å¾ˆç†Ÿæ‚‰çš„ setState, ä¸€ä¸ªæ˜¯ç§æœ‰æ–¹æ³• _renderDOM.
_renderDOM æ–¹æ³•ä¼šè°ƒç”¨ this.render æ¥æ„å»º DOM å…ƒç´ å¹¶ä¸”ç›‘å¬ onClick äº‹ä»¶.
æ‰€ä»¥, ç»„ä»¶å­ç±»ç»§æ‰¿çš„æ—¶å€™åªéœ€è¦å®ç°ä¸€ä¸ªè¿”å› HTML å­—ç¬¦ä¸²çš„ render æ–¹æ³•å°±å¯ä»¥äº†.

è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„ mount çš„æ–¹æ³•, å…¶å®å°±æ˜¯æŠŠç»„ä»¶çš„ DOM å…ƒç´ æ’å…¥é¡µé¢, å¹¶ä¸”åœ¨ setState çš„æ—¶å€™æ›´æ–°é¡µé¢:

#+CAPTION: mount
#+BEGIN_SRC javascript :results values list :exports no-eval
const mount = (component, wrapper) => {
  wrapper.appendChild(component._renderDOM())
  component.onStateChange = (oldEl, newEl) => {
    wrapper.insertBefore(newEl, oldEl)
    wrapper.removeChild(oldEl)
  }
}
#+END_SRC
<<mount>>

[[onStateChange][See: onStateChange]]

è¿™æ ·çš„è¯æˆ‘ä»¬é‡æ–°å†™ç‚¹èµç»„ä»¶å°±ä¼šå˜æˆ:

#+CAPTION: è¿”å›å­—ç¬¦ä¸²çš„ render æ–¹æ³•
#+BEGIN_SRC javascript :results values list :exports no-eval
class LikeButton extends Component {
  constructor () {
    super()
    this.state = { isLiked: false }
  }

  onClick () {
    this.setState({
      isLiked: !this.state.isLiked
    })
  }

  render () {
    return `
        <button class='like-btn'>
          <span class='like-text'>${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}</span>
          <span>ğŸ‘</span>
        </button>
      `
  }
}

mount(new LikeButton(), wrapper)
#+END_SRC
<<è¿”å›å­—ç¬¦ä¸²çš„ render æ–¹æ³•>>

[[_renderDOM][See: _renderDOM]]

è¿™æ ·è¿˜ä¸å¤Ÿå¥½. åœ¨å®é™…å¼€å‘å½“ä¸­, ä½ å¯èƒ½éœ€è¦ç»™ç»„ä»¶ä¼ å…¥ä¸€äº›è‡ªå®šä¹‰çš„é…ç½®æ•°æ®.
ä¾‹å¦‚è¯´æƒ³é…ç½®ä¸€ä¸‹ç‚¹èµæŒ‰é’®çš„èƒŒæ™¯é¢œè‰², å¦‚æœæˆ‘ç»™å®ƒä¼ å…¥ä¸€ä¸ªå‚æ•°, å‘Šè¯‰å®ƒæ€ä¹ˆè®¾ç½®è‡ªå·±çš„é¢œè‰².
é‚£ä¹ˆè¿™ä¸ªæŒ‰é’®çš„å®šåˆ¶æ€§å°±æ›´å¼ºäº†. æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™ç»„ä»¶ç±»å’Œå®ƒçš„å­ç±»éƒ½ä¼ å…¥ä¸€ä¸ªå‚æ•° props, ä½œä¸ºç»„ä»¶çš„é…ç½®å‚æ•°. ä¿®æ”¹ Component çš„æ„é€ å‡½æ•°ä¸º:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
    constructor (props = {}) {
        this.props = props
    }
...
#+END_SRC

ç»§æ‰¿çš„æ—¶å€™é€šè¿‡ super(props) æŠŠ props ä¼ ç»™çˆ¶ç±», è¿™æ ·å°±å¯ä»¥é€šè¿‡ this.props è·å–åˆ°é…ç½®å‚æ•°:

#+CAPTION: æ”¯æŒè¯»å– props å‚æ•°çš„ render æ–¹æ³•
#+BEGIN_SRC javascript :results values list :exports no-eval
class LikeButton extends Component {
  constructor (props) {
    super(props)
    this.state = { isLiked: false }
  }

  onClick () {
    this.setState({
      isLiked: !this.state.isLiked
    })
  }

  render () {
    return `
        <button class='like-btn' style="background-color: ${this.props.bgColor}">
          <span class='like-text'>
            ${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}
          </span>
          <span>ğŸ‘</span>
        </button>
      `
  }
}

mount(new LikeButton({ bgColor: 'red' }), wrapper)
#+END_SRC
<<æ”¯æŒè¯»å– props å‚æ•°çš„ render æ–¹æ³•>>

è¿™é‡Œæˆ‘ä»¬ç¨å¾®ä¿®æ”¹äº†ä¸€ä¸‹åŸæœ‰çš„ LikeButton çš„ render æ–¹æ³•, è®©å®ƒå¯ä»¥æ ¹æ®ä¼ å…¥çš„å‚æ•° this.props.bgColor æ¥ç”Ÿæˆä¸åŒçš„ style å±æ€§.
è¿™æ ·å°±å¯ä»¥è‡ªç”±é…ç½®ç»„ä»¶çš„é¢œè‰²äº†.

åªè¦æœ‰äº†ä¸Šé¢é‚£ä¸ª Component ç±»å’Œ mount [[mount][See: mount ]] æ–¹æ³•åŠ èµ·æ¥ä¸è¶³ 40 è¡Œä»£ç å°±å¯ä»¥åšåˆ°ç»„ä»¶åŒ–.
å¦‚æœæˆ‘ä»¬éœ€è¦å†™å¦å¤–ä¸€ä¸ªç»„ä»¶, åªéœ€è¦åƒä¸Šé¢é‚£æ ·, ç®€å•åœ°ç»§æ‰¿ä¸€ä¸‹ Component ç±»å°±å¥½äº†:

#+BEGIN_SRC javascript :results values list :exports no-eval
class RedBlueButton extends Component {
  constructor (props) {
    super(props)
    this.state = {
      color: 'red'
    }
  }

  onClick () {
    this.setState({
      color: 'blue'
    })
  }

  render () {
    return `
        <div style='color: ${this.state.color};'>${this.state.color}</div>
      `
  }
}
#+END_SRC

ç®€å•å¥½ç”¨, ç°åœ¨å¯ä»¥çµæ´»åœ°ç»„ä»¶åŒ–é¡µé¢äº†.Component å®Œæ•´çš„ä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°.

#+CAPTION: reactjs-in-40
#+BEGIN_SRC html
<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <title>Reactjs in 40 </title>
    <style media="screen">
      .like-btn { font-size: 50px; }
    </style>
  </head>

  <body>
    <div class='wrapper'></div>
  </body>

  <script type="text/javascript">
    /* Component */
    class Component {
      constructor (props = {}) {
        this.props = props
      }
      setState (state) {
        const oldEl = this.el
        this.state = state
        this.el = this.renderDOM()
        if (this.onStateChange) this.onStateChange(oldEl, this.el)
      }
      renderDOM () {
        this.el = createDOMFromString(this.render())
        if (this.onClick) {
          this.el.addEventListener('click', this.onClick.bind(this), false)
        }
        return this.el
      }
    }
    const createDOMFromString = (domString) => {
      const div = document.createElement('div')
      div.innerHTML = domString
      return div
    }
    const mount = (component, wrapper) => {
      wrapper.appendChild(component.renderDOM())
      component.onStateChange = (oldEl, newEl) => {
        wrapper.insertBefore(newEl, oldEl)
        wrapper.removeChild(oldEl)
      }
    }
    /* ========================================= */
    class LikeButton extends Component {
      constructor (props) {
        super(props)
        this.state = { isLiked: false }
      }
      onClick () {
        this.setState({
          isLiked: !this.state.isLiked
        })
      }
      render () {
        return `
          <button class='like-btn' style="background-color: ${this.props.bgColor}">
            <span class='like-text'>
              ${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}
            </span>
            <span>ğŸ‘</span>
          </button>
        `
      }
    }
    class RedBlueButton extends Component {
      constructor (props) {
        super(props)
        this.state = {
          color: 'red'
        }
      }
      onClick () {
        this.setState({
          color: 'blue'
        })
      }
      render () {
        return `
          <div style='color: ${this.state.color};'>${this.state.color}</div>
        `
      }
    }
    const wrapper = document.querySelector('.wrapper')
    mount(new LikeButton({ bgColor: 'red' }), wrapper)
    mount(new LikeButton(), wrapper)
    mount(new RedBlueButton(), wrapper)
  </script>
</html>
#+END_SRC
<<reactjs-in-40>>

** æ€»ç»“
 æˆ‘ä»¬ç”¨äº†å¾ˆé•¿çš„ç¯‡å¹…æ¥è®²ä¸€ä¸ªç®€å•çš„ç‚¹èµçš„ä¾‹å­, å¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹é‡Œé¢ä¸€ç›´åœ¨ä¼˜åŒ–ç¼–å†™çš„æ–¹å¼.
 æœ€åæŠ½ç¦»å‡ºæ¥äº†ä¸€ä¸ªç±», å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„åšç»„ä»¶åŒ–. åœ¨è¿™ä¸ªè¿‡ç¨‹é‡Œé¢æˆ‘ä»¬å­¦åˆ°äº†ä»€ä¹ˆ?

 ç»„ä»¶åŒ–å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³å‰ç«¯ç»“æ„çš„å¤ç”¨æ€§é—®é¢˜, æ•´ä¸ªé¡µé¢å¯ä»¥ç”±è¿™æ ·çš„ä¸åŒçš„ç»„ä»¶ç»„åˆ, åµŒå¥—æ„æˆ.

 ä¸€ä¸ªç»„ä»¶æœ‰è‡ªå·±çš„æ˜¾ç¤ºå½¢æ€(ä¸Šé¢çš„ HTML ç»“æ„å’Œå†…å®¹) è¡Œä¸º, ç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€å’Œè¡Œä¸ºå¯ä»¥ç”±æ•°æ®çŠ¶æ€ (state) å’Œé…ç½®å‚æ•° (props) å…±åŒå†³å®š.
 æ•°æ®çŠ¶æ€å’Œé…ç½®å‚æ•°çš„æ”¹å˜éƒ½ä¼šå½±å“åˆ°è¿™ä¸ªç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€.

 å½“æ•°æ®å˜åŒ–çš„æ—¶å€™, ç»„ä»¶çš„æ˜¾ç¤ºéœ€è¦æ›´æ–°. æ‰€ä»¥å¦‚æœç»„ä»¶åŒ–çš„æ¨¡å¼èƒ½æä¾›ä¸€ç§é«˜æ•ˆçš„æ–¹å¼è‡ªåŠ¨åŒ–åœ°å¸®åŠ©æˆ‘ä»¬æ›´æ–°é¡µé¢, é‚£ä¹Ÿå°±å¯ä»¥å¤§å¤§åœ°é™ä½æˆ‘ä»¬ä»£ç çš„å¤æ‚åº¦, å¸¦æ¥æ›´å¥½çš„å¯ç»´æŠ¤æ€§.

 å¥½äº†, è¯¾ç¨‹ç»“æŸäº†. ä½ å·²ç»å­¦ä¼šäº†æ€ä¹ˆä½¿ç”¨ React.js äº†, å› ä¸ºæˆ‘ä»¬å·²ç»å†™äº†ä¸€ä¸ªâ€”â€”å½“ç„¶æˆ‘æ˜¯åœ¨å¼€ç©ç¬‘, ä½†æ˜¯ä¸Šé¢è¿™ä¸ª Component ç±»å…¶å®å’Œ React çš„ Component ä½¿ç”¨æ–¹å¼å¾ˆç±»ä¼¼. æŒæ¡äº†è¿™å‡ èŠ‚çš„è¯¾ç¨‹, ä½ åŸºæœ¬å°±æŒæ¡äº†åŸºç¡€çš„ React.js çš„æ¦‚å¿µ.

 æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹æ­£å¼è¿›å…¥ä¸»é¢˜, å¼€å§‹æ­£å¼ä»‹ç» React.js. ä½ ä¼šå‘ç°, æœ‰äº†å‰é¢çš„é“ºå«, ä¸‹é¢è®²çš„å†…å®¹ç†è§£èµ·æ¥ä¼šç®€å•å¾ˆå¤šäº†.

* React.js åŸºæœ¬ç¯å¢ƒå®‰è£…
** å®‰è£… React.js
 React.js å•ç‹¬ä½¿ç”¨åŸºæœ¬ä¸Šæ˜¯ä¸å¯èƒ½çš„äº‹æƒ…. ä¸è¦æŒ‡æœ›ç€ç±»ä¼¼äº jQuery ä¸‹è½½æ”¾åˆ° <head/> æ ‡ç­¾å°±å¼€å§‹ä½¿ç”¨.
 ä½¿ç”¨ React.js ä¸ç®¡åœ¨å¼€å‘é˜¶æ®µç”Ÿäº§é˜¶æ®µéƒ½éœ€è¦ä¸€å †å·¥å…·å’Œåº“è¾…åŠ©, ç¼–è¯‘é˜¶æ®µä½ éœ€è¦å€ŸåŠ© Babel, éœ€è¦ Redux ç­‰ç¬¬ä¸‰æ–¹çš„çŠ¶æ€ç®¡ç†å·¥å…·æ¥ç»„ç»‡ä»£ç , å¦‚æœä½ è¦å†™å•é¡µé¢åº”ç”¨é‚£ä¹ˆä½ éœ€è¦ React-router. è¿™å°±æ˜¯æ‰€è°“çš„"React.js å…¨å®¶æ¡¶".

 æœ¬è¯¾ç¨‹ä¸ä¼šæ•™å¤§å®¶å¦‚ä½•é…ç½®è¿™äº›ä¸œè¥¿, å› ä¸ºè¿™ä¸æ˜¯è¯¾ç¨‹çš„é‡ç‚¹, ç½‘ä¸Šæœ‰å¾ˆå¤šçš„èµ„æ–™, å¤§å®¶å¯ä»¥å»å‚è€ƒé‚£äº›èµ„æ–™.
 æˆ‘ä»¬è¿™é‡Œä¼šç›´æ¥ä½¿ç”¨ React.js å®˜ç½‘æ‰€æ¨èä½¿ç”¨çš„å·¥å…· create-react-app å·¥å…·.
 å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¸€é”®ç”Ÿæˆæ‰€éœ€è¦çš„å·¥ç¨‹ç›®å½•, å¹¶å¸®æˆ‘ä»¬åšå¥½å„ç§é…ç½®å’Œä¾èµ–, ä¹Ÿå¸®æˆ‘ä»¬éšè—äº†è¿™äº›é…ç½®çš„ç»†èŠ‚. ä¹Ÿå°±æ˜¯æ‰€è°“çš„" å¼€ç®±å³ç”¨".

 å·¥å…·åœ°å€:https://github.com/facebookincubator/create-react-app

 [[file:./static/React.js å°ä¹¦/C9754D1A-0989-49B2-AC9F-B8D9717198CB.png]]

 åœ¨å®‰è£…ä¹‹å‰è¦ç¡®è®¤ä½ çš„æœºå™¨ä¸Šå®‰è£…äº† node.js ç¯å¢ƒåŒ…æ‹¬ npm. å¦‚æœæ²¡æœ‰å®‰è£…çš„åŒå­¦å¯ä»¥åˆ° node.js çš„å®˜ç½‘ä¸‹è½½è‡ªå·±ç”µè„‘çš„å¯¹åº”çš„å®‰è£…åŒ…æ¥å®‰è£…å¥½ç¯å¢ƒ.

 å®‰è£…å¥½ç¯å¢ƒä»¥å, åªéœ€è¦æŒ‰ç…§å®˜ç½‘çš„æŒ‡å¼•å®‰è£… create-react-app å³å¯.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 npm install -g create-react-app
 #+END_SRC

 è¿™æ¡å‘½ä»¤ä¼šå¾€æˆ‘ä»¬çš„æœºå™¨ä¸Šå®‰è£…ä¸€æ¡å« create-react-app çš„å‘½ä»¤, å®‰è£…å¥½ä»¥åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒæ¥æ„å»ºä¸€ä¸ª react çš„å‰ç«¯å·¥ç¨‹:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 create-react-app hello-react
 #+END_SRC

 è¿™æ¡å‘½ä»¤ä¼šå¸®æˆ‘ä»¬æ„å»ºä¸€ä¸ªå« hello-react çš„å·¥ç¨‹, å¹¶ä¸”ä¼šè‡ªåŠ¨åœ°å¸®åŠ©æˆ‘ä»¬å®‰è£…æ‰€éœ€è¦çš„ä¾èµ–, ç°åœ¨åªéœ€è¦å®‰é™åœ°ç­‰å¾…å®ƒå®‰è£…å®Œ.

 #+BEGIN_QUOTE
 é¢å¤–çš„å°è´´å£«:

 å¦‚æœæœ‰äº›åŒå­¦å®‰è£…è¿‡ç¨‹æ¯”è¾ƒæ…¢, é‚£æ˜¯å¾ˆæœ‰å¯èƒ½æ˜¯å› ä¸º npm ä¸‹è½½çš„æ—¶å€™æ˜¯ä»å›½å¤–çš„æºä¸‹è½½çš„ç¼˜æ•….
 æ‰€ä»¥å¯ä»¥æŠŠ npm çš„æºæ”¹æˆå›½å†…çš„ taobao çš„æº, è¿™æ ·ä¼šåŠ é€Ÿä¸‹è½½è¿‡ç¨‹. åœ¨æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ä¹‹å‰å¯ä»¥å…ˆä¿®æ”¹ä¸€ä¸‹ npm çš„æº:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 npm config set registry https://registry.npm.taobao.org
 #+END_SRC

 #+END_QUOTE

 ä¸‹è½½å®Œä»¥åæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨å·¥ç¨‹äº†, è¿›å…¥å·¥ç¨‹ç›®å½•ç„¶åé€šè¿‡ npm å¯åŠ¨å·¥ç¨‹:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 cd hello-react
 npm start
 #+END_SRC

 ç»ˆç«¯æç¤ºæˆåŠŸ:

 [[file:./static/React.js å°ä¹¦/C9754D1A-0989-49B2-AC9F-B8D9717198CB.png]]

 å¹¶ä¸”ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨, å°±å¯ä»¥çœ‹åˆ° React çš„å·¥ç¨‹é¡ºåˆ©è¿è¡Œçš„æ•ˆæœ:

 [[file:./static/React.js å°ä¹¦/React_App.png]]

 è¿™æ—¶å€™æˆ‘ä»¬æŠŠ src/App.js æ–‡ä»¶ä¸­çš„ <h2> æ ‡ç­¾çš„å†…å®¹ä¿®æ”¹ä¸º Hello React,

 #+BEGIN_SRC javascript :results values list :exports no-eval
     <h2>Hello React</h2>
 #+END_SRC

 ä¿å­˜ä¸€ä¸‹, ç„¶åæˆ·å°±ä¼šå‘ç°æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°, å¹¶ä¸”æˆ‘ä»¬çš„ä¿®æ”¹ä¹Ÿç”Ÿæ•ˆäº†:

 [[file:./static/React.js å°ä¹¦/3FDC1B75-AACD-40A4-9101-1AF8C57EFBF4.png]]

 åˆ°è¿™é‡Œæˆ‘ä»¬çš„ç¯å¢ƒå·²ç»å®‰è£…å¥½äº†, å¹¶ä¸”é¡ºåˆ©åœ°è¿è¡Œäº†æˆ‘ä»¬ç¬¬ä¸€ä¸ªä¾‹å­. æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šæ¢è®¨ React.js çš„ç»„ä»¶çš„åŸºæœ¬å†™æ³•.

* ä½¿ç”¨ JSX æè¿° UI ä¿¡æ¯
è¿™ä¸€èŠ‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­è®²è§£ React.js æè¿°é¡µé¢ UI çš„æ–¹å¼. æŠŠ src/index.js ä¸­çš„ä»£ç æ”¹æˆ:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import ReactDOM from 'react-dom'
import './index.css'

class Header extends Component {
  render () {
    return (
      <div>
        <h1>React å°ä¹¦</h1>
      </div>
    )
  }
}

ReactDOM.render(
  <Header />,
  document.getElementById('root')
)
#+END_SRC

æˆ‘ä»¬åœ¨æ–‡ä»¶å¤´éƒ¨ä» react çš„åŒ…å½“ä¸­å¼•å…¥äº† React å’Œ React.js çš„ç»„ä»¶çˆ¶ç±» Component. è®°ä½, åªè¦ä½ è¦å†™ React.js ç»„ä»¶, é‚£ä¹ˆå°±å¿…é¡»è¦å¼•å…¥è¿™ä¸¤ä¸ªä¸œè¥¿.

ReactDOM å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠ React ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šå», æ²¡æœ‰å…¶å®ƒçš„ä½œç”¨äº†.
ä½ å¯ä»¥å‘ç°å®ƒæ˜¯ä» react-dom ä¸­å¼•å…¥çš„, è€Œä¸æ˜¯ä» react å¼•å…¥. æœ‰äº›æœ‹å‹å¯èƒ½ä¼šç–‘æƒ‘, ä¸ºä»€ä¹ˆä¸æŠŠè¿™äº›ä¸œè¥¿éƒ½åŒ…å«åœ¨ react åŒ…å½“ä¸­å‘¢? æˆ‘ä»¬ç¨åä¼šå›ç­”è¿™ä¸ªé—®é¢˜.

æ¥ä¸‹æ¥çš„ä»£ç ä½ çœ‹èµ·æ¥ä¼šæ¯”è¾ƒç†Ÿæ‚‰, ä½†åˆä¼šæœ‰ç‚¹é™Œç”Ÿ.
ä½ çœ‹å…¶å®å®ƒè·Ÿæˆ‘ä»¬å‰å‡ èŠ‚é‡Œé¢è®²çš„å†…å®¹å…¶å®å¾ˆç±»ä¼¼, ä¸€ä¸ªç»„ä»¶ç»§æ‰¿ Component ç±», æœ‰ä¸€ä¸ª render([[render][See: render]]) æ–¹æ³•, å¹¶ä¸”æŠŠè¿™ä¸ªç»„ä»¶çš„ HTML ç»“æ„è¿”å›,
è¿™é‡Œ return çš„ä¸œè¥¿å°±æ¯”è¾ƒå¥‡æ€ªäº†, å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸², çœ‹èµ·æ¥åƒæ˜¯çº¯ HTML ä»£ç å†™åœ¨ JavaScript ä»£ç é‡Œé¢.
ä½ ä¹Ÿè®¸ä¼šè¯´, è¿™ä¸å°±æœ‰è¯­æ³•é”™è¯¯äº†ä¹ˆ? è¿™å®Œå…¨ä¸æ˜¯åˆæ³•çš„ JavaScript ä»£ç . è¿™ç§çœ‹èµ·æ¥" åœ¨ JavaScript å†™çš„æ ‡ç­¾çš„" è¯­æ³•å« JSX.

** JSX åŸç†
 ä¸ºäº†è®©å¤§å®¶æ·±åˆ»ç†è§£ JSX çš„å«ä¹‰.
 æœ‰å¿…è¦ç®€å•ä»‹ç»äº†ä¸€ä¸‹ JSX ç¨å¾®åº•å±‚çš„è¿ä½œåŸç†, è¿™æ ·å¤§å®¶å¯ä»¥æ›´åŠ æ·±åˆ»ç†è§£ JSX åˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿, ä¸ºä»€ä¹ˆè¦æœ‰è¿™ç§è¯­æ³•, å®ƒæ˜¯ç»è¿‡æ€ä¹ˆæ ·çš„è½¬åŒ–å˜æˆé¡µé¢çš„å…ƒç´ çš„.

 æ€è€ƒä¸€ä¸ªé—®é¢˜: å¦‚ä½•ç”¨ JavaScript å¯¹è±¡æ¥è¡¨ç°ä¸€ä¸ª DOM å…ƒç´ çš„ç»“æ„, ä¸¾ä¸ªä¾‹å­:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 <div class='box' id='content'>
 <div class='title'>Hello</div>
 <button>Click</button>
 </div>
 #+END_SRC

 æ¯ä¸ª DOM å…ƒç´ çš„ç»“æ„éƒ½å¯ä»¥ç”¨ JavaScript çš„å¯¹è±¡æ¥è¡¨ç¤º. ä½ ä¼šå‘ç°ä¸€ä¸ª DOM å…ƒç´ åŒ…å«çš„ä¿¡æ¯å…¶å®åªæœ‰ä¸‰ä¸ª: æ ‡ç­¾å, å±æ€§, å­å…ƒç´ .

 æ‰€ä»¥å…¶å®ä¸Šé¢è¿™ä¸ª HTML æ‰€æœ‰çš„ä¿¡æ¯æˆ‘ä»¬éƒ½å¯ä»¥ç”¨åˆæ³•çš„ JavaScript å¯¹è±¡æ¥è¡¨ç¤º:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 {
     tag: 'div',
     attrs: { className: 'box', id: 'content'},
     children: [
         {
             tag: 'div',
             arrts: { className: 'title' },
             children: ['Hello']
         },
         {
             tag: 'button',
             attrs: null,
             children: ['Click']
         }
     ]
 }
 #+END_SRC

 ä½ ä¼šå‘ç°,HTML çš„ä¿¡æ¯å’Œ JavaScript æ‰€åŒ…å«çš„ç»“æ„å’Œä¿¡æ¯å…¶å®æ˜¯ä¸€æ ·çš„, æˆ‘ä»¬å¯ä»¥ç”¨ JavaScript å¯¹è±¡æ¥æè¿°æ‰€æœ‰èƒ½ç”¨ HTML è¡¨ç¤ºçš„ UI ä¿¡æ¯.
 ä½†æ˜¯ç”¨ JavaScript å†™èµ·æ¥å¤ªé•¿äº†, ç»“æ„çœ‹èµ·æ¥åˆä¸æ¸…æ™°, ç”¨ HTML çš„æ–¹å¼å†™èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šäº†.

 äºæ˜¯ React.js å°±æŠŠ JavaScript çš„è¯­æ³•æ‰©å±•äº†ä¸€ä¸‹, è®© JavaScript è¯­è¨€èƒ½å¤Ÿæ”¯æŒè¿™ç§ç›´æ¥åœ¨ JavaScript ä»£ç é‡Œé¢ç¼–å†™ç±»ä¼¼ HTML æ ‡ç­¾ç»“æ„çš„è¯­æ³•, è¿™æ ·å†™èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šäº†.
 ç¼–è¯‘çš„è¿‡ç¨‹ä¼šæŠŠç±»ä¼¼ HTML çš„ JSX ç»“æ„è½¬æ¢æˆ JavaScript çš„å¯¹è±¡ç»“æ„.

 ä¸Šé¢çš„ä»£ç :

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'
 import ReactDOM from 'react-dom'
 import './index.css'

 class Header extends Component {
   render () {
     return (
       <div>
         <h1 className='title'>React å°ä¹¦</h1>
       </div>
     )
   }
 }

 ReactDOM.render(
   <Header />,
   document.getElementById('root')
 )
 #+END_SRC

 ç»è¿‡ç¼–è¯‘ä»¥åä¼šå˜æˆ:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'
 import ReactDOM from 'react-dom'
 import './index.css'

 class Header extends Component {
   render () {
     return (
       React.createElement(
         'div',
         null,
         React.createElement(
           'h1',
           { className: 'title' },
           'React å°ä¹¦'
         )
       )
     )
   }
 }

 ReactDOM.render(
   React.createElement(Header, null),
   document.getElementById('root')
 )
 #+END_SRC

 React.createElement ä¼šæ„å»ºä¸€ä¸ª JavaScript å¯¹è±¡æ¥æè¿°ä½  HTML ç»“æ„çš„ä¿¡æ¯, åŒ…æ‹¬æ ‡ç­¾å, å±æ€§, è¿˜æœ‰å­å…ƒç´ ç­‰.
 è¿™æ ·çš„ä»£ç å°±æ˜¯åˆæ³•çš„ JavaScript ä»£ç äº†. æ‰€ä»¥ä½¿ç”¨ React å’Œ JSX çš„æ—¶å€™ä¸€å®šè¦ç»è¿‡ç¼–è¯‘çš„è¿‡ç¨‹.

 è¿™é‡Œå†é‡å¤ä¸€é: æ‰€è°“çš„ JSX å…¶å®å°±æ˜¯ JavaScript å¯¹è±¡.
 æ¯å½“åœ¨ JavaScript ä»£ç ä¸­çœ‹åˆ°è¿™ç§ JSX ç»“æ„çš„æ—¶å€™, è„‘å­é‡Œé¢å°±å¯ä»¥è‡ªåŠ¨åšè½¬åŒ–, è¿™æ ·å¯¹ä½ ç†è§£ React.js çš„ç»„ä»¶å†™æ³•å¾ˆæœ‰å¥½å¤„.

 æœ‰äº†è¿™ä¸ªè¡¨ç¤º HTML ç»“æ„å’Œä¿¡æ¯çš„å¯¹è±¡ä»¥å, å°±å¯ä»¥æ‹¿å»æ„é€ çœŸæ­£çš„ DOM å…ƒç´ , ç„¶åæŠŠè¿™ä¸ª DOM å…ƒç´ å¡åˆ°é¡µé¢ä¸Š.
 è¿™ä¹Ÿæ˜¯æˆ‘ä»¬æœ€åä¸€æ®µä»£ç ä¸­ ReactDOM.render æ‰€å¹²çš„äº‹æƒ…:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ReactDOM.render(
   <Header />,
   document.getElementById('root')
 )
 #+END_SRC

 ReactDOM.render åŠŸèƒ½å°±æ˜¯æŠŠç»„ä»¶æ¸²æŸ“å¹¶ä¸”æ„é€  DOM æ ‘, ç„¶åæ’å…¥åˆ°é¡µé¢ä¸ŠæŸä¸ªç‰¹å®šçš„å…ƒç´ ä¸Š(åœ¨è¿™é‡Œæ˜¯ id ä¸º root çš„ div å…ƒç´ ).

 æ‰€ä»¥å¯ä»¥æ€»ç»“ä¸€ä¸‹ä» JSX åˆ°é¡µé¢åˆ°åº•ç»è¿‡äº†ä»€ä¹ˆæ ·çš„è¿‡ç¨‹:

 [[file:./static/React.js å°ä¹¦/44B5EC06-EAEB-4BA2-B3DC-325703E4BA45.png]]

 æœ‰äº›åŒå­¦å¯èƒ½ä¼šé—®, ä¸ºä»€ä¹ˆä¸ç›´æ¥ä» JSX ç›´æ¥æ¸²æŸ“æ„é€  DOM ç»“æ„, è€Œæ˜¯è¦ç»è¿‡ä¸­é—´è¿™ä¹ˆä¸€å±‚å‘¢?

 ç¬¬ä¸€ä¸ªåŸå› æ˜¯, å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªè¡¨ç¤º UI çš„ç»“æ„å’Œä¿¡æ¯çš„å¯¹è±¡ä»¥å, ä¸ä¸€å®šä¼šæŠŠå…ƒç´ æ¸²æŸ“åˆ°æµè§ˆå™¨çš„æ™®é€šé¡µé¢ä¸Š, æˆ‘ä»¬æœ‰å¯èƒ½æŠŠè¿™ä¸ªç»“æ„æ¸²æŸ“åˆ° canvas ä¸Š, æˆ–è€…æ˜¯æ‰‹æœº App ä¸Š.
 æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼šè¦æŠŠ react-dom å•ç‹¬æŠ½ç¦»å‡ºæ¥çš„åŸå› , å¯ä»¥æƒ³è±¡æœ‰ä¸€ä¸ªå« react-canvas å¯ä»¥å¸®æˆ‘ä»¬æŠŠ UI æ¸²æŸ“åˆ° canvas ä¸Š,
 æˆ–è€…æ˜¯æœ‰ä¸€ä¸ªå« react-app å¯ä»¥å¸®æˆ‘ä»¬æŠŠå®ƒè½¬æ¢æˆåŸç”Ÿçš„ App(å®é™…ä¸Šè¿™ç©æ„å« ReactNative).

 ç¬¬äºŒä¸ªåŸå› æ˜¯, æœ‰äº†è¿™æ ·ä¸€ä¸ªå¯¹è±¡. å½“æ•°æ®å˜åŒ–, éœ€è¦æ›´æ–°ç»„ä»¶çš„æ—¶å€™, å°±å¯ä»¥ç”¨æ¯”è¾ƒå¿«çš„ç®—æ³•æ“ä½œè¿™ä¸ª JavaScript å¯¹è±¡,
 è€Œä¸ç”¨ç›´æ¥æ“ä½œé¡µé¢ä¸Šçš„ DOM, è¿™æ ·å¯ä»¥å°½é‡å°‘çš„å‡å°‘æµè§ˆå™¨é‡æ’, æå¤§åœ°ä¼˜åŒ–æ€§èƒ½. è¿™ä¸ªåœ¨ä»¥åçš„ç« èŠ‚ä¸­æˆ‘ä»¬ä¼šæåˆ°.

** æ€»ç»“
 è¦è®°ä½å‡ ä¸ªç‚¹:

 - JSX æ˜¯ JavaScript è¯­è¨€çš„ä¸€ç§è¯­æ³•æ‰©å±•, é•¿å¾—åƒ HTML, ä½†å¹¶ä¸æ˜¯ HTML.
 - React.js å¯ä»¥ç”¨ JSX æ¥æè¿°ä½ çš„ç»„ä»¶é•¿ä»€ä¹ˆæ ·çš„.
 - JSX åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå˜æˆç›¸åº”çš„ JavaScript å¯¹è±¡æè¿°.
 - react-dom è´Ÿè´£æŠŠè¿™ä¸ªç”¨æ¥æè¿° UI ä¿¡æ¯çš„ JavaScript å¯¹è±¡å˜æˆ DOM å…ƒç´ , å¹¶ä¸”æ¸²æŸ“åˆ°é¡µé¢ä¸Š.

* ç»„ä»¶çš„ render æ–¹æ³•
React.js ä¸­ä¸€åˆ‡çš†ç»„ä»¶, ç”¨ React.js å†™çš„å…¶å®å°±æ˜¯ React.js ç»„ä»¶.
æˆ‘ä»¬åœ¨ç¼–å†™ React.js ç»„ä»¶çš„æ—¶å€™, ä¸€èˆ¬éƒ½éœ€è¦ç»§æ‰¿ React.js çš„ Component(è¿˜æœ‰åˆ«çš„ç¼–å†™ç»„ä»¶çš„æ–¹å¼æˆ‘ä»¬åç»­ä¼šæåˆ°).
ä¸€ä¸ªç»„ä»¶ç±»å¿…é¡»è¦å®ç°ä¸€ä¸ª render æ–¹æ³•, è¿™ä¸ª render æ–¹æ³•å¿…é¡»è¦è¿”å›ä¸€ä¸ª JSX å…ƒç´ .
ä½†è¿™é‡Œè¦æ³¨æ„çš„æ˜¯, å¿…é¡»è¦ç”¨ä¸€ä¸ªå¤–å±‚çš„ JSX å…ƒç´ æŠŠæ‰€æœ‰å†…å®¹åŒ…è£¹èµ·æ¥. è¿”å›å¹¶åˆ—å¤šä¸ª JSX å…ƒç´ æ˜¯ä¸åˆæ³•çš„, ä¸‹é¢æ˜¯é”™è¯¯çš„åšæ³•:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
    render () {
      return (
        <div>ç¬¬ä¸€ä¸ª</div>
        <div>ç¬¬äºŒä¸ª</div>
      )
    }
...
#+END_SRC

å¿…é¡»è¦ç”¨ä¸€ä¸ªå¤–å±‚å…ƒç´ æŠŠå†…å®¹è¿›è¡ŒåŒ…è£¹:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
    render () {
      return (
        <div>
          <div>ç¬¬ä¸€ä¸ª</div>
          <div>ç¬¬äºŒä¸ª</div>
        </div>
      )
    }
...
#+END_SRC

** è¡¨è¾¾å¼æ’å…¥
 åœ¨ JSX å½“ä¸­ä½ å¯ä»¥æ’å…¥ JavaScript çš„è¡¨è¾¾å¼, è¡¨è¾¾å¼è¿”å›çš„ç»“æœä¼šç›¸åº”åœ°æ¸²æŸ“åˆ°é¡µé¢ä¸Š. è¡¨è¾¾å¼ç”¨ {} åŒ…è£¹. ä¾‹å¦‚:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     render () {
       const word = 'is good'
       return (
         <div>
           <h1>React å°ä¹¦ {word}</h1>
        </div>
     )
     }
 ...
 #+END_SRC

 é¡µé¢ä¸Šå°±æ˜¾ç¤º"React å°ä¹¦ is good". ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒæ”¹æˆ {1 + 2}, å®ƒå°±ä¼šæ˜¾ç¤º "React å°ä¹¦ 3". ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒå†™æˆä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼è¿”å›:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     render () {
       return (
         <div>
           <h1>React å°ä¹¦ {(function () { return 'is good'})()}</h1>
         </div>
       )
     }
 ...
 #+END_SRC

 ç®€è€Œè¨€ä¹‹,{} å†…å¯ä»¥æ”¾ä»»ä½• JavaScript çš„ä»£ç , åŒ…æ‹¬å˜é‡, è¡¨è¾¾å¼è®¡ç®—, å‡½æ•°æ‰§è¡Œç­‰ç­‰. render ä¼šæŠŠè¿™äº›ä»£ç è¿”å›çš„å†…å®¹å¦‚å®åœ°æ¸²æŸ“åˆ°é¡µé¢ä¸Š, éå¸¸çš„çµæ´».

 /*è¡¨è¾¾å¼æ’å…¥ä¸ä»…ä»…å¯ä»¥ç”¨åœ¨æ ‡ç­¾å†…éƒ¨, ä¹Ÿå¯ä»¥ç”¨åœ¨æ ‡ç­¾çš„å±æ€§ä¸Š*/, ä¾‹å¦‚:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     render () {
       const className = 'header'
       return (
         <div className={className}>
           <h1>React å°ä¹¦</h1>
         </div>
       )
     }
 ...
 #+END_SRC

 è¿™æ ·å°±å¯ä»¥ä¸º div æ ‡ç­¾æ·»åŠ ä¸€ä¸ªå« header çš„ç±»å.

 æ³¨æ„, ç›´æ¥ä½¿ç”¨ class åœ¨ React.js çš„å…ƒç´ ä¸Šæ·»åŠ ç±»åå¦‚ <div class="xxx"> è¿™ç§æ–¹å¼æ˜¯ä¸åˆæ³•çš„.
 å› ä¸º class æ˜¯ JavaScript çš„å…³é”®å­—, æ‰€ä»¥ React.js ä¸­å®šä¹‰äº†ä¸€ç§æ–°çš„æ–¹å¼: className æ¥å¸®åŠ©æˆ‘ä»¬ç»™å…ƒç´ æ·»åŠ ç±»å.

 è¿˜æœ‰ä¸€ä¸ªç‰¹ä¾‹å°±æ˜¯ for å±æ€§, ä¾‹å¦‚ <label for='male'>Male</label>, å› ä¸º for ä¹Ÿæ˜¯ JavaScript çš„å…³é”®å­—, æ‰€ä»¥åœ¨ JSX ç”¨ /*htmlFor*/ æ›¿ä»£,
 å³ ~<label htmlFor='male'>Male</label>~. è€Œå…¶ä»–çš„ HTML å±æ€§ä¾‹å¦‚ style ,data-* ç­‰å°±å¯ä»¥åƒæ™®é€šçš„ HTML å±æ€§é‚£æ ·ç›´æ¥æ·»åŠ ä¸Šå».

** æ¡ä»¶è¿”å›
 {} ä¸Šé¢è¯´äº†,JSX å¯ä»¥æ”¾ç½®ä»»ä½•è¡¨è¾¾å¼å†…å®¹. æ‰€ä»¥ä¹Ÿå¯ä»¥æ”¾ JSX, å®é™…ä¸Š, æˆ‘ä»¬å¯ä»¥åœ¨ render å‡½æ•°å†…éƒ¨æ ¹æ®ä¸åŒæ¡ä»¶è¿”å›ä¸åŒçš„ JSX. ä¾‹å¦‚:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     render () {
       const isGoodWord = true
       return (
         <div>
           <h1>
             React å°ä¹¦
             {isGoodWord
              ? <strong> is good</strong>
              : <span> is not good</span>
             }
           </h1>
         </div>
       )
     }
 ...
 #+END_SRC

 ä¸Šé¢çš„ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ª isGoodWord å˜é‡ä¸º true, ä¸‹é¢æœ‰ä¸ªç”¨ {} åŒ…å«çš„è¡¨è¾¾å¼, æ ¹æ® isGoodWord çš„ä¸åŒè¿”å›ä¸åŒçš„ JSX å†…å®¹.
 ç°åœ¨é¡µé¢ä¸Šæ˜¯æ˜¾ç¤º React å°ä¹¦ is good. å¦‚æœä½ æŠŠ isGoodWord æ”¹æˆ false ç„¶åå†çœ‹é¡µé¢ä¸Šå°±ä¼šæ˜¾ç¤º React å°ä¹¦ is not good.

 å¦‚æœä½ åœ¨è¡¨è¾¾å¼æ’å…¥é‡Œé¢è¿”å› null , é‚£ä¹ˆ React.js ä¼šä»€ä¹ˆéƒ½ä¸æ˜¾ç¤º, ç›¸å½“äºå¿½ç•¥äº†è¯¥è¡¨è¾¾å¼æ’å…¥. ç»“åˆæ¡ä»¶è¿”å›çš„è¯, æˆ‘ä»¬å°±åšåˆ°æ˜¾ç¤ºæˆ–è€…éšè—æŸäº›å…ƒç´ :

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     render () {
       const isGoodWord = true
         return (
           <div>
             <h1>
               React å°ä¹¦
               {isGoodWord
                ? <strong> is good</strong>
                : null
               }
             </h1>
           </div>
         )
     }
 ...
 #+END_SRC

 è¿™æ ·å°±ç›¸å½“äºåœ¨ isGoodWord ä¸º true çš„æ—¶å€™æ˜¾ç¤º <strong>is good</strong>, å¦åˆ™å°±éšè—.

 æ¡ä»¶è¿”å› JSX çš„æ–¹å¼åœ¨ React.js ä¸­å¾ˆå¸¸è§, ç»„ä»¶çš„å‘ˆç°æ–¹å¼éšç€æ•°æ®çš„å˜åŒ–è€Œä¸ä¸€æ ·, ä½ å¯ä»¥åˆ©ç”¨ JSX è¿™ç§çµæ´»çš„æ–¹å¼éšæ—¶ç»„åˆæ„å»ºä¸åŒçš„é¡µé¢ç»“æ„.

 å¦‚æœè¿™é‡Œæœ‰äº›åŒå­¦è§‰å¾—æ¯”è¾ƒéš¾ç†è§£çš„è¯, å¯ä»¥å›æƒ³ä¸€ä¸‹, å…¶å® JSX å°±æ˜¯ JavaScript é‡Œé¢çš„å¯¹è±¡,
 è½¬æ¢ä¸€ä¸‹è§’åº¦, æŠŠä¸Šé¢çš„å†…å®¹ç¿»è¯‘æˆ JavaScript å¯¹è±¡çš„å½¢å¼, ä¸Šé¢çš„ä»£ç å°±å¾ˆå¥½ç†è§£äº†.

** JSX å…ƒç´ å˜é‡
 åŒæ ·çš„, å¦‚æœä½ èƒ½ç†è§£ JSX å…ƒç´ å°±æ˜¯ JavaScript å¯¹è±¡. é‚£ä¹ˆä½ å°±å¯ä»¥è”æƒ³åˆ°,
 /*JSX å…ƒç´ å…¶å®å¯ä»¥åƒ JavaScript å¯¹è±¡é‚£æ ·è‡ªç”±åœ°èµ‹å€¼ç»™å˜é‡, æˆ–è€…ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’, æˆ–è€…ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼*/.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     render () {
       const isGoodWord = true
       const goodWord = <strong> is good</strong>
       const badWord = <span> is not good</span>
         return (
           <div>
             <h1>
             React å°ä¹¦
             {isGoodWord ? goodWord : badWord}
             </h1>
           </div>
       )
 }
 ...
 #+END_SRC

 è¿™é‡Œç»™æŠŠä¸¤ä¸ª JSX å…ƒç´ èµ‹å€¼ç»™äº† goodWord å’Œ badWord ä¸¤ä¸ªå˜é‡, ç„¶åæŠŠå®ƒä»¬ä½œä¸ºè¡¨è¾¾å¼æ’å…¥çš„æ¡ä»¶è¿”å›å€¼. è¾¾åˆ°æ•ˆæœå’Œä¸Šé¢çš„ä¾‹å­ä¸€æ ·, éšæœºè¿”å›ä¸åŒçš„é¡µé¢æ•ˆæœå‘ˆç°.

 å†ä¸¾ä¸€ä¸ªä¾‹å­:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     renderGoodWord (goodWord, badWord) {
       const isGoodWord = true
       return isGoodWord ? goodWord : badWord
     }

 render () {
   return (
     <div>
       <h1>
       React å°ä¹¦
       {this.renderGoodWord(
         <strong> is good</strong>,
         <span> is not good</span>
       )}
       </h1>
     </div>
   )
 }
 ...
 #+END_SRC

è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª renderGoodWord å‡½æ•°, è¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ª JSX å…ƒç´ ä½œä¸ºå‚æ•°, å¹¶ä¸”éšæœºè¿”å›å…¶ä¸­ä¸€ä¸ª.
åœ¨ render æ–¹æ³•ä¸­, æˆ‘ä»¬æŠŠä¸Šé¢ä¾‹å­çš„ä¸¤ä¸ª JSX å…ƒç´ ä¼ å…¥ renderGoodWord å½“ä¸­, é€šè¿‡è¡¨è¾¾å¼æ’å…¥æŠŠè¯¥å‡½æ•°è¿”å›çš„ JSX å…ƒç´ æ’å…¥åˆ°é¡µé¢ä¸Š.
ç”¨ React.js æ„å»ºæœªè¯»æ¶ˆæ¯ç»„ä»¶

** ä½¿ç”¨ React.js æ„å»ºä¸€ä¸ªæœªè¯»æ¶ˆæ¯ç»„ä»¶ Notification.
 é€šè¿‡ getNotificationsCount() æ¥è·å–æœªè¯»æ¶ˆæ¯çš„æ•°é‡ , å¦‚æœæœ‰æœªè¯»æ¶ˆæ¯ N æ¡, è€Œä¸” N > 0, é‚£ä¹ˆ Notification ç»„ä»¶æ¸²æŸ“æ˜¾ç¤º:

 #+BEGIN_QUOTE
 <span>æœ‰(N) æ¡æœªè¯»æ¶ˆæ¯</span>
 #+END_QUOTE

 å¦åˆ™æ˜¾ç¤º:

 #+BEGIN_QUOTE
 <span>æ²¡æœ‰æœªè¯»æ¶ˆæ¯</span>
 #+END_QUOTE

 #+BEGIN_SRC javascript :results values list :exports no-eval
 // å‡½æ•° getNotificationsCount å·²ç»å¯ä»¥ç›´æ¥è°ƒç”¨

 class Notification extends Component {
   render () {
     const N = getNotificationsCount()
     return (
       <div>
         {N > 0 ? <span>æœ‰({N}) æ¡æœªè¯»æ¶ˆæ¯</span> : <span>æ²¡æœ‰æœªè¯»æ¶ˆæ¯</span>}
       </div>
     )
   }
 }
 #+END_SRC

 æˆ–è€…

 #+BEGIN_SRC javascript :results values list :exports no-eval
 // å‡½æ•° getNotificationsCount å·²ç»å¯ä»¥ç›´æ¥è°ƒç”¨

 class Notification extends Component {
   render () {
     // TODO
     let N = getNotificationsCount()
     return (
       <div>
         <span>{N > 0 ? `æœ‰(${N}) æ¡æœªè¯»æ¶ˆæ¯` : `æ²¡æœ‰æœªè¯»æ¶ˆæ¯`}</span>
       </div>
     )
   }
 }
 #+END_SRC

* ç»„ä»¶çš„ç»„åˆ, åµŒå¥—å’Œç»„ä»¶æ ‘
ç»§ç»­æ‹“å±•å‰é¢çš„ä¾‹å­, ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº† Header ç»„ä»¶äº†.
å‡è®¾æˆ‘ä»¬ç°åœ¨æ„å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶å« Title, å®ƒä¸“é—¨è´Ÿè´£æ˜¾ç¤ºæ ‡é¢˜. ä½ å¯ä»¥åœ¨ Header é‡Œé¢ä½¿ç”¨ Title ç»„ä»¶:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Title extends Component {
  render () {
    return (
      <h1>React å°ä¹¦</h1>
    )
  }
}

class Header extends Component {
  render () {
    return (
      <div>
        <Title />
      </div>
    )
  }
}
#+END_SRC

æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ Header æ ‡ç­¾é‡Œé¢ç›´æ¥ä½¿ç”¨ Title æ ‡ç­¾.
å°±åƒæ˜¯ä¸€ä¸ªæ™®é€šçš„æ ‡ç­¾ä¸€æ ·.React.js ä¼šåœ¨ <Title /> æ‰€åœ¨çš„åœ°æ–¹æŠŠ Title ç»„ä»¶çš„ render æ–¹æ³•è¡¨ç¤ºçš„ JSX å†…å®¹æ¸²æŸ“å‡ºæ¥,
ä¹Ÿå°±æ˜¯è¯´ <h1>React å°ä¹¦</h1> ä¼šæ˜¾ç¤ºåœ¨ç›¸åº”çš„ä½ç½®ä¸Š.
å¦‚æœç°åœ¨æˆ‘ä»¬åœ¨ Header é‡Œé¢ä½¿ç”¨ä¸‰ä¸ª <Title /> , é‚£ä¹ˆå°±ä¼šæœ‰ä¸‰ä¸ª <h1 /> æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š.

#+BEGIN_SRC javascript :results values list :exports no-eval
<div>
  <Title />
  <Title />
  <Title />
</div>
#+END_SRC

è¿™æ ·å¯å¤ç”¨æ€§éå¸¸å¼º, æˆ‘ä»¬å¯ä»¥æŠŠç»„ä»¶çš„å†…å®¹å°è£…å¥½, ç„¶åçµæ´»åœ¨ä½¿ç”¨åœ¨ä»»ä½•ç»„ä»¶å†….
å¦å¤–è¿™é‡Œè¦æ³¨æ„çš„æ˜¯, /*è‡ªå®šä¹‰çš„ç»„ä»¶éƒ½å¿…é¡»è¦ç”¨å¤§å†™å­—æ¯å¼€å¤´*/, æ™®é€šçš„ HTML æ ‡ç­¾éƒ½ç”¨å°å†™å­—æ¯å¼€å¤´.

ç°åœ¨è®©ç»„ä»¶å¤šèµ·æ¥. æˆ‘ä»¬æ¥æ„å»ºé¢å¤–çš„ç»„ä»¶æ¥æ„å»ºé¡µé¢, å‡è®¾é¡µé¢æ˜¯ç”± Header,Main,Footer å‡ ä¸ªéƒ¨åˆ†ç»„æˆ, ç”±ä¸€ä¸ª Index æŠŠå®ƒä»¬ç»„åˆèµ·æ¥.

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import ReactDOM from 'react-dom'

class Title extends Component {
  render () {
    return (
      <h1>React å°ä¹¦</h1>
    )
  }
}

class Header extends Component {
  render () {
    return (
      <div>
        <Title />
        <h2>This is Header</h2>
      </div>
    )
  }
}

class Main extends Component {
  render () {
    return (
      <div>
        <h2>This is main content</h2>
      </div>
    )
  }
}

class Footer extends Component {
  render () {
    return (
      <div>
        <h2>This is footer</h2>
      </div>
    )
  }
}

class Index extends Component {
  render () {
    return (
      <div>
        <Header />
        <Main />
        <Footer />
      </div>
    )
  }
}

ReactDOM.render(
  <Index />,
  document.getElementById('root')
)
#+END_SRC

æœ€åé¡µé¢ä¼šæ˜¾ç¤ºå†…å®¹:

[[file:./static/React.js å°ä¹¦/D57824A9-3F1F-44ED-9CFF-478902261653.png]]

ç»„ä»¶å¯ä»¥å’Œç»„ä»¶ç»„åˆåœ¨ä¸€èµ·, ç»„ä»¶å†…éƒ¨å¯ä»¥ä½¿ç”¨åˆ«çš„ç»„ä»¶.
å°±åƒæ™®é€šçš„ HTML æ ‡ç­¾ä¸€æ ·ä½¿ç”¨å°±å¯ä»¥.
è¿™æ ·çš„ç»„åˆåµŒå¥—, æœ€åæ„æˆä¸€ä¸ªæ‰€è°“çš„ç»„ä»¶æ ‘, å°±æ­£å¦‚ä¸Šé¢çš„ä¾‹å­é‚£æ ·,Index ç”¨äº† Header,Main,Footer,Header åˆä½¿ç”¨äº† Title.
è¿™æ ·ç”¨è¿™æ ·çš„æ ‘çŠ¶ç»“æ„è¡¨ç¤ºå®ƒä»¬ä¹‹é—´çš„å…³ç³»:

[[file:./static/React.js å°ä¹¦/19BBE4E2-A12E-4657-BA6A-61484F67FA60.png]]

è¿™é‡Œçš„ç»“æ„è¿˜æ˜¯æ¯”è¾ƒç®€å•, å› ä¸ºæˆ‘ä»¬çš„é¡µé¢ç»“æ„å¹¶ä¸å¤æ‚.
å½“é¡µé¢ç»“æ„å¤æ‚èµ·æ¥, æœ‰è®¸å¤šä¸åŒçš„ç»„ä»¶åµŒå¥—ç»„åˆçš„è¯, ç»„ä»¶æ ‘ä¼šç›¸å½“çš„å¤æ‚å’Œåºå¤§.
ç†è§£ç»„ä»¶æ ‘çš„æ¦‚å¿µå¯¹åé¢ç†è§£æ•°æ®æ˜¯å¦‚ä½•åœ¨ç»„ä»¶æ ‘å†…è‡ªä¸Šå¾€ä¸‹æµåŠ¨è¿‡ç¨‹å¾ˆé‡è¦.

* äº‹ä»¶ç›‘å¬
åœ¨ React.js é‡Œé¢ç›‘å¬äº‹ä»¶æ˜¯å¾ˆå®¹æ˜“çš„äº‹æƒ…, ä½ åªéœ€è¦ç»™éœ€è¦ç›‘å¬äº‹ä»¶çš„å…ƒç´ åŠ ä¸Šå±æ€§ç±»ä¼¼äº onClick,onKeyDown è¿™æ ·çš„å±æ€§, ä¾‹å¦‚æˆ‘ä»¬ç°åœ¨è¦ç»™ Title åŠ ä¸Šç‚¹å‡»çš„äº‹ä»¶ç›‘å¬:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Title extends Component {
  handleClickOnTitle () {
    console.log('Click on title.')
  }

  render () {
    return (
      <h1 onClick={this.handleClickOnTitle}>React å°ä¹¦</h1>
    )
  }
}
#+END_SRC

åªéœ€è¦ç»™ h1 æ ‡ç­¾åŠ ä¸Š onClick çš„äº‹ä»¶, /*onClick ç´§è·Ÿç€æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼æ’å…¥, è¿™ä¸ªè¡¨è¾¾å¼è¿”å›ä¸€ä¸ª Title è‡ªå·±çš„ä¸€ä¸ªå®ä¾‹æ–¹æ³•*/.
å½“ç”¨æˆ·ç‚¹å‡» h1 çš„æ—¶å€™,React.js å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•, æ‰€ä»¥ä½ åœ¨æ§åˆ¶å°å°±å¯ä»¥çœ‹åˆ° Click on title. æ‰“å°å‡ºæ¥.

åœ¨ React.js ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨æµè§ˆå™¨åŸç”Ÿçš„ addEventListener è¿›è¡Œäº‹ä»¶ç›‘å¬.
React.js å¸®æˆ‘ä»¬å°è£…å¥½äº†ä¸€ç³»åˆ—çš„ on* çš„å±æ€§, å½“ä½ éœ€è¦ä¸ºæŸä¸ªå…ƒç´ ç›‘å¬æŸä¸ªäº‹ä»¶çš„æ—¶å€™, åªéœ€è¦ç®€å•åœ°ç»™å®ƒåŠ ä¸Š on* å°±å¯ä»¥äº†.
è€Œä¸”ä½ ä¸éœ€è¦è€ƒè™‘ä¸åŒæµè§ˆå™¨å…¼å®¹æ€§çš„é—®é¢˜,React.js éƒ½å¸®æˆ‘ä»¬å°è£…å¥½è¿™äº›ç»†èŠ‚äº†.

React.js å°è£…äº†ä¸åŒç±»å‹çš„äº‹ä»¶, è¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾, æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒå®˜ç½‘æ–‡æ¡£:[[https://reactjs.org/docs/events.html#supported-events][SyntheticEvent - React]], å¤šå°è¯•ä¸åŒçš„äº‹ä»¶.
å¦å¤–è¦æ³¨æ„çš„æ˜¯, è¿™äº›äº‹ä»¶å±æ€§åéƒ½å¿…é¡»è¦ç”¨é©¼å³°å‘½åæ³•.

/*æ²¡æœ‰ç»è¿‡ç‰¹æ®Šå¤„ç†çš„è¯, è¿™äº› onXXX çš„äº‹ä»¶ç›‘å¬åªèƒ½ç”¨åœ¨æ™®é€šçš„ HTML çš„æ ‡ç­¾ä¸Š, è€Œä¸èƒ½ç”¨åœ¨ç»„ä»¶æ ‡ç­¾ä¸Š*/. ä¹Ÿå°±æ˜¯è¯´,<Header onClick={â€¦} /> è¿™æ ·çš„å†™æ³•ä¸ä¼šæœ‰ä»€ä¹ˆæ•ˆæœçš„.
è¿™ä¸€ç‚¹è¦æ³¨æ„, ä½†æ˜¯æœ‰åŠæ³•å¯ä»¥åšåˆ°è¿™æ ·çš„ç»‘å®š, ä»¥åæˆ‘ä»¬ä¼šæåŠ. ç°åœ¨åªè¦è®°ä½ä¸€ç‚¹å°±å¯ä»¥äº†: è¿™äº› on* çš„äº‹ä»¶ç›‘å¬åªèƒ½ç”¨åœ¨æ™®é€šçš„ HTML çš„æ ‡ç­¾ä¸Š, è€Œä¸èƒ½ç”¨åœ¨ç»„ä»¶æ ‡ç­¾ä¸Š.

** event å¯¹è±¡
 å’Œæ™®é€šæµè§ˆå™¨ä¸€æ ·, äº‹ä»¶ç›‘å¬å‡½æ•°ä¼šè¢«è‡ªåŠ¨ä¼ å…¥ä¸€ä¸ª event å¯¹è±¡, è¿™ä¸ªå¯¹è±¡å’Œæ™®é€šçš„æµè§ˆå™¨ event å¯¹è±¡æ‰€åŒ…å«çš„æ–¹æ³•å’Œå±æ€§éƒ½åŸºæœ¬ä¸€è‡´.
 ä¸åŒçš„æ˜¯ React.js ä¸­çš„ event å¯¹è±¡å¹¶ä¸æ˜¯æµè§ˆå™¨æä¾›çš„, è€Œæ˜¯å®ƒè‡ªå·±å†…éƒ¨æ‰€æ„å»ºçš„.React.js å°†æµè§ˆå™¨åŸç”Ÿçš„ event å¯¹è±¡å°è£…äº†ä¸€ä¸‹,
 å¯¹å¤–æä¾›ç»Ÿä¸€çš„ API å’Œå±æ€§, è¿™æ ·ä½ å°±ä¸ç”¨è€ƒè™‘ä¸åŒæµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜.
 è¿™ä¸ª event å¯¹è±¡æ˜¯ç¬¦åˆ W3C æ ‡å‡†(W3C UI Events) çš„, å®ƒå…·æœ‰ç±»ä¼¼äº event.stopPropagation, event.preventDefault è¿™ç§å¸¸ç”¨çš„æ–¹æ³•.

 æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹, è¿™æ¬¡å°è¯•å½“ç”¨æˆ·ç‚¹å‡» h1 çš„æ—¶å€™, æŠŠ h1 çš„ innerHTML æ‰“å°å‡ºæ¥:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Title extends Component {
   handleClickOnTitle (e) {
     console.log(e.target.innerHTML)
   }

   render () {
     return (
       <h1 onClick={this.handleClickOnTitle}>React å°ä¹¦</h1>
     )
   }
 }
 #+END_SRC

 å†çœ‹çœ‹æ§åˆ¶å°, æ¯æ¬¡ç‚¹å‡»çš„æ—¶å€™å°±ä¼šæ‰“å°"React å°ä¹¦".

** å…³äºäº‹ä»¶ä¸­çš„ this
 ä¸€èˆ¬åœ¨æŸä¸ªç±»çš„å®ä¾‹æ–¹æ³•é‡Œé¢çš„ this æŒ‡çš„æ˜¯è¿™ä¸ªå®ä¾‹æœ¬èº«.
 ä½†æ˜¯ä½ åœ¨ä¸Šé¢çš„ handleClickOnTitle ä¸­æŠŠ this æ‰“å°å‡ºæ¥, ä½ ä¼šçœ‹åˆ° this æ˜¯ null æˆ–è€… undefined.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     handleClickOnTitle (e) {
       console.log(this) // => null or undefined
     }
 ...
 #+END_SRC

 è¿™æ˜¯å› ä¸º React.js è°ƒç”¨ä½ æ‰€ä¼ ç»™å®ƒçš„æ–¹æ³•çš„æ—¶å€™, å¹¶ä¸æ˜¯é€šè¿‡å¯¹è±¡æ–¹æ³•çš„æ–¹å¼è°ƒç”¨ (this.handleClickOnTitle),
 è€Œæ˜¯ç›´æ¥é€šè¿‡å‡½æ•°è°ƒç”¨ (handleClickOnTitle), æ‰€ä»¥äº‹ä»¶ç›‘å¬å‡½æ•°å†…å¹¶ä¸èƒ½é€šè¿‡ this è·å–åˆ°å®ä¾‹.

 /*å¦‚æœä½ æƒ³åœ¨äº‹ä»¶å‡½æ•°å½“ä¸­ä½¿ç”¨å½“å‰çš„å®ä¾‹, ä½ éœ€è¦æ‰‹åŠ¨åœ°å°†å®ä¾‹æ–¹æ³• bind åˆ°å½“å‰å®ä¾‹ä¸Šå†ä¼ å…¥ç»™ React.js*/.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Title extends Component {
   handleClickOnTitle (e) {
     console.log(this)
   }

   render () {
     return (
       <h1 onClick={this.handleClickOnTitle.bind(this)}>React å°ä¹¦</h1>
     )
   }
 }
 #+END_SRC

 bind ä¼šæŠŠå®ä¾‹æ–¹æ³•ç»‘å®šåˆ°å½“å‰å®ä¾‹ä¸Š, ç„¶åæˆ‘ä»¬å†æŠŠç»‘å®šåçš„å‡½æ•°ä¼ ç»™ React.js çš„ onClick äº‹ä»¶ç›‘å¬. è¿™æ—¶å€™ä½ å†çœ‹çœ‹, ç‚¹å‡» h1 çš„æ—¶å€™, å°±ä¼šæŠŠå½“å‰çš„å®ä¾‹æ‰“å°å‡ºæ¥:

 [[file:./static/React.js å°ä¹¦/07937EC0-AAFE-4FD5-ABB7-06A69EBF54C7.png]]

 ä½ ä¹Ÿå¯ä»¥åœ¨ bind çš„æ—¶å€™ç»™äº‹ä»¶ç›‘å¬å‡½æ•°ä¼ å…¥ä¸€äº›å‚æ•°:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Title extends Component {
   handleClickOnTitle (word, e) {
     console.log(this, word)
   }

   render () {
     return (
       <h1 onClick={this.handleClickOnTitle.bind(this, 'Hello')}>React å°ä¹¦</h1>
     )
   }
 }
 #+END_SRC

 è¿™ç§ bind æ¨¡å¼åœ¨ React.js çš„äº‹ä»¶ç›‘å¬å½“ä¸­éå¸¸å¸¸è§, bind ä¸ä»…å¯ä»¥å¸®æˆ‘ä»¬æŠŠäº‹ä»¶ç›‘å¬æ–¹æ³•ä¸­çš„ this ç»‘å®šåˆ°å½“å‰ç»„ä»¶å®ä¾‹ä¸Š,
 è¿˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨åœ¨æ¸²æŸ“åˆ—è¡¨å…ƒç´ çš„æ—¶å€™, æŠŠåˆ—è¡¨å…ƒç´ ä¼ å…¥äº‹ä»¶ç›‘å¬å‡½æ•°å½“ä¸­â€”â€”è¿™ä¸ªå°†åœ¨ä»¥åçš„ç« èŠ‚æåŠ.

 å¦‚æœæœ‰äº›åŒå­¦å¯¹ JavaScript çš„ this æ¨¡å¼æˆ–è€… bind å‡½æ•°çš„ä½¿ç”¨æ–¹å¼ä¸æ˜¯ç‰¹åˆ«äº†è§£åˆ°è¯, å¯èƒ½ä¼šå¯¹è¿™éƒ¨åˆ†å†…å®¹ä¼šæœ‰äº›è¿·æƒ‘,
 å¯ä»¥è¡¥å……å¯¹ JavaScript çš„ [[https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/this][this]] å’Œ [[https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind][bind]] ç›¸å…³çš„çŸ¥è¯†å†æ¥å›é¡¾è¿™éƒ¨åˆ†å†…å®¹.

** æ€»ç»“
 ä¸º React çš„ç»„ä»¶æ·»åŠ äº‹ä»¶ç›‘å¬æ˜¯å¾ˆç®€å•çš„äº‹æƒ…, ä½ åªéœ€è¦ä½¿ç”¨ React.js æä¾›äº†ä¸€ç³»åˆ—çš„ on* æ–¹æ³•å³å¯.

 React.js ä¼šç»™æ¯ä¸ªäº‹ä»¶ç›‘å¬ä¼ å…¥ä¸€ä¸ª event å¯¹è±¡, è¿™ä¸ªå¯¹è±¡æä¾›çš„åŠŸèƒ½å’Œæµè§ˆå™¨æä¾›çš„åŠŸèƒ½ä¸€è‡´, è€Œä¸”å®ƒæ˜¯å…¼å®¹æ‰€æœ‰æµè§ˆå™¨çš„.

 React.js çš„äº‹ä»¶ç›‘å¬æ–¹æ³•éœ€è¦æ‰‹åŠ¨ bind åˆ°å½“å‰å®ä¾‹, è¿™ç§æ¨¡å¼åœ¨ React.js ä¸­éå¸¸å¸¸ç”¨.

** ä¸èƒ½æ‘¸çš„ç‹—
 æœ‰ä¸€åªç‹—, ä¸å…è®¸åˆ«äººæ‘¸å®ƒ, ä¸€æ—¦æ‘¸å®ƒå°±ä¼šå«, ç„¶åå°±è·‘äº†.

 å®Œæˆ Dog ç»„ä»¶, å½“ç”¨æˆ·ç‚¹å‡»çš„æ—¶å€™ä¼šæ‰§è¡Œè‡ªèº«çš„ bark å’Œ run æ–¹æ³•.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Dog extends Component {
   bark () {
     console.log('bark')
   }

   run () {
     console.log('run')
   }

   render () {
     return (<div onClick={() => { this.bark(); this.run() }}>DOG</div>)
   }
 }
 #+END_SRC

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Dog extends Component {
   bark () {
     console.log('bark')
   }

   run () {
     console.log('run')
   }

   handleOnClick () {
     this.bark()
     this.run()
   }

   render () {
     return (<div onClick={this.handleOnClick.bind(this)}>DOG</div>)
   }
 }
 #+END_SRC

 å¦‚æœä¸ä½¿ç”¨ bind(this), å‡ºç°å¦‚ä¸‹é”™è¯¯:

 [[file:./static/React.js å°ä¹¦/fasfshfhsfjls.png]]

* ç»„ä»¶çš„ state å’Œ setState
** state
 æˆ‘ä»¬å‰é¢æåˆ°è¿‡, ä¸€ä¸ªç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€æ˜¯å¯ä»¥ç”±å®ƒæ•°æ®çŠ¶æ€å’Œé…ç½®å‚æ•°å†³å®šçš„.
 ä¸€ä¸ªç»„ä»¶å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„çŠ¶æ€, å°±åƒä¸€ä¸ªç‚¹èµæŒ‰é’®, å¯ä»¥æœ‰" å·²ç‚¹èµ" å’Œ" æœªç‚¹èµ" çŠ¶æ€, å¹¶ä¸”å¯ä»¥åœ¨è¿™ä¸¤ç§çŠ¶æ€ä¹‹é—´è¿›è¡Œåˆ‡æ¢.
 React.js çš„ state å°±æ˜¯ç”¨æ¥å­˜å‚¨è¿™ç§å¯å˜åŒ–çš„çŠ¶æ€çš„.

 [[file:./static/React.js å°ä¹¦/B7575C67-64F8-4A13-9C63-4D6805FA360D.png]]

 æˆ‘ä»¬è¿˜æ˜¯æ‹¿ç‚¹èµæŒ‰é’®åšä¾‹å­, å®ƒå…·æœ‰å·²ç‚¹èµå’Œæœªç‚¹èµä¸¤ç§çŠ¶æ€. é‚£ä¹ˆå°±å¯ä»¥æŠŠè¿™ä¸ªçŠ¶æ€å­˜å‚¨åœ¨ state ä¸­. ä¿®æ”¹ `src/index.js` ä¸º:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'
 import ReactDOM from 'react-dom'
 import './index.css'

 class LikeButton extends Component {
   constructor () {
     super()
     this.state = { isLiked: false }
   }

   handleClickOnLikeButton () {
     this.setState({
       isLiked: !this.state.isLiked
     })
   }

   render () {
     return (
       <button onClick={this.handleClickOnLikeButton.bind(this)}>
         {this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'} ğŸ‘
       </button>
     )
   }
 }
 #+END_SRC

 isLiked å­˜æ”¾åœ¨å®ä¾‹çš„ state å¯¹è±¡å½“ä¸­, è¿™ä¸ªå¯¹è±¡åœ¨æ„é€ å‡½æ•°é‡Œé¢åˆå§‹åŒ–.
 è¿™ä¸ªç»„ä»¶çš„ render å‡½æ•°å†…, ä¼šæ ¹æ®ç»„ä»¶çš„ state çš„ä¸­çš„ isLiked ä¸åŒæ˜¾ç¤º" å–æ¶ˆ" æˆ–" ç‚¹èµ" å†…å®¹. å¹¶ä¸”ç»™ button åŠ ä¸Šäº†ç‚¹å‡»çš„äº‹ä»¶ç›‘å¬.

 æœ€åæ„å»ºä¸€ä¸ª Index , åœ¨å®ƒçš„ render å‡½æ•°å†…ä½¿ç”¨ LikeButton . ç„¶åæŠŠ Index æ¸²æŸ“åˆ°é¡µé¢ä¸Š:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Index extends Component {
   render () {
     return (
       <div>
         <LikeButton />
       </div>
     )
   }
 }

 ReactDOM.render(
   <Index />,
   document.getElementById('root')
 )
 #+END_SRC

** setState æ¥å—å¯¹è±¡å‚æ•°
 åœ¨ handleClickOnLikeButton äº‹ä»¶ç›‘å¬å‡½æ•°é‡Œé¢, å¤§å®¶å¯ä»¥ç•™æ„åˆ°, æˆ‘ä»¬è°ƒç”¨äº† setState å‡½æ•°, æ¯æ¬¡ç‚¹å‡»éƒ½ä¼šæ›´æ–° isLiked å±æ€§ä¸º !isLiked, è¿™æ ·å°±å¯ä»¥åšåˆ°ç‚¹èµå’Œå–æ¶ˆåŠŸèƒ½.

 setState æ–¹æ³•ç”±çˆ¶ç±» Component æ‰€æä¾›. å½“æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™,React.js ä¼šæ›´æ–°ç»„ä»¶çš„çŠ¶æ€ state , å¹¶ä¸”é‡æ–°è°ƒç”¨ render æ–¹æ³•, ç„¶åå†æŠŠ render æ–¹æ³•æ‰€æ¸²æŸ“çš„æœ€æ–°çš„å†…å®¹æ˜¾ç¤ºåˆ°é¡µé¢ä¸Š.

 /*æ³¨æ„, å½“æˆ‘ä»¬è¦æ”¹å˜ç»„ä»¶çš„çŠ¶æ€çš„æ—¶å€™, ä¸èƒ½ç›´æ¥ç”¨ this.state = xxx è¿™ç§æ–¹å¼æ¥ä¿®æ”¹, å¦‚æœè¿™æ ·åš React.js å°±æ²¡åŠæ³•çŸ¥é“ä½ ä¿®æ”¹äº†ç»„ä»¶çš„çŠ¶æ€, å®ƒä¹Ÿå°±æ²¡æœ‰åŠæ³•æ›´æ–°é¡µé¢*/.
 æ‰€ä»¥, ä¸€å®šè¦ä½¿ç”¨ React.js æä¾›çš„ setState æ–¹æ³•,  /*å®ƒæ¥å—ä¸€ä¸ªå¯¹è±¡æˆ–è€…å‡½æ•°ä½œä¸ºå‚æ•°*/.

 ä¼ å…¥ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™, è¿™ä¸ªå¯¹è±¡è¡¨ç¤ºè¯¥ç»„ä»¶çš„æ–°çŠ¶æ€. ä½†ä½ åªéœ€è¦ä¼ å…¥éœ€è¦æ›´æ–°çš„éƒ¨åˆ†å°±å¯ä»¥äº†, è€Œä¸éœ€è¦ä¼ å…¥æ•´ä¸ªå¯¹è±¡. ä¾‹å¦‚, å‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰å¦å¤–ä¸€ä¸ªçŠ¶æ€ name :

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     constructor (props) {
       super(props)
       this.state = {
         name: 'Tomy',
         isLiked: false
       }
     }

 handleClickOnLikeButton () {
   this.setState({
     isLiked: !this.state.isLiked
   })
 }
 ...
 #+END_SRC

 å› ä¸ºç‚¹å‡»çš„æ—¶å€™æˆ‘ä»¬å¹¶ä¸éœ€è¦ä¿®æ”¹ name, æ‰€ä»¥åªéœ€è¦ä¼ å…¥ isLiked å°±è¡Œäº†.Tomy è¿˜æ˜¯é‚£ä¸ª Tomy, è€Œ isLiked å·²ç»ä¸æ˜¯é‚£ä¸ª isLiked äº†.

** setState æ¥å—å‡½æ•°å‚æ•°
 è¿™é‡Œè¿˜æœ‰è¦æ³¨æ„çš„æ˜¯, å½“ä½ è°ƒç”¨ setState çš„æ—¶å€™,React.js å¹¶ä¸ä¼šé©¬ä¸Šä¿®æ”¹ state.
 è€Œæ˜¯æŠŠè¿™ä¸ªå¯¹è±¡æ”¾åˆ°ä¸€ä¸ªæ›´æ–°é˜Ÿåˆ—é‡Œé¢, ç¨åæ‰ä¼šä»é˜Ÿåˆ—å½“ä¸­æŠŠæ–°çš„çŠ¶æ€æå–å‡ºæ¥åˆå¹¶åˆ° state å½“ä¸­, ç„¶åå†è§¦å‘ç»„ä»¶æ›´æ–°.
 è¿™ä¸€ç‚¹è¦å¥½å¥½æ³¨æ„. å¯ä»¥ä½“ä¼šä¸€ä¸‹ä¸‹é¢çš„ä»£ç :

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     handleClickOnLikeButton () {
       console.log(this.state.isLiked)
       this.setState({
         isLiked: !this.state.isLiked
       })
       console.log(this.state.isLiked)
     }
 ...
 #+END_SRC

 ä½ ä¼šå‘ç°ä¸¤æ¬¡æ‰“å°çš„éƒ½æ˜¯ false, å³ä½¿æˆ‘ä»¬ä¸­é—´å·²ç» setState è¿‡ä¸€æ¬¡äº†.
 è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆ bug, åªæ˜¯ React.js çš„ setState æŠŠä½ çš„ä¼ è¿›æ¥çš„çŠ¶æ€ç¼“å­˜èµ·æ¥, ç¨åæ‰ä¼šå¸®ä½ æ›´æ–°åˆ° state ä¸Š, æ‰€ä»¥ä½ è·å–åˆ°çš„è¿˜æ˜¯åŸæ¥çš„ isLiked.

 æ‰€ä»¥å¦‚æœä½ æƒ³åœ¨ setState ä¹‹åä½¿ç”¨æ–°çš„ state æ¥åšåç»­è¿ç®—å°±åšä¸åˆ°äº†, ä¾‹å¦‚:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     handleClickOnLikeButton () {
       this.setState({ count: 0 }) // => this.state.count è¿˜æ˜¯ undefined
       this.setState({ count: this.state.count + 1}) // => undefined + 1 = NaN
       this.setState({ count: this.state.count + 2}) // => NaN + 2 = NaN
     }
 ...
 #+END_SRC

 ä¸Šé¢çš„ä»£ç çš„è¿è¡Œç»“æœå¹¶ä¸èƒ½è¾¾åˆ°æˆ‘ä»¬çš„é¢„æœŸ, æˆ‘ä»¬å¸Œæœ› count è¿è¡Œç»“æœæ˜¯ 3 , å¯æ˜¯æœ€åå¾—åˆ°çš„æ˜¯ NaN.
 ä½†æ˜¯è¿™ç§åç»­æ“ä½œä¾èµ–å‰ä¸€ä¸ª setState çš„ç»“æœçš„æƒ…å†µå¹¶ä¸ç½•è§.

 è¿™é‡Œå°±è‡ªç„¶åœ°å¼•å‡ºäº† setState çš„ç¬¬äºŒç§ä½¿ç”¨æ–¹å¼, /*å¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°.React.js ä¼šæŠŠä¸Šä¸€ä¸ª setState çš„ç»“æœä¼ å…¥è¿™ä¸ªå‡½æ•°, ä½ å°±å¯ä»¥ä½¿ç”¨è¯¥ç»“æœè¿›è¡Œè¿ç®—, æ“ä½œ, ç„¶åè¿”å›ä¸€ä¸ªå¯¹è±¡ä½œä¸ºæ›´æ–° state çš„å¯¹è±¡*/:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     handleClickOnLikeButton () {
       this.setState((prevState) => {
         return { count: 0 }
       })
       this.setState((prevState) => {
         return { count: prevState.count + 1 } // ä¸Šä¸€ä¸ª setState çš„è¿”å›æ˜¯ count ä¸º 0, å½“å‰è¿”å› 1
       })
       this.setState((prevState) => {
         return { count: prevState.count + 2 } // ä¸Šä¸€ä¸ª setState çš„è¿”å›æ˜¯ count ä¸º 1, å½“å‰è¿”å› 3
       })
       // æœ€åçš„ç»“æœæ˜¯ this.state.count ä¸º 3
     }
 ...
 #+END_SRC

 è¿™æ ·å°±å¯ä»¥è¾¾åˆ°ä¸Šè¿°çš„åˆ©ç”¨ä¸Šä¸€æ¬¡ setState ç»“æœè¿›è¡Œè¿ç®—çš„æ•ˆæœ.

** setState åˆå¹¶
 ä¸Šé¢æˆ‘ä»¬è¿›è¡Œäº†ä¸‰æ¬¡ setState, ä½†æ˜¯å®é™…ä¸Šç»„ä»¶åªä¼šé‡æ–°æ¸²æŸ“ä¸€æ¬¡, è€Œä¸æ˜¯ä¸‰æ¬¡,
 è¿™æ˜¯å› ä¸ºåœ¨ React.js å†…éƒ¨ä¼šæŠŠ JavaScript äº‹ä»¶å¾ªç¯ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—çš„åŒä¸€ä¸ªæ¶ˆæ¯ä¸­çš„ setState éƒ½è¿›è¡Œåˆå¹¶ä»¥åå†é‡æ–°æ¸²æŸ“ç»„ä»¶.

 æ·±å±‚çš„åŸç†å¹¶ä¸éœ€è¦è¿‡å¤šçº ç»“, ä½ åªéœ€è¦è®°ä½çš„æ˜¯: åœ¨ä½¿ç”¨ React.js çš„æ—¶å€™, å¹¶ä¸éœ€è¦æ‹…å¿ƒå¤šæ¬¡è¿›è¡Œ setState ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜.

** ä¸èƒ½æ‘¸çš„ç‹—(äºŒ)
 æœ‰ä¸€åªç‹—, ä¸å…è®¸åˆ«äººæ‘¸å®ƒ, ä¸€æ—¦æ‘¸å®ƒå°±ä¼šå«, ç„¶åå°±è·‘äº†, è¿™åªç‹—è·‘ä¸€æ®µæ—¶é—´(20~50ms) ä»¥åå°±ä¼šåœä¸‹æ¥, ä¹Ÿä¸å«äº†.

 å®Œæˆ Dog ç»„ä»¶, å½“ç”¨æˆ·ç‚¹å‡»çš„æ—¶å€™ä¼šæ‰§è¡Œè‡ªèº«çš„ bark å’Œ run æ–¹æ³•.
 ç»™è¿™ä¸ª Dog ç»„ä»¶åŠ ä¸ŠçŠ¶æ€ isRunning å’Œ isBarking, åœ¨è¿›è¡Œç›¸åº”çš„åŠ¨ä½œçš„æ—¶å€™è®¾ç½®ä¸º true, åœä¸‹æ¥çš„æ—¶å€™è®¾ç½®ä¸º false.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Dog extends Component {
   constructor () {
     super()
     this.state = {
       isBarking: true,
       isRunning: true
     }
   }

   bark () {
     console.log('Barking')
   }

   run () {
     console.log('Running')
   }

   render () {
     setTimeout(() => { this.setState({ isBarking: false, isRunning: false }) }, 10000)
     return (
       <div onClick={() => {
         if (this.state.isBarking) { this.bark() };
         if (this.state.isRunning) { this.run() };
       }
       }>Dog
       </div>
     )
   }
 }
  #+END_SRC

* é…ç½®ç»„ä»¶çš„ props
ç»„ä»¶æ˜¯ç›¸äº’ç‹¬ç«‹, å¯å¤ç”¨çš„å•å…ƒ, ä¸€ä¸ªç»„ä»¶å¯èƒ½åœ¨ä¸åŒåœ°æ–¹è¢«ç”¨åˆ°.
ä½†æ˜¯åœ¨ä¸åŒçš„åœºæ™¯ä¸‹å¯¹è¿™ä¸ªç»„ä»¶çš„éœ€æ±‚å¯èƒ½ä¼šæ ¹æ®æƒ…å†µæœ‰æ‰€ä¸åŒ, ä¾‹å¦‚ä¸€ä¸ªç‚¹èµæŒ‰é’®ç»„ä»¶, åœ¨æˆ‘è¿™é‡Œéœ€è¦å®ƒæ˜¾ç¤ºçš„æ–‡æœ¬æ˜¯" ç‚¹èµ" å’Œ" å–æ¶ˆ",
å½“åˆ«çš„åŒäº‹æ‹¿è¿‡å»ç”¨çš„æ—¶å€™, å´éœ€è¦å®ƒæ˜¾ç¤º" èµ" å’Œ" å·²èµ".
å¦‚ä½•è®©ç»„ä»¶èƒ½é€‚åº”ä¸åŒåœºæ™¯ä¸‹çš„éœ€æ±‚, æˆ‘ä»¬å°±è¦è®©ç»„ä»¶å…·æœ‰ä¸€å®šçš„" å¯é…ç½®" æ€§.

React.js çš„ props å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¾¾åˆ°è¿™ä¸ªæ•ˆæœ. æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥æ¥å—ä¸€ä¸ª props å‚æ•°, å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡, åŒ…å«äº†æ‰€æœ‰ä½ å¯¹è¿™ä¸ªç»„ä»¶çš„é…ç½®. å°±æ‹¿æˆ‘ä»¬ç‚¹èµæŒ‰é’®åšä¾‹å­:

[[file:./static/React.js å°ä¹¦/B7575C67-64F8-4A13-9C63-4D6805FA360D.png]]

ä¸‹é¢çš„ä»£ç å¯ä»¥è®©å®ƒè¾¾åˆ°ä¸Šè¿°çš„å¯é…ç½®æ€§:

#+BEGIN_SRC javascript :results values list :exports no-eval
class LikeButton extends Component {
  constructor () {
    super()
    this.state = { isLiked: false }
  }

  handleClickOnLikeButton () {
    this.setState({
      isLiked: !this.state.isLiked
    })
  }

  render () {
    const likedText = this.props.likedText || 'å–æ¶ˆ'
    const unlikedText = this.props.unlikedText || 'ç‚¹èµ'
    return (
      <button onClick={this.handleClickOnLikeButton.bind(this)}>
        {this.state.isLiked ? likedText : unlikedText} ğŸ‘
      </button>
    )
  }
}
#+END_SRC

ä» render å‡½æ•°å¯ä»¥çœ‹å‡ºæ¥, ç»„ä»¶å†…éƒ¨æ˜¯é€šè¿‡ this.props çš„æ–¹å¼è·å–åˆ°ç»„ä»¶çš„å‚æ•°çš„,
å¦‚æœ this.props é‡Œé¢æœ‰éœ€è¦çš„å±æ€§æˆ‘ä»¬å°±é‡‡ç”¨ç›¸åº”çš„å±æ€§, æ²¡æœ‰çš„è¯å°±ç”¨é»˜è®¤çš„å±æ€§.

é‚£ä¹ˆæ€ä¹ˆæŠŠ props ä¼ è¿›å»å‘¢? åœ¨ä½¿ç”¨ä¸€ä¸ªç»„ä»¶çš„æ—¶å€™, å¯ä»¥æŠŠå‚æ•°æ”¾åœ¨æ ‡ç­¾çš„å±æ€§å½“ä¸­, æ‰€æœ‰çš„å±æ€§éƒ½ä¼šä½œä¸º props å¯¹è±¡çš„é”®å€¼:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Index extends Component {
  render () {
    return (
      <div>
        <LikeButton likedText='å·²èµ' unlikedText='èµ' />
      </div>
    )
  }
}
#+END_SRC

å°±åƒä½ åœ¨ç”¨æ™®é€šçš„ HTML æ ‡ç­¾çš„å±æ€§ä¸€æ ·, å¯ä»¥æŠŠå‚æ•°æ”¾åœ¨è¡¨ç¤ºç»„ä»¶çš„æ ‡ç­¾ä¸Š, ç»„ä»¶å†…éƒ¨å°±å¯ä»¥é€šè¿‡ this.props æ¥è®¿é—®åˆ°è¿™äº›é…ç½®å‚æ•°äº†.

[[file:./static/React.js å°ä¹¦/1D4C87F2-9B05-47CE-8144-1154B5CB1FC3.png]]

å‰é¢çš„ç« èŠ‚æˆ‘ä»¬è¯´è¿‡,JSX çš„è¡¨è¾¾å¼æ’å…¥å¯ä»¥åœ¨æ ‡ç­¾å±æ€§ä¸Šä½¿ç”¨.
æ‰€ä»¥å…¶å®å¯ä»¥æŠŠä»»ä½•ç±»å‹çš„æ•°æ®ä½œä¸ºç»„ä»¶çš„å‚æ•°, åŒ…æ‹¬å­—ç¬¦ä¸², æ•°å­—, å¯¹è±¡, æ•°ç»„, ç”šè‡³æ˜¯å‡½æ•°ç­‰ç­‰.
ä¾‹å¦‚ç°åœ¨æˆ‘ä»¬æŠŠä¸€ä¸ªå¯¹è±¡ä¼ ç»™ç‚¹èµç»„ä»¶ä½œä¸ºå‚æ•°:

#+CAPTION: JSX è¡¨è¾¾å¼çš„æ’å…¥
#+BEGIN_SRC javascript :results values list :exports no-eval
class Index extends Component {
  render () {
    return (
      <div>
        <LikeButton wordings={{ likedText: 'å·²èµ', unlikedText: 'èµ' }} />
      </div>
    )
  }
}
#+END_SRC
<<JSX è¡¨è¾¾å¼çš„æ’å…¥>>

ç°åœ¨æˆ‘ä»¬æŠŠ likedText å’Œ unlikedText è¿™ä¸¤ä¸ªå‚æ•°å°è£…åˆ°ä¸€ä¸ªå« wordings çš„å¯¹è±¡å‚æ•°å†…, ç„¶åä¼ å…¥ç‚¹èµç»„ä»¶ä¸­.
å¤§å®¶çœ‹åˆ° {{likedText: 'å·²èµ', unlikedText: 'èµ'}} è¿™æ ·çš„ä»£ç çš„æ—¶å€™, ä¸è¦ä»¥ä¸ºæ˜¯ä»€ä¹ˆæ–°è¯­æ³•.
ä¹‹å‰è®¨è®ºè¿‡, /*JSX çš„ {} å†…å¯ä»¥åµŒå…¥ä»»ä½•è¡¨è¾¾å¼,{{}} å°±æ˜¯åœ¨ {} å†…éƒ¨ç”¨å¯¹è±¡å­—é¢é‡è¿”å›ä¸€ä¸ªå¯¹è±¡è€Œå·²*/.

è¿™æ—¶å€™, ç‚¹èµæŒ‰é’®çš„å†…éƒ¨å°±è¦ç”¨ this.props.wordings æ¥è·å–åˆ°åˆ°å‚æ•°äº†:

#+BEGIN_SRC javascript :results values list :exports no-eval
class LikeButton extends Component {
  constructor () {
    super()
    this.state = { isLiked: false }
  }

  handleClickOnLikeButton () {
    this.setState({
      isLiked: !this.state.isLiked
    })
  }

  render () {
    const wordings = this.props.wordings || {
      likedText: 'å–æ¶ˆ',
      unlikedText: 'ç‚¹èµ'
    }
    return (
      <button onClick={this.handleClickOnLikeButton.bind(this)}>
        {this.state.isLiked ? wordings.likedText : wordings.unlikedText} ğŸ‘
      </button>
    )
  }
}
#+END_SRC

ç”šè‡³å¯ä»¥å¾€ç»„ä»¶å†…éƒ¨ä¼ å…¥å‡½æ•°ä½œä¸ºå‚æ•°:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Index extends Component {
  render () {
    return (
      <div>
        <LikeButton
          wordings={{ likedText: 'å·²èµ', unlikedText: 'èµ' }}
          onClick={() => console.log('Click on like button!')} />
      </div>
    )
  }
}
#+END_SRC

è¿™æ ·å¯ä»¥é€šè¿‡ this.props.onClick è·å–åˆ°è¿™ä¸ªä¼ è¿›å»çš„å‡½æ•°, ä¿®æ”¹ LikeButton çš„ handleClickOnLikeButton æ–¹æ³•:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
    handleClickOnLikeButton () {
      this.setState({
        isLiked: !this.state.isLiked
      })
      if (this.props.onClick) {
        this.props.onClick()
      }
    }
...
#+END_SRC

å½“æ¯æ¬¡ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™, æ§åˆ¶å°ä¼šæ˜¾ç¤º Click on like button!.
ä½†è¿™ä¸ªè¡Œä¸ºä¸æ˜¯ç‚¹èµç»„ä»¶è‡ªå·±å®ç°çš„, è€Œæ˜¯æˆ‘ä»¬ä¼ è¿›å»çš„. æ‰€ä»¥, ä¸€ä¸ªç»„ä»¶çš„è¡Œä¸º, æ˜¾ç¤ºå½¢æ€éƒ½å¯ä»¥ç”¨ props æ¥æ§åˆ¶, å°±å¯ä»¥è¾¾åˆ°å¾ˆå¥½çš„å¯é…ç½®æ€§.

** é»˜è®¤é…ç½® defaultProps
 ä¸Šé¢çš„ç»„ä»¶é»˜è®¤é…ç½®æˆ‘ä»¬æ˜¯é€šè¿‡ || æ“ä½œç¬¦æ¥å®ç°.
 è¿™ç§éœ€è¦é»˜è®¤é…ç½®çš„æƒ…å†µåœ¨ React.js ä¸­éå¸¸å¸¸è§, æ‰€ä»¥ React.js ä¹Ÿæä¾›äº†ä¸€ç§æ–¹å¼ defaultProps, å¯ä»¥æ–¹ä¾¿çš„åšåˆ°é»˜è®¤é…ç½®.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class LikeButton extends Component {
     static defaultProps = {
         likedText: 'å–æ¶ˆ',
         unlikedText: 'ç‚¹èµ'
     }

     constructor () {
         super()
         this.state = { isLiked: false }
     }

     handleClickOnLikeButton () {
         this.setState({
             isLiked: !this.state.isLiked
         })
     }

     render () {
         return (
             <button onClick={this.handleClickOnLikeButton.bind(this)}>
                 {this.state.isLiked
                  ? this.props.likedText
                  : this.props.unlikedText} ğŸ‘
             </button>
         )
     }
 }
 #+END_SRC

 æ³¨æ„, æˆ‘ä»¬ç»™ç‚¹èµç»„ä»¶åŠ ä¸Šäº†ä»¥ä¸‹çš„ä»£ç :

 #+BEGIN_SRC javascript :results values list :exports no-eval
 static defaultProps = {
   likedText: 'å–æ¶ˆ',
   unlikedText: 'ç‚¹èµ'
 }
 #+END_SRC

 /*defaultProps ä½œä¸ºç‚¹èµæŒ‰é’®ç»„ä»¶çš„ç±»å±æ€§*/, é‡Œé¢æ˜¯å¯¹ props ä¸­å„ä¸ªå±æ€§çš„é»˜è®¤é…ç½®.
 è¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦åˆ¤æ–­é…ç½®å±æ€§æ˜¯å¦ä¼ è¿›æ¥äº†: å¦‚æœæ²¡æœ‰ä¼ è¿›æ¥, ä¼šç›´æ¥ä½¿ç”¨ defaultProps ä¸­çš„é»˜è®¤å±æ€§.
 æ‰€ä»¥å¯ä»¥çœ‹åˆ°, åœ¨ render å‡½æ•°ä¸­, æˆ‘ä»¬ä¼šç›´æ¥ä½¿ç”¨ this.props è€Œä¸éœ€è¦å†åšåˆ¤æ–­.

** props ä¸å¯å˜
 props ä¸€æ—¦ä¼ å…¥è¿›æ¥å°±ä¸èƒ½æ”¹å˜. ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­ä¸­çš„ handleClickOnLikeButton:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     handleClickOnLikeButton () {
       this.props.likedText = 'å–æ¶ˆ'
       this.setState({
         isLiked: !this.state.isLiked
       })
     }
 ...

 #+END_SRC
 æˆ‘ä»¬å°è¯•åœ¨ç”¨æˆ·ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™æ”¹å˜ this.props.likedText, ç„¶åä½ ä¼šçœ‹åˆ°æ§åˆ¶å°æŠ¥é”™äº†:

 [[file:./static/React.js å°ä¹¦/F170536D-CD3B-4828-B73E-33DC883A8E99.png]]

 ä½ ä¸èƒ½æ”¹å˜ä¸€ä¸ªç»„ä»¶è¢«æ¸²æŸ“çš„æ—¶å€™ä¼ è¿›æ¥çš„ props. React.js å¸Œæœ›ä¸€ä¸ªç»„ä»¶åœ¨è¾“å…¥ç¡®å®šçš„ props çš„æ—¶å€™, èƒ½å¤Ÿè¾“å‡ºç¡®å®šçš„ UI æ˜¾ç¤ºå½¢æ€.
 å¦‚æœ props æ¸²æŸ“è¿‡ç¨‹ä¸­å¯ä»¥è¢«ä¿®æ”¹, é‚£ä¹ˆå°±ä¼šå¯¼è‡´è¿™ä¸ªç»„ä»¶æ˜¾ç¤ºå½¢æ€å’Œè¡Œä¸ºå˜å¾—ä¸å¯é¢„æµ‹, è¿™æ ·ä¼šå¯èƒ½ä¼šç»™ç»„ä»¶ä½¿ç”¨è€…å¸¦æ¥å›°æƒ‘.

 ä½†è¿™å¹¶ä¸æ„å‘³ç€ç”± props å†³å®šçš„æ˜¾ç¤ºå½¢æ€ä¸èƒ½è¢«ä¿®æ”¹. ç»„ä»¶çš„ä½¿ç”¨è€…å¯ä»¥ä¸»åŠ¨åœ°é€šè¿‡é‡æ–°æ¸²æŸ“çš„æ–¹å¼æŠŠæ–°çš„ props ä¼ å…¥ç»„ä»¶å½“ä¸­,
 è¿™æ ·è¿™ä¸ªç»„ä»¶ä¸­ç”± props å†³å®šçš„æ˜¾ç¤ºå½¢æ€ä¹Ÿä¼šå¾—åˆ°ç›¸åº”çš„æ”¹å˜.

 ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­çš„ Index ç»„ä»¶:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Index extends Component {
   constructor () {
     super()
     this.state = {
       likedText: 'å·²èµ',
       unlikedText: 'èµ'
     }
   }

   handleClickOnChange () {
     this.setState({
       likedText: 'å–æ¶ˆ',
       unlikedText: 'ç‚¹èµ'
     })
   }

   render () {
     return (
       <div>
         <LikeButton
           likedText={this.state.likedText}
           unlikedText={this.state.unlikedText} />
         <div>
           <button onClick={this.handleClickOnChange.bind(this)}>
                         ä¿®æ”¹ wordings
           </button>
         </div>
       </div>
     )
   }
 }
 #+END_SRC

 åœ¨è¿™é‡Œ, æˆ‘ä»¬æŠŠ Index çš„ state ä¸­çš„ likedText å’Œ unlikedText ä¼ ç»™ LikeButton.
 Index è¿˜æœ‰å¦å¤–ä¸€ä¸ªæŒ‰é’®, ç‚¹å‡»è¿™ä¸ªæŒ‰é’®ä¼šé€šè¿‡ setState ä¿®æ”¹ Index çš„ state ä¸­çš„ä¸¤ä¸ªå±æ€§.

 ç”±äº setState ä¼šå¯¼è‡´ Index é‡æ–°æ¸²æŸ“, æ‰€ä»¥ LikedButton ä¼šæ¥æ”¶åˆ°æ–°çš„ props, å¹¶ä¸”é‡æ–°æ¸²æŸ“, äºæ˜¯å®ƒçš„æ˜¾ç¤ºå½¢æ€ä¹Ÿä¼šå¾—åˆ°æ›´æ–°.
 è¿™å°±æ˜¯é€šè¿‡é‡æ–°æ¸²æŸ“çš„æ–¹å¼æ¥ä¼ å…¥æ–°çš„ props ä»è€Œè¾¾åˆ°ä¿®æ”¹ LikedButton æ˜¾ç¤ºå½¢æ€çš„æ•ˆæœ.

** æ€»ç»“
 ä¸ºäº†ä½¿å¾—ç»„ä»¶çš„å¯å®šåˆ¶æ€§æ›´å¼º, åœ¨ä½¿ç”¨ç»„ä»¶çš„æ—¶å€™, å¯ä»¥åœ¨æ ‡ç­¾ä¸ŠåŠ å±æ€§æ¥ä¼ å…¥é…ç½®å‚æ•°.
 ç»„ä»¶å¯ä»¥åœ¨å†…éƒ¨é€šè¿‡ this.props è·å–åˆ°é…ç½®å‚æ•°, ç»„ä»¶å¯ä»¥æ ¹æ® props çš„ä¸åŒæ¥ç¡®å®šè‡ªå·±çš„æ˜¾ç¤ºå½¢æ€, è¾¾åˆ°å¯é…ç½®çš„æ•ˆæœ.
 å¯ä»¥é€šè¿‡ç»™ç»„ä»¶æ·»åŠ ç±»å±æ€§ defaultProps æ¥é…ç½®é»˜è®¤å‚æ•°.
 props ä¸€æ—¦ä¼ å…¥, ä½ å°±ä¸å¯ä»¥åœ¨ç»„ä»¶å†…éƒ¨å¯¹å®ƒè¿›è¡Œä¿®æ”¹. ä½†æ˜¯ä½ å¯ä»¥é€šè¿‡çˆ¶ç»„ä»¶ä¸»åŠ¨é‡æ–°æ¸²æŸ“çš„æ–¹å¼æ¥ä¼ å…¥æ–°çš„ props, ä»è€Œè¾¾åˆ°æ›´æ–°çš„æ•ˆæœ.

* state vs props
æˆ‘ä»¬æ¥ä¸€ä¸ªå…³äº state å’Œ props çš„æ€»ç»“.

state çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºç»„ä»¶ä¿å­˜, æ§åˆ¶, ä¿®æ”¹è‡ªå·±çš„å¯å˜çŠ¶æ€.state åœ¨ç»„ä»¶å†…éƒ¨åˆå§‹åŒ–, å¯ä»¥è¢«ç»„ä»¶è‡ªèº«ä¿®æ”¹, è€Œå¤–éƒ¨ä¸èƒ½è®¿é—®ä¹Ÿä¸èƒ½ä¿®æ”¹.
ä½ å¯ä»¥è®¤ä¸º state æ˜¯ä¸€ä¸ªå±€éƒ¨çš„, åªèƒ½è¢«ç»„ä»¶è‡ªèº«æ§åˆ¶çš„æ•°æ®æº.state ä¸­çŠ¶æ€å¯ä»¥é€šè¿‡ this.setState æ–¹æ³•è¿›è¡Œæ›´æ–°,setState ä¼šå¯¼è‡´ç»„ä»¶çš„é‡æ–°æ¸²æŸ“.

props çš„ä¸»è¦ä½œç”¨æ˜¯è®©ä½¿ç”¨è¯¥ç»„ä»¶çš„çˆ¶ç»„ä»¶å¯ä»¥ä¼ å…¥å‚æ•°æ¥é…ç½®è¯¥ç»„ä»¶.
å®ƒæ˜¯å¤–éƒ¨ä¼ è¿›æ¥çš„é…ç½®å‚æ•°, ç»„ä»¶å†…éƒ¨æ— æ³•æ§åˆ¶ä¹Ÿæ— æ³•ä¿®æ”¹. é™¤éå¤–éƒ¨ç»„ä»¶ä¸»åŠ¨ä¼ å…¥æ–°çš„ props, å¦åˆ™ç»„ä»¶çš„ props æ°¸è¿œä¿æŒä¸å˜.

state å’Œ props æœ‰ç€åƒä¸ä¸‡ç¼•çš„å…³ç³». å®ƒä»¬éƒ½å¯ä»¥å†³å®šç»„ä»¶çš„è¡Œä¸ºå’Œæ˜¾ç¤ºå½¢æ€.
ä¸€ä¸ªç»„ä»¶çš„ state ä¸­çš„æ•°æ®å¯ä»¥é€šè¿‡ props ä¼ ç»™å­ç»„ä»¶, ä¸€ä¸ªç»„ä»¶å¯ä»¥ä½¿ç”¨å¤–éƒ¨ä¼ å…¥çš„ props æ¥åˆå§‹åŒ–è‡ªå·±çš„ state.
ä½†æ˜¯å®ƒä»¬çš„èŒè´£å…¶å®éå¸¸æ˜æ™°åˆ†æ˜:state æ˜¯è®©ç»„ä»¶æ§åˆ¶è‡ªå·±çš„çŠ¶æ€,props æ˜¯è®©å¤–éƒ¨å¯¹ç»„ä»¶è‡ªå·±è¿›è¡Œé…ç½®.

å¦‚æœä½ è§‰å¾—è¿˜æ˜¯æä¸æ¸… state å’Œ props çš„ä½¿ç”¨åœºæ™¯, é‚£ä¹ˆè¯·è®°ä½ä¸€ä¸ªç®€å•çš„è§„åˆ™: /*å°½é‡å°‘åœ°ç”¨ state, å°½é‡å¤šåœ°ç”¨ props*/.

æ²¡æœ‰ state çš„ç»„ä»¶å« æ— çŠ¶æ€ç»„ä»¶(stateless component), è®¾ç½®äº† state çš„å«åš æœ‰çŠ¶æ€ç»„ä»¶(stateful component).
å› ä¸ºçŠ¶æ€ä¼šå¸¦æ¥ç®¡ç†çš„å¤æ‚æ€§, æˆ‘ä»¬å°½é‡å¤šåœ°å†™æ— çŠ¶æ€ç»„ä»¶, å°½é‡å°‘åœ°å†™æœ‰çŠ¶æ€çš„ç»„ä»¶.
è¿™æ ·ä¼šé™ä½ä»£ç ç»´æŠ¤çš„éš¾åº¦, ä¹Ÿä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢å¼ºç»„ä»¶çš„å¯å¤ç”¨æ€§. å‰ç«¯åº”ç”¨çŠ¶æ€ç®¡ç†æ˜¯ä¸€ä¸ªå¤æ‚çš„é—®é¢˜, æˆ‘ä»¬åç»­ä¼šç»§ç»­è®¨è®º.

React.js éå¸¸é¼“åŠ±æ— çŠ¶æ€ç»„ä»¶, åœ¨ 0.14 ç‰ˆæœ¬å¼•å…¥äº†å‡½æ•°å¼ç»„ä»¶â€”â€”ä¸€ç§å®šä¹‰ä¸èƒ½ä½¿ç”¨ state ç»„ä»¶, ä¾‹å¦‚ä¸€ä¸ªåŸæ¥è¿™æ ·å†™çš„ç»„ä»¶:

#+BEGIN_SRC javascript :results values list :exports no-eval
class HelloWorld extends Component {
  sayHi () {
    alert('Hello World')
  }

  render () {
    return (
      <div onClick={this.sayHi.bind(this)}>Hello World</div>
    )
  }
}
#+END_SRC

ç”¨å‡½æ•°å¼ç»„ä»¶çš„ç¼–å†™æ–¹å¼å°±æ˜¯:

#+BEGIN_SRC javascript :results values list :exports no-eval
const HelloWorld = (props) => {
  const sayHi = (event) => alert('Hello World')
  return (
    <div onClick={sayHi}>Hello World</div>
  )
}
#+END_SRC

ä»¥å‰ä¸€ä¸ªç»„ä»¶æ˜¯é€šè¿‡ç»§æ‰¿ Component æ¥æ„å»º, ä¸€ä¸ªå­ç±»å°±æ˜¯ä¸€ä¸ªç»„ä»¶. è€Œç”¨å‡½æ•°å¼çš„ç»„ä»¶ç¼–å†™æ–¹å¼æ˜¯ä¸€ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªç»„ä»¶, ä½ å¯ä»¥å’Œä»¥å‰ä¸€æ ·é€šè¿‡ <HellWorld /> ä½¿ç”¨è¯¥ç»„ä»¶.
ä¸åŒçš„æ˜¯, /*å‡½æ•°å¼ç»„ä»¶ åªèƒ½æ¥å— props è€Œæ— æ³•åƒè·Ÿç±»ç»„ä»¶ä¸€æ ·å¯ä»¥åœ¨ constructor é‡Œé¢åˆå§‹åŒ– state*/.
ä½ å¯ä»¥ç†è§£å‡½æ•°å¼ç»„ä»¶å°±æ˜¯ä¸€ç§åªèƒ½æ¥å— props å’Œæä¾› render æ–¹æ³•çš„ç±»ç»„ä»¶.

ä½†æœ¬ä¹¦å…¨ä¹¦ä¸é‡‡ç”¨è¿™ç§å‡½æ•°å¼çš„æ–¹å¼æ¥ç¼–å†™ç»„ä»¶, ç»Ÿä¸€é€šè¿‡ç»§æ‰¿ Component æ¥æ„å»ºç»„ä»¶.

* æ¸²æŸ“åˆ—è¡¨æ•°æ®
åˆ—è¡¨æ•°æ®åœ¨å‰ç«¯éå¸¸å¸¸è§, æˆ‘ä»¬ç»å¸¸è¦å¤„ç†è¿™ç§ç±»å‹çš„æ•°æ®, ä¾‹å¦‚æ–‡ç« åˆ—è¡¨, è¯„è®ºåˆ—è¡¨, ç”¨æˆ·åˆ—è¡¨â€¦ä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆå‡ ä¹æ¯å¤©éƒ½éœ€è¦è·Ÿåˆ—è¡¨æ•°æ®æ‰“äº¤é“.

React.js å½“ç„¶ä¹Ÿå…è®¸æˆ‘ä»¬å¤„ç†åˆ—è¡¨æ•°æ®, ä½†åœ¨ä½¿ç”¨ React.js å¤„ç†åˆ—è¡¨æ•°æ®çš„æ—¶å€™, éœ€è¦æŒæ¡ä¸€äº›è§„åˆ™. æˆ‘ä»¬è¿™ä¸€èŠ‚ä¼šä¸“é—¨è®¨è®ºè¿™æ–¹é¢çš„çŸ¥è¯†.

** æ¸²æŸ“å­˜æ”¾ JSX å…ƒç´ çš„æ•°ç»„
 å‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰è¿™ä¹ˆä¸€ä¸ªç”¨æˆ·åˆ—è¡¨æ•°æ®, å­˜æ”¾åœ¨ä¸€ä¸ªæ•°ç»„å½“ä¸­:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const users = [
   { username: 'Jerry', age: 21, gender: 'male' },
   { username: 'Tomy', age: 22, gender: 'male' },
   { username: 'Lily', age: 19, gender: 'female' },
   { username: 'Lucy', age: 20, gender: 'female' }
 ]
 #+END_SRC

 å¦‚æœç°åœ¨è¦æŠŠè¿™ä¸ªæ•°ç»„é‡Œé¢çš„æ•°æ®æ¸²æŸ“é¡µé¢ä¸Šè¦æ€ä¹ˆåš? å¼€å§‹ä¹‹å‰è¦è¡¥å……ä¸€ä¸ªçŸ¥è¯†.
 ä¹‹å‰è¯´è¿‡ JSX çš„è¡¨è¾¾å¼æ’å…¥ {} é‡Œé¢å¯ä»¥æ”¾ä»»ä½•æ•°æ®, å¦‚æœæˆ‘ä»¬å¾€ {} é‡Œé¢æ”¾ä¸€ä¸ªå­˜æ”¾ JSX å…ƒç´ çš„æ•°ç»„ä¼šæ€ä¹ˆæ ·?

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Index extends Component {
   render () {
     return (
       <div>
         {[
           <span>React.js </span>,
           <span>is </span>,
           <span>good</span>
         ]}
       </div>
     )
   }
 }

 ReactDOM.render(
   <Index />,
   document.getElementById('root')
 )
 #+END_SRC

 æˆ‘ä»¬å¾€ JSX é‡Œé¢å¡äº†ä¸€ä¸ªæ•°ç»„, è¿™ä¸ªæ•°ç»„é‡Œé¢æ”¾äº†ä¸€äº› JSX å…ƒç´ (å…¶å®å°±æ˜¯ JavaScript å¯¹è±¡). åˆ°æµè§ˆå™¨ä¸­, ä½ åœ¨é¡µé¢ä¸Šä¼šçœ‹åˆ°:

 [[file:./static/React.js å°ä¹¦/3ADE3817-7D91-4462-830D-1802D8345326.png]]

 å®¡æŸ¥ä¸€ä¸‹å…ƒç´ , çœ‹çœ‹ä¼šå‘ç°ä»€ä¹ˆ:

 [[file:./static/React.js å°ä¹¦/05FD6746-FEF5-4253-9802-EB563643DEDC.png]]

 React.js æŠŠæ’å…¥è¡¨è¾¾å¼æ•°ç»„é‡Œé¢çš„æ¯ä¸€ä¸ª JSX å…ƒç´ ä¸€ä¸ªä¸ªç½—åˆ—ä¸‹æ¥, æ¸²æŸ“åˆ°é¡µé¢ä¸Š.
 æ‰€ä»¥è¿™é‡Œæœ‰ä¸ªå…³é”®ç‚¹: å¦‚æœä½ å¾€ {} æ”¾ä¸€ä¸ªæ•°ç»„,React.js ä¼šå¸®ä½ æŠŠæ•°ç»„é‡Œé¢ä¸€ä¸ªä¸ªå…ƒç´ ç½—åˆ—å¹¶ä¸”æ¸²æŸ“å‡ºæ¥.

** ä½¿ç”¨ map æ¸²æŸ“åˆ—è¡¨æ•°æ®
 çŸ¥é“è¿™ä¸€ç‚¹ä»¥åä½ å°±å¯ä»¥çŸ¥é“æ€ä¹ˆç”¨å¾ªç¯æŠŠå…ƒç´ æ¸²æŸ“åˆ°é¡µé¢ä¸Š: å¾ªç¯ä¸Šé¢ç”¨æˆ·æ•°ç»„é‡Œé¢çš„æ¯ä¸€ä¸ªç”¨æˆ·, ä¸ºæ¯ä¸ªç”¨æˆ·æ•°æ®æ„å»ºä¸€ä¸ª JSX,
 ç„¶åæŠŠ JSX æ”¾åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„é‡Œé¢, å†æŠŠæ–°çš„æ•°ç»„æ’å…¥ render æ–¹æ³•çš„ JSX é‡Œé¢. çœ‹çœ‹ä»£ç æ€ä¹ˆå†™:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const users = [
   { username: 'Jerry', age: 21, gender: 'male' },
   { username: 'Tomy', age: 22, gender: 'male' },
   { username: 'Lily', age: 19, gender: 'female' },
   { username: 'Lucy', age: 20, gender: 'female' }
 ]

 class Index extends Component {
   render () {
     const usersElements = [] // ä¿å­˜æ¯ä¸ªç”¨æˆ·æ¸²æŸ“ä»¥å JSX çš„æ•°ç»„
     for (let user of users) {
       usersElements.push( // å¾ªç¯æ¯ä¸ªç”¨æˆ·, æ„å»º JSX,push åˆ°æ•°ç»„ä¸­
         <div>
           <div>å§“å:{user.username}</div>
           <div>å¹´é¾„:{user.age}</div>
           <div>æ€§åˆ«:{user.gender}</div>
           <hr />
         </div>
       )
     }

     return (
       <div>{usersElements}</div>
     )
   }
 }

 ReactDOM.render(
   <Index />,
   document.getElementById('root')
 )
 #+END_SRC

 è¿™é‡Œç”¨äº†ä¸€ä¸ªæ–°çš„æ•°ç»„ usersElements, ç„¶åå¾ªç¯ users æ•°ç»„, ä¸ºæ¯ä¸ª user æ„å»ºä¸€ä¸ª JSX ç»“æ„, ç„¶å push åˆ° usersElements ä¸­.
 ç„¶åç›´æ¥ç”¨è¡¨è¾¾å¼æ’å…¥, æŠŠè¿™ä¸ª userElements æ’åˆ° return çš„ JSX å½“ä¸­. å› ä¸º React.js ä¼šè‡ªåŠ¨åŒ–å¸®æˆ‘ä»¬æŠŠæ•°ç»„å½“ä¸­çš„ JSX ç½—åˆ—æ¸²æŸ“å‡ºæ¥, æ‰€ä»¥å¯ä»¥çœ‹åˆ°é¡µé¢ä¸Šæ˜¾ç¤º:

 [[file:./static/React.js å°ä¹¦/AABC1755-55EA-4E42-8763-A15234DB1F02.png]]

 ä½†æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šæ‰‹åŠ¨å†™å¾ªç¯æ¥æ„å»ºåˆ—è¡¨çš„ JSX ç»“æ„, å¯ä»¥ç›´æ¥ç”¨ ES6 è‡ªå¸¦çš„ map(ä¸äº†è§£ map å‡½æ•°çš„åŒå­¦å¯ä»¥å…ˆäº†è§£ç›¸å…³çš„çŸ¥è¯†å†æ¥å›é¡¾è¿™é‡Œ), ä»£ç å¯ä»¥ç®€åŒ–æˆ:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Index extends Component {
   render () {
     return (
       <div>
         {users.map((user) => {
           return (
             <div>
               <div>å§“å:{user.username}</div>
               <div>å¹´é¾„:{user.age}</div>
               <div>æ€§åˆ«:{user.gender}</div>
               <hr />
             </div>
           )
         })}
       </div>
     )
   }
 }
 #+END_SRC

 è¿™æ ·çš„æ¨¡å¼åœ¨ JavaScript ä¸­éå¸¸å¸¸è§, ä¸€èˆ¬æ¥è¯´, åœ¨ React.js å¤„ç†åˆ—è¡¨å°±æ˜¯ç”¨ map æ¥å¤„ç†, æ¸²æŸ“çš„.
 ç°åœ¨è¿›ä¸€æ­¥æŠŠæ¸²æŸ“å•ç‹¬ä¸€ä¸ªç”¨æˆ·çš„ç»“æ„æŠ½ç¦»å‡ºæ¥ä½œä¸ºä¸€ä¸ªç»„ä»¶, ç»§ç»­ä¼˜åŒ–ä»£ç :

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const users = [
   { username: 'Jerry', age: 21, gender: 'male' },
   { username: 'Tomy', age: 22, gender: 'male' },
   { username: 'Lily', age: 19, gender: 'female' },
   { username: 'Lucy', age: 20, gender: 'female' }
 ]

 class User extends Component {
   render () {
     const { user } = this.props
     return (
       <div>
         <div>å§“å:{user.username}</div>
         <div>å¹´é¾„:{user.age}</div>
         <div>æ€§åˆ«:{user.gender}</div>
         <hr />
       </div>
     )
   }
 }

 class Index extends Component {
   render () {
     return (
       <div>
         {users.map((user) => <User user={user} />)}
       </div>
     )
   }
 }

 ReactDOM.render(
   <Index />,
   document.getElementById('root')
 )
 #+END_SRC

 è¿™é‡ŒæŠŠè´Ÿè´£å±•ç¤ºç”¨æˆ·æ•°æ®çš„ JSX ç»“æ„æŠ½ç¦»æˆä¸€ä¸ªç»„ä»¶ User, å¹¶ä¸”é€šè¿‡ props æŠŠ user æ•°æ®ä½œä¸ºç»„ä»¶çš„é…ç½®å‚æ•°ä¼ è¿›å», è¿™æ ·æ”¹å†™ Index å°±éå¸¸æ¸…æ™°äº†, çœ‹ä¸€çœ¼å°±çŸ¥é“è´Ÿè´£æ¸²æŸ“ users åˆ—è¡¨, è€Œç”¨çš„ç»„ä»¶æ˜¯ User.

** key! key! key!
 ç°åœ¨ä»£ç è¿ä½œæ­£å¸¸, å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜. æ‰“å¼€æ§åˆ¶å°çœ‹çœ‹:

 [[file:./static/React.js å°ä¹¦/85CA5037-99C1-422C-99A4-AADA978C6801.png]]

 React.js æŠ¥é”™äº†. å¦‚æœéœ€è¦è¯¦ç»†è§£é‡Šè¿™é‡ŒæŠ¥é”™çš„åŸå› , ä¼°è®¡è¦å•ç‹¬å†™åŠæœ¬ä¹¦. ä½†å¯ä»¥ç®€å•è§£é‡Šä¸€ä¸‹.

 React.js çš„æ˜¯éå¸¸é«˜æ•ˆçš„, å®ƒé«˜æ•ˆä¾èµ–äºæ‰€è°“çš„ Virtual-DOM ç­–ç•¥. ç®€å•æ¥è¯´, èƒ½å¤ç”¨çš„è¯ React.js å°±ä¼šå°½é‡å¤ç”¨, æ²¡æœ‰å¿…è¦çš„è¯ç»å¯¹ä¸ç¢° DOM.
 å¯¹äºåˆ—è¡¨å…ƒç´ æ¥è¯´ä¹Ÿæ˜¯è¿™æ ·, ä½†æ˜¯å¤„ç†åˆ—è¡¨å…ƒç´ çš„å¤ç”¨æ€§ä¼šæœ‰ä¸€ä¸ªé—®é¢˜: å…ƒç´ å¯èƒ½ä¼šåœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­æ”¹å˜ä½ç½®. ä¾‹å¦‚:

 #+BEGIN_SRC html :results values list :exports no-eval
 <div>a</div>
 <div>b</div>
 <div>c</div>
 #+END_SRC

 å‡è®¾é¡µé¢ä¸Šæœ‰è¿™ä¹ˆ 3 ä¸ªåˆ—è¡¨å…ƒç´ , ç°åœ¨æ”¹å˜ä¸€ä¸‹ä½ç½®:

 #+BEGIN_SRC html :results values list :exports no-eval
 <div>a</div>
 <div>c</div>
 <div>b</div>
 #+END_SRC

 c å’Œ b çš„ä½ç½®äº’æ¢äº†. ä½†å…¶å® React.js åªéœ€è¦äº¤æ¢ä¸€ä¸‹ DOM ä½ç½®å°±è¡Œäº†, ä½†æ˜¯å®ƒå¹¶ä¸çŸ¥é“å…¶å®æˆ‘ä»¬åªæ˜¯æ”¹å˜äº†å…ƒç´ çš„ä½ç½®,
 æ‰€ä»¥å®ƒä¼šé‡æ–°æ¸²æŸ“åé¢ä¸¤ä¸ªå…ƒç´ (å†æ‰§è¡Œ Virtual-DOM ç­–ç•¥), è¿™æ ·ä¼šå¤§å¤§å¢åŠ  DOM æ“ä½œ. ä½†å¦‚æœç»™æ¯ä¸ªå…ƒç´ åŠ ä¸Šå”¯ä¸€çš„æ ‡è¯†,React.js å°±å¯ä»¥çŸ¥é“è¿™ä¸¤ä¸ªå…ƒç´ åªæ˜¯äº¤æ¢äº†ä½ç½®:

 #+BEGIN_SRC html :results values list :exports no-eval
 <div key='a'>a</div>
 <div key='b'>b</div>
 <div key='c'>c</div>
 #+END_SRC

 è¿™æ · React.js å°±ç®€å•çš„é€šè¿‡ key æ¥åˆ¤æ–­å‡ºæ¥, è¿™ä¸¤ä¸ªåˆ—è¡¨å…ƒç´ åªæ˜¯äº¤æ¢äº†ä½ç½®, å¯ä»¥å°½é‡å¤ç”¨å…ƒç´ å†…éƒ¨çš„ç»“æ„.

 è¿™é‡Œæ²¡å¬æ‡‚æ²¡æœ‰å…³ç³», åé¢æœ‰æœºä¼šä¼šç»§ç»­è®²è§£è¿™éƒ¨åˆ†å†…å®¹.
 ç°åœ¨åªéœ€è¦è®°ä½ä¸€ä¸ªç®€å•çš„è§„åˆ™: å¯¹äºç”¨è¡¨è¾¾å¼å¥—æ•°ç»„ç½—åˆ—åˆ°é¡µé¢ä¸Šçš„å…ƒç´ , éƒ½è¦ä¸ºæ¯ä¸ªå…ƒç´ åŠ ä¸Š key å±æ€§, è¿™ä¸ª key å¿…é¡»æ˜¯æ¯ä¸ªå…ƒç´ å”¯ä¸€çš„æ ‡è¯†. ä¸€èˆ¬æ¥è¯´,key çš„å€¼å¯ä»¥ç›´æ¥åå°æ•°æ®è¿”å›çš„ id, å› ä¸ºåå°çš„ id éƒ½æ˜¯å”¯ä¸€çš„.

 åœ¨ä¸Šé¢çš„ä¾‹å­å½“ä¸­, æ¯ä¸ª user æ²¡æœ‰ id å¯ä»¥ç”¨, å¯ä»¥ç›´æ¥ç”¨å¾ªç¯è®¡æ•°å™¨ i ä½œä¸º key:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Index extends Component {
   render () {
     return (
       <div>
         {users.map((user, i) => <User key={i} user={user} />)}
       </div>
     )
   }
 }
 #+END_SRC

 å†çœ‹çœ‹, æ§åˆ¶å°å·²ç»æ²¡æœ‰é”™è¯¯ä¿¡æ¯äº†.
 ä½†è¿™æ˜¯ä¸å¥½çš„åšæ³•, è¿™åªæ˜¯æ©è€³ç›—é“ƒ(å…·ä½“åŸå› å¤§å®¶å¯ä»¥è‡ªå·±æ€è€ƒä¸€ä¸‹).
 è®°ä½ä¸€ç‚¹: åœ¨å®é™…é¡¹ç›®å½“ä¸­, å¦‚æœä½ çš„æ•°æ®é¡ºåºå¯èƒ½å‘ç”Ÿå˜åŒ–, æ ‡å‡†åšæ³•æ˜¯æœ€å¥½æ˜¯åå°æ•°æ®è¿”å›çš„ id ä½œä¸ºåˆ—è¡¨å…ƒç´ çš„ key.

* å®æˆ˜åˆ†æ: è¯„è®ºåŠŸèƒ½(ä¸€)
è¯¾ç¨‹åˆ°è¿™é‡Œå¤§å®¶å·²ç»æŒæ¡äº† React.js çš„åŸºç¡€çŸ¥è¯†å’Œç»„ä»¶çš„åŸºæœ¬å†™æ³•äº†. ç°åœ¨å¯ä»¥æŠŠæˆ‘ä»¬æ‰€å­¦åˆ°çš„å†…å®¹åº”ç”¨äºå®æˆ˜å½“ä¸­. è¿™é‡Œç»™å¤§å®¶æä¾›ä¸€ä¸ªå®æˆ˜çš„æ¡ˆä¾‹: ä¸€ä¸ªè¯„è®ºåŠŸèƒ½. æ•ˆæœå¦‚ä¸‹:

[[file:./static/React.js å°ä¹¦/2B86ED50-DDF5-4B3A-82A0-DECFD6767A8F.png]]

[[https://huzidaha.github.io/react-naive-book-examples/comment-app/build/index.html][åœ¨çº¿æ¼”ç¤ºåœ°å€]]

æ¥ä¸‹æ¥ä¼šå¸¦å¤§å®¶ä¸€èµ·æ¥å­¦ä¹ å¦‚ä½•åˆ†æ, ç¼–å†™è¿™ä¸ªåŠŸèƒ½. åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šè¡¥å……ä¸€äº›ä¹‹å‰æ²¡æœ‰æåŠçš„çŸ¥è¯†ç‚¹, è™½ç„¶è¿™äº›çŸ¥è¯†ç‚¹ä¹‹å‰æ²¡æœ‰å•ç‹¬æ‹¿å‡ºæ¥è®²è§£, ä½†æ˜¯è¿™äº›çŸ¥è¯†ç‚¹ä¹Ÿå¾ˆå…³é”®.

** ç»„ä»¶åˆ’åˆ†
 React.js ä¸­ä¸€åˆ‡éƒ½æ˜¯ç»„ä»¶, ç”¨ React.js æ„å»ºçš„åŠŸèƒ½å…¶å®ä¹Ÿå°±æ˜¯ç”±å„ç§ç»„ä»¶ç»„åˆè€Œæˆ.
 æ‰€ä»¥æ‹¿åˆ°ä¸€ä¸ªéœ€æ±‚ä»¥å, æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯ç†è§£éœ€æ±‚, åˆ†æéœ€æ±‚, åˆ’åˆ†è¿™ä¸ªéœ€æ±‚ç”±å“ªäº›ç»„ä»¶æ„æˆ.

 ç»„ä»¶çš„åˆ’åˆ†æ²¡æœ‰ç‰¹åˆ«æ˜ç¡®çš„æ ‡å‡†. åˆ’åˆ†ç»„ä»¶çš„ç›®çš„æ€§æ˜¯ä¸ºäº†ä»£ç å¯å¤ç”¨æ€§, å¯ç»´æŠ¤æ€§.
 åªè¦æŸä¸ªéƒ¨åˆ†æœ‰å¯èƒ½å¤ç”¨åˆ°åˆ«çš„åœ°æ–¹, ä½ éƒ½å¯ä»¥æŠŠå®ƒæŠ½ç¦»å‡ºæ¥å½“æˆä¸€ä¸ªç»„ä»¶, æˆ–è€…æŠŠæŸä¸€éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥å¯¹ä»£ç çš„ç»„ç»‡å’Œç®¡ç†ä¼šå¸¦æ¥å¸®åŠ©, ä½ ä¹Ÿå¯ä»¥æ¯«ä¸çŠ¹è±«åœ°æŠŠå®ƒæŠ½ç¦»å‡ºæ¥.

 å¯¹äºä¸Šé¢è¿™ä¸ªè¯„è®ºåŠŸèƒ½, å¯ä»¥ç²—ç•¥åœ°åˆ’åˆ†æˆä»¥ä¸‹å‡ éƒ¨åˆ†:

 [[file:./static/React.js å°ä¹¦/1.png]]

 - CommentApp: è¯„è®ºåŠŸèƒ½çš„æ•´ä½“ç”¨ä¸€ä¸ªå« CommentApp çš„ç»„ä»¶åŒ…å«èµ·æ¥.CommentApp åŒ…å«ä¸Šéƒ¨å’Œä¸‹éƒ¨ä¸¤éƒ¨åˆ†.
 - CommentInput: ä¸Šé¢éƒ¨åˆ†æ˜¯è´Ÿè´£ç”¨æˆ·è¾“å…¥å¯æ“ä½œçš„è¾“å…¥åŒºåŸŸ, åŒ…æ‹¬è¾“å…¥è¯„è®ºçš„ç”¨æˆ·å, è¯„è®ºå†…å®¹å’Œå‘å¸ƒæŒ‰é’®, è¿™ä¸€éƒ¨åˆ†åŠŸèƒ½åˆ’åˆ†åˆ°ä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶ CommentInput ä¸­.
 - CommentList: ä¸‹é¢éƒ¨åˆ†æ˜¯è¯„è®ºåˆ—è¡¨, ç”¨ä¸€ä¸ªå« CommentList çš„ç»„ä»¶è´Ÿè´£åˆ—è¡¨çš„å±•ç¤º.
 - Comment: æ¯ä¸ªè¯„è®ºåˆ—è¡¨é¡¹ç”±ç‹¬ç«‹çš„ç»„ä»¶ Comment è´Ÿè´£æ˜¾ç¤º, è¿™ä¸ªç»„ä»¶è¢« CommentList æ‰€ä½¿ç”¨.

 æ‰€ä»¥è¿™ä¸ªè¯„è®ºåŠŸèƒ½åˆ’åˆ†æˆå››ç§ç»„ä»¶,CommentApp,CommentInput,CommentList,Comment. ç”¨ç»„ä»¶æ ‘è¡¨ç¤º:

 [[file:./static/React.js å°ä¹¦/DAFA784B-6AD3-474B-9A87-316E5741DED6.png]]

 ç°åœ¨å°±å¯ä»¥å°è¯•ç¼–å†™ä»£ç äº†.

** ç»„ä»¶å®ç°
 åœ¨å†™ä»£ç ä¹‹å‰, æˆ‘ä»¬å…ˆç”¨ create-react-app æ„å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹ç›®å½•. æ‰€æœ‰çš„è¯„è®ºåŠŸèƒ½åœ¨è¿™ä¸ªå·¥ç¨‹å†…å®Œæˆ:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 create-react-app comment-app
 #+END_SRC

 ç„¶ååœ¨å·¥ç¨‹ç›®å½•ä¸‹çš„ src/ ç›®å½•ä¸‹æ–°å»ºå››ä¸ªæ–‡ä»¶, æ¯ä¸ªæ–‡ä»¶å¯¹åº”çš„æ˜¯ä¸Šè¿°çš„å››ä¸ªç»„ä»¶.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 src/
     CommentApp.js
     CommentInput.js
     CommentList.js
     Comment.js
 ...
 #+END_SRC

 ä½ å¯ä»¥æ³¨æ„åˆ°, è¿™é‡Œçš„æ–‡ä»¶åçš„å¼€å¤´æ˜¯å¤§å†™å­—æ¯. æˆ‘ä»¬éµå¾ªä¸€ä¸ªåŸåˆ™: /*å¦‚æœä¸€ä¸ªæ–‡ä»¶å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªç±», é‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶åå°±ç”¨å¤§å†™å¼€å¤´*/. å››ä¸ªç»„ä»¶ç±»æ–‡ä»¶å¯¼å‡ºéƒ½æ˜¯ç±», æ‰€ä»¥éƒ½æ˜¯å¤§å†™å­—æ¯å¼€å¤´.

 æˆ‘ä»¬å…ˆé“ºå«ä¸€äº›åŸºç¡€ä»£ç , è®©ç»„ä»¶ä¹‹é—´çš„å…³ç³»æ¸…æ™°èµ·æ¥.
 éµå¾ª" è‡ªé¡¶è€Œä¸‹, é€æ­¥æ±‚ç²¾" çš„åŸåˆ™, æˆ‘ä»¬ä»ç»„ä»¶çš„é¡¶å±‚å¼€å§‹, å†ä¸€æ­¥æ­¥å¾€ä¸‹æ„å»ºç»„ä»¶æ ‘. å…ˆä¿®æ”¹ CommentApp.js å¦‚ä¸‹:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'
 import CommentInput from './CommentInput'
 import CommentList from './CommentList'

 class CommentApp extends Component {
   render () {
     return (
       <div>
         <CommentInput />
         <CommentList />
       </div>
     )
   }
 }

 export default CommentApp
 #+END_SRC

 CommentApp ç°åœ¨æš‚æ—¶è¿˜å¾ˆç®€å•, æ–‡ä»¶é¡¶éƒ¨å¼•å…¥äº† CommentInput å’Œ CommentList.
 ç„¶åæŒ‰ç…§ä¸Šé¢çš„éœ€æ±‚, åº”ç”¨åœ¨äº† CommentApp è¿”å›çš„ JSX ç»“æ„ä¸­, ä¸Šé¢æ˜¯ç”¨æˆ·è¾“å…¥åŒºåŸŸ, ä¸‹é¢æ˜¯è¯„è®ºåˆ—è¡¨.

 ç°åœ¨æ¥ä¿®æ”¹ CommentInput.js ä¸­çš„å†…å®¹:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'

 class CommentInput extends Component {
   render () {
     return (
       <div>CommentInput</div>
     )
   }
 }

 export default CommentInput
 #+END_SRC

 è¿™é‡Œæš‚æ—¶è®©å®ƒåªç®€å•è¿”å› <div> ç»“æ„, åŒæ ·åœ°ä¿®æ”¹ CommentList.js:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'

 class CommentList extends Component {
   render () {
     return (
       <div>CommentList</div>
     )
   }
 }

 export default CommentList
 #+END_SRC

 ç°åœ¨å¯ä»¥æŠŠè¿™ä¸ªç®€å•çš„ç»“æ„æ¸²æŸ“åˆ°é¡µé¢ä¸Šçœ‹çœ‹ä»€ä¹ˆæ•ˆæœ, ä¿®æ”¹ src/index.js:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React from 'react'
 import ReactDOM from 'react-dom'
 import CommentApp from './CommentApp'
 import './index.css'

 ReactDOM.render(
   <CommentApp />,
   document.getElementById('root')
 )
 #+END_SRC

 ç„¶åè¿›å…¥å·¥ç¨‹ç›®å½•å¯åŠ¨å·¥ç¨‹:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 npm run start
 #+END_SRC

 åœ¨æµè§ˆå™¨ä¸­å¯ä»¥çœ‹åˆ°, åŸºæœ¬çš„ç»“æ„å·²ç»æ¸²æŸ“åˆ°äº†é¡µé¢ä¸Šäº†:

 [[file:./static/React.js å°ä¹¦/F1DAEB81-6DE9-4031-8476-9AA7047E4DA6.png]]

** æ·»åŠ æ ·å¼
 ç°åœ¨æƒ³è®©è¿™ä¸ªç»“æ„åœ¨æµè§ˆå™¨ä¸­å±…ä¸­æ˜¾ç¤º, æˆ‘ä»¬å°±è¦ç»™ CommentApp é‡Œé¢çš„ <div> æ·»åŠ æ ·å¼.
 ä¿®æ”¹ CommentApp ä¸­çš„ render æ–¹æ³•, ç»™å®ƒæ·»åŠ ä¸€ä¸ª wrapper ç±»å:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class CommentApp extends Component {
   render () {
     return (
       <div className='wrapper'>
         <CommentInput />
         <CommentList />
       </div>
     )
   }
 }
 #+END_SRC

 ååœ¨ index.css æ–‡ä»¶ä¸­æ·»åŠ æ ·å¼:

 #+BEGIN_SRC css :results values list :exports no-eval
 .wrapper {
   width: 500px;
   margin: 10px auto;
   font-size: 14px;
   background-color: #fff;
   border: 1px solid #f1f1f1;
   padding: 20px;
 }
 #+END_SRC

 åœ¨æµè§ˆå™¨ä¸­å¯ä»¥çœ‹åˆ°æ ·å¼ç”Ÿæ•ˆäº†:

 [[file:./static/React.js å°ä¹¦/770AFFBC-852C-4770-965A-695B43B7BB65.png]]

 è¯„è®ºåŠŸèƒ½æ¡ˆä¾‹çš„æ‰€æœ‰æ ·å¼éƒ½æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œæ·»åŠ .
 ç”±äºæˆ‘ä»¬ä¸“æ³¨ç‚¹åœ¨äº React.js, æœ¬æ¡ˆä¾‹åç»­ä¸ä¼šåœ¨æ ·å¼ä¸Šè¿‡äºçº ç¼ . è¿™é‡Œå†™å¥½äº†ä¸€ä¸ªæ ·å¼æ–‡ä»¶(index.css) æä¾›ç»™å¤§å®¶, å¯ä»¥å¤åˆ¶åˆ° index.css å½“ä¸­.
 åç»­åªéœ€è¦åœ¨å…ƒç´ ä¸ŠåŠ ä¸Šç±»åå°±å¯ä»¥äº†.

 å¦‚ä½•åœ¨ React.js ä¸­ä½¿ç”¨æ ·å¼æœ‰å¾ˆå¤šç§æ–¹å¼, ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„è¯é¢˜, æœ‰å¾ˆå¤šç§ä¸åŒçš„æ–¹å¼ä¹Ÿæœ‰å¾ˆå¤šä¸åŒçš„äº‰è®º, è¿™ä¸ªè¯é¢˜åç»­æœ‰æœºä¼šä¼šé‡ç‚¹è®²è§£.

* å®æˆ˜åˆ†æ: è¯„è®ºåŠŸèƒ½(äºŒ)
ä¸Šä¸€èŠ‚æˆ‘ä»¬æ„å»ºäº†åŸºæœ¬çš„ä»£ç æ¡†æ¶, ç°åœ¨å¼€å§‹å®Œå–„å…¶ä»–çš„å†…å®¹.

** å¤„ç†ç”¨æˆ·è¾“å…¥
 æˆ‘ä»¬ä» ComponentInput ç»„ä»¶å¼€å§‹, å­¦ä¹  React.js æ˜¯å¦‚ä½•å¤„ç†ç”¨æˆ·è¾“å…¥çš„.
 é¦–å…ˆä¿®æ”¹ ComponentInput.js, å®Œå–„ ComponentInput çš„ render å‡½æ•°ä¸­çš„ HTML ç»“æ„:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'

 class CommentInput extends Component {
   render () {
     return (
       <div className='comment-input'>
         <div className='comment-field'>
           <span className='comment-field-name'>ç”¨æˆ·å:</span>
           <div className='comment-field-input'>
             <input />
           </div>
         </div>
         <div className='comment-field'>
           <span className='comment-field-name'>è¯„è®ºå†…å®¹:</span>
           <div className='comment-field-input'>
             <textarea />
           </div>
         </div>
         <div className='comment-field-button'>
           <button>å‘å¸ƒ</button>
         </div>
       </div>
     )
   }
 }

 export default CommentInput
 #+END_SRC

 åœ¨æµè§ˆå™¨ä¸­å¯ä»¥çœ‹åˆ° ComponentInput çš„ç»“æ„å’Œæ ·å¼éƒ½å·²ç»ç”Ÿæ•ˆ:

 [[file:./static/React.js å°ä¹¦/E384080A-1876-4C76-B2B8-940D3EB2E774.png]]

 å› ä¸ºè¿˜æ²¡æœ‰åŠ å…¥å¤„ç†é€»è¾‘, æ‰€ä»¥ä½ è¾“å…¥å†…å®¹, ç„¶åç‚¹å‡»å‘å¸ƒæ˜¯ä¸ä¼šæœ‰ä»€ä¹ˆæ•ˆæœçš„.
 ç”¨æˆ·å¯è¾“å…¥å†…å®¹ä¸€ä¸ªæ˜¯ç”¨æˆ·å(username), ä¸€ä¸ªæ˜¯è¯„è®ºå†…å®¹(content), æˆ‘ä»¬åœ¨ç»„ä»¶çš„æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ä¸€ä¸ª state æ¥ä¿å­˜è¿™ä¸¤ä¸ªçŠ¶æ€:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class CommentInput extends Component {
   constructor () {
     super()
     this.state = {
       username: '',
       content: ''
     }
   }
 }
 #+END_SRC

 ç„¶åç»™è¾“å…¥æ¡†è®¾ç½® value å±æ€§, è®©å®ƒä»¬çš„ value å€¼ç­‰äº this.state é‡Œé¢ç›¸åº”çš„å€¼:

 #+BEGIN_SRC html :results values list :exports no-eval
 ...
     <div className='comment-field'>
         <span className='comment-field-name'>ç”¨æˆ·å:</span>
         <div className='comment-field-input'>
             <input value={this.state.username} />
         </div>
     </div>
     <div className='comment-field'>
         <span className='comment-field-name'>è¯„è®ºå†…å®¹:</span>
         <div className='comment-field-input'>
             <textarea value={this.state.content} />
         </div>
     </div>
 ...
 #+END_SRC

 å¯ä»¥çœ‹åˆ°æ¥å—ç”¨æˆ·åè¾“å…¥çš„ <input /> å’Œæ¥å—ç”¨æˆ·è¯„è®ºå†…å®¹çš„ <textarea /> çš„ value å€¼åˆ†åˆ«ç”± state.username å’Œ state.content æ§åˆ¶.
 è¿™æ—¶å€™ä½ åˆ°æµè§ˆå™¨é‡Œé¢å»è¾“å…¥å†…å®¹çœ‹çœ‹, ä½ ä¼šå‘ç°ä½ ä»€ä¹ˆéƒ½è¾“å…¥ä¸äº†.

 è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?React.js è®¤ä¸ºæ‰€æœ‰çš„çŠ¶æ€éƒ½åº”è¯¥ç”± React.js çš„ state æ§åˆ¶, åªè¦ç±»ä¼¼äº <input />,<textarea />,<select /> è¿™æ ·çš„è¾“å…¥æ§ä»¶è¢«è®¾ç½®äº† value å€¼,
 é‚£ä¹ˆå®ƒä»¬çš„å€¼æ°¸è¿œä»¥è¢«è®¾ç½®çš„å€¼ä¸ºå‡†.
 å€¼ä¸å˜,value å°±ä¸ä¼šå˜åŒ–.

 ä¾‹å¦‚, ä¸Šé¢è®¾ç½®äº† <input /> çš„ value ä¸º this.state.username,username åœ¨ constructor ä¸­è¢«åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸².
 å³ä½¿ç”¨æˆ·åœ¨è¾“å…¥æ¡†é‡Œé¢å°è¯•è¾“å…¥å†…å®¹äº†, è¿˜æ˜¯æ²¡æœ‰æ”¹å˜ this.state.username æ˜¯ç©ºå­—ç¬¦ä¸²çš„äº‹å®.

 æ‰€ä»¥åº”è¯¥æ€ä¹ˆåšæ‰èƒ½æŠŠç”¨æˆ·å†…å®¹è¾“å…¥æ›´æ–°åˆ°è¾“å…¥æ¡†å½“ä¸­å‘¢?
 åœ¨ React.js å½“ä¸­å¿…é¡»è¦ç”¨ setState æ‰èƒ½æ›´æ–°ç»„ä»¶çš„å†…å®¹, æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯: ç›‘å¬è¾“å…¥æ¡†çš„ onChange äº‹ä»¶,
 ç„¶åè·å–åˆ°ç”¨æˆ·è¾“å…¥çš„å†…å®¹, å†é€šè¿‡ setState çš„æ–¹å¼æ›´æ–° state ä¸­çš„ username, è¿™æ · input çš„å†…å®¹æ‰ä¼šæ›´æ–°.

 #+CAPTION: ç›‘å¬ç”¨æˆ·åè¾“å…¥æ¡† 1
 #+BEGIN_SRC html :results values list :exports no-eval
 ...
      <div className='comment-field-input'>
        <input
          value={this.state.username}
          onChange={this.handleUsernameChange.bind(this)} />
      </div>
  ...
 #+END_SRC
 <<ç›‘å¬ç”¨æˆ·åè¾“å…¥æ¡† 1>>

 ä¸Šé¢çš„ä»£ç ç»™ input åŠ ä¸Šäº† onChange äº‹ä»¶ç›‘å¬, ç»‘å®šåˆ° this.handleUsernameChange æ–¹æ³•ä¸­, è¯¥æ–¹æ³•å®ç°å¦‚ä¸‹:

 #+CAPTION: ç›‘å¬ç”¨æˆ·åè¾“å…¥æ¡† 2
 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     handleUsernameChange (event) {
       this.setState({
         username: event.target.value
       })
     }
 ...
 #+END_SRC
 <<ç›‘å¬ç”¨æˆ·åè¾“å…¥æ¡† 2>>

 åœ¨è¿™ä¸ªæ–¹æ³•ä¸­, æˆ‘ä»¬é€šè¿‡ event.target.value è·å– <input /> ä¸­ç”¨æˆ·è¾“å…¥çš„å†…å®¹, ç„¶åé€šè¿‡ setState æŠŠå®ƒè®¾ç½®åˆ° state.username å½“ä¸­,
 è¿™æ—¶å€™ç»„ä»¶çš„å†…å®¹å°±ä¼šæ›´æ–°,input çš„ value å€¼å°±ä¼šå¾—åˆ°æ›´æ–°å¹¶æ˜¾ç¤ºåˆ°è¾“å…¥æ¡†å†…. è¿™æ—¶å€™è¾“å…¥å·²ç»æ²¡æœ‰é—®é¢˜äº†:

 [[file:./static/React.js å°ä¹¦/10C463F1-26E4-4E05-8945-9B56D5F68CDD.png]]

 ç±»ä¼¼äº <input />,<select />,<textarea> è¿™äº›å…ƒç´ çš„ value å€¼è¢« React.js æ‰€æ§åˆ¶, æ¸²æŸ“çš„ç»„ä»¶,
 åœ¨ React.js å½“ä¸­è¢«ç§°ä¸º /*å—æ§ç»„ä»¶(Controlled Component)*/.
 å¯¹äºç”¨æˆ·å¯è¾“å…¥çš„æ§ä»¶, ä¸€èˆ¬éƒ½å¯ä»¥è®©å®ƒä»¬æˆä¸ºå—æ§ç»„ä»¶, è¿™æ˜¯ React.js æ‰€æ¨å´‡çš„åšæ³•. å¦å¤–è¿˜æœ‰éå—æ§ç»„ä»¶, è¿™é‡Œæš‚æ—¶ä¸æåŠ.

 åŒæ ·åœ°, è®© <textarea /> æˆä¸ºå—æ§ç»„ä»¶:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     handleContentChange (event) {
       this.setState({
         content: event.target.value
       })
     }
 ...
     <div className='comment-field'>
       <span className='comment-field-name'>è¯„è®ºå†…å®¹:</span>
         <div className='comment-field-input'>
           <textarea
             value={this.state.content}
             onChange={this.handleContentChange.bind(this)} />
         </div>
     </div>
 ...
 #+END_SRC

** å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®
 å½“ç”¨æˆ·åœ¨ CommentInput é‡Œé¢è¾“å…¥å®Œå†…å®¹ä»¥å, ç‚¹å‡»å‘å¸ƒ, å†…å®¹å…¶å®æ˜¯éœ€è¦æ˜¾ç¤ºåˆ° CommentList ç»„ä»¶å½“ä¸­çš„. ä½†è¿™ä¸¤ä¸ªç»„ä»¶æ˜æ˜¾æ˜¯å•ç‹¬çš„, åˆ†ç¦»çš„ç»„ä»¶. æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ä¹‹å‰æ˜¯æ€ä¹ˆåˆ’åˆ†ç»„ä»¶çš„:

 [[file:./static/React.js å°ä¹¦/DAFA784B-6AD3-474B-9A87-316E5741DED6.png]]

 å¯ä»¥çœ‹åˆ°,CommentApp ç»„ä»¶å°† CommentInput å’Œ CommentList ç»„åˆèµ·æ¥, å®ƒæ˜¯å®ƒä»¬ä¿©çš„çˆ¶ç»„ä»¶, å¯ä»¥å……å½“æ¡¥æ¥ä¸¤ä¸ªå­ç»„ä»¶çš„æ¡¥æ¢.
 æ‰€ä»¥å½“ç”¨æˆ·ç‚¹å‡»å‘å¸ƒæŒ‰é’®çš„æ—¶å€™, æˆ‘ä»¬å°±å°† CommentInput çš„ state å½“ä¸­æœ€æ–°çš„è¯„è®ºæ•°æ®ä¼ é€’ç»™çˆ¶ç»„ä»¶ CommentApp, ç„¶åè®©çˆ¶ç»„ä»¶æŠŠè¿™ä¸ªæ•°æ®ä¼ é€’ç»™ CommentList è¿›è¡Œæ¸²æŸ“.

 CommentInput å¦‚ä½•å‘ CommentApp ä¼ é€’çš„æ•°æ®?
 çˆ¶ç»„ä»¶ CommentApp åªéœ€è¦é€šè¿‡ props ç»™å­ç»„ä»¶ CommentInput ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°.
 å½“ç”¨æˆ·ç‚¹å‡»å‘å¸ƒæŒ‰é’®çš„æ—¶å€™,CommentInput è°ƒç”¨ props ä¸­çš„å›è°ƒå‡½æ•°å¹¶ä¸”å°† state ä¼ å…¥è¯¥å‡½æ•°å³å¯.

 å…ˆç»™å‘å¸ƒæŒ‰é’®æ·»åŠ äº‹ä»¶:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     <div className='comment-field-button'>
       <button onClick={this.handleSubmit.bind(this)}>
       å‘å¸ƒ
       </button>
     </div>
 ...
 #+END_SRC

 ç”¨æˆ·ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ä¼šè°ƒç”¨ this.handleSubmit æ–¹æ³•:

 #+CAPTION: CommentInput.handleSubmit
 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     handleSubmit () {
       if (this.props.onSubmit) {
         const { username, content } = this.state
         this.props.onSubmit({username, content})
         }
       this.setState({ content: '' })
     }
 ...
 #+END_SRC
 <<CommentInput.handleSubmit>>

 [[CommentApp.handleSubmitComment][See: CommentApp.handleSubmitComment]]

 handleSubmit æ–¹æ³•ä¼šåˆ¤æ–­ props ä¸­æ˜¯å¦ä¼ å…¥äº† onSubmit å±æ€§. æœ‰çš„è¯å°±è°ƒç”¨è¯¥å‡½æ•°, å¹¶ä¸”æŠŠç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œè¯„è®ºæ•°æ®ä¼ å…¥è¯¥å‡½æ•°.
 ç„¶åå†é€šè¿‡ setState æ¸…ç©ºç”¨æˆ·è¾“å…¥çš„è¯„è®ºå†…å®¹(ä½†ä¸ºäº†ç”¨æˆ·ä½“éªŒ, ä¿ç•™è¾“å…¥çš„ç”¨æˆ·å).

 ä¿®æ”¹ CommentApp.js, è®©å®ƒå¯ä»¥é€šè¿‡ä¼ å…¥å›è°ƒæ¥è·å–åˆ°æ–°å¢è¯„è®ºæ•°æ®:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class CommentApp extends Component {
   handleSubmitComment (comment) {
     console.log(comment)
   }

   render () {
     return (
       <div className='wrapper'>
         <CommentInput
           onSubmit={this.handleSubmitComment.bind(this)} />
         <CommentList />
       </div>
     )
   }
 }
 #+END_SRC

 åœ¨ CommentApp ä¸­ç»™ CommentInput ä¼ å…¥ä¸€ä¸ª onSubmit å±æ€§, è¿™ä¸ªå±æ€§å€¼æ˜¯ CommentApp è‡ªå·±çš„ä¸€ä¸ªæ–¹æ³• handleSubmitComment.
 è¿™æ · CommentInput å°±å¯ä»¥è°ƒç”¨ this.props.onSubmit(â€¦) æŠŠæ•°æ®ä¼ ç»™ CommenApp.

 ç°åœ¨åœ¨ CommentInput ä¸­è¾“å…¥å®Œè¯„è®ºå†…å®¹ä»¥åç‚¹å‡»å‘å¸ƒ, å°±å¯ä»¥çœ‹åˆ° CommentApp åœ¨æ§åˆ¶å°æ‰“å°çš„æ•°æ®:

 [[file:./static/React.js å°ä¹¦/7F15DF0A-1DC8-436A-98F4-E6072DCD78BE.png]]

 è¿™æ ·å°±é¡ºåˆ©åœ°æŠŠæ•°æ®ä¼ é€’ç»™äº†çˆ¶ç»„ä»¶, æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å¤„ç†è¯„è®ºåˆ—è¡¨ç›¸å…³çš„é€»è¾‘.

* å®æˆ˜åˆ†æ: è¯„è®ºåŠŸèƒ½(ä¸‰)
æ¥ä¸‹æ¥çš„ä»£ç æ¯”è¾ƒé¡ºç†æˆç« äº†. ä¿®æ”¹ CommentList å¯ä»¥è®©å®ƒå¯ä»¥æ˜¾ç¤ºè¯„è®ºåˆ—è¡¨:

#+BEGIN_SRC javascript :results values list :exports no-eval
// CommentList.js
import React, { Component } from 'react'

class CommentList extends Component {
  render () {
    const comments = [
      { username: 'Jerry', content: 'Hello' },
      { username: 'Tomy', content: 'World' },
      { username: 'Lucy', content: 'Good' }
    ]

    return (
      <div>{comments.map((comment, i) => {
        return (
          <div key={i}>
            {comment.username}:{comment.content}
          </div>
        )
      })}
      </div>
    )
  }
}

export default CommentList
#+END_SRC

è¿™é‡Œçš„ä»£ç æ²¡æœ‰ä»€ä¹ˆæ–°é²œçš„å†…å®¹, åªä¸è¿‡æ˜¯å»ºç«‹äº†ä¸€ä¸ª comments çš„æ•°ç»„æ¥å­˜æ”¾ä¸€äº›æµ‹è¯•æ•°æ®çš„å†…å®¹, æ–¹ä¾¿æˆ‘ä»¬åç»­æµ‹è¯•.
ç„¶åæŠŠ comments çš„æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸Š, è¿™è·Ÿæˆ‘ä»¬ä¹‹å‰è®²è§£çš„ç« èŠ‚çš„å†…å®¹ä¸€æ ·â€”â€”ä½¿ç”¨ map æ„å»ºä¸€ä¸ªå­˜æ”¾ JSX çš„æ•°ç»„. å°±å¯ä»¥åœ¨æµè§ˆå™¨çœ‹åˆ°æ•ˆæœ:

[[file:./static/React.js å°ä¹¦/4EFF52CA-B573-4DBB-A313-8ADD90F65F24.png]]

ä¿®æ”¹ Comment.js è®©å®ƒæ¥è´Ÿè´£å…·ä½“æ¯æ¡è¯„è®ºå†…å®¹çš„æ¸²æŸ“:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'

class Comment extends Component {
  render () {
    return (
      <div className='comment'>
        <div className='comment-user'>
          <span>{this.props.comment.username} </span>:
        </div>
        <p>{this.props.comment.content}</p>
      </div>
    )
  }
}

export default Comment
#+END_SRC

è¿™ä¸ªç»„ä»¶å¯èƒ½æ˜¯æˆ‘ä»¬æ¡ˆä¾‹é‡Œé¢æœ€ç®€å•çš„ç»„ä»¶äº†, å®ƒåªè´Ÿè´£æ¯æ¡è¯„è®ºçš„å…·ä½“æ˜¾ç¤º.
ä½ åªéœ€è¦ç»™å®ƒçš„ props ä¸­ä¼ å…¥ä¸€ä¸ª comment å¯¹è±¡, å®ƒå°±ä¼šæŠŠè¯¥å¯¹è±¡ä¸­çš„ username å’Œ content æ¸²æŸ“åˆ°é¡µé¢ä¸Š.

é©¬ä¸ŠæŠŠ Comment åº”ç”¨åˆ° CommentList å½“ä¸­, ä¿®æ”¹ CommentList.js ä»£ç :

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import Comment from './Comment'

class CommentList extends Component {
  render () {
    const comments = [
      { username: 'Jerry', content: 'Hello' },
      { username: 'Tomy', content: 'World' },
      { username: 'Lucy', content: 'Good' }
    ]

    return (
      <div>
        {comments.map((comment, i) => <Comment comment={comment} key={i} />)}
      </div>
    )
  }
}

export default CommentList
#+END_SRC

å¯ä»¥çœ‹åˆ°æµ‹è¯•æ•°æ®æ˜¾ç¤ºåˆ°äº†é¡µé¢ä¸Š:

[[file:./static/React.js å°ä¹¦/6A3B65A1-0CEA-4F98-B2E7-DC1D9B4CED83.png]]

ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ CommentList çš„æ•°æ®åº”è¯¥æ˜¯ç”±çˆ¶ç»„ä»¶ CommentApp ä¼ è¿›æ¥çš„, ç°åœ¨æˆ‘ä»¬åˆ é™¤æµ‹è¯•æ•°æ®, æ”¹æˆä» props è·å–è¯„è®ºæ•°æ®:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import Comment from './Comment'

class CommentList extends Component {
  render () {
    return (
      <div>
        {this.props.comments.map((comment, i) =>
          <Comment comment={comment} key={i} />
        )}
      </div>
    )
  }
}

export default CommentList
#+END_SRC

è¿™æ—¶å€™å¯ä»¥çœ‹åˆ°æµè§ˆå™¨æŠ¥é”™äº†:

[[file:./static/React.js å°ä¹¦/2B73DDBA-0D90-473A-BC2A-DB9C8E132458.png]]

è¿™æ˜¯å› ä¸º CommentApp ä½¿ç”¨ CommentList çš„æ—¶å€™å¹¶æ²¡æœ‰ä¼ å…¥ comments.
æˆ‘ä»¬ç»™ CommentList åŠ ä¸Š defaultProps é˜²æ­¢ comments ä¸ä¼ å…¥çš„æƒ…å†µ:

#+BEGIN_SRC javascript :results values list :exports no-eval
class CommentList extends Component {
  static defaultProps = {
    comments: []
  }
#+END_SRC

è¿™æ—¶å€™ä»£ç å°±ä¸æŠ¥é”™äº†. ä½†æ˜¯ CommentInput ç»™ CommentApp ä¼ é€’çš„è¯„è®ºæ•°æ®å¹¶æ²¡æœ‰ä¼ é€’ç»™ CommentList, æ‰€ä»¥ç°åœ¨å‘è¡¨è¯„è®ºæ—¶æ²¡æœ‰ååº”çš„.

æˆ‘ä»¬åœ¨ CommentApp çš„ state ä¸­åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„, æ¥ä¿å­˜æ‰€æœ‰çš„è¯„è®ºæ•°æ®, å¹¶ä¸”é€šè¿‡ props æŠŠå®ƒä¼ é€’ç»™ CommentList. ä¿®æ”¹ CommentApp.js:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import CommentInput from './CommentInput'
import CommentList from './CommentList'

class CommentApp extends Component {
  constructor () {
    super()
    this.state = {
      comments: []
    }
  }

  handleSubmitComment (comment) {
    console.log(comment)
  }

  render () {
    return (
      <div className='wrapper'>
        <CommentInput onSubmit={this.handleSubmitComment.bind(this)} />
        <CommentList comments={this.state.comments} />
      </div>
    )
  }
}

export default CommentApp
#+END_SRC

æ¥ä¸‹æ¥, ä¿®æ”¹ handleSubmitComment : æ¯å½“ç”¨æˆ·å‘å¸ƒè¯„è®ºçš„æ—¶å€™, å°±æŠŠè¯„è®ºæ•°æ®æ’å…¥ this.state.comments ä¸­, ç„¶åé€šè¿‡ setState æŠŠæ•°æ®æ›´æ–°åˆ°é¡µé¢ä¸Š:

#+CAPTION: CommentApp.handleSubmitComment
#+BEGIN_SRC javascript :results values list :exports no-eval
...
    handleSubmitComment (comment) {
      this.state.comments.push(comment)
      this.setState({
        comments: this.state.comments
      })
    }
...
#+END_SRC
<<CommentApp.handleSubmitComment>>

[[CommentInput.handleSubmit][See: CommentInput.handleSubmit]]

#+BEGIN_QUOTE
å°æç¤º: è¿™é‡Œçš„ä»£ç ç›´æ¥å¾€ state.comments æ•°ç»„é‡Œé¢æ’å…¥æ•°æ®å…¶å®è¿åäº† React.js çš„ state ä¸å¯ç›´æ¥ä¿®æ”¹çš„åŸåˆ™.
ä½†å…¶å®è¿™ä¸ªåŸåˆ™æ˜¯ä¸ºäº† shouldComponentUpdate çš„ä¼˜åŒ–å’Œå˜åŒ–çš„è·Ÿè¸ª, è€Œè¿™ç§ç›®çš„åœ¨ä½¿ç”¨ React-redux çš„æ—¶å€™å…¶å®ä¼šè‡ªç„¶è€Œç„¶è¾¾åˆ°,
æˆ‘ä»¬å¾ˆå°‘ç›´æ¥æ‰‹åŠ¨åœ°ä¼˜åŒ–, è¿™æ—¶å€™è¿™ä¸ªåŸåˆ™å°±ä¼šæ˜¾å¾—æœ‰ç‚¹é¸¡è‚‹.
æ‰€ä»¥è¿™é‡Œä¸ºäº†é™ä½å¤§å®¶çš„ç†è§£æˆæœ¬å°±ä¸å¼ºåˆ¶ä½¿ç”¨è¿™ä¸ªåŸåˆ™, æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ: Tutorial: Intro To React - React.
#+END_QUOTE

ç°åœ¨ä»£ç åº”è¯¥æ˜¯å¯ä»¥æŒ‰ç…§éœ€æ±‚æ­£å¸¸è¿ä½œäº†, è¾“å…¥ç”¨æˆ·åå’Œè¯„è®ºå†…å®¹, ç„¶åç‚¹å‡»å‘å¸ƒ:

[[file:./static/React.js å°ä¹¦/62C055E7-F668-4C70-A0C0-B8989A5E3B58.png]]

ä¸ºäº†è®©ä»£ç çš„å¥å£®æ€§æ›´å¼º, ç»™ handleSubmitComment åŠ å…¥ç®€å•çš„æ•°æ®æ£€æŸ¥:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
    handleSubmitComment (comment) {
      if (!comment) return
      if (!comment.username) return alert('è¯·è¾“å…¥ç”¨æˆ·å')
      if (!comment.content) return alert('è¯·è¾“å…¥è¯„è®ºå†…å®¹')
      this.state.comments.push(comment)
      this.setState({
        comments: this.state.comments
      })
    }
...
#+END_SRC

åˆ°è¿™é‡Œ, æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå®æˆ˜æ¡ˆä¾‹â€”â€”è¯„è®ºåŠŸèƒ½å·²ç»å®Œæˆäº†! å®Œæ•´çš„æ¡ˆä¾‹ä»£ç å¯ä»¥åœ¨è¿™é‡Œ [[https://github.com/huzidaha/react-naive-book-examples/tree/master/comment-app/src][comment-app]] æ‰¾åˆ°, [[https://huzidaha.github.io/react-naive-book-examples/comment-app/build/index.html][åœ¨çº¿æ¼”ç¤º]] ä½“éªŒ.

** æ€»ç»“
 åœ¨è¿™ä¸ªæ¡ˆä¾‹é‡Œé¢, æˆ‘ä»¬é™¤äº†å¤ä¹ äº†ä¹‹å‰æ‰€å­¦è¿‡çš„å†…å®¹ä»¥å¤–è¿˜å­¦ä¹ äº†æ–°çš„çŸ¥è¯†ç‚¹. åŒ…æ‹¬:

 - å®ç°åŠŸèƒ½ä¹‹å‰å…ˆç†è§£, åˆ†æéœ€æ±‚, åˆ’åˆ†ç»„ä»¶. å¹¶ä¸”æŒæ¡åˆ’åˆ†ç»„ä»¶çš„åŸºæœ¬åŸåˆ™â€”â€”å¯å¤ç”¨æ€§, å¯ç»´æŠ¤æ€§.
 - å—æ§ç»„ä»¶çš„æ¦‚å¿µ,React.js ä¸­çš„ <input /> ,<textarea />,<select /> ç­‰å…ƒç´ çš„ value å€¼å¦‚æœæ˜¯å—åˆ° React.js çš„æ§åˆ¶, é‚£ä¹ˆå°±æ˜¯å—æ§ç»„ä»¶.
 - ç»„ä»¶ä¹‹é—´ä½¿ç”¨ props é€šè¿‡çˆ¶å…ƒç´ ä¼ é€’æ•°æ®çš„æŠ€å·§.

 å½“ç„¶, åœ¨çœŸå®çš„é¡¹ç›®å½“ä¸­, è¿™ä¸ªæ¡ˆä¾‹å¾ˆå¤šåœ°æ–¹æ˜¯å¯ä»¥ä¼˜åŒ–çš„.
 åŒ…æ‹¬ç»„ä»¶å¯å¤ç”¨æ€§æ–¹é¢(æœ‰æ²¡æœ‰å‘ç°å…¶å® CommentInput ä¸­æœ‰é‡å¤çš„ä»£ç ?), åº”ç”¨çš„çŠ¶æ€ç®¡ç†æ–¹é¢.
 ä½†åœ¨è¿™é‡Œä¸ºäº†ç»™å¤§å®¶æ€»ç»“å’Œæ¼”ç¤º, å®ç°åˆ°è¿™ä¸ªç¨‹åº¦ä¹Ÿå°±è¶³å¤Ÿäº†.

 åˆ°æ­¤ä¸ºæ­¢,React.js å°ä¹¦çš„ç¬¬ä¸€é˜¶æ®µå·²ç»ç»“æŸ, ä½ å¯ä»¥åˆ©ç”¨è¿™äº›çŸ¥è¯†ç‚¹æ¥æ„å»ºç®€å•çš„åŠŸèƒ½æ¨¡å—äº†.
 ä½†æ˜¯åœ¨å®é™…é¡¹ç›®å¦‚æœè¦æ„å»ºæ¯”è¾ƒç³»ç»Ÿå’Œå®Œå–„çš„åŠŸèƒ½, è¿˜éœ€è¦æ›´å¤šçš„ React.js çš„çŸ¥è¯†è¿˜æœ‰å…³äºå‰ç«¯å¼€å‘çš„ä¸€äº›è®¤çŸ¥æ¥ååŠ©æˆ‘ä»¬.
 æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå¼€å¯æ–°çš„ä¸€ä¸ªé˜¶æ®µæ¥å­¦ä¹ æ›´å¤šå…³äº React.js çš„çŸ¥è¯†, ä»¥åŠå¦‚ä½•æ›´åŠ çµæ´»å’Œç†Ÿç»ƒåœ°ä½¿ç”¨å®ƒä»¬. è®©æˆ‘ä»¬è¿›å…¥ç¬¬äºŒé˜¶æ®µå§!

* å‰ç«¯åº”ç”¨çŠ¶æ€ç®¡ç† â€”â€” çŠ¶æ€æå‡
<<çŠ¶æ€æå‡>>
ä¸Šä¸€ä¸ªè¯„è®ºåŠŸèƒ½çš„æ¡ˆä¾‹ä¸­, å¯èƒ½ä¼šæœ‰äº›åŒå­¦ä¼šå¯¹ä¸€ä¸ªåœ°æ–¹æ„Ÿåˆ°ç–‘æƒ‘: CommentList ä¸­æ˜¾ç¤ºçš„è¯„è®ºåˆ—è¡¨æ•°æ®ä¸ºä»€ä¹ˆè¦é€šè¿‡çˆ¶ç»„ä»¶ CommentApp ç”¨ props ä¼ è¿›æ¥?
ä¸ºä»€ä¹ˆä¸ç›´æ¥å­˜æ”¾åœ¨ CommentList çš„ state å½“ä¸­? ä¾‹å¦‚è¿™æ ·åšä¹Ÿæ˜¯å¯ä»¥çš„:

#+BEGIN_SRC javascript :results values list :exports no-eval
class CommentList extends Component {
  constructor () {
    this.state = { comments: [] }
  }

  addComment (comment) {
    this.state.comments.push(comment)
    this.setState({
      comments: this.state.comments
    })
  }

  render () {
    return (
      <div>
        {this.state.comments.map((comment, i) =>
          <Comment comment={comment} key={i} />
        )}
      </div>
    )
  }
}
#+END_SRC

å¦‚æœæŠŠè¿™ä¸ª comments æ”¾åˆ° CommentList å½“ä¸­, å½“æœ‰åˆ«çš„ç»„ä»¶ä¹Ÿä¾èµ–è¿™ä¸ª comments æ•°æ®æˆ–è€…æœ‰åˆ«çš„ç»„ä»¶ä¼šå½±å“è¿™ä¸ªæ•°æ®, é‚£ä¹ˆå°±å¸¦æ¥é—®é¢˜äº†.
ä¸¾ä¸€ä¸ªæ•°æ®ä¾èµ–çš„ä¾‹å­: ä¾‹å¦‚, ç°åœ¨æˆ‘ä»¬æœ‰å¦å¤–ä¸€ä¸ªå’Œ CommentList åŒçº§çš„ CommentList2, ä¹Ÿæ˜¯éœ€è¦æ˜¾ç¤ºåŒæ ·çš„è¯„è®ºåˆ—è¡¨æ•°æ®.

[[file:./static/React.js å°ä¹¦/85B8A2B7-288F-4FC2-A0AB-C4E153BB3854.png]]

CommentList2 å’Œ CommentList å¹¶åˆ—ä¸º CommentApp çš„å­ç»„ä»¶, å®ƒä¹Ÿéœ€è¦ä¾èµ– comments æ˜¾ç¤ºè¯„è®ºåˆ—è¡¨.
ä½†æ˜¯å› ä¸º comments æ•°æ®åœ¨ CommentList ä¸­, å®ƒæ²¡åŠæ³•è®¿é—®åˆ°.

é‡åˆ°è¿™ç§æƒ…å†µ, æˆ‘ä»¬å°†è¿™ç§ç»„ä»¶ä¹‹é—´å…±äº«çš„çŠ¶æ€äº¤ç»™ç»„ä»¶æœ€è¿‘çš„å…¬å…±çˆ¶èŠ‚ç‚¹ä¿ç®¡, ç„¶åé€šè¿‡ props æŠŠçŠ¶æ€ä¼ é€’ç»™å­ç»„ä»¶, è¿™æ ·å°±å¯ä»¥åœ¨ç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®äº†.

[[file:./static/React.js å°ä¹¦/C547BD3E-F923-4B1D-96BC-A77966CDFBEF.png]]

åœ¨æˆ‘ä»¬çš„ä¾‹å­å½“ä¸­, å¦‚æœæŠŠ comments äº¤ç»™çˆ¶ç»„ä»¶ CommentApp, é‚£ä¹ˆ CommentList å’Œ CommentList2 éƒ½å¯ä»¥é€šè¿‡ props è·å–åˆ° comments,React.js æŠŠè¿™ç§è¡Œä¸ºå«åš" çŠ¶æ€æå‡".

ä½†æ˜¯è¿™ä¸ª CommentList2 æ˜¯æˆ‘ä»¬ä¸´æ—¶åŠ ä¸Šå»çš„, åœ¨å®é™…æ¡ˆä¾‹å½“ä¸­å¹¶æ²¡æœ‰æ¶‰åŠåˆ°è¿™ç§ç»„ä»¶ä¹‹é—´ä¾èµ– comments çš„æƒ…å†µ, ä¸ºä»€ä¹ˆè¿˜éœ€è¦æŠŠ comments æå‡åˆ° CommentApp?
é‚£æ˜¯å› ä¸ºæœ‰ä¸ªç»„ä»¶ä¼šå½±å“åˆ° comments, é‚£å°±æ˜¯ CommentInput.
CommentInput äº§ç”Ÿçš„æ–°çš„è¯„è®ºæ•°æ®æ˜¯ä¼šæ’å…¥ comments å½“ä¸­çš„, æ‰€ä»¥æˆ‘ä»¬é‡åˆ°è¿™ç§æƒ…å†µä¹Ÿä¼šæŠŠçŠ¶æ€æå‡åˆ°çˆ¶ç»„ä»¶.

æ€»ç»“ä¸€ä¸‹: å½“æŸä¸ªçŠ¶æ€è¢«å¤šä¸ªç»„ä»¶ä¾èµ–æˆ–è€…å½±å“çš„æ—¶å€™, å°±æŠŠè¯¥çŠ¶æ€æå‡åˆ°è¿™äº›ç»„ä»¶çš„æœ€è¿‘å…¬å…±çˆ¶ç»„ä»¶ä¸­å»ç®¡ç†, ç”¨ props ä¼ é€’æ•°æ®æˆ–è€…å‡½æ•°æ¥ç®¡ç†è¿™ç§ä¾èµ–æˆ–ç€å½±å“çš„è¡Œä¸º.

æˆ‘ä»¬æ¥çœ‹çœ‹çŠ¶æ€æå‡æ›´å¤šçš„ä¾‹å­, å‡è®¾ç°åœ¨æˆ‘ä»¬çš„çˆ¶ç»„ä»¶ CommentApp åªæ˜¯å±äºæ›´å¤§çš„ç»„ä»¶æ ‘ PostApp çš„ä¸€éƒ¨åˆ†:

[[file:./static/React.js å°ä¹¦/5.png]]

è€Œè¿™ä¸ªæ›´å¤§çš„ç»„ä»¶æ ‘çš„å¦å¤–çš„å­æ ‘çš„ CommentsCount ç»„ä»¶ä¹Ÿéœ€è¦ä¾èµ– comments æ¥æ˜¾ç¤ºè¯„è®ºæ•°, é‚£æˆ‘ä»¬å°±åªèƒ½æŠŠ comments ç»§ç»­æå‡åˆ°è¿™äº›ä¾èµ–ç»„ä»¶çš„æœ€è¿‘å…¬å…±çˆ¶ç»„ä»¶ PostApp å½“ä¸­.

ç°åœ¨ç»§ç»­è®©æˆ‘ä»¬çš„ä¾‹å­æç«¯èµ·æ¥.
å‡è®¾ç°åœ¨ PostApp åªæ˜¯å¦å¤–ä¸€ä¸ªæ›´å¤§çš„çˆ¶ç»„ä»¶ Index çš„å­æ ‘.
è€Œ Index çš„æŸä¸ªå­æ ‘çš„æœ‰ä¸€ä¸ªæŒ‰é’®ç»„ä»¶å¯ä»¥ä¸€é”®æ¸…ç©ºæ‰€æœ‰ comments(ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ªæŒ‰é’®ç»„ä»¶å¯ä»¥å½±å“åˆ°è¿™ä¸ªæ•°æ®), æˆ‘ä»¬åªèƒ½ç»§ç»­ commenets æå‡åˆ° Index å½“ä¸­.

ä½ ä¼šå‘ç°è¿™ç§æ— é™åˆ¶çš„æå‡ä¸æ˜¯ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆ.
ä¸€æ—¦å‘ç”Ÿäº†æå‡, ä½ å°±éœ€è¦ä¿®æ”¹åŸæ¥ä¿å­˜è¿™ä¸ªçŠ¶æ€çš„ç»„ä»¶çš„ä»£ç , ä¹Ÿè¦æŠŠæ•´ä¸ªæ•°æ®ä¼ é€’è·¯å¾„ç»è¿‡çš„ç»„ä»¶éƒ½ä¿®æ”¹ä¸€é, å¥½è®©æ•°æ®èƒ½å¤Ÿä¸€å±‚å±‚åœ°ä¼ é€’ä¸‹å».
è¿™æ ·å¯¹ä»£ç çš„ç»„ç»‡ç®¡ç†ç»´æŠ¤å¸¦æ¥å¾ˆå¤§çš„é—®é¢˜. åˆ°è¿™é‡Œä½ å¯ä»¥æŠ½è±¡ä¸€ä¸‹é—®é¢˜:

#+BEGIN_QUOTE
å¦‚ä½•æ›´å¥½çš„ç®¡ç†è¿™ç§è¢«å¤šä¸ªç»„ä»¶æ‰€ä¾èµ–æˆ–å½±å“çš„çŠ¶æ€?
#+END_QUOTE

ä½ å¯ä»¥çœ‹åˆ° React.js å¹¶æ²¡æœ‰æä¾›å¥½çš„è§£å†³æ–¹æ¡ˆæ¥ç®¡ç†è¿™ç§ç»„ä»¶ä¹‹é—´çš„å…±äº«çŠ¶æ€.
åœ¨å®é™…é¡¹ç›®å½“ä¸­çŠ¶æ€æå‡å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆ, æ‰€ä»¥æˆ‘ä»¬åç»­ä¼šå¼•å…¥ Redux è¿™æ ·çš„çŠ¶æ€ç®¡ç†å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬æ¥ç®¡ç†è¿™ç§å…±äº«çŠ¶æ€, ä½†æ˜¯åœ¨è®²è§£åˆ° Redux ä¹‹å‰, æˆ‘ä»¬æš‚æ—¶é‡‡å–çŠ¶æ€æå‡çš„æ–¹å¼æ¥è¿›è¡Œç®¡ç†.

å¯¹äºä¸ä¼šè¢«å¤šä¸ªç»„ä»¶ä¾èµ–å’Œå½±å“çš„çŠ¶æ€(ä¾‹å¦‚æŸç§ä¸‹æ‹‰èœå•çš„å±•å¼€å’Œæ”¶èµ·çŠ¶æ€), ä¸€èˆ¬æ¥è¯´åªéœ€è¦ä¿å­˜åœ¨ç»„ä»¶å†…éƒ¨å³å¯, ä¸éœ€è¦åšæå‡æˆ–è€…ç‰¹æ®Šçš„ç®¡ç†.

* æŒ‚è½½é˜¶æ®µçš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ(ä¸€)
æˆ‘ä»¬åœ¨è®²è§£ JSX çš„ç« èŠ‚ä¸­æåˆ°, ä¸‹é¢çš„ä»£ç :

#+BEGIN_SRC javascript :results values list :exports no-eval
ReactDOM.render(
  <Header />,
  document.getElementById('root')
)
#+END_SRC

ä¼šç¼–è¯‘æˆ:

#+BEGIN_SRC javascript :results values list :exports no-eval
ReactDOM.render(
  React.createElement(Header, null),
  document.getElementById('root')
)
#+END_SRC

å…¶å®æˆ‘ä»¬æŠŠ Header ç»„ä»¶ä¼ ç»™äº† React.createElement å‡½æ•°, åˆæŠŠå‡½æ•°è¿”å›ç»“æœä¼ ç»™äº† ReactDOM.render.
æˆ‘ä»¬å¯ä»¥ç®€å•çŒœæƒ³ä¸€ä¸‹å®ƒä»¬ä¼šå¹²ä»€ä¹ˆäº‹æƒ…:

#+BEGIN_SRC javascript :results values list :exports no-eval
// React.createElement ä¸­å®ä¾‹åŒ–ä¸€ä¸ª Header
const header = new Header(props, children)
// React.createElement ä¸­è°ƒç”¨ header.render æ–¹æ³•æ¸²æŸ“ç»„ä»¶çš„å†…å®¹
const headerJsxObject = header.render ()

// ReactDOM ç”¨æ¸²æŸ“åçš„ JavaScript å¯¹è±¡æ¥æ¥æ„å»ºçœŸæ­£çš„ DOM å…ƒç´ 
const headerDOM = createDOMFromObject(headerJsxObject)
// ReactDOM æŠŠ DOM å…ƒç´ å¡åˆ°é¡µé¢ä¸Š
document.getElementById('root').appendChild(headerDOM)
#+END_SRC

ä¸Šé¢è¿‡ç¨‹å…¶å®å¾ˆç®€å•, çœ‹ä»£ç å°±èƒ½ç†è§£.
æˆ‘ä»¬æŠŠ React.js å°†ç»„ä»¶æ¸²æŸ“, å¹¶ä¸”æ„é€  DOM å…ƒç´ ç„¶åå¡å…¥é¡µé¢çš„è¿‡ç¨‹ç§°ä¸ºç»„ä»¶çš„æŒ‚è½½(è¿™ä¸ªå®šä¹‰è¯·å¥½å¥½è®°ä½).
å…¶å® React.js å†…éƒ¨å¯¹å¾…æ¯ä¸ªç»„ä»¶éƒ½æœ‰è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹, ä¹Ÿå°±æ˜¯åˆå§‹åŒ–ç»„ä»¶ -> æŒ‚è½½åˆ°é¡µé¢ä¸Šçš„è¿‡ç¨‹. æ‰€ä»¥ä½ å¯ä»¥ç†è§£ä¸€ä¸ªç»„ä»¶çš„æ–¹æ³•è°ƒç”¨æ˜¯è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹:

#+BEGIN_SRC javascript :results values list :exports no-eval
-> constructor()
-> render ()
// ç„¶åæ„é€  DOM å…ƒç´ æ’å…¥é¡µé¢
#+END_SRC

è¿™å½“ç„¶æ˜¯å¾ˆå¥½ç†è§£çš„.React.js ä¸ºäº†è®©æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½çš„æŒæ§ç»„ä»¶çš„æŒ‚è½½è¿‡ç¨‹, å¾€ä¸Šé¢æ’å…¥äº†ä¸¤ä¸ªæ–¹æ³•:

#+BEGIN_SRC javascript :results values list :exports no-eval
-> constructor()
-> componentWillMount()
-> render ()
// ç„¶åæ„é€  DOM å…ƒç´ æ’å…¥é¡µé¢
-> componentDidMount()
#+END_SRC

componentWillMount å’Œ componentDidMount éƒ½æ˜¯å¯ä»¥åƒ render æ–¹æ³•ä¸€æ ·è‡ªå®šä¹‰åœ¨ç»„ä»¶çš„å†…éƒ¨.
æŒ‚è½½çš„æ—¶å€™,React.js ä¼šåœ¨ç»„ä»¶çš„ render ä¹‹å‰è°ƒç”¨ componentWillMount, åœ¨ DOM å…ƒç´ å¡å…¥é¡µé¢ä»¥åè°ƒç”¨ componentDidMount.

æˆ‘ä»¬ç»™ Header ç»„ä»¶åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•, å¹¶ä¸”æ‰“ä¸€äº› Log:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Header extends Component {
  constructor () {
    super()
    console.log('construct')
  }

  componentWillMount () {
    console.log('component will mount')
  }

  componentDidMount () {
    console.log('component did mount')
  }

  render () {
    console.log('render')
    return (
      <div>
        <h1 className='title'>React å°ä¹¦</h1>
      </div>
    )
  }
}
#+END_SRC

åœ¨æ§åˆ¶å°ä½ å¯ä»¥çœ‹åˆ°ä¾æ¬¡è¾“å‡º:

[[file:./static/React.js å°ä¹¦/69676213-FDED-4E60-8142-07599BA10696.png]]

å¯ä»¥çœ‹åˆ°,React.js ç¡®å®æŒ‰ç…§æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„é‚£æ ·è°ƒç”¨äº†å®šä¹‰çš„ä¸¤ä¸ªæ–¹æ³• componentWillMount å’Œ componentDidMount.

æœºçµçš„åŒå­¦å¯ä»¥æƒ³åˆ°, ä¸€ä¸ªç»„ä»¶å¯ä»¥æ’å…¥é¡µé¢, å½“ç„¶ä¹Ÿå¯ä»¥ä»é¡µé¢ä¸­åˆ é™¤.

#+BEGIN_SRC javascript :results values list :exports no-eval
-> constructor()
-> componentWillMount()
-> render ()
// ç„¶åæ„é€  DOM å…ƒç´ æ’å…¥é¡µé¢
-> componentDidMount()
// ...
// ä»é¡µé¢ä¸­åˆ é™¤
#+END_SRC

React.js ä¹Ÿæ§åˆ¶äº†è¿™ä¸ªç»„ä»¶çš„åˆ é™¤è¿‡ç¨‹. åœ¨ç»„ä»¶åˆ é™¤ä¹‹å‰ React.js ä¼šè°ƒç”¨ç»„ä»¶å®šä¹‰çš„ componentWillUnmount:

#+BEGIN_SRC javascript :results values list :exports no-eval
-> constructor()
-> componentWillMount()
-> render ()
// ç„¶åæ„é€  DOM å…ƒç´ æ’å…¥é¡µé¢
-> componentDidMount()
// ...
// å³å°†ä»é¡µé¢ä¸­åˆ é™¤
-> componentWillUnmount()
// ä»é¡µé¢ä¸­åˆ é™¤
#+END_SRC

çœ‹çœ‹ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæŠŠç»„ä»¶ä»é¡µé¢ä¸­åˆ é™¤, ç»§ç»­ä½¿ç”¨ä¸Šé¢ä¾‹å­çš„ä»£ç , æˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ª Index ç»„ä»¶:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Index extends Component {
  constructor () {
    super()
    this.state = {
      isShowHeader: true
    }
  }

  handleShowOrHide () {
    this.setState({
      isShowHeader: !this.state.isShowHeader
    })
  }

  render () {
    return (
      <div>
        {this.state.isShowHeader ? <Header /> : null}
        <button onClick={this.handleShowOrHide.bind(this)}>
                æ˜¾ç¤ºæˆ–è€…éšè—æ ‡é¢˜
        </button>
      </div>
    )
  }
}

ReactDOM.render(
  <Index />,
  document.getElementById('root')
)
#+END_SRC

Index ç»„ä»¶ä½¿ç”¨äº† Header ç»„ä»¶, å¹¶ä¸”æœ‰ä¸€ä¸ªæŒ‰é’®, å¯ä»¥æ§åˆ¶ Header çš„æ˜¾ç¤ºæˆ–è€…éšè—. ä¸‹é¢è¿™è¡Œä»£ç :

#+BEGIN_SRC javascript :results values list :exports no-eval
...a
{this.state.isShowHeader ? <Header /> : null}
...
#+END_SRC

ç›¸å½“äº state.isShowHeader ä¸º true çš„æ—¶å€™æŠŠ Header æ’å…¥é¡µé¢,false çš„æ—¶å€™æŠŠ Header ä»é¡µé¢ä¸Šåˆ é™¤.
è¿™æ—¶å€™æˆ‘ä»¬ç»™ Header æ·»åŠ  componentWillUnmount æ–¹æ³•:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
    componentWillUnmount() {
      console.log('component will unmount')
    }
...
#+END_SRC

è¿™æ—¶å€™ç‚¹å‡»é¡µé¢ä¸Šçš„æŒ‰é’®, ä½ ä¼šçœ‹åˆ°é¡µé¢çš„æ ‡é¢˜éšè—äº†, å¹¶ä¸”æ§åˆ¶å°æ‰“å°å‡ºæ¥ä¸‹å›¾çš„æœ€åä¸€è¡Œ, è¯´æ˜ componentWillUnmount ç¡®å®è¢« React.js æ‰€è°ƒç”¨äº†:

[[file:./static/React.js å°ä¹¦/B396B6CF-50F1-4C4E-9D16-4E746F15F91F.png]]

ä½ å¯ä»¥å¤šæ¬¡ç‚¹å‡»æŒ‰é’®, éšç€æŒ‰é’®çš„æ˜¾ç¤ºå’Œéšè—, ä¸Šé¢çš„å†…å®¹ä¼šæŒ‰é¡ºåºé‡å¤åœ°æ‰“å°å‡ºæ¥, å¯ä»¥ä½“ä¼šä¸€ä¸‹è¿™å‡ ä¸ªæ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹å’Œé¡ºåº.

** æ€»ç»“
 React.js å°†ç»„ä»¶æ¸²æŸ“, å¹¶ä¸”æ„é€  DOM å…ƒç´ ç„¶åå¡å…¥é¡µé¢çš„è¿‡ç¨‹ç§°ä¸ºç»„ä»¶çš„æŒ‚è½½. è¿™ä¸€èŠ‚æˆ‘ä»¬å­¦ä¹ äº† React.js æ§åˆ¶ç»„ä»¶åœ¨é¡µé¢ä¸ŠæŒ‚è½½å’Œåˆ é™¤è¿‡ç¨‹é‡Œé¢å‡ ä¸ªæ–¹æ³•:
 - componentWillMount: ç»„ä»¶æŒ‚è½½å¼€å§‹ä¹‹å‰, ä¹Ÿå°±æ˜¯åœ¨ç»„ä»¶è°ƒç”¨ render æ–¹æ³•ä¹‹å‰è°ƒç”¨.
 - componentDidMount: ç»„ä»¶æŒ‚è½½å®Œæˆä»¥å, ä¹Ÿå°±æ˜¯ DOM å…ƒç´ å·²ç»æ’å…¥é¡µé¢åè°ƒç”¨.
 - componentWillUnmount: ç»„ä»¶å¯¹åº”çš„ DOM å…ƒç´ ä»é¡µé¢ä¸­åˆ é™¤ä¹‹å‰è°ƒç”¨.
 ä½†è¿™ä¸€èŠ‚å¹¶æ²¡æœ‰è®²è¿™å‡ ä¸ªæ–¹æ³•åˆ°åº•åœ¨å®é™…é¡¹ç›®å½“ä¸­æœ‰ä»€ä¹ˆä½œç”¨, ä¸‹ä¸€èŠ‚æˆ‘ä»¬é€šè¿‡ä¾‹å­æ¥è®²è§£ä¸€ä¸‹è¿™å‡ ä¸ªæ–¹æ³•çš„ç”¨é€”.

* æŒ‚è½½é˜¶æ®µçš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ(äºŒ)
è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹å¯¹äºä¸€ä¸ªç»„ä»¶æ¥è¯´,constructor,componentWillMount,componentDidMount,componentWillUnmount è¿™å‡ ä¸ªæ–¹æ³•åœ¨ä¸€ä¸ªç»„ä»¶çš„å‡ºç”Ÿåˆ°æ­»äº¡çš„è¿‡ç¨‹é‡Œé¢èµ·äº†ä»€ä¹ˆæ ·çš„ä½œç”¨.

ä¸€èˆ¬æ¥è¯´, æ‰€æœ‰å…³äºç»„ä»¶è‡ªèº«çš„çŠ¶æ€çš„åˆå§‹åŒ–å·¥ä½œéƒ½ä¼šæ”¾åœ¨ constructor é‡Œé¢å»åš.
ä½ ä¼šå‘ç°æœ¬ä¹¦æ‰€æœ‰ç»„ä»¶çš„ state çš„åˆå§‹åŒ–å·¥ä½œéƒ½æ˜¯æ”¾åœ¨ constructor é‡Œé¢çš„. å‡è®¾æˆ‘ä»¬ç°åœ¨åœ¨åšä¸€ä¸ªæ—¶é’Ÿåº”ç”¨:

[[file:./static/React.js å°ä¹¦/FECF7A01-5C87-4E03-AA98-03BB30538C66.png]]

æˆ‘ä»¬ä¼šåœ¨ constructor é‡Œé¢åˆå§‹åŒ– state.date, å½“ç„¶ç°åœ¨é¡µé¢è¿˜æ˜¯é™æ€çš„, ç­‰ä¸‹ä¸€ä¼šè®©æ—¶é—´åŠ¨èµ·æ¥.

#+BEGIN_SRC javascript :results values list :exports no-eval
class Clock extends Component {
  constructor () {
    super()
    this.state = {
      date: new Date()
    }
  }

  render () {
    return (
      <div>
        <h1>
          <p>ç°åœ¨çš„æ—¶é—´æ˜¯</p>
          {this.state.date.toLocaleTimeString()}
        </h1>
      </div>
    )
  }
}
#+END_SRC

ä¸€äº›ç»„ä»¶å¯åŠ¨çš„åŠ¨ä½œ, åŒ…æ‹¬åƒ Ajax æ•°æ®çš„æ‹‰å–æ“ä½œ, ä¸€äº›å®šæ—¶å™¨çš„å¯åŠ¨ç­‰, å°±å¯ä»¥æ”¾åœ¨ componentWillMount é‡Œé¢è¿›è¡Œ, ä¾‹å¦‚ Ajax:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
    componentWillMount () {
      ajax.get('http://json-api.com/user', (userData) => {
        this.setState({ userData })
      })
    }
...
#+END_SRC

å½“ç„¶åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œé¢æ˜¯å®šæ—¶å™¨çš„å¯åŠ¨, æˆ‘ä»¬ç»™ Clock å¯åŠ¨å®šæ—¶å™¨:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Clock extends Component {
  constructor () {
    super()
    this.state = {
      date: new Date()
    }
  }

  componentWillMount () {
    this.timer = setInterval(() => {
      this.setState({ date: new Date() })
    }, 1000)
  }
}
#+END_SRC

æˆ‘ä»¬åœ¨ componentWillMount ä¸­ç”¨ setInterval å¯åŠ¨äº†ä¸€ä¸ªå®šæ—¶å™¨: æ¯éš” 1 ç§’æ›´æ–°ä¸­çš„ state.date, è¿™æ ·é¡µé¢å°±å¯ä»¥åŠ¨èµ·æ¥äº†.
æˆ‘ä»¬ç”¨ä¸€ä¸ª Index æŠŠå®ƒç”¨èµ·æ¥, å¹¶ä¸”æ’å…¥é¡µé¢:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Index extends Component {
  render () {
    return (
      <div>
        <Clock />
      </div>
    )
  }
}

ReactDOM.render(
  <Index />,
  document.getElementById('root')
)
#+END_SRC

åƒä¸Šä¸€èŠ‚é‚£æ ·, æˆ‘ä»¬ä¿®æ”¹è¿™ä¸ª Index è®©è¿™ä¸ªæ—¶é’Ÿå¯ä»¥éšè—æˆ–è€…æ˜¾ç¤º:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Index extends Component {
  constructor () {
    super()
    this.state = { isShowClock: true }
  }

  handleShowOrHide () {
    this.setState({
      isShowClock: !this.state.isShowClock
    })
  }

  render () {
    return (
      <div>
        {this.state.isShowClock ? <Clock /> : null }
        <button onClick={this.handleShowOrHide.bind(this)}>
                æ˜¾ç¤ºæˆ–éšè—æ—¶é’Ÿ
        </button>
      </div>
    )
  }
}
#+END_SRC

ç°åœ¨é¡µé¢ä¸Šæœ‰ä¸ªæŒ‰é’®å¯ä»¥æ˜¾ç¤ºæˆ–è€…éšè—æ—¶é’Ÿ. ä½ è¯•ä¸€ä¸‹æ˜¾ç¤ºæˆ–è€…éšè—æ—¶é’Ÿ, è™½ç„¶é¡µé¢ä¸Šçœ‹èµ·æ¥åŠŸèƒ½éƒ½æ­£å¸¸, åœ¨æ§åˆ¶å°ä½ ä¼šå‘ç°æŠ¥é”™äº†:

[[file:./static/React.js å°ä¹¦/340BBCEA-35CC-4B35-B352-267F381477EF.png]]

è¿™æ˜¯å› ä¸º, å½“æ—¶é’Ÿéšè—çš„æ—¶å€™, æˆ‘ä»¬å¹¶æ²¡æœ‰æ¸…é™¤å®šæ—¶å™¨.
æ—¶é’Ÿéšè—çš„æ—¶å€™, å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°è¿˜åœ¨ä¸åœåœ°å°è¯• setState, ç”±äº setState åªèƒ½åœ¨å·²ç»æŒ‚è½½æˆ–è€…æ­£åœ¨æŒ‚è½½çš„ç»„ä»¶ä¸Šè°ƒç”¨, æ‰€ä»¥ React.js å¼€å§‹ç–¯ç‹‚æŠ¥é”™.

å¤šæ¬¡çš„éšè—å’Œæ˜¾ç¤ºä¼šè®© React.js é‡æ–°æ„é€ å’Œé”€æ¯ Clock ç»„ä»¶, æ¯æ¬¡æ„é€ éƒ½ä¼šé‡æ–°æ„å»ºä¸€ä¸ªå®šæ—¶å™¨.
è€Œé”€æ¯ç»„ä»¶çš„æ—¶å€™æ²¡æœ‰æ¸…é™¤å®šæ—¶å™¨, æ‰€ä»¥ä½ çœ‹åˆ°æŠ¥é”™ä¼šè¶Šæ¥è¶Šå¤š.
è€Œä¸”å› ä¸º JavaScript çš„é—­åŒ…ç‰¹æ€§, è¿™æ ·ä¼šå¯¼è‡´ä¸¥é‡çš„å†…å­˜æ³„æ¼.

è¿™æ—¶å€™ componentWillUnmount å°±å¯ä»¥æ´¾ä¸Šç”¨åœºäº†, å®ƒçš„ä½œç”¨å°±æ˜¯åœ¨ç»„ä»¶é”€æ¯çš„æ—¶å€™, åšè¿™ç§æ¸…åœºçš„å·¥ä½œ.
ä¾‹å¦‚æ¸…é™¤è¯¥ç»„ä»¶çš„å®šæ—¶å™¨å’Œå…¶ä»–çš„æ•°æ®æ¸…ç†å·¥ä½œ. æˆ‘ä»¬ç»™ Clock æ·»åŠ  componentWillUnmount, åœ¨ç»„ä»¶é”€æ¯çš„æ—¶å€™æ¸…é™¤è¯¥ç»„ä»¶çš„å®šæ—¶å™¨:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
    componentWillUnmount () {
      clearInterval(this.timer)
    }
...
#+END_SRC

è¿™æ—¶å€™å°±æ²¡æœ‰é”™è¯¯äº†.

** æ€»ç»“
 æˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠç»„ä»¶çš„ state çš„åˆå§‹åŒ–å·¥ä½œæ”¾åœ¨ constructor é‡Œé¢å»åš, åœ¨ componentWillMount è¿›è¡Œç»„ä»¶çš„å¯åŠ¨å·¥ä½œ, ä¾‹å¦‚ Ajax æ•°æ®æ‹‰å–, å®šæ—¶å™¨çš„å¯åŠ¨, ç»„ä»¶ä»é¡µé¢ä¸Šé”€æ¯çš„æ—¶å€™, æœ‰æ—¶å€™éœ€è¦ä¸€äº›æ•°æ®çš„æ¸…ç†, ä¾‹å¦‚å®šæ—¶å™¨çš„æ¸…ç†, å°±ä¼šæ”¾åœ¨ componentWillUnmount é‡Œé¢å»åš.

 è¯´ä¸€ä¸‹æœ¬èŠ‚æ²¡æœ‰æåˆ°çš„ componentDidMount.
 ä¸€èˆ¬æ¥è¯´, æœ‰äº›ç»„ä»¶çš„å¯åŠ¨å·¥ä½œæ˜¯ä¾èµ– DOM çš„, ä¾‹å¦‚åŠ¨ç”»çš„å¯åŠ¨, è€Œ componentWillMount çš„æ—¶å€™ç»„ä»¶è¿˜æ²¡æŒ‚è½½å®Œæˆ, æ‰€ä»¥æ²¡æ³•è¿›è¡Œè¿™äº›å¯åŠ¨å·¥ä½œ, è¿™æ—¶å€™å°±å¯ä»¥æŠŠè¿™äº›æ“ä½œæ”¾åœ¨ componentDidMount å½“ä¸­.
 componentDidMount çš„å…·ä½“ä½¿ç”¨æˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚å½“ä¸­ç»“åˆ DOM æ¥è®².

** å®Œæˆ Post ç»„ä»¶, å®ƒå¯ä»¥åŠ è½½, åˆ·æ–°æ–‡ç« å†…å®¹
 å·²æœ‰å‡½æ•° getPostData, å®ƒä¼šè¿”å›ä¸€ä¸ª Promise, ä½ å¯ä»¥é€šè¿‡å®ƒè·å–æ–‡ç« çš„å†…å®¹.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 getPostData().then((postContent) => {
     // ...
 })
 #+END_SRC

 åœ¨è·å–æ•°æ®çš„æ—¶å€™,Post ç»„ä»¶çš„ div.post-content ä¸­æ˜¾ç¤º æ•°æ®åŠ è½½ä¸­..., å®ŒæˆåŠ è½½ä»¥åç›´æ¥æ˜¾ç¤º getPostData çš„è¿”å›ç»“æœ.

 é¡µé¢æœ‰ä¸ªæŒ‰é’®, ç‚¹å‡»å¯ä»¥é‡æ–°åŠ è½½æ•°æ®.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Post extends Component {
   constructor () {
     super()
     this.state = { content: '' }
   }

   componentWillMount () {
     this._loadData()
   }

   async _loadData () {
     this.setState({ content: 'æ•°æ®åŠ è½½ä¸­...' })
     const content = await getPostData()
     this.setState({ content })
   }

   render () {
     return (
       <div>
         <div className='post-content'>{this.state.content}</div>
         <button onClick={() => {
           this._loadData()
         }}>åˆ·æ–°</button>
       </div>
     )
   }
 }
 #+END_SRC

* æ›´æ–°é˜¶æ®µçš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
ä»ä¹‹å‰çš„ç« èŠ‚æˆ‘ä»¬äº†è§£åˆ°, ç»„ä»¶çš„æŒ‚è½½æŒ‡çš„æ˜¯å°†ç»„ä»¶æ¸²æŸ“å¹¶ä¸”æ„é€  DOM å…ƒç´ ç„¶åæ’å…¥é¡µé¢çš„è¿‡ç¨‹.
è¿™æ˜¯ä¸€ä¸ªä»æ— åˆ°æœ‰çš„è¿‡ç¨‹,React.js æä¾›ä¸€äº›ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¯ä»¥ç»™æˆ‘ä»¬åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åšä¸€äº›æ“ä½œ.

é™¤äº†æŒ‚è½½é˜¶æ®µ, è¿˜æœ‰ä¸€ç§" æ›´æ–°é˜¶æ®µ". è¯´ç™½äº†å°±æ˜¯ setState å¯¼è‡´ React.js é‡æ–°æ¸²æŸ“ç»„ä»¶å¹¶ä¸”æŠŠç»„ä»¶çš„å˜åŒ–åº”ç”¨åˆ° DOM å…ƒç´ ä¸Šçš„è¿‡ç¨‹, è¿™æ˜¯ä¸€ä¸ªç»„ä»¶çš„å˜åŒ–è¿‡ç¨‹.
è€Œ React.js ä¹Ÿæä¾›äº†ä¸€ç³»åˆ—çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¯ä»¥è®©æˆ‘ä»¬åœ¨è¿™ä¸ªç»„ä»¶æ›´æ–°çš„è¿‡ç¨‹æ‰§è¡Œä¸€äº›æ“ä½œ.

è¿™äº›ç”Ÿå‘½å‘¨æœŸåœ¨æ·±å…¥é¡¹ç›®å¼€å‘é˜¶æ®µæ˜¯éå¸¸é‡è¦çš„.
è€Œè¦å®Œå…¨ç†è§£æ›´æ–°é˜¶æ®µçš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€ä¸ªéœ€è¦ç»éªŒå’ŒçŸ¥è¯†ç§¯ç´¯çš„è¿‡ç¨‹, ä½ éœ€è¦å¯¹ Virtual-DOM ç­–ç•¥æœ‰æ¯”è¾ƒæ·±å…¥ç†è§£æ‰èƒ½å®Œå…¨æŒæ¡, ä½†è¿™è¶…å‡ºäº†æœ¬ä¹¦çš„ç›®çš„.
æœ¬ä¹¦çš„ç›®çš„æ˜¯ä¸ºäº†è®©å¤§å®¶å¿«é€ŸæŒæ¡ React.js æ ¸å¿ƒçš„æ¦‚å¿µ, å¿«é€Ÿä¸Šæ‰‹é¡¹ç›®è¿›è¡Œå®æˆ˜. æ‰€ä»¥å¯¹äºç»„ä»¶æ›´æ–°é˜¶æ®µçš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ, æˆ‘ä»¬ç®€å•æåŠå¹¶ä¸”æä¾›ä¸€äº›èµ„æ–™ç»™å¤§å®¶.

è¿™é‡Œä¸ºäº†çŸ¥è¯†çš„å®Œæ•´, è¡¥å……å…³äºæ›´æ–°é˜¶æ®µçš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ:

- shouldComponentUpdate(nextProps, nextState): ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ§åˆ¶ç»„ä»¶æ˜¯å¦é‡æ–°æ¸²æŸ“. å¦‚æœè¿”å› false ç»„ä»¶å°±ä¸ä¼šé‡æ–°æ¸²æŸ“. è¿™ä¸ªç”Ÿå‘½å‘¨æœŸåœ¨ React.js æ€§èƒ½ä¼˜åŒ–ä¸Šéå¸¸æœ‰ç”¨.
- componentWillReceiveProps(nextProps): ç»„ä»¶ä»çˆ¶ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„ props ä¹‹å‰è°ƒç”¨.
- componentWillUpdate(): ç»„ä»¶å¼€å§‹é‡æ–°æ¸²æŸ“ä¹‹å‰è°ƒç”¨.
- componentDidUpdate(): ç»„ä»¶é‡æ–°æ¸²æŸ“å¹¶ä¸”æŠŠæ›´æ”¹å˜æ›´åˆ°çœŸå®çš„ DOM ä»¥åè°ƒç”¨.

å¤§å®¶å¯¹è¿™æ›´æ–°é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒæ„Ÿå…´è¶£çš„è¯å¯ä»¥æŸ¥çœ‹[[https://facebook.github.io/react/docs/react-component.html][å®˜ç½‘æ–‡æ¡£]].

ä½†è¿™é‡Œå»ºè®®å¤§å®¶å¯ä»¥å…ˆç®€å•äº†è§£ React.js ç»„ä»¶æ˜¯æœ‰æ›´æ–°é˜¶æ®µçš„, å¹¶ä¸”æœ‰è¿™ä¹ˆå‡ ä¸ªæ›´æ–°é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸå³å¯.
ç„¶ååœ¨æ·±å…¥é¡¹ç›®å®æˆ˜çš„æ—¶å€™é€æ¸åœ°æŒæ¡ç†è§£ä»–ä»¬, ç°åœ¨å¹¶ä¸éœ€è¦å¯¹ä»–ä»¬æ”¾è¿‡å¤šçš„ç²¾åŠ›.

æœ‰æœ‹å‹å¯¹ Virtual-DOM ç­–ç•¥æ¯”è¾ƒæ„Ÿå…´è¶£çš„è¯, å¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢: [[https://github.com/livoras/blog/issues/13][æ·±åº¦å‰–æ: å¦‚ä½•å®ç°ä¸€ä¸ª Virtual DOM ç®—æ³•]]. å¯¹æ·±å…¥ç†è§£ React.js æ ¸å¿ƒç®—æ³•æœ‰ä¸€å®šå¸®åŠ©.

* ref å’Œ React.js ä¸­çš„ DOM æ“ä½œ
åœ¨ React.js å½“ä¸­ä½ åŸºæœ¬ä¸éœ€è¦å’Œ DOM ç›´æ¥æ‰“äº¤é“.React.js æä¾›äº†ä¸€ç³»åˆ—çš„ on* æ–¹æ³•å¸®åŠ©æˆ‘ä»¬è¿›è¡Œäº‹ä»¶ç›‘å¬,
æ‰€ä»¥ React.js å½“ä¸­ä¸éœ€è¦ç›´æ¥è°ƒç”¨ addEventListener çš„ DOM API, ä»¥å‰æˆ‘ä»¬é€šè¿‡æ‰‹åŠ¨ DOM æ“ä½œè¿›è¡Œé¡µé¢æ›´æ–°(ä¾‹å¦‚å€ŸåŠ© jQuery),
è€Œåœ¨ React.js å½“ä¸­å¯ä»¥ç›´æ¥é€šè¿‡ setState çš„æ–¹å¼é‡æ–°æ¸²æŸ“ç»„ä»¶, æ¸²æŸ“çš„æ—¶å€™å¯ä»¥æŠŠæ–°çš„ props ä¼ é€’ç»™å­ç»„ä»¶, ä»è€Œè¾¾åˆ°é¡µé¢æ›´æ–°çš„æ•ˆæœ.

React.js è¿™ç§é‡æ–°æ¸²æŸ“çš„æœºåˆ¶å¸®åŠ©æˆ‘ä»¬å…é™¤äº†ç»å¤§éƒ¨åˆ†çš„ DOM æ›´æ–°æ“ä½œ, ä¹Ÿè®©ç±»ä¼¼äº jQuery è¿™ç§ä»¥å°è£… DOM æ“ä½œä¸ºä¸»çš„ç¬¬ä¸‰æ–¹çš„åº“ä»æˆ‘ä»¬çš„å¼€å‘å·¥å…·é“¾ä¸­åˆ é™¤.

ä½†æ˜¯ React.js å¹¶ä¸èƒ½å®Œå…¨æ»¡è¶³æ‰€æœ‰ DOM æ“ä½œéœ€æ±‚, æœ‰äº›æ—¶å€™æˆ‘ä»¬è¿˜æ˜¯éœ€è¦å’Œ DOM æ‰“äº¤é“.
æ¯”å¦‚è¯´ä½ æƒ³è¿›å…¥é¡µé¢ä»¥åè‡ªåŠ¨ focus åˆ°æŸä¸ªè¾“å…¥æ¡†, ä½ éœ€è¦è°ƒç”¨ input.focus() çš„ DOM API, æ¯”å¦‚è¯´ä½ æƒ³åŠ¨æ€è·å–æŸä¸ª DOM å…ƒç´ çš„å°ºå¯¸æ¥åšåç»­çš„åŠ¨ç”», ç­‰ç­‰.

React.js å½“ä¸­æä¾›äº† ref å±æ€§æ¥å¸®åŠ©æˆ‘ä»¬è·å–å·²ç»æŒ‚è½½çš„å…ƒç´ çš„ DOM èŠ‚ç‚¹, ä½ å¯ä»¥ç»™æŸä¸ª JSX å…ƒç´ åŠ ä¸Š ref å±æ€§:

#+BEGIN_SRC javascript :results values list :exports no-eval
class AutoFocusInput extends Component {
  componentDidMount () {
    this.input.focus()
  }

  render () {
    return (
      <input ref={(input) => (this.input = input)} />
    )
  }
}

ReactDOM.render(
  <AutoFocusInput />,
  document.getElementById('root')
)
#+END_SRC

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç»™ input å…ƒç´ åŠ äº†ä¸€ä¸ª ref å±æ€§, è¿™ä¸ªå±æ€§å€¼æ˜¯ä¸€ä¸ªå‡½æ•°.
å½“ input å…ƒç´ åœ¨é¡µé¢ä¸ŠæŒ‚è½½å®Œæˆä»¥å, React.js å°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°, å¹¶ä¸”æŠŠè¿™ä¸ªæŒ‚è½½ä»¥åçš„ DOM èŠ‚ç‚¹ä¼ ç»™è¿™ä¸ªå‡½æ•°.
åœ¨å‡½æ•°ä¸­æˆ‘ä»¬æŠŠè¿™ä¸ª DOM å…ƒç´ è®¾ç½®ä¸ºç»„ä»¶å®ä¾‹çš„ä¸€ä¸ªå±æ€§, è¿™æ ·ä»¥åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ this.input è·å–åˆ°è¿™ä¸ª DOM å…ƒç´ .

ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨ componentDidMount ä¸­ä½¿ç”¨è¿™ä¸ª DOM å…ƒç´ , å¹¶ä¸”è°ƒç”¨ this.input.focus() çš„ DOM API.
æ•´ä½“å°±è¾¾åˆ°äº†é¡µé¢åŠ è½½å®Œæˆå°±è‡ªåŠ¨ focus åˆ°è¾“å…¥æ¡†çš„åŠŸèƒ½(å¤§å®¶å¯ä»¥æ³¨æ„åˆ°æˆ‘ä»¬ç”¨ä¸Šäº† componentDidMount è¿™ä¸ªç»„ä»¶ç”Ÿå‘½å‘¨æœŸ).

æˆ‘ä»¬å¯ä»¥ç»™ä»»æ„ä»£è¡¨ HTML å…ƒç´ æ ‡ç­¾åŠ ä¸Š ref ä»è€Œè·å–åˆ°å®ƒ DOM å…ƒç´ ç„¶åè°ƒç”¨ DOM API.
ä½†æ˜¯è®°ä½ä¸€ä¸ªåŸåˆ™: èƒ½ä¸ç”¨ ref å°±ä¸ç”¨.
ç‰¹åˆ«æ˜¯è¦é¿å…ç”¨ ref æ¥åš React.js æœ¬æ¥å°±å¯ä»¥å¸®åŠ©ä½ åšåˆ°çš„é¡µé¢è‡ªåŠ¨æ›´æ–°çš„æ“ä½œå’Œäº‹ä»¶ç›‘å¬.
å¤šä½™çš„ DOM æ“ä½œå…¶å®æ˜¯ä»£ç é‡Œé¢çš„" å™ªéŸ³", ä¸åˆ©äºæˆ‘ä»¬ç†è§£å’Œç»´æŠ¤.

é¡ºå¸¦ä¸€æçš„æ˜¯, å…¶å®å¯ä»¥ç»™ç»„ä»¶æ ‡ç­¾ä¹ŸåŠ ä¸Š ref, ä¾‹å¦‚:

#+BEGIN_SRC javascript :results values list :exports no-eval
    <Clock ref={(clock) => this.clock = clock} />
#+END_SRC

è¿™æ ·ä½ è·å–åˆ°çš„æ˜¯è¿™ä¸ª Clock ç»„ä»¶åœ¨ React.js å†…éƒ¨åˆå§‹åŒ–çš„å®ä¾‹.
ä½†è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆå¸¸ç”¨çš„åšæ³•, è€Œä¸”ä¹Ÿå¹¶ä¸å»ºè®®è¿™ä¹ˆåš, æ‰€ä»¥è¿™é‡Œå°±ç®€å•æåŠ, æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªå·±å­¦ä¹ æ¢ç´¢.

* props.children å’Œå®¹å™¨ç±»ç»„ä»¶
æœ‰ä¸€ç±»ç»„ä»¶, å……å½“äº†å®¹å™¨çš„ä½œç”¨, å®ƒå®šä¹‰äº†ä¸€ç§å¤–å±‚ç»“æ„å½¢å¼, ç„¶åä½ å¯ä»¥å¾€é‡Œé¢å¡ä»»æ„çš„å†…å®¹. è¿™ç§ç»“æ„åœ¨å®é™…å½“ä¸­éå¸¸å¸¸è§, ä¾‹å¦‚è¿™ç§å¸¦å¡ç‰‡ç»„ä»¶:

[[file:./static/React.js å°ä¹¦/45A7AD7E-CC88-4957-B1EF-09DFE7755590.png]]

ç»„ä»¶æœ¬èº«æ˜¯ä¸€ä¸ªä¸å¸¦ä»»ä½•å†…å®¹çš„æ–¹å½¢çš„å®¹å™¨, æˆ‘å¯ä»¥åœ¨ç”¨è¿™ä¸ªç»„ä»¶çš„æ—¶å€™ç»™å®ƒä¼ å…¥ä»»æ„å†…å®¹:

[[file:./static/React.js å°ä¹¦/6BD73C14-60FE-44BA-A93C-B637BD07DE59.png]]

åŸºäºæˆ‘ä»¬ç›®å‰çš„çŸ¥è¯†å‚¨å¤‡, å¯ä»¥è¿…é€Ÿå†™å‡ºè¿™æ ·çš„ä»£ç :

#+BEGIN_SRC javascript :results values list :exports no-eval
class Card extends Component {
  render () {
    return (
      <div className='card'>
        <div className='card-content'>
          {this.props.content}
        </div>
      </div>
    )
  }
}

ReactDOM.render(
  <Card content={
    <div>
      <h2>React.js å°ä¹¦</h2>
      <div>å¼€æº, å…è´¹, ä¸“ä¸š, ç®€å•</div>
            è®¢é˜…:<input />
    </div>
  } />,
  document.getElementById('root')
)
#+END_SRC

æˆ‘ä»¬é€šè¿‡ç»™ Card ç»„ä»¶ä¼ å…¥ä¸€ä¸ª content å±æ€§, è¿™ä¸ªå±æ€§å¯ä»¥ä¼ å…¥ä»»æ„çš„ JSX ç»“æ„ [[JSX è¡¨è¾¾å¼çš„æ’å…¥][See: JSX è¡¨è¾¾å¼çš„æ’å…¥]].
ç„¶ååœ¨ Card å†…éƒ¨ä¼šé€šè¿‡ {this.props.content} æŠŠå†…å®¹æ¸²æŸ“åˆ°é¡µé¢ä¸Š.

è¿™æ ·æ˜æ˜¾å¤ªä¸‘äº†, å¦‚æœ Card é™¤äº† content ä»¥å¤–è¿˜èƒ½ä¼ å…¥å…¶ä»–å±æ€§çš„è¯, é‚£ä¹ˆè¿™äº› JSX å’Œå…¶ä»–å±æ€§å°±ä¼šæ··åœ¨ä¸€èµ·.
å¾ˆä¸å¥½ç»´æŠ¤, å¦‚æœèƒ½åƒä¸‹é¢çš„ä»£ç é‚£æ ·ä½¿ç”¨ Card é‚£æƒ³å¿…ä¹Ÿæ˜¯æå¥½çš„:

#+BEGIN_SRC javascript :results values list :exports no-eval
ReactDOM.render(
  <Card>
    <h2>React.js å°ä¹¦</h2>
    <div>å¼€æº, å…è´¹, ä¸“ä¸š, ç®€å•</div>
                è®¢é˜…:<input />
  </Card>,
  document.getElementById('root')
)
#+END_SRC

å¦‚æœç»„ä»¶æ ‡ç­¾ä¹Ÿèƒ½åƒæ™®é€šçš„ HTML æ ‡ç­¾é‚£æ ·ç¼–å†™å†…åµŒçš„ç»“æ„, é‚£ä¹ˆå°±æ–¹ä¾¿å¾ˆå¤šäº†.
å®é™…ä¸Š,React.js é»˜è®¤å°±æ”¯æŒè¿™ç§å†™æ³•, æ‰€æœ‰åµŒå¥—åœ¨ç»„ä»¶ä¸­çš„ JSX ç»“æ„éƒ½å¯ä»¥åœ¨ç»„ä»¶å†…éƒ¨é€šè¿‡ props.children è·å–åˆ°:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Card extends Component {
  render () {
    return (
      <div className='card'>
        <div className='card-content'>
          {this.props.children}
        </div>
      </div>
    )
  }
}
#+END_SRC

æŠŠ props.children æ‰“å°å‡ºæ¥, ä½ å¯ä»¥çœ‹åˆ°å®ƒå…¶å®æ˜¯ä¸ªæ•°ç»„:

[[file:./static/React.js å°ä¹¦/4CD84934-5A7F-4942-A5F5-3C935E113499.png]]

React.js å°±æ˜¯æŠŠæˆ‘ä»¬åµŒå¥—çš„ JSX å…ƒç´ ä¸€ä¸ªä¸ªéƒ½æ”¾åˆ°æ•°ç»„å½“ä¸­, ç„¶åé€šè¿‡ props.children ä¼ ç»™äº† Card.

ç”±äº JSX ä¼šæŠŠæ’å…¥è¡¨è¾¾å¼é‡Œé¢æ•°ç»„ä¸­çš„ JSX ä¸€ä¸ªä¸ªç½—åˆ—ä¸‹æ¥æ˜¾ç¤º.
æ‰€ä»¥å…¶å®å°±ç›¸å½“äºåœ¨ Card ä¸­åµŒå¥—äº†ä»€ä¹ˆ JSX ç»“æ„, éƒ½ä¼šæ˜¾ç¤ºåœ¨ Card çš„ç±»åä¸º card-content çš„ div å…ƒç´ å½“ä¸­.

è¿™ç§åµŒå¥—çš„å†…å®¹æˆä¸ºäº† props.children æ•°ç»„çš„æœºåˆ¶ä½¿å¾—æˆ‘ä»¬ç¼–å†™ç»„ä»¶å˜å¾—éå¸¸çš„çµæ´», æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨ç»„ä»¶å†…éƒ¨æŠŠæ•°ç»„ä¸­çš„ JSX å…ƒç´ å®‰ç½®åœ¨ä¸åŒçš„åœ°æ–¹:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Layout extends Component {
  render () {
    return (
      <div className='two-cols-layout'>
        <div className='sidebar'>
          {this.props.children[0]}
        </div>
        <div className='main'>
          {this.props.children[1]}
        </div>
      </div>
    )
  }
}
#+END_SRC

è¿™æ˜¯ä¸€ä¸ªä¸¤åˆ—å¸ƒå±€ç»„ä»¶, åµŒå¥—çš„ JSX çš„ç¬¬ä¸€ä¸ªç»“æ„ä¼šæˆä¸ºä¾§è¾¹æ , ç¬¬äºŒä¸ªç»“æ„ä¼šæˆä¸ºå†…å®¹æ , å…¶ä½™çš„ç»“æ„éƒ½ä¼šè¢«å¿½ç•¥.
è¿™æ ·é€šè¿‡è¿™ä¸ªå¸ƒå±€ç»„ä»¶, å°±å¯ä»¥åœ¨å„ä¸ªåœ°æ–¹é«˜åº¦å¤ç”¨æˆ‘ä»¬çš„å¸ƒå±€.

** æ€»ç»“
 ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶çš„æ—¶å€™, å¯ä»¥åœ¨å…¶ä¸­åµŒå¥— JSX ç»“æ„.
 åµŒå¥—çš„ç»“æ„åœ¨ç»„ä»¶å†…éƒ¨éƒ½å¯ä»¥é€šè¿‡ props.children è·å–åˆ°, è¿™ç§ç»„ä»¶ç¼–å†™æ–¹å¼åœ¨ç¼–å†™å®¹å™¨ç±»å‹çš„ç»„ä»¶å½“ä¸­éå¸¸æœ‰ç”¨.
 è€Œåœ¨å®é™…çš„ React.js é¡¹ç›®å½“ä¸­, æˆ‘ä»¬å‡ ä¹æ¯å¤©éƒ½éœ€è¦ç”¨è¿™ç§æ–¹å¼æ¥ç¼–å†™ç»„ä»¶.

* dangerouslySetHTML å’Œ style å±æ€§
è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è¡¥å……ä¸¤ä¸ªä¹‹å‰æ²¡æœ‰æåˆ°çš„å±æ€§, ä½†æ˜¯åœ¨ React.js ç»„ä»¶å¼€å‘ä¸­ä¹Ÿéå¸¸å¸¸ç”¨, ä½†æ˜¯å®ƒä»¬ä¹Ÿå¾ˆç®€å•.

** dangerouslySetHTML
 å‡ºäºå®‰å…¨è€ƒè™‘çš„åŸå› (XSS æ”»å‡»), åœ¨ React.js å½“ä¸­æ‰€æœ‰çš„è¡¨è¾¾å¼æ’å…¥çš„å†…å®¹éƒ½ä¼šè¢«è‡ªåŠ¨è½¬ä¹‰,
 å°±ç›¸å½“äº jQuery é‡Œé¢çš„ text(â€¦) å‡½æ•°ä¸€æ ·, ä»»ä½•çš„ HTML æ ¼å¼éƒ½ä¼šè¢«è½¬ä¹‰æ‰:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Editor extends Component {
   constructor () {
     super()
     this.state = {
       content: '<h1>React.js å°ä¹¦</h1>'
     }
   }

   render () {
     return (
       <div className='editor-wrapper'>
         {this.state.content}
       </div>
     )
   }
 }
 #+END_SRC

 å‡è®¾ä¸Šé¢æ˜¯ä¸€ä¸ªå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç»„ä»¶, å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„å†…å®¹æ˜¯åŠ¨æ€çš„ HTML å†…å®¹, ç”¨ this.state.content æ¥ä¿å­˜.
 æˆ‘å¸Œæœ›åœ¨ç¼–è¾‘å™¨å†…éƒ¨æ˜¾ç¤ºè¿™ä¸ªåŠ¨æ€ HTML ç»“æ„, ä½†æ˜¯å› ä¸º React.js çš„è½¬ä¹‰ç‰¹æ€§, é¡µé¢ä¸Šä¼šæ˜¾ç¤º:

 [[file:./static/React.js å°ä¹¦/A67A4660-604A-4F42-A743-A059A96344C8.png]]

 è¡¨è¾¾å¼æ’å…¥å¹¶ä¸ä¼šæŠŠä¸€ä¸ª <h1> æ¸²æŸ“åˆ°é¡µé¢, è€Œæ˜¯æŠŠå®ƒçš„æ–‡æœ¬å½¢å¼æ¸²æŸ“äº†.
 é‚£è¦æ€ä¹ˆæ‰èƒ½åšåˆ°è®¾ç½®åŠ¨æ€ HTML ç»“æ„çš„æ•ˆæœå‘¢?React.js æä¾›äº†ä¸€ä¸ªå±æ€§ dangerouslySetInnerHTML, å¯ä»¥è®©æˆ‘ä»¬è®¾ç½®åŠ¨æ€è®¾ç½®å…ƒç´ çš„ innerHTML:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
  render () {
    return (
      <div
        className='editor-wrapper'
        dangerouslySetInnerHTML={{__html: this.state.content}} />
      )
    }
 ...
 #+END_SRC

 éœ€è¦ç»™ dangerouslySetInnerHTML ä¼ å…¥ä¸€ä¸ªå¯¹è±¡, è¿™ä¸ªå¯¹è±¡çš„ __html å±æ€§å€¼å°±ç›¸å½“äºå…ƒç´ çš„ innerHTML, è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åŠ¨æ€æ¸²æŸ“å…ƒç´ çš„ innerHTML ç»“æ„äº†.

 æœ‰å†™æœ‹å‹ä¼šè§‰å¾—å¾ˆå¥‡æ€ª, ä¸ºä»€ä¹ˆè¦æŠŠä¸€ä»¶è¿™ä¹ˆç®€å•çš„äº‹æƒ…æå¾—è¿™ä¹ˆå¤æ‚, åå­—åˆé•¿, è¿˜è¦ä¼ å…¥ä¸€ä¸ªå¥‡æ€ªçš„å¯¹è±¡.
 é‚£æ˜¯å› ä¸ºè®¾ç½® innerHTML å¯èƒ½ä¼šå¯¼è‡´è·¨ç«™è„šæœ¬æ”»å‡»(XSS), æ‰€ä»¥ React.js å›¢é˜Ÿè®¤ä¸ºæŠŠäº‹æƒ…æå¤æ‚å¯ä»¥é˜²æ­¢(è­¦ç¤º) å¤§å®¶æ»¥ç”¨è¿™ä¸ªå±æ€§. è¿™ä¸ªå±æ€§ä¸å¿…è¦çš„æƒ…å†µå°±ä¸è¦ä½¿ç”¨.

** style
 React.js ä¸­çš„å…ƒç´ çš„ style å±æ€§çš„ç”¨æ³•å’Œ DOM é‡Œé¢çš„ style ä¸å¤§ä¸€æ ·, æ™®é€šçš„ HTML ä¸­çš„:

 #+BEGIN_SRC html :results values list :exports no-eval
     <h1 style='font-size: 12px; color: red;'>React.js å°ä¹¦</h1>
 #+END_SRC

 åœ¨ React.js ä¸­ä½ éœ€è¦æŠŠ CSS å±æ€§å˜æˆä¸€ä¸ªå¯¹è±¡å†ä¼ ç»™å…ƒç´ :

 #+BEGIN_SRC javascript :results values list :exports no-eval
     <h1 style={{fontSize: '12px', color: 'red'}}>React.js å°ä¹¦</h1>
 #+END_SRC

 style æ¥å—ä¸€ä¸ªå¯¹è±¡, è¿™ä¸ªå¯¹è±¡é‡Œé¢æ˜¯è¿™ä¸ªå…ƒç´ çš„ CSS å±æ€§é”®å€¼å¯¹, /*åŸæ¥ CSS å±æ€§ä¸­å¸¦ - çš„å…ƒç´ éƒ½å¿…é¡»è¦å»æ‰ - æ¢æˆé©¼å³°å‘½å*/,
 å¦‚ font-size æ¢æˆ fontSize,text-align æ¢æˆ textAlign.

 ç”¨å¯¹è±¡ä½œä¸º style æ–¹ä¾¿æˆ‘ä»¬åŠ¨æ€è®¾ç½®å…ƒç´ çš„æ ·å¼.
 æˆ‘ä»¬å¯ä»¥ç”¨ props æˆ–è€… state ä¸­çš„æ•°æ®ç”Ÿæˆæ ·å¼å¯¹è±¡å†ä¼ ç»™å…ƒç´ , ç„¶åç”¨ setState å°±å¯ä»¥ä¿®æ”¹æ ·å¼, éå¸¸çµæ´»:

 #+BEGIN_SRC javascript :results values list :exports no-eval
     <h1 style={{fontSize: '12px', color: this.state.color}}>React.js å°ä¹¦</h1>
 #+END_SRC

 åªè¦ç®€å•åœ° setState({color: 'blue'}) å°±å¯ä»¥ä¿®æ”¹å…ƒç´ çš„é¢œè‰²æˆè“è‰².

* PropTypes å’Œç»„ä»¶å‚æ•°éªŒè¯
æˆ‘ä»¬æ¥äº†åˆ°äº†ä¸€ä¸ªéå¸¸å°´å°¬çš„ç« èŠ‚, å¾ˆå¤šåˆå­¦çš„æœ‹å‹å¯èƒ½å¯¹è¿™ä¸€ç« çš„çŸ¥è¯†ç‚¹ä¸å±‘ä¸€é¡¾, è§‰å¾—ç”¨ä¸ç”¨å¯¹ç¨‹åºåŠŸèƒ½ä¹Ÿæ²¡ä»€ä¹ˆå½±å“.
ä½†å…¶å®è¿™ä¸€ç« èŠ‚çš„çŸ¥è¯†åœ¨ä½ æ„å»ºå¤šäººåä½œ, å¤§å‹çš„åº”ç”¨ç¨‹åºçš„æ—¶å€™ä¹Ÿæ˜¯éå¸¸é‡è¦çš„, ä¸å¯å¿½è§†.

éƒ½è¯´ JavaScript æ˜¯ä¸€é—¨çµæ´»çš„è¯­è¨€ â€”â€” è¿™å°±æ˜¯åƒæ˜¯è¯´" ä½ æ˜¯ä¸ªå¥½äºº" ä¸€æ ·, å‡¡äº‹éƒ½æœ‰èƒŒåæ²¡æœ‰è¯´å‡ºæ¥çš„è¯.
JavaScript çš„çµæ´»æ€§ä½“ç°åœ¨å¼±ç±»å‹, é«˜é˜¶å‡½æ•°ç­‰è¯­è¨€ç‰¹æ€§ä¸Š.
è€Œè¯­è¨€çš„å¼±ç±»å‹ä¸€èˆ¬æ¥è¯´ç¡®å®è®©æˆ‘ä»¬å†™ä»£ç å¾ˆçˆ½, ä½†æ˜¯ä¹Ÿå¾ˆå®¹æ˜“å‡º bug.

å˜é‡æ²¡æœ‰å›ºå®šç±»å‹å¯ä»¥éšæ„èµ‹å€¼, åœ¨æˆ‘ä»¬æ„å»ºå¤§å‹åº”ç”¨ç¨‹åºçš„æ—¶å€™å¹¶ä¸æ˜¯ä»€ä¹ˆå¥½çš„äº‹æƒ….
ä½ å†™ä¸‹äº† let a = {} , å¦‚æœè¿™æ˜¯ä¸ªå…±äº«çš„çŠ¶æ€å¹¶ä¸”åœ¨æŸä¸ªåœ°æ–¹æŠŠ a = 3, é‚£ä¹ˆ a.xxx å°±ä¼šè®©ç¨‹åºå´©æºƒäº†.
è€Œè¿™ç§éå¸¸éšæ™¦ä½†æ˜¯ä½çº§çš„é”™è¯¯åœ¨å¼ºç±»å‹çš„è¯­è¨€ä¾‹å¦‚ C/C++,Java ä¸­æ˜¯ä¸å¯èƒ½å‘ç”Ÿçš„, è¿™äº›ä»£ç è¿ç¼–è¯‘éƒ½ä¸å¯èƒ½é€šè¿‡, ä¹Ÿåˆ«å¦„å›¾è¿è¡Œ.

å¤§å‹åº”ç”¨ç¨‹åºçš„æ„å»ºå…¶å®æ›´é€‚åˆç”¨å¼ºç±»å‹çš„è¯­è¨€æ¥æ„å»º, å®ƒæœ‰æ›´å¤šçš„è§„åˆ™, å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç é˜¶æ®µ, ç¼–è¯‘é˜¶æ®µè§„é¿æ‰å¾ˆå¤šé—®é¢˜, è®©æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ›´åŠ çš„å®‰å…¨.
JavaScript æ—©å°±è„±ç¦»äº†ç©å…·è¯­è¨€çš„é¢†åŸŸå¹¶ä¸”æŠ•å…¥åˆ°å¤§å‹çš„åº”ç”¨ç¨‹åºçš„ç”Ÿäº§æ´»åŠ¨ä¸­, å› ä¸ºå®ƒçš„å¼±ç±»å‹, å¸¸å¸¸æ„å‘³ç€ä¸æ˜¯å¾ˆå®‰å…¨.
æ‰€ä»¥è¿‘å¹´æ¥å‡ºç°äº†ç±»ä¼¼ TypeScript å’Œ Flow ç­‰æŠ€æœ¯, æ¥å¼¥è¡¥ JavaScript è¿™æ–¹é¢çš„ç¼ºé™·.

React.js çš„ç»„ä»¶å…¶å®æ˜¯ä¸ºäº†æ„å»ºå¤§å‹åº”ç”¨ç¨‹åºè€Œç”Ÿ.
ä½†æ˜¯å› ä¸º JavaScript è¿™æ ·çš„ç‰¹æ€§, ä½ åœ¨ç¼–å†™äº†ä¸€ä¸ªç»„ä»¶ä»¥å, æ ¹æœ¬ä¸çŸ¥é“åˆ«äººä¼šæ€ä¹ˆä½¿ç”¨ä½ çš„ç»„ä»¶, å¾€é‡Œä¼ ä»€ä¹ˆä¹±ä¸ƒå…«ç³Ÿçš„å‚æ•°, ä¾‹å¦‚è¯„è®ºç»„ä»¶:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Comment extends Component {
  const { comment } = this.props
  render () {
    return (
      <div className='comment'>
        <div className='comment-user'>
          <span>{comment.username} </span>:
          </div>
          <p>{comment.content}</p>
        </div>
    )
  }
}
#+END_SRC

ä½†æ˜¯åˆ«äººå¾€é‡Œé¢ä¼ ä¸€ä¸ªæ•°å­—ä½ æ‹¿ä»–ä¸€ç‚¹åŠæ³•éƒ½æ²¡æœ‰:

#+BEGIN_SRC javascript :results values list :exports no-eval
    <Comment comment={1} />
#+END_SRC

JavaScript åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯ä¸ä¼šæŠ¥ä»»ä½•é”™è¯¯çš„, ä½†æ˜¯é¡µé¢å°±æ˜¯æ˜¾ç¤ºä¸æ­£å¸¸, ç„¶åæˆ‘ä»¬è¸ä¸Šäº†æ¼«æ¼« debug çš„è·¯ç¨‹.
è¿™é‡Œçš„ä¾‹å­è¿˜æ˜¯è¿‡äºç®€å•, å®¹æ˜“ debug, ä½†æ˜¯å¯¹äºæ¯”è¾ƒå¤æ‚çš„æˆå› å’Œæƒ…å†µæ˜¯æ¯”è¾ƒéš¾å¤„ç†çš„.

äºæ˜¯ React.js å°±æä¾›äº†ä¸€ç§æœºåˆ¶, è®©ä½ å¯ä»¥ç»™ç»„ä»¶çš„é…ç½®å‚æ•°åŠ ä¸Šç±»å‹éªŒè¯, å°±ç”¨ä¸Šè¿°çš„è¯„è®ºç»„ä»¶ä¾‹å­, ä½ å¯ä»¥é…ç½® Comment åªèƒ½æ¥å—å¯¹è±¡ç±»å‹çš„ comment å‚æ•°,
ä½ ä¼ ä¸ªæ•°å­—è¿›æ¥ç»„ä»¶å°±å¼ºåˆ¶æŠ¥é”™.
æˆ‘ä»¬è¿™é‡Œå…ˆå®‰è£…ä¸€ä¸ª React æä¾›çš„ç¬¬ä¸‰æ–¹åº“ prop-types:

#+BEGIN_SRC javascript :results values list :exports no-eval
npm install --save prop-types
#+END_SRC

å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬éªŒè¯ props çš„å‚æ•°ç±»å‹, ä¾‹å¦‚:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'

class Comment extends Component {
  static propTypes = {
    comment: PropTypes.object
  }

  render () {
    const { comment } = this.props
      return (
        <div className='comment'>
          <div className='comment-user'>
            <span>{comment.username} </span>:
              </div>
              <p>{comment.content}</p>
          </div>
      )
  }
}
#+END_SRC

æ³¨æ„æˆ‘ä»¬åœ¨æ–‡ä»¶å¤´éƒ¨å¼•å…¥äº† PropTypes, å¹¶ä¸”ç»™ Comment ç»„ä»¶ç±»æ·»åŠ äº†ç±»å±æ€§ propTypes, é‡Œé¢çš„å†…å®¹çš„æ„æ€å°±æ˜¯ä½ ä¼ å…¥çš„ comment ç±»å‹å¿…é¡»ä¸º object(å¯¹è±¡).

è¿™æ—¶å€™å¦‚æœå†å¾€é‡Œé¢ä¼ å…¥æ•°å­—, æµè§ˆå™¨å°±ä¼šæŠ¥é”™:

[[file:./static/React.js å°ä¹¦/BFC94736-56D0-42C2-B1A4-088334397D4D.png]]

å‡ºé”™ä¿¡æ¯æ˜ç¡®å‘Šè¯‰æˆ‘ä»¬: ä½ ç»™ Comment ç»„ä»¶ä¼ äº†ä¸€ä¸ªæ•°å­—ç±»å‹çš„ comment, è€Œå®ƒåº”è¯¥æ˜¯ object. ä½ å°±æ¸…æ™°çŸ¥é“é—®é¢˜å‡ºåœ¨å“ªé‡Œäº†.

è™½ç„¶ propTypes å¸®æˆ‘ä»¬æŒ‡å®šäº†å‚æ•°ç±»å‹, ä½†æ˜¯å¹¶æ²¡æœ‰è¯´è¿™ä¸ªå‚æ•°ä¸€å®šè¦ä¼ å…¥, äº‹å®ä¸Š, è¿™äº›å‚æ•°é»˜è®¤éƒ½æ˜¯å¯é€‰çš„.
å¯é€‰å‚æ•°æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½® defaultProps, è®©å®ƒåœ¨ä¸ä¼ å…¥çš„æ—¶å€™æœ‰é»˜è®¤å€¼.
ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œå¹¶æ²¡æœ‰é…ç½® defaultProps, æ‰€ä»¥å¦‚æœç›´æ¥ç”¨ <Comment /> è€Œä¸ä¼ å…¥ä»»ä½•å‚æ•°çš„è¯,comment å°±ä¼šæ˜¯ undefined,comment.username ä¼šå¯¼è‡´ç¨‹åºæŠ¥é”™:

[[file:./static/React.js å°ä¹¦/CCDCBB39-A469-4EE7-9D85-F32AA7C9F4E0.png]]

è¿™ä¸ªå‡ºé”™ä¿¡æ¯å¹¶ä¸å¤Ÿå‹å¥½. æˆ‘ä»¬å¯ä»¥é€šè¿‡ isRequired å…³é”®å­—æ¥å¼ºåˆ¶ç»„ä»¶æŸä¸ªå‚æ•°å¿…é¡»ä¼ å…¥:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
    static propTypes = {
      comment: PropTypes.object.isRequired
    }
...
#+END_SRC

é‚£ä¹ˆä¼šè·å¾—ä¸€ä¸ªæ›´åŠ å‹å¥½çš„å‡ºé”™ä¿¡æ¯, æŸ¥é”™ä¼šæ›´æ–¹ä¾¿:

[[file:./static/React.js å°ä¹¦/E1896DA9-0ED6-4A99-B7B5-EEC260FB9814.png]]

React.js æä¾›çš„ PropTypes æä¾›äº†ä¸€ç³»åˆ—çš„æ•°æ®ç±»å‹å¯ä»¥ç”¨æ¥é…ç½®ç»„ä»¶çš„å‚æ•°:

#+BEGIN_SRC javascript :results values list :exports no-eval
PropTypes.array
PropTypes.bool
PropTypes.func
PropTypes.number
PropTypes.object
PropTypes.string
PropTypes.node
PropTypes.element
...
#+END_SRC

æ›´å¤šç±»å‹åŠå…¶ç”¨æ³•å¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£:[[https://facebook.github.io/react/docs/typechecking-with-proptypes.html][ Typechecking With PropTypes - React]].

ç»„ä»¶å‚æ•°éªŒè¯åœ¨æ„å»ºå¤§å‹çš„ç»„ä»¶åº“çš„æ—¶å€™ç›¸å½“æœ‰ç”¨, å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿…é€Ÿå®šä½è¿™ç§ç±»å‹é”™è¯¯, è®©æˆ‘ä»¬ç»„ä»¶å¼€å‘æ›´åŠ è§„èŒƒ.
å¦å¤–ä¹Ÿèµ·åˆ°äº†ä¸€ä¸ªè¯´æ˜æ–‡æ¡£çš„ä½œç”¨, å¦‚æœå¤§å®¶éƒ½çº¦å®šéƒ½å†™ propTypes, é‚£ä½ åœ¨ä½¿ç”¨åˆ«äººå†™çš„ç»„ä»¶çš„æ—¶å€™,
åªè¦çœ‹åˆ°ç»„ä»¶çš„ propTypes å°±æ¸…æ™°åœ°çŸ¥é“è¿™ä¸ªç»„ä»¶åˆ°åº•èƒ½å¤Ÿæ¥å—ä»€ä¹ˆå‚æ•°, ä»€ä¹ˆå‚æ•°æ˜¯å¯é€‰çš„, ä»€ä¹ˆå‚æ•°æ˜¯å¿…é€‰çš„.

** æ€»ç»“
 é€šè¿‡ PropTypes ç»™ç»„ä»¶çš„å‚æ•°åšç±»å‹é™åˆ¶, å¯ä»¥åœ¨å¸®åŠ©æˆ‘ä»¬è¿…é€Ÿå®šä½é”™è¯¯, è¿™åœ¨æ„å»ºå¤§å‹åº”ç”¨ç¨‹åºçš„æ—¶å€™ç‰¹åˆ«æœ‰ç”¨, å¦å¤–, ç»™ç»„ä»¶åŠ ä¸Š propTypes, ä¹Ÿè®©ç»„ä»¶çš„å¼€å‘, ä½¿ç”¨æ›´åŠ è§„èŒƒæ¸…æ™°.

 è¿™é‡Œå»ºè®®å¤§å®¶å†™ç»„ä»¶çš„æ—¶å€™å°½é‡éƒ½å†™ propTypes, æœ‰æ—¶å€™æœ‰ç‚¹éº»çƒ¦, ä½†æ˜¯æ˜¯å€¼å¾—çš„.

* å®æˆ˜åˆ†æ: è¯„è®ºåŠŸèƒ½(å››)
ç›®å‰ä¸ºæ­¢, ç¬¬äºŒé˜¶æ®µçŸ¥è¯†å·²ç»åŸºæœ¬ä»‹ç»å®Œ, æˆ‘ä»¬å·²ç»å…·å¤‡äº†é¡¹ç›®ä¸Šæ‰‹å®æˆ˜å¿…å¤‡çš„ React.js çŸ¥è¯†, ç°åœ¨å¯ä»¥æŠŠè¿™äº›çŸ¥è¯†åº”ç”¨èµ·æ¥.
æ¥ä¸‹æ¥æ˜¯å®æˆ˜ç¯èŠ‚, æˆ‘ä»¬ä¼šç»§ç»­ä¸Šä¸€é˜¶æ®µçš„ä¾‹å­, æŠŠè¯„è®ºåŠŸèƒ½åšå¾—æ›´åŠ å¤æ‚ä¸€ç‚¹.

æˆ‘ä»¬åœ¨ä¸Šä¸€é˜¶æ®µçš„è¯„è®ºåŠŸèƒ½åŸºç¡€ä¸ŠåŠ ä¸Šä»¥ä¸‹åŠŸèƒ½éœ€æ±‚:

- é¡µé¢åŠ è½½å®Œæˆè‡ªåŠ¨èšç„¦åˆ°è¯„è®ºè¾“å…¥æ¡†.
- æŠŠç”¨æˆ·åæŒä¹…åŒ–, å­˜æ”¾åˆ°æµè§ˆå™¨çš„ LocalStorage ä¸­. é¡µé¢åŠ è½½æ—¶ä¼šæŠŠç”¨æˆ·ååŠ è½½å‡ºæ¥æ˜¾ç¤ºåˆ°è¾“å…¥æ¡†, ç”¨æˆ·å°±ä¸éœ€è¦é‡æ–°è¾“å…¥ç”¨æˆ·åäº†.
- æŠŠå·²ç»å‘å¸ƒçš„è¯„è®ºæŒä¹…åŒ–, å­˜æ”¾åˆ°æµè§ˆå™¨çš„ LocalStorage ä¸­. é¡µé¢åŠ è½½æ—¶ä¼šæŠŠå·²ç»ä¿å­˜çš„è¯„è®ºåŠ è½½å‡ºæ¥, æ˜¾ç¤ºåˆ°é¡µé¢çš„è¯„è®ºåˆ—è¡¨ä¸Š.
- è¯„è®ºæ˜¾ç¤ºå‘å¸ƒæ—¥æœŸ, å¦‚"1 ç§’å‰","30 åˆ†é’Ÿå‰", å¹¶ä¸”ä¼šæ¯éš” 5 ç§’æ›´æ–°å‘å¸ƒæ—¥æœŸ.
- è¯„è®ºå¯ä»¥è¢«åˆ é™¤.
- ç±»ä¼¼ Markdown çš„è¡Œå†…ä»£ç å—æ˜¾ç¤ºåŠŸèƒ½, ç”¨æˆ·è¾“å…¥çš„ç”¨ `` åŒ…å«èµ·æ¥çš„å†…å®¹éƒ½ä¼šè¢«å¤„ç†æˆç”¨ <code> å…ƒç´ åŒ…å«.
  ä¾‹å¦‚è¾“å…¥ `console.log` å°±ä¼šå¤„ç†æˆ <code>console.log</code> å†æ˜¾ç¤ºåˆ°é¡µé¢ä¸Š.

[[file:./static/React.js å°ä¹¦/E01D3698-F041-4149-9626-849F023E5638.png]]

[[https://huzidaha.github.io/react-naive-book-examples/comment-app2/build/index.html][åœ¨çº¿æ¼”ç¤ºåœ°å€]].

å¤§å®¶å¯ä»¥åœ¨åŸæ¥çš„ç¬¬ä¸€é˜¶æ®µä»£ç çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹, ç¬¬ä¸€, äºŒé˜¶æ®µè¯„è®ºåŠŸèƒ½ä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°: [[https://github.com/huzidaha/react-naive-book-examples][react-naive-book-examples]].
å¯ä»¥ç›´æ¥ä½¿ç”¨æœ€æ–°çš„æ ·å¼æ–‡ä»¶ index.css è¦†ç›–åŸæ¥çš„ index.css.

æ¥ä¸‹æ¥å¯ä»¥åˆ†æå¦‚ä½•åˆ©ç”¨ç¬¬äºŒé˜¶æ®µçš„çŸ¥è¯†æ¥æ„å»ºè¿™äº›åŠŸèƒ½, åœ¨è¿™ä¸ªè¿‡ç¨‹é‡Œé¢å¯èƒ½ä¼šç©¿æ’ä¸€äº›å°æŠ€å·§, å¸Œæœ›å¯¹å¤§å®¶æœ‰ç”¨. æˆ‘ä»¬å›é¡¾ä¸€ä¸‹è¿™ä¸ªé¡µé¢çš„ç»„æˆ:

[[file:./static/React.js å°ä¹¦/1.png]]

æˆ‘ä»¬ä¹‹å‰æŠŠé¡µé¢åˆ†æˆäº†å››ç§ä¸åŒçš„ç»„ä»¶: åˆ†åˆ«æ˜¯ CommentApp,CommentInput,CommentList,Comment.
æˆ‘ä»¬å¼€å§‹ä¿®æ”¹è¿™ä¸ªç»„ä»¶, æŠŠä¸Šé¢çš„éœ€æ±‚é€ä¸ªå®Œæˆ.

** è‡ªåŠ¨èšç„¦åˆ°è¯„è®ºæ¡†
 è¿™ä¸ªåŠŸèƒ½æ˜¯å¾ˆç®€å•çš„, æˆ‘ä»¬éœ€è¦è·å– textarea çš„ DOM å…ƒç´ ç„¶åè°ƒç”¨ focus() API å°±å¯ä»¥äº†.
 æˆ‘ä»¬ç»™è¾“å…¥æ¡†å…ƒç´ åŠ ä¸Š ref ä»¥ä¾¿è·å–åˆ° DOM å…ƒç´ , ä¿®æ”¹ src/CommentInput.js æ–‡ä»¶:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     <textarea
       ref={(textarea) => this.textarea = textarea}
       value={this.state.content}
       onChange={this.handleContentChange.bind(this)} />
 ...
 #+END_SRC

 ç»„ä»¶æŒ‚è½½å®Œä»¥åå®Œæˆä»¥åå°±å¯ä»¥è°ƒç”¨ this.textarea.focus(), ç»™ CommentInput ç»„ä»¶åŠ ä¸Š ComponentDidMount ç”Ÿå‘½å‘¨æœŸ:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class CommentInput extends Component {
   static propTypes = {
     onSubmit: PropTypes.func
   }

   constructor () {
     super()
     this.state = {
       username: '',
       content: ''
       }
     }

   componentDidMount () {
     this.textarea.focus()
   }
 ...
 #+END_SRC

 è¿™ä¸ªåŠŸèƒ½å°±å®Œæˆäº†. ç°åœ¨ä½“éªŒè¿˜ä¸æ˜¯å¾ˆå¥½, æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠç”¨æˆ·åæŒä¹…åŒ–ä¸€ä¸‹, ä½“éªŒå°±ä¼šå¥½å¾ˆå¤š.

 å¤§å®¶å¯ä»¥æ³¨æ„åˆ°æˆ‘ä»¬ç»™åŸæ¥çš„ props.onSubmit å‚æ•°åŠ äº†ç»„ä»¶å‚æ•°éªŒè¯, åœ¨è¿™æ¬¡å®æˆ˜æ¡ˆä¾‹ä¸­, æˆ‘ä»¬éƒ½ä¼šç»™è¯„è®ºåŠŸèƒ½çš„ç»„ä»¶åŠ ä¸Š propTypes è¿›è¡Œå‚æ•°éªŒè¯, æ¥ä¸‹æ¥å°±ä¸ç´¯è¿°.

** æŒä¹…åŒ–ç”¨æˆ·å
 ç”¨æˆ·è¾“å…¥ç”¨æˆ·å, ç„¶åæˆ‘ä»¬æŠŠç”¨æˆ·åä¿å­˜åˆ°æµè§ˆå™¨çš„ LocalStorage å½“ä¸­, å½“é¡µé¢åŠ è½½çš„æ—¶å€™å†ä» LocalStorage æŠŠä¹‹å‰ä¿å­˜çš„ç”¨æˆ·åæ˜¾ç¤ºåˆ°ç”¨æˆ·åè¾“å…¥æ¡†å½“ä¸­.
 è¿™æ ·ç”¨æˆ·å°±ä¸ç”¨æ¯æ¬¡éƒ½è¾“å…¥ç”¨æˆ·åäº†, å¹¶ä¸”è¯„è®ºæ¡†æ˜¯è‡ªåŠ¨èšç„¦çš„, ç”¨æˆ·çš„è¾“å…¥ä½“éªŒå°±å¥½å¾ˆå¤š.

 æˆ‘ä»¬ç›‘å¬ç”¨æˆ·åè¾“å…¥æ¡†å¤±å»ç„¦ç‚¹çš„äº‹ä»¶ onBlur:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     <input
        value={this.state.username}
        onBlur={this.handleUsernameBlur.bind(this)}
        onChange={this.handleUsernameChange.bind(this)} />
 ...
 #+END_SRC

 åœ¨ handleUsernameBlur ä¸­æˆ‘ä»¬æŠŠç”¨æˆ·çš„è¾“å…¥å†…å®¹ä¿å­˜åˆ° LocalStorage å½“ä¸­:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class CommentInput extends Component {
     constructor () {
         super()
         this.state = {
             username: '',
             content: ''
         }
     }

     componentDidMount () {
         this.textarea.focus()
     }

     _saveUsername (username) {
         localStorage.setItem('username', username)
     }

     handleUsernameBlur (event) {
         this._saveUsername(event.target.value)
     }
     ...
 #+END_SRC

 åœ¨ handleUsernameBlur ä¸­æˆ‘ä»¬æŠŠç”¨æˆ·è¾“å…¥çš„å†…å®¹ä¼ ç»™äº† _saveUsername ç§æœ‰æ–¹æ³•(æ‰€æœ‰ç§æœ‰æ–¹æ³•éƒ½ä»¥ _ å¼€å¤´).
 _saveUsername ä¼šè®¾ç½® LocalStorage ä¸­çš„ username å­—æ®µ, ç”¨æˆ·åå°±æŒä¹…åŒ–äº†.
 è¿™æ ·å°±ç›¸å½“äºæ¯å½“ç”¨æˆ·è¾“å…¥å®Œç”¨æˆ·åä»¥å(è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹çš„æ—¶å€™), éƒ½ä¼šæŠŠç”¨æˆ·åè‡ªåŠ¨ä¿å­˜ä¸€æ¬¡.

 è¾“å…¥ç”¨æˆ·å, ç„¶ååˆ°æµè§ˆå™¨é‡Œé‡Œé¢çœ‹çœ‹æ˜¯å¦ä¿å­˜äº†:

 [[file:./static/React.js å°ä¹¦/04093DE1-B4C0-4CBD-B3F8-DF924C9F6799.png]]

 ç„¶åæˆ‘ä»¬ç»„ä»¶æŒ‚è½½çš„æ—¶å€™æŠŠç”¨æˆ·ååŠ è½½å‡ºæ¥.
 è¿™æ˜¯ä¸€ç§æ•°æ®åŠ è½½æ“ä½œ, æˆ‘ä»¬è¯´è¿‡, ä¸ä¾èµ– DOM æ“ä½œçš„ç»„ä»¶å¯åŠ¨çš„æ“ä½œéƒ½å¯ä»¥æ”¾åœ¨ componentWillMount ä¸­è¿›è¡Œ, æ‰€ä»¥ç»™ CommentInput æ·»åŠ  componentWillMount çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     componentWillMount () {
       this._loadUsername()
     }

 _loadUsername () {
   const username = localStorage.getItem('username')
   if (username) {
     this.setState({ username })
   }
 }

 _saveUsername (username) {
   localStorage.setItem('username', username)
 }
 ...
 #+END_SRC

 componentWillMount ä¼šè°ƒç”¨ _loadUsername ç§æœ‰æ–¹æ³•, _loadUsername ä¼šä» LocalStorage åŠ è½½ç”¨æˆ·åå¹¶ä¸” setState åˆ°ç»„ä»¶çš„ state.username ä¸­.
 é‚£ä¹ˆç»„ä»¶åœ¨æ¸²æŸ“çš„æ—¶å€™(render æ–¹æ³•) æŒ‚è½½çš„æ—¶å€™å°±å¯ä»¥ç”¨ä¸Šç”¨æˆ·åäº†.

 è¿™æ ·ä½“éªŒå°±å¥½å¤šäº†, åˆ·æ–°é¡µé¢, ä¸éœ€è¦è¾“å…¥ç”¨æˆ·å, å¹¶ä¸”è‡ªåŠ¨èšç„¦åˆ°äº†è¾“å…¥æ¡†.
 æˆ‘ä»¬ 1,2 éœ€æ±‚éƒ½å·²ç»å®Œæˆ.

** å°è´´å£«
 è¿™é‡Œæ’å…¥ä¸€äº›å°è´´ç¤º, å¤§å®¶å¯ä»¥æ³¨æ„åˆ°æˆ‘ä»¬ç»„ä»¶çš„å‘½åå’Œæ–¹æ³•çš„æ‘†æ”¾é¡ºåºå…¶å®æœ‰ä¸€å®šçš„è®²ç©¶, è¿™é‡Œå¯ä»¥ç®€å•åˆ†äº«ä¸€ä¸‹ä¸ªäººçš„ä¹ æƒ¯, ä»…ä¾›å‚è€ƒ.

 ç»„ä»¶çš„ç§æœ‰æ–¹æ³•éƒ½ç”¨ _ å¼€å¤´, æ‰€æœ‰äº‹ä»¶ç›‘å¬çš„æ–¹æ³•éƒ½ç”¨ handle å¼€å¤´.
 æŠŠäº‹ä»¶ç›‘å¬æ–¹æ³•ä¼ ç»™ç»„ä»¶çš„æ—¶å€™, å±æ€§åç”¨ on å¼€å¤´. ä¾‹å¦‚:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 <CommentInput
   onSubmit={this.handleSubmitComment.bind(this)} />
 #+END_SRC

 è¿™æ ·ç»Ÿä¸€è§„èŒƒå¤„ç†äº‹ä»¶å‘½åä¼šç»™æˆ‘ä»¬å¸¦æ¥è¯­ä¹‰åŒ–ç»„ä»¶çš„å¥½å¤„, ç›‘å¬(on)CommentInput çš„ Submit äº‹ä»¶, å¹¶ä¸”äº¤ç»™ this å»å¤„ç†(handle).
 è¿™ç§è§„èŒƒåœ¨å¤šäººåä½œçš„æ—¶å€™ä¹Ÿä¼šéå¸¸æ–¹ä¾¿.

 å¦å¤–, ç»„ä»¶çš„å†…å®¹ç¼–å†™é¡ºåºå¦‚ä¸‹:

 - static å¼€å¤´çš„ç±»å±æ€§, å¦‚ defaultProps,propTypes.
 - æ„é€ å‡½æ•°,constructor.
 - getter/setter(è¿˜ä¸äº†è§£çš„åŒå­¦å¯ä»¥æš‚æ—¶å¿½ç•¥).
 - ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ.
 - _ å¼€å¤´çš„ç§æœ‰æ–¹æ³•.
 - äº‹ä»¶ç›‘å¬æ–¹æ³•,handle*.
 - render*å¼€å¤´çš„æ–¹æ³•, æœ‰æ—¶å€™ render() æ–¹æ³•é‡Œé¢çš„å†…å®¹ä¼šåˆ†å¼€åˆ°ä¸åŒå‡½æ•°é‡Œé¢è¿›è¡Œ, è¿™äº›å‡½æ•°éƒ½ä»¥ render* å¼€å¤´.
 - render() æ–¹æ³•.

 å¦‚æœæ‰€æœ‰çš„ç»„ä»¶éƒ½æŒ‰è¿™ç§é¡ºåºæ¥ç¼–å†™, é‚£ä¹ˆç»´æŠ¤èµ·æ¥å°±ä¼šæ–¹ä¾¿å¾ˆå¤š, å¤šäººåä½œçš„æ—¶å€™åˆ«äººç†è§£ä»£ç ä¹Ÿä¼šä¸€ç›®äº†ç„¶.

* å®æˆ˜åˆ†æ: è¯„è®ºåŠŸèƒ½(äº”)
** æŒä¹…åŒ–è¯„è®º
 åŒæ ·åœ°, å¯ä»¥é€šè¿‡ç±»ä¼¼äºç”¨æˆ·åæŒä¹…åŒ–çš„æ–¹å¼å¯¹è¯„è®ºåˆ—è¡¨å†…å®¹è¿›è¡ŒæŒä¹…åŒ–, è®©ç”¨æˆ·å‘å¸ƒçš„è¯„è®ºåœ¨åˆ·æ–°é¡µé¢ä»¥åä¾ç„¶å¯ä»¥å­˜åœ¨. ä¿®æ”¹ src/CommentApp.js:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class CommentApp extends Component {
     constructor () {
         super()
         this.state = {
             comments: []
         }
     }

     componentWillMount () {
         this._loadComments()
     }

     _loadComments () {
         let comments = localStorage.getItem('comments')
         if (comments) {
             comments = JSON.parse(comments)
             this.setState({ comments })
         }
     }

     _saveComments (comments) {
         localStorage.setItem('comments', JSON.stringify(comments))
     }

     handleSubmitComment (comment) {
         if (!comment) return
         if (!comment.username) return alert('è¯·è¾“å…¥ç”¨æˆ·å')
         if (!comment.content) return alert('è¯·è¾“å…¥è¯„è®ºå†…å®¹')
         const comments = this.state.comments
         comments.push(comment)
         this.setState({ comments })
         this._saveComments(comments)
     }
 }
 ...
 #+END_SRC

 æˆ‘ä»¬å¢åŠ äº† _loadComments å’Œ _saveComments åˆ†åˆ«ç”¨äºåŠ è½½å’Œä¿å­˜è¯„è®ºåˆ—è¡¨æ•°æ®.
 ç”¨æˆ·æ¯æ¬¡æäº¤è¯„è®ºéƒ½ä¼šæŠŠè¯„è®ºåˆ—è¡¨æ•°æ®ä¿å­˜ä¸€æ¬¡, æ‰€ä»¥æˆ‘ä»¬åœ¨ handleSubmitComment è°ƒç”¨ _saveComments æ–¹æ³•,
 è€Œåœ¨ componentWillMount ä¸­è°ƒç”¨ _loadComments æ–¹æ³•, åœ¨ç»„ä»¶å¼€å§‹æŒ‚è½½çš„æ—¶å€™æŠŠè¯„è®ºåˆ—è¡¨æ•°æ®åŠ è½½å‡ºæ¥ setState åˆ° this.state å½“ä¸­,
 ç»„ä»¶å°±å¯ä»¥æ¸²æŸ“ä» LocalStorage ä»åŠ è½½å‡ºæ¥çš„è¯„è®ºåˆ—è¡¨æ•°æ®äº†.

 ç°åœ¨å‘å¸ƒè¯„è®º, ç„¶ååˆ·æ–°å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„è¯„è®ºå¹¶ä¸ä¼šåƒä»¥å‰ä¸€æ ·æ¶ˆå¤±.
 éå¸¸çš„ä¸é”™, æŒä¹…åŒ–è¯„è®ºçš„åŠŸèƒ½ä¹Ÿå®Œæˆäº†.

** æ˜¾ç¤ºè¯„è®ºå‘å¸ƒæ—¶é—´
 ç°åœ¨æˆ‘ä»¬ç»™æ¯æ¡è¯„è®ºéƒ½åŠ ä¸Šå‘å¸ƒçš„æ—¥æœŸ, å¹¶ä¸”åœ¨è¯„è®ºåˆ—è¡¨é¡¹ä¸Šæ˜¾ç¤ºå·²ç»å‘è¡¨äº†å¤šä¹…, ä¾‹å¦‚"1 ç§’å‰","30 åˆ†é’Ÿå‰", å¹¶ä¸”ä¼šæ¯éš” 5 ç§’è¿›è¡Œæ›´æ–°.
 ä¿®æ”¹ src/CommentInput.js å½“ç”¨æˆ·ç‚¹å‡»å‘å¸ƒæŒ‰é’®çš„æ—¶å€™, ä¼ å‡ºå»çš„è¯„è®ºæ•°æ®å¸¦ä¸Šè¯„è®ºå‘å¸ƒçš„æ—¶é—´æˆ³:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     handleSubmit () {
       if (this.props.onSubmit) {
         this.props.onSubmit({
         username: this.state.username,
         content: this.state.content,
         createdTime: +new Date()
         })
       }
       this.setState({ content: '' })
     }
 ...
 #+END_SRC

 åœ¨è¯„è®ºåˆ—è¡¨é¡¹ä¸Šæ˜¾ç¤ºè¯„è®º, ä¿®æ”¹ src/comment.js:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Comment extends Component {
   static propTypes = {
     comment: PropTypes.object.isRequired
   }

   constructor () {
     super()
     this.state = { timeString: '' }
   }

   componentWillMount () {
     this._updateTimeString()
   }

   _updateTimeString () {
     const comment = this.props.comment
     const duration = (+Date.now() - comment.createdTime) / 1000
     this.setState({
       timeString: duration > 60
         ? `${Math.round(duration / 60)} åˆ†é’Ÿå‰`
         : `${Math.round(Math.max(duration, 1))} ç§’å‰`
     })
   }

   render () {
     return (
       <div className='comment'>
         <div className='comment-user'>
           <span>{this.props.comment.username} </span>:
         </div>
         <p>{this.props.comment.content}</p>
         <span className='comment-createdtime'>
           {this.state.timeString}
         </span>
       </div>
     )
   }
 }
 #+END_SRC

 æ¯ä¸ª Comment ç»„ä»¶å®ä¾‹ä¼šä¿å­˜ä¸€ä¸ª timeString çŠ¶æ€, ç”¨äºè¯¥è¯„è®ºæ˜¾ç¤ºå‘å¸ƒäº†å¤šä¹….
 _updateTimeString è¿™ä¸ªç§æœ‰æ–¹æ³•ä¼šæ ¹æ® props.comment é‡Œé¢çš„ createdTime æ¥æ›´æ–°è¿™ä¸ª timeString: è®¡ç®—å½“å‰æ—¶é—´å’Œè¯„è®ºå‘å¸ƒæ—¶é—´çš„æ—¶é—´å·®, å¦‚æœå·²ç»å‘å¸ƒ 60 ç§’ä»¥ä¸Šå°±æ˜¾ç¤ºåˆ†é’Ÿ, å¦åˆ™å°±æ˜¾ç¤ºç§’.
 ç„¶å componentWillMount ä¼šåœ¨ç»„ä»¶æŒ‚è½½é˜¶æ®µè°ƒç”¨ _updateTimeString æ›´æ–°ä¸€ä¸‹è¿™ä¸ªå­—ç¬¦ä¸²,render() æ–¹æ³•å°±æŠŠè¿™ä¸ªæ˜¾ç¤ºæ—¶é—´å·®çš„å­—ç¬¦ä¸²æ¸²æŸ“åˆ°ä¸€ä¸ª <span> ä¸Š.

 å†çœ‹çœ‹é¡µé¢æ˜¾ç¤º:

 [[file:./static/React.js å°ä¹¦/04093DE1-B4C0-4CBD-B3F8-DF924C9F6799.png]]

 è¿™æ—¶å€™çš„æ—¶é—´æ˜¯ä¸ä¼šè‡ªåŠ¨æ›´æ–°çš„.
 é™¤éä½ æ‰‹åŠ¨åˆ·æ–°é¡µé¢, å¦åˆ™æ°¸è¿œæ˜¾ç¤º"1 ç§’å‰".
 æˆ‘ä»¬å¯ä»¥åœ¨ componentWillMount ä¸­å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨, æ¯éš” 5 ç§’è°ƒç”¨ä¸€ä¸‹ _updateTimeString, è®©å®ƒå»é€šè¿‡ setState æ›´æ–° timeString:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     componentWillMount () {
       this._updateTimeString()
       this._timer = setInterval(
         this._updateTimeString.bind(this),
         5000
       )
     }
 ...
 #+END_SRC

 è¿™æ ·å°±å¯ä»¥åšåˆ°è¯„è®ºçš„å‘å¸ƒæ—¶é—´è‡ªåŠ¨åˆ·æ–°äº†, åˆ°è¿™é‡Œå‰ 4 ä¸ªéœ€æ±‚éƒ½å·²ç»å®Œæˆäº†.

* å®æˆ˜åˆ†æ: è¯„è®ºåŠŸèƒ½(å…­)
** åˆ é™¤è¯„è®º
 ç°åœ¨å‘å¸ƒè¯„è®º, è¯„è®ºä¸ä¼šæ¶ˆå¤±, è¯„è®ºè¶Šæ¥è¶Šå¤šå¹¶ä¸æ˜¯ä»€ä¹ˆå¥½äº‹. æ‰€ä»¥æˆ‘ä»¬ç»™è¯„è®ºç»„ä»¶åŠ ä¸Šåˆ é™¤è¯„è®ºçš„åŠŸèƒ½, è¿™æ ·å°±å¯ä»¥åˆ é™¤ä¸æƒ³è¦çš„è¯„è®ºäº†.
 ä¿®æ”¹ src/Comment.js çš„ render æ–¹æ³•, æ–°å¢ä¸€ä¸ªåˆ é™¤æŒ‰é’®:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 render () {
   const { comment } = this.props
   return (
     <div className='comment'>
       <div className='comment-user'>
         <span className='comment-username'>
           {comment.username}
         </span>:
       </div>
       <p>{comment.content}</p>
       <span className='comment-createdtime'>
         {this.state.timeString}
       </span>
       <span className='comment-delete'>
         åˆ é™¤
       </span>
     </div>
   )
 }
 #+END_SRC

 æˆ‘ä»¬åœ¨åé¢åŠ äº†ä¸€ä¸ªåˆ é™¤æŒ‰é’®, å› ä¸º index.css å®šä¹‰äº†æ ·å¼, æ‰€ä»¥é¼ æ ‡æ”¾åˆ°ç‰¹å®šçš„è¯„è®ºä¸Šæ‰ä¼šæ˜¾ç¤ºåˆ é™¤æŒ‰é’®, è®©ç”¨æˆ·ä½“éªŒå¥½ä¸€äº›.

 æˆ‘ä»¬çŸ¥é“è¯„è®ºåˆ—è¡¨æ•°æ®æ˜¯æ”¾åœ¨ CommentApp å½“ä¸­çš„, è€Œè¿™ä¸ªåˆ é™¤æŒ‰é’®æ˜¯åœ¨ Comment å½“ä¸­çš„, ç°åœ¨æˆ‘ä»¬è¦åšçš„äº‹æƒ…æ˜¯ç”¨æˆ·ç‚¹å‡»æŸæ¡è¯„è®ºçš„åˆ é™¤æŒ‰é’®,
 ç„¶ååœ¨ CommentApp ä¸­æŠŠç›¸åº”çš„æ•°æ®åˆ é™¤.
 ä½†æ˜¯ CommentApp å’Œ Comment çš„å…³ç³»æ˜¯è¿™æ ·çš„:

 [[file:./static/React.js å°ä¹¦/DAFA784B-6AD3-474B-9A87-316E5741DED6.png]]

 Comment å’Œ CommentApp ä¹‹é—´éš”äº†ä¸€ä¸ª CommentList,Comment æ— æ³•ç›´æ¥è·Ÿ CommentApp æ‰“äº¤é“, åªèƒ½é€šè¿‡ CommentList æ¥è½¬å‘è¿™ç§åˆ é™¤è¯„è®ºçš„æ¶ˆæ¯.
 ä¿®æ”¹ Comment ç»„ä»¶, è®©å®ƒå¯ä»¥æŠŠåˆ é™¤çš„æ¶ˆæ¯ä¼ é€’åˆ°ä¸Šä¸€å±‚:

 #+CAPTION: åˆ é™¤è¯„è®ºçš„ Comment ç»„ä»¶
 #+BEGIN_SRC javascript :results values list :exports no-eval
 class Comment extends Component {
   static propTypes = {
     comment: PropTypes.object.isRequired,
     onDeleteComment: PropTypes.func,
     index: PropTypes.number
   }
   ...
   handleDeleteComment () {
     if (this.props.onDeleteComment) {
       this.props.onDeleteComment(this.props.index)
     }
   }

   render () {
   ...
     <span
       onClick={this.handleDeleteComment.bind(this)}
       className='comment-delete'>
       åˆ é™¤
     </span>
   ...
   }
 #+END_SRC
 <<åˆ é™¤è¯„è®ºçš„ Comment ç»„ä»¶>>

 ç°åœ¨åœ¨ä½¿ç”¨ Comment çš„æ—¶å€™, å¯ä»¥ä¼ å…¥ onDeleteComment å’Œ index ä¸¤ä¸ªå‚æ•°.
 index ç”¨æ¥æ ‡å¿—è¿™ä¸ªè¯„è®ºåœ¨åˆ—è¡¨çš„ä¸‹æ ‡, è¿™æ ·ç‚¹å‡»åˆ é™¤æŒ‰é’®çš„æ—¶å€™æˆ‘ä»¬æ‰èƒ½çŸ¥é“ä½ ç‚¹å‡»çš„æ˜¯å“ªä¸ªè¯„è®º, æ‰èƒ½çŸ¥é“æ€ä¹ˆä»åˆ—è¡¨æ•°æ®ä¸­åˆ é™¤.
 ç”¨æˆ·ç‚¹å‡»åˆ é™¤ä¼šè°ƒç”¨ handleDeleteComment, å®ƒä¼šè°ƒç”¨ä»ä¸Šå±‚ä¼ å…¥çš„ props.
 onDeleteComment å‡½æ•°å‘ŠçŸ¥ä¸Šä¸€å±‚ç»„ä»¶åˆ é™¤çš„æ¶ˆæ¯, å¹¶ä¸”æŠŠè¯„è®ºä¸‹æ ‡ä¼ å‡ºå».
 ç°åœ¨ä¿®æ”¹ src/CommentList.js è®©å®ƒæŠŠè¿™ä¸¤ä¸ªå‚æ•°ä¼ è¿›æ¥:

 #+CAPTION: åˆ é™¤è¯„è®ºçš„ CommentList ç»„ä»¶
 #+BEGIN_SRC javascript :results values list :exports no-eval
 class CommentList extends Component {
   static propTypes = {
     comments: PropTypes.array,
     onDeleteComment: PropTypes.func
   }

   static defaultProps = {
     comments: []
   }

   handleDeleteComment (index) {
     if (this.props.onDeleteComment) {
       this.props.onDeleteComment(index)
     }
   }

   render() {
     return (
       <div>
         {this.props.comments.map((comment, i) =>
           <Comment
             comment={comment}
             key={i}
             index={i}
             onDeleteComment={this.handleDeleteComment.bind(this)} />
             )}
       </div>
     )
   }
 }
 #+END_SRC
 <<åˆ é™¤è¯„è®ºçš„ CommentList ç»„ä»¶>>

 å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™, Comment ç»„ä»¶ä¼šè°ƒç”¨ props.onDeleteComment, ä¹Ÿå°±æ˜¯ CommentList çš„ handleDeleteComment æ–¹æ³•.
 è€Œ CommenList.handleDeleteComment ä¼šè°ƒç”¨ CommentList æ‰€æ¥å—çš„é…ç½®å‚æ•°ä¸­çš„ props.onDeleteComment, å¹¶ä¸”æŠŠä¸‹æ ‡ä¼ å‡ºå».

 ä¹Ÿå°±æ˜¯è¯´, æˆ‘ä»¬å¯ä»¥åœ¨ CommentApp ç»™ CommentList ä¼ å…¥ä¸€ä¸ª onDeleteComment çš„é…ç½®å‚æ•°æ¥æ¥å—è¿™ä¸ªåˆ é™¤è¯„è®ºçš„æ¶ˆæ¯, ä¿®æ”¹ CommentApp.js:

 #+CAPTION: åˆ é™¤è¯„è®ºçš„ CommentApp ç»„ä»¶
 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
 handleDeleteComment (index) {
   console.log(index)
 }

 render() {
   return (
     <div className='wrapper'>
       <CommentInput onSubmit={this.handleSubmitComment.bind(this)} />
         <CommentList
           comments={this.state.comments}
           onDeleteComment={this.handleDeleteComment.bind(this)} />
     </div>
   )
 }
 ...
 #+END_SRC
 <<åˆ é™¤è¯„è®ºçš„ CommentApp ç»„ä»¶>>

 ç°åœ¨ç‚¹å‡»åˆ é™¤æŒ‰é’®, å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°è¯„è®ºå¯¹åº”çš„ä¸‹æ ‡æ‰“å°äº†å‡ºæ¥.
 å…¶å®è¿™å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹:CommentList æŠŠä¸‹æ ‡ index ä¼ ç»™ Comment.
 ç‚¹å‡»åˆ é™¤æŒ‰é’®çš„æ—¶å€™,Comment æŠŠ index ä¼ ç»™äº† CommentList,CommentList å†æŠŠå®ƒä¼ ç»™ CommentApp.
 ç°åœ¨å¯ä»¥åœ¨ CommentApp ä¸­åˆ é™¤è¯„è®ºäº†:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
 handleDeleteComment (index) {
   const comments = this.state.comments
   comments.splice(index, 1)
   this.setState({ comments })
   this._saveComments(comments)
 }
 ...
 #+END_SRC

 æˆ‘ä»¬é€šè¿‡ comments.splice åˆ é™¤ç‰¹å®šä¸‹æ ‡çš„è¯„è®º, å¹¶ä¸”é€šè¿‡ setState é‡æ–°æ¸²æŸ“æ•´ä¸ªè¯„è®ºåˆ—è¡¨,
 å½“ç„¶äº†, è¿˜éœ€è¦æŠŠæœ€æ–°çš„è¯„è®ºåˆ—è¡¨æ•°æ®æ›´æ–°åˆ° LocalStorage ä¸­, æ‰€ä»¥æˆ‘ä»¬åœ¨åˆ é™¤, æ›´æ–°ä»¥åè°ƒç”¨äº† _saveComments æ–¹æ³•æŠŠæ•°æ®åŒæ­¥åˆ° LocalStorage ä¸­.

 ç°åœ¨å°±å¯ä»¥æ„‰å¿«åœ°åˆ é™¤è¯„è®ºäº†. ä½†æ˜¯, ä½ åˆ é™¤è¯„è®ºä»¥å 5 ç§’é’Ÿåå°±ä¼šåœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æŠ¥é”™äº†:

 [[file:./static/React.js å°ä¹¦/83C3CDDD-F8C5-4C37-B848-852E98E0E464.png]]

 è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¿˜äº†æ¸…é™¤è¯„è®ºçš„å®šæ—¶å™¨, ä¿®æ”¹ src/Comment.js, æ–°å¢ç”Ÿå‘½å‘¨æœŸ commentWillUnmount åœ¨è¯„è®ºç»„ä»¶é”€æ¯çš„æ—¶å€™æ¸…é™¤å®šæ—¶å™¨:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
 componentWillUnmount () {
   clearInterval(this._timer)
 }
 ...
 #+END_SRC

 è¿™æ‰ç®—å®Œæˆäº†ç¬¬ 5 ä¸ªéœ€æ±‚.

** æ˜¾ç¤ºä»£ç å—
 ç”¨æˆ·åœ¨çš„è¾“å…¥å†…å®¹ä¸­ä»»ä½•ä»¥ `` åŒ…å«çš„å†…å®¹éƒ½ä¼šç”¨ <code> åŒ…å«èµ·æ¥æ˜¾ç¤ºåˆ°é¡µé¢ä¸Š.
 <code> è¿™æ˜¯ä¸€ä¸ª HTML ç»“æ„, éœ€è¦å¾€é¡µé¢åŠ¨æ€æ’å…¥ HTML ç»“æ„æˆ‘ä»¬åªèƒ½ç”¨ dangerouslySetInnerHTML äº†, ä¿®æ”¹ src/Comment.js, æŠŠåŸæ¥ render() å‡½æ•°ä¸­çš„:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 <p>{comment.content}</p>
 #+END_SRC

 ä¿®æ”¹æˆ:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 <p dangerouslySetInnerHTML={{
   __html: this._getProcessedContent(comment.content)
 }} />
 #+END_SRC

 æˆ‘ä»¬æŠŠç»è¿‡ this._getProcessedContent å¤„ç†çš„è¯„è®ºå†…å®¹ä»¥ HTML çš„æ–¹å¼æ’å…¥åˆ° <p> å…ƒç´ ä¸­.
 this._getProcessedContent è¦æŠŠ `` åŒ…å«çš„å†…å®¹ç”¨ <code> åŒ…è£¹èµ·æ¥, ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å°±å¯ä»¥åšåˆ°äº†:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     _getProcessedContent (content) {
       return content.replace(/`([\S\s]+?)`/g, '<code>$1</code>')
     }
 ...
 #+END_SRC

 ä½†æ˜¯è¿™æ ·åšä¼šæœ‰ä¸¥é‡çš„ XSS æ¼æ´, ç”¨æˆ·å¯ä»¥è¾“å…¥ä»»æ„çš„ HTML æ ‡ç­¾, ç”¨ <script> æ‰§è¡Œä»»æ„çš„ JavaScript ä»£ç .
 æ‰€ä»¥åœ¨æ›¿æ¢ä»£ç ä¹‹å‰, æˆ‘ä»¬è¦æ‰‹åŠ¨åœ°æŠŠè¿™äº› HTML æ ‡ç­¾è¿›è¡Œè½¬ä¹‰:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
     _getProcessedContent (content) {
       return content
         .replace(/&/g, "&amp;")
         .replace(/</g, "&lt;")
         .replace(/>/g, "&gt;")
         .replace(/"/g, "&quot;")
         .replace(/'/g, "&#039;")
         .replace(/`([\S\s]+?)`/g, '<code>$1</code>')
     }
 ...
 #+END_SRC

 å‰ 5 ä¸ª replace å®é™…ä¸Šæ˜¯æŠŠç±»ä¼¼äº <,> è¿™ç§å†…å®¹æ›¿æ¢è½¬ä¹‰ä¸€ä¸‹, é˜²æ­¢ç”¨æˆ·è¾“å…¥ HTML æ ‡ç­¾. æœ€åä¸€è¡Œä»£ç æ‰æ˜¯å®ç°åŠŸèƒ½çš„ä»£ç .

 è¿™æ—¶å€™åœ¨è¯„è®ºæ¡†ä¸­è¾“å…¥:
 #+BEGIN_QUOTE
 è¿™æ˜¯ä»£ç å— `console.log`, è¿™æ˜¯ <h1>æ­£å¸¸å†…å®¹</h1>.
 #+END_QUOTE

 ç„¶åç‚¹å‡»å‘å¸ƒ, çœ‹çœ‹æ•ˆæœ:

 [[file:./static/React.js å°ä¹¦/5C18C820-E406-4D38-95DC-B4FEA70E34EE.png]]

 æˆ‘ä»¬å®‰å…¨åœ°å®Œæˆäº†ç¬¬ 6 ä¸ªéœ€æ±‚.
 åˆ°ç›®å‰ä¸ºæ­¢, ç¬¬äºŒé˜¶æ®µçš„å®æˆ˜å·²ç»å…¨éƒ¨å®Œæˆ, ä½ å¯ä»¥åœ¨ [[https://github.com/huzidaha/react-naive-book-examples][è¿™é‡Œ]] æ‰¾åˆ°å®Œæ•´çš„ä»£ç .

** æ€»ç»“
 åˆ°è¿™é‡Œç¬¬äºŒé˜¶æ®µå·²ç»å…¨éƒ¨ç»“æŸ, æˆ‘ä»¬å·²ç»æŒæ¡äº†å…¨éƒ¨ React.js å®æˆ˜éœ€è¦çš„å…¥é—¨çŸ¥è¯†.
 æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå­¦ä¹ ä¸¤ä¸ªç›¸å¯¹æ¯”è¾ƒé«˜çº§çš„ React.js çš„æ¦‚å¿µ, ç„¶åè¿›å…¥ React-redux çš„ä¸–ç•Œ, è®©å®ƒä»¬é…åˆ React.js æ¥æ„å»ºæ›´æˆç†Ÿçš„å‰ç«¯é¡µé¢.

* é«˜é˜¶ç»„ä»¶(Higher-Order Components)
<<é«˜é˜¶ç»„ä»¶>>
æœ‰æ—¶å€™äººä»¬å¾ˆå–œæ¬¢é€ ä¸€äº›åå­—å¾ˆå“äººçš„åè¯, è®©äººä¸€å¬è¿™ä¸ªåè¯å°±è§‰å¾—è‡ªå·±ä¸å¯èƒ½å­¦ä¼š, ä»è€Œè®©äººæœ›è€Œå´æ­¥.
ä½†æ˜¯å…¶å®è¿™äº›åè¯èƒŒåæ‰€ä»£è¡¨çš„ä¸œè¥¿å…¶å®å¾ˆç®€å•.

æˆ‘ä¸èƒ½è¯´é«˜é˜¶ç»„ä»¶å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªä¸œè¥¿. ä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªæ¦‚å¿µä¸Šå¾ˆç®€å•, ä½†å´éå¸¸å¸¸ç”¨, å®ç”¨çš„ä¸œè¥¿, è¢«å¤§é‡ React.js ç›¸å…³çš„ç¬¬ä¸‰æ–¹åº“é¢‘ç¹åœ°ä½¿ç”¨.
åœ¨å‰ç«¯çš„ä¸šåŠ¡å¼€å‘å½“ä¸­, ä½ ä¸æŒæ¡é«˜é˜¶ç»„ä»¶å…¶å®ä¹Ÿå¯ä»¥å®Œæˆé¡¹ç›®çš„å¼€å‘, ä½†æ˜¯å¦‚æœä½ èƒ½å¤Ÿçµæ´»åœ°ä½¿ç”¨é«˜é˜¶ç»„ä»¶, å¯ä»¥è®©ä½ ä»£ç æ›´åŠ ä¼˜é›…, å¤ç”¨æ€§, çµæ´»æ€§æ›´å¼º.
å®ƒæ˜¯ä¸€ä¸ªåŠ åˆ†é¡¹, è€Œä¸”åŠ çš„åˆ†è¿˜ä¸å°‘.

æœ¬ç« èŠ‚å¯èƒ½æœ‰éƒ¨åˆ†å†…å®¹ç†è§£èµ·æ¥ä¼šæœ‰éš¾åº¦, å¦‚æœä½ è§‰å¾—æ— æ³•å®Œå…¨ç†è§£æœ¬èŠ‚å†…å®¹. å¯ä»¥å…ˆç®€å•ç†è§£é«˜é˜¶ç»„ä»¶çš„æ¦‚å¿µå’Œä½œç”¨å³å¯, å…¶ä»–å†…å®¹é€‰æ‹©æ€§åœ°è·³è¿‡.

äº†è§£é«˜é˜¶ç»„ä»¶å¯¹æˆ‘ä»¬ç†è§£å„ç§ React.js ç¬¬ä¸‰æ–¹åº“çš„åŸç†å¾ˆæœ‰å¸®åŠ©.

** ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶
 é«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå‡½æ•°, ä¼ ç»™å®ƒä¸€ä¸ªç»„ä»¶, å®ƒè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const NewComponent = higherOrderComponent(OldComponent)
 #+END_SRC

 é‡è¦çš„äº‹æƒ…å†é‡å¤ä¸€æ¬¡, é«˜é˜¶ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°(è€Œä¸æ˜¯ç»„ä»¶), å®ƒæ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°, è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶.
 è¿™ä¸ªæ–°çš„ç»„ä»¶ä¼šä½¿ç”¨ä½ ä¼ ç»™å®ƒçš„ç»„ä»¶ä½œä¸ºå­ç»„ä»¶, æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªå¾ˆç®€å•çš„é«˜é˜¶ç»„ä»¶:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'

 export default (WrappedComponent) => {
   class NewComponent extends Component {
     // å¯ä»¥åšå¾ˆå¤šè‡ªå®šä¹‰é€»è¾‘
     render () {
       return <WrappedComponent />
     }
   }
   return NewComponent
 }
 #+END_SRC

 ç°åœ¨çœ‹æ¥å¥½åƒä»€ä¹ˆç”¨éƒ½æ²¡æœ‰, å®ƒå°±æ˜¯ç®€å•çš„æ„å»ºäº†ä¸€ä¸ªæ–°çš„ç»„ä»¶ç±» NewComponent, ç„¶åæŠŠä¼ è¿›å…¥å»çš„ WrappedComponent æ¸²æŸ“å‡ºæ¥.
 ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç»™ NewCompoent åšä¸€äº›æ•°æ®å¯åŠ¨å·¥ä½œ:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'

 export default (WrappedComponent, name) => {
   class NewComponent extends Component {
     constructor () {
       super()
       this.state = { data: null }
     }

     componentWillMount () {
       let data = localStorage.getItem(name)
       this.setState({ data })
     }

     render () {
       return <WrappedComponent data={this.state.data} />
     }
   }
   return NewComponent
 }
 #+END_SRC

 ç°åœ¨ NewComponent ä¼šæ ¹æ®ç¬¬äºŒä¸ªå‚æ•° name åœ¨æŒ‚è½½é˜¶æ®µä» LocalStorage åŠ è½½æ•°æ®, å¹¶ä¸” setState åˆ°è‡ªå·±çš„ state.data ä¸­,
 è€Œæ¸²æŸ“çš„æ—¶å€™å°† state.data é€šè¿‡ props.data ä¼ ç»™ WrappedComponent.

 è¿™ä¸ªé«˜é˜¶ç»„ä»¶æœ‰ä»€ä¹ˆç”¨å‘¢? å‡è®¾ä¸Šé¢çš„ä»£ç æ˜¯åœ¨ src/wrapWithLoadData.js æ–‡ä»¶ä¸­çš„, æˆ‘ä»¬å¯ä»¥åœ¨åˆ«çš„åœ°æ–¹è¿™ä¹ˆç”¨å®ƒ:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import wrapWithLoadData from './wrapWithLoadData'

 class InputWithUserName extends Component {
   render () {
     return <input value={this.props.data} />
   }
 }

 InputWithUserName = wrapWithLoadData(InputWithUserName, 'username')
 export default InputWithUserName
 #+END_SRC

 å‡å¦‚ InputWithUserName çš„åŠŸèƒ½éœ€æ±‚æ˜¯æŒ‚è½½çš„æ—¶å€™ä» LocalStorage é‡Œé¢åŠ è½½ username å­—æ®µä½œä¸º <input /> çš„ value å€¼,
 ç°åœ¨æœ‰äº† wrapWithLoadData, æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°åšåˆ°è¿™ä»¶äº‹æƒ….

 åªéœ€è¦å®šä¹‰ä¸€ä¸ªéå¸¸ç®€å•çš„ InputWithUserName, å®ƒä¼šæŠŠ props.data ä½œä¸º <input /> çš„ value å€¼.
 ç„¶åæŠŠè¿™ä¸ªç»„ä»¶å’Œ 'username' ä¼ ç»™ wrapWithLoadData, wrapWithLoadData ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶, æˆ‘ä»¬ç”¨è¿™ä¸ªæ–°çš„ç»„ä»¶è¦†ç›–åŸæ¥çš„ InputWithUserName,
 ç„¶åå†å¯¼å‡ºå»æ¨¡å—.

 åˆ«äººç”¨è¿™ä¸ªç»„ä»¶çš„æ—¶å€™å®é™…æ˜¯ç”¨äº†è¢«åŠ å·¥è¿‡çš„ç»„ä»¶:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import InputWithUserName from './InputWithUserName'

 class Index extends Component {
   render () {
     return (
       <div>
             ç”¨æˆ·å:<InputWithUserName />
       </div>
     )
   }
 }
 #+END_SRC

 æ ¹æ® wrapWithLoadData çš„ä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“, è¿™ä¸ªæ–°çš„ç»„ä»¶æŒ‚è½½çš„æ—¶å€™ä¼šå…ˆå» LocalStorage åŠ è½½æ•°æ®,
 æ¸²æŸ“çš„æ—¶å€™å†é€šè¿‡ props.data ä¼ ç»™çœŸæ­£çš„ InputWithUserName.

 å¦‚æœç°åœ¨æˆ‘ä»¬éœ€è¦å¦å¤–ä¸€ä¸ªæ–‡æœ¬è¾“å…¥æ¡†ç»„ä»¶, å®ƒä¹Ÿéœ€è¦ LocalStorage åŠ è½½ 'content' å­—æ®µçš„æ•°æ®. æˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªæ–°çš„ TextareaWithContent:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import wrapWithLoadData from './wrapWithLoadData'

 class TextareaWithContent extends Component {
   render () {
     return <textarea value={this.props.data} />
   }
 }

 TextareaWithContent = wrapWithLoadData(TextareaWithContent, 'content')
 export default TextareaWithContent
 #+END_SRC

 å†™èµ·æ¥éå¸¸è½»æ¾, æˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦é‡å¤å†™ä» LocalStorage åŠ è½½æ•°æ®å­—æ®µçš„é€»è¾‘, ç›´æ¥ç”¨ wrapWithLoadData åŒ…è£…ä¸€ä¸‹å°±å¯ä»¥äº†.

 æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…, å¯¹äº InputWithUserName å’Œ TextareaWithContent è¿™ä¸¤ä¸ªç»„ä»¶æ¥è¯´,
 å®ƒä»¬çš„éœ€æ±‚æœ‰ç€è¿™ä¹ˆä¸€ä¸ªç›¸åŒçš„é€»è¾‘:" æŒ‚è½½é˜¶æ®µä» LocalStorage ä¸­åŠ è½½ç‰¹å®šå­—æ®µæ•°æ®".

 å¦‚æœæŒ‰ç…§ä¹‹å‰çš„åšæ³•, æˆ‘ä»¬éœ€è¦ç»™å®ƒä»¬ä¸¤ä¸ªéƒ½åŠ ä¸Š componentWillMount ç”Ÿå‘½å‘¨æœŸ, ç„¶ååœ¨é‡Œé¢è°ƒç”¨ LocalStorage.
 è¦æ˜¯æœ‰ç¬¬ä¸‰ä¸ªç»„ä»¶ä¹Ÿæœ‰è¿™æ ·çš„åŠ è½½é€»è¾‘, æˆ‘åˆå¾—å†™ä¸€éè¿™æ ·çš„é€»è¾‘.
 ä½†æœ‰äº† wrapWithLoadData é«˜é˜¶ç»„ä»¶, æˆ‘ä»¬æŠŠè¿™æ ·çš„é€»è¾‘ç”¨ä¸€ä¸ªç»„ä»¶åŒ…è£¹äº†èµ·æ¥, å¹¶ä¸”é€šè¿‡ç»™é«˜é˜¶ç»„ä»¶ä¼ å…¥ name æ¥è¾¾åˆ°ä¸åŒå­—æ®µçš„æ•°æ®åŠ è½½.
 å……åˆ†å¤ç”¨äº†é€»è¾‘ä»£ç .

 åˆ°è¿™é‡Œ, é«˜é˜¶ç»„ä»¶çš„ä½œç”¨å…¶å®ä¸è¨€è€Œå–», å…¶å®å°±æ˜¯ä¸ºäº†ç»„ä»¶ä¹‹é—´çš„ä»£ç å¤ç”¨.
 ç»„ä»¶å¯èƒ½æœ‰ç€æŸäº›ç›¸åŒçš„é€»è¾‘, æŠŠè¿™äº›é€»è¾‘æŠ½ç¦»å‡ºæ¥, æ”¾åˆ°é«˜é˜¶ç»„ä»¶ä¸­è¿›è¡Œå¤ç”¨.
 é«˜é˜¶ç»„ä»¶å†…éƒ¨çš„åŒ…è£…ç»„ä»¶å’Œè¢«åŒ…è£…ç»„ä»¶ä¹‹é—´é€šè¿‡ props ä¼ é€’æ•°æ®.

** é«˜é˜¶ç»„ä»¶çš„çµæ´»æ€§
 ä»£ç å¤ç”¨çš„æ–¹æ³•, å½¢å¼æœ‰å¾ˆå¤šç§, ä½ å¯ä»¥ç”¨ç±»ç»§æ‰¿æ¥åšåˆ°ä»£ç å¤ç”¨, ä¹Ÿå¯ä»¥åˆ†ç¦»æ¨¡å—çš„æ–¹å¼.
 ä½†æ˜¯é«˜é˜¶ç»„ä»¶è¿™ç§æ–¹å¼å¾ˆæœ‰æ„æ€, ä¹Ÿå¾ˆçµæ´».
 å­¦è¿‡è®¾è®¡æ¨¡å¼çš„åŒå­¦å…¶å®åº”è¯¥èƒ½ååº”è¿‡æ¥, å®ƒå…¶å®å°±æ˜¯è®¾è®¡æ¨¡å¼é‡Œé¢çš„è£…é¥°è€…æ¨¡å¼.
 å®ƒé€šè¿‡ç»„åˆçš„æ–¹å¼è¾¾åˆ°å¾ˆé«˜çš„çµæ´»ç¨‹åº¦.

 å‡è®¾ç°åœ¨æˆ‘ä»¬éœ€æ±‚å˜åŒ–äº†, ç°åœ¨è¦çš„æ˜¯é€šè¿‡ Ajax åŠ è½½æ•°æ®è€Œä¸æ˜¯ä» LocalStorage åŠ è½½æ•°æ®.
 æˆ‘ä»¬åªéœ€è¦æ–°å»ºä¸€ä¸ª wrapWithAjaxData é«˜é˜¶ç»„ä»¶:

 #+CAPTION: wrapWithAjaxData é«˜é˜¶ç»„ä»¶
 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'

 export default (WrappedComponent, name) => {
   class NewComponent extends Component {
     constructor () {
       super()
       this.state = { data: null }
     }

     componentWillMount () {
       ajax.get('/data/' + name, (data) => {
         this.setState({ data })
       })
     }

     render () {
       return <WrappedComponent data={this.state.data} />
     }
   }
   return NewComponent
 }
 #+END_SRC
 <<wrapWithAjaxData é«˜é˜¶ç»„ä»¶>>

 å…¶å®å°±æ˜¯æ”¹äº†ä¸€ä¸‹ wrapWithLoadData çš„ componentWillMount ä¸­çš„é€»è¾‘, æ”¹æˆäº†ä»æœåŠ¡å™¨åŠ è½½æ•°æ®.
 ç°åœ¨åªéœ€è¦æŠŠ InputWithUserName ç¨å¾®æ”¹ä¸€ä¸‹:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import wrapWithAjaxData from './wrapWithAjaxData'

 class InputWithUserName extends Component {
     render () {
         return <input value={this.props.data} />
     }
 }

 InputWithUserName = wrapWithAjaxData(InputWithUserName, 'username')
 export default InputWithUserName
 #+END_SRC

 åªè¦æ”¹ä¸€ä¸‹åŒ…è£…çš„é«˜é˜¶ç»„ä»¶å°±å¯ä»¥è¾¾åˆ°éœ€è¦çš„æ•ˆæœ.
 è€Œä¸”æˆ‘ä»¬å¹¶æ²¡æœ‰æ”¹åŠ¨ InputWithUserName ç»„ä»¶å†…éƒ¨çš„ä»»ä½•é€»è¾‘, ä¹Ÿæ²¡æœ‰æ”¹åŠ¨ Index çš„ä»»ä½•é€»è¾‘, åªæ˜¯æ”¹åŠ¨äº†ä¸­é—´çš„é«˜é˜¶ç»„ä»¶å‡½æ•°.

 (ä»¥ä¸‹å†…å®¹ä¸ºé€‰è¯»å†…å®¹, æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç»§ç»­å¾€ä¸‹è¯», å¦åˆ™ä¹Ÿå¯ä»¥ç›´æ¥è·³åˆ°æ–‡æœ«çš„æ€»ç»“éƒ¨åˆ†.)

** å¤šå±‚é«˜é˜¶ç»„ä»¶(é€‰è¯»)
 å‡å¦‚ç°åœ¨éœ€æ±‚æœ‰å˜åŒ–äº†: æˆ‘ä»¬éœ€è¦å…ˆä» LocalStorage ä¸­åŠ è½½æ•°æ®, å†ç”¨è¿™ä¸ªæ•°æ®å»æœåŠ¡å™¨å–æ•°æ®.
 æˆ‘ä»¬æ”¹ä¸€ä¸‹(æˆ–è€…æ–°å»ºä¸€ä¸ª) wrapWithAjaxData é«˜é˜¶ç»„ä»¶, ä¿®æ”¹å…¶ä¸­çš„ componentWillMount:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
 componentWillMount () {
   ajax.get('/data/' + this.props.data, (data) => {
     this.setState({ data })
   })
 }
 ...
 #+END_SRC

 å®ƒä¼šç”¨ä¼ è¿›æ¥çš„ props.data å»æœåŠ¡å™¨å–æ•°æ®. è¿™æ—¶å€™ä¿®æ”¹ InputWithUserName:

 #+CAPTION: å¤šå±‚é«˜é˜¶ç»„ä»¶
 #+BEGIN_SRC javascript :results values list :exports no-eval
 import wrapWithLoadData from './wrapWithLoadData'
 import wrapWithAjaxData from './wrapWithAjaxData'

 class InputWithUserName extends Component {
   render () {
     return <input value={this.props.data} />
   }
 }

 InputWithUserName = wrapWithAjaxData(InputWithUserName)
 InputWithUserName = wrapWithLoadData(InputWithUserName, 'username')
 export default InputWithUserName
 #+END_SRC
 <<å¤šå±‚é«˜é˜¶ç»„ä»¶>>

 å¤§å®¶å¯ä»¥çœ‹åˆ°, æˆ‘ä»¬ç»™ InputWithUserName åº”ç”¨äº†ä¸¤ç§é«˜é˜¶ç»„ä»¶: å…ˆç”¨ wrapWithAjaxData åŒ…è£¹ InputWithUserName,
 å†ç”¨ wrapWithLoadData åŒ…å«ä¸Šæ¬¡åŒ…è£¹çš„ç»“æœ. å®ƒä»¬çš„å…³ç³»å°±å¦‚ä¸‹å›¾çš„ä¸‰ä¸ªåœ†åœˆ:

 [[file:./static/React.js å°ä¹¦/A8F1DD5F-1995-419E-8551-4FC2D59F58B4.png]]

 å®é™…ä¸Šæœ€ç»ˆå¾—åˆ°çš„ç»„ä»¶ä¼šå…ˆå» LocalStorage å–æ•°æ®, ç„¶åé€šè¿‡ props.data ä¼ ç»™ä¸‹ä¸€å±‚ç»„ä»¶,
 ä¸‹ä¸€å±‚ç”¨è¿™ä¸ª props.data é€šè¿‡ Ajax å»æœåŠ¡ç«¯å–æ•°æ®, ç„¶åå†é€šè¿‡ props.data æŠŠæ•°æ®ä¼ ç»™ä¸‹ä¸€å±‚,
 ä¹Ÿå°±æ˜¯ InputWithUserName. å¤§å®¶å¯ä»¥ä½“ä¼šä¸€ä¸‹ä¸‹å›¾å°–å¤´ä»£è¡¨çš„ç»„ä»¶ä¹‹é—´çš„æ•°æ®æµå‘:

 [[file:./static/React.js å°ä¹¦/8F6C1E91-B365-4919-84C3-2252223621F8.png]]

** ç”¨é«˜é˜¶ç»„ä»¶æ”¹é€ è¯„è®ºåŠŸèƒ½(é€‰è¯»)
 å¤§å®¶å¯¹è¿™ç§åœ¨æŒ‚è½½é˜¶æ®µä» LocalStorage åŠ è½½æ•°æ®çš„æ¨¡å¼éƒ½å¾ˆç†Ÿæ‚‰, åœ¨ä¸Šä¸€é˜¶æ®µçš„å®æˆ˜ä¸­,
 CommentInput å’Œ CommentApp éƒ½ç”¨äº†è¿™ç§æ–¹å¼åŠ è½½, ä¿å­˜æ•°æ®.
 å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªé«˜é˜¶ç»„ä»¶æŠŠå®ƒä»¬çš„ç›¸åŒçš„é€»è¾‘æŠ½ç¦»å‡ºæ¥, æ„å»ºä¸€ä¸ªé«˜é˜¶ç»„ä»¶ wrapWithLoadData:

 #+CAPTION: wrapWithLoadData é«˜é˜¶ç»„ä»¶
 #+BEGIN_SRC javascript :results values list :exports no-eval
 export default (WrappedComponent, name) => {
   class LocalStorageActions extends Component {
     constructor () {
       super()
       this.state = { data: null }
     }

     componentWillMount () {
       let data = localStorage.getItem(name)
       try {
         // å°è¯•æŠŠå®ƒè§£ææˆ JSON å¯¹è±¡
         this.setState({ data: JSON.parse(data) })
       } catch (e) {
         // å¦‚æœå‡ºé”™äº†å°±å½“æ™®é€šå­—ç¬¦ä¸²è¯»å–
         this.setState({ data })
       }
     }

     saveData (data) {
       try {
         // å°è¯•æŠŠå®ƒè§£ææˆ JSON å­—ç¬¦ä¸²
         localStorage.setItem(name, JSON.stringify(data))
       } catch (e) {
         // å¦‚æœå‡ºé”™äº†å°±å½“æ™®é€šå­—ç¬¦ä¸²ä¿å­˜
         localStorage.setItem(name, `${data}`)
       }
     }

     render () {
       return (
         <WrappedComponent
           data={this.state.data}
           saveData={this.saveData.bind(this)}
           // è¿™é‡Œçš„æ„æ€æ˜¯æŠŠå…¶ä»–çš„å‚æ•°åŸå°ä¸åŠ¨åœ°ä¼ é€’ç»™è¢«åŒ…è£…çš„ç»„ä»¶
           {...this.props} />
       )
     }
   }
   return LocalStorageActions
 }
 #+END_SRC
 <<wrapWithLoadData é«˜é˜¶ç»„ä»¶>>

 CommentApp å¯ä»¥è¿™æ ·ä½¿ç”¨:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 class CommentApp extends Component {
   static propTypes = {
     data: PropTypes.any,
     saveData: PropTypes.func.isRequired
     }

   constructor (props) {
     super(props)
     this.state = { comments: props.data }
   }

   handleSubmitComment (comment) {
     if (!comment) return
     if (!comment.username) return alert('è¯·è¾“å…¥ç”¨æˆ·å')
     if (!comment.content) return alert('è¯·è¾“å…¥è¯„è®ºå†…å®¹')
     const comments = this.state.comments
     comments.push(comment)
     this.setState({ comments })
     this.props.saveData(comments)
   }

   handleDeleteComment (index) {
     const comments = this.state.comments
     comments.splice(index, 1)
     this.setState({ comments })
     this.props.saveData(comments)
   }

   render () {
     return (
       <div className='wrapper'>
         <CommentInput onSubmit={this.handleSubmitComment.bind(this)} />
         <CommentList comments={this.state.comments} onDeleteComment={this.handleDeleteComment.bind(this)} />
       </div>
     )
   }
 }

 CommentApp = wrapWithLoadData(CommentApp, 'comments')
 export default CommentApp
 #+END_SRC

 [[åˆ é™¤è¯„è®ºçš„ Comment ç»„ä»¶][See: åˆ é™¤è¯„è®ºçš„ Comment ç»„ä»¶]]

 [[åˆ é™¤è¯„è®ºçš„ CommentList ç»„ä»¶][See: åˆ é™¤è¯„è®ºçš„ CommentList ç»„ä»¶]]

 [[åˆ é™¤è¯„è®ºçš„ CommentApp ç»„ä»¶][See: åˆ é™¤è¯„è®ºçš„ CommentApp ç»„ä»¶]]

 åŒæ ·åœ°å¯ä»¥åœ¨ CommentInput ä¸­ä½¿ç”¨ wrapWithLoadData, è¿™é‡Œå°±ä¸è´´ä»£ç äº†. æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥æŸ¥çœ‹é«˜é˜¶ç»„ä»¶é‡æ„çš„ CommentApp ç‰ˆæœ¬.

** æ€»ç»“
 /*é«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå‡½æ•°, ä¼ ç»™å®ƒä¸€ä¸ªç»„ä»¶, å®ƒè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶*/. æ–°çš„ç»„ä»¶ä½¿ç”¨ä¼ å…¥çš„ç»„ä»¶ä½œä¸ºå­ç»„ä»¶.

 é«˜é˜¶ç»„ä»¶çš„ä½œç”¨æ˜¯ç”¨äºä»£ç å¤ç”¨, å¯ä»¥æŠŠç»„ä»¶ä¹‹é—´å¯å¤ç”¨çš„ä»£ç , é€»è¾‘æŠ½ç¦»åˆ°é«˜é˜¶ç»„ä»¶å½“ä¸­. æ–°çš„ç»„ä»¶å’Œä¼ å…¥çš„ç»„ä»¶é€šè¿‡ props ä¼ é€’ä¿¡æ¯.

 é«˜é˜¶ç»„ä»¶æœ‰åŠ©äºæé«˜æˆ‘ä»¬ä»£ç çš„çµæ´»æ€§, é€»è¾‘çš„å¤ç”¨æ€§.
 çµæ´»å’Œç†Ÿç»ƒåœ°æŒæ¡é«˜é˜¶ç»„ä»¶çš„ç”¨æ³•éœ€è¦ç»éªŒçš„ç§¯ç´¯è¿˜æœ‰é•¿æ—¶é—´çš„æ€è€ƒå’Œç»ƒä¹ , å¦‚æœä½ è§‰å¾—æœ¬ç« èŠ‚çš„å†…å®¹æ— æ³•å®Œå…¨æ¶ˆåŒ–å’ŒæŒæ¡ä¹Ÿæ²¡æœ‰å…³ç³»,
 å¯ä»¥å…ˆç®€å•äº†è§£é«˜é˜¶ç»„ä»¶çš„å®šä¹‰, å½¢å¼å’Œä½œç”¨å³å¯.

* React.js çš„ context
<<context>>
è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸ªä½ å¯èƒ½æ°¸è¿œç”¨ä¸ä¸Šçš„ React.js ç‰¹æ€§ â€”â€” context.
ä½†æ˜¯äº†è§£å®ƒå¯¹äºäº†è§£æ¥ä¸‹æ¥è¦è®²è§£çš„ React-redux å¾ˆæœ‰å¥½å¤„, æ‰€ä»¥å¤§å®¶å¯ä»¥ç®€å•äº†è§£ä¸€ä¸‹å®ƒçš„æ¦‚å¿µå’Œä½œç”¨.

åœ¨è¿‡å»å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œé¢,React.js çš„ context ä¸€ç›´è¢«è§†ä¸ºä¸€ä¸ªä¸ç¨³å®šçš„, å±é™©çš„, å¯èƒ½ä¼šè¢«å»æ‰çš„ç‰¹æ€§è€Œä¸è¢«å®˜ç½‘æ–‡æ¡£æ‰€è®°è½½.
ä½†æ˜¯å…¨ä¸–ç•Œçš„ç¬¬ä¸‰æ–¹åº“éƒ½åœ¨ç”¨ä½¿ç”¨è¿™ä¸ªç‰¹æ€§, ç›´åˆ°äº† React.js çš„ v0.14.1 ç‰ˆæœ¬,context æ‰è¢«å®˜æ–¹æ–‡æ¡£æ‰€è®°å½•.

é™¤éä½ è§‰å¾—è‡ªå·±çš„ React.js æ°´å¹³å·²ç»æ¯”è¾ƒç‚‰ç«çº¯é’äº†, å¦åˆ™ä½ æ°¸è¿œä¸è¦ä½¿ç”¨ context.
å°±åƒä½ å­¦ JavaScript çš„æ—¶å€™, æ€»æ˜¯ä¼šè¢«æé†’ä¸è¦ç”¨å…¨å±€å˜é‡ä¸€æ ·,React.js çš„ context å…¶å®åƒå°±æ˜¯ç»„ä»¶æ ‘ä¸ŠæŸé¢—å­æ ‘çš„å…¨å±€å˜é‡.

æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬æœ‰è¿™ä¹ˆä¸€æ£µç»„ä»¶æ ‘:

[[file:./static/React.js å°ä¹¦/85C81DFF-F71E-4B2B-9BAB-AF285F3DB1DB.png]]

å‡è®¾ç°åœ¨è¿™ä¸ªç»„ä»¶æ ‘ä»£è¡¨çš„åº”ç”¨æ˜¯ç”¨æˆ·å¯ä»¥è‡ªä¸»æ¢ä¸»é¢˜è‰²çš„, æ¯ä¸ªå­ç»„ä»¶ä¼šæ ¹æ®ä¸»é¢˜è‰²çš„ä¸åŒè°ƒæ•´è‡ªå·±çš„å­—ä½“é¢œè‰²æˆ–è€…èƒŒæ™¯é¢œè‰².
" ä¸»é¢˜è‰²" è¿™ä¸ªç©æ„æ˜¯æ‰€æœ‰ç»„ä»¶å…±äº«çš„çŠ¶æ€, æ ¹æ®æˆ‘ä»¬åœ¨ [[çŠ¶æ€æå‡][See: çŠ¶æ€æå‡]]ä¸­æ‰€æåˆ°çš„,
éœ€è¦æŠŠè¿™ä¸ªçŠ¶æ€æå‡åˆ°æ ¹èŠ‚ç‚¹çš„ Index ä¸Š, ç„¶åæŠŠè¿™ä¸ªçŠ¶æ€é€šè¿‡ props ä¸€å±‚å±‚ä¼ é€’ä¸‹å»:

[[file:./static/React.js å°ä¹¦/03118DDD-60E3-469A-AB78-5FBE57425E30.png]]

å‡è®¾åŸæ¥ä¸»é¢˜è‰²æ˜¯ç»¿è‰², é‚£ä¹ˆ Index ä¸Šä¿å­˜çš„å°±æ˜¯ this.state = { themeColor: 'green' }.
å¦‚æœè¦æ”¹å˜ä¸»é¢˜è‰², å¯ä»¥ç›´æ¥é€šè¿‡ this.setState({ themeColor: 'red' }) æ¥è¿›è¡Œ.
è¿™æ ·æ•´é¢—ç»„ä»¶æ ‘å°±ä¼šé‡æ–°æ¸²æŸ“, å­ç»„ä»¶ä¹Ÿå°±å¯ä»¥æ ¹æ®é‡æ–°ä¼ è¿›æ¥çš„ props.themeColor æ¥è°ƒæ•´è‡ªå·±çš„é¢œè‰².

ä½†è¿™é‡Œçš„é—®é¢˜ä¹Ÿæ˜¯éå¸¸æ˜æ˜¾çš„, æˆ‘ä»¬éœ€è¦æŠŠ themeColor è¿™ä¸ªçŠ¶æ€ä¸€å±‚å±‚æ‰‹åŠ¨åœ°ä»ç»„ä»¶æ ‘é¡¶å±‚å¾€ä¸‹ä¼ , æ¯å±‚éƒ½éœ€è¦å†™ props.themeColor.
å¦‚æœæˆ‘ä»¬çš„ç»„ä»¶æ ‘å¾ˆå±‚æ¬¡å¾ˆæ·±çš„è¯, è¿™æ ·ç»´æŠ¤èµ·æ¥ç®€ç›´æ˜¯ç¾éš¾.

å¦‚æœè¿™é¢—ç»„ä»¶æ ‘èƒ½å¤Ÿå…¨å±€å…±äº«è¿™ä¸ªçŠ¶æ€å°±å¥½äº†, æˆ‘ä»¬è¦çš„æ—¶å€™å°±å»å–è¿™ä¸ªçŠ¶æ€, ä¸ç”¨æ‰‹åŠ¨åœ°ä¼ :

[[file:./static/React.js å°ä¹¦/3BC6BDFC-5772-4045-943B-15FBEC28DAC0.png]]

å°±åƒè¿™æ ·,Index æŠŠ state.themeColor æ”¾åˆ°æŸä¸ªåœ°æ–¹, è¿™ä¸ªåœ°æ–¹æ˜¯æ¯ä¸ª Index çš„å­ç»„ä»¶éƒ½å¯ä»¥è®¿é—®åˆ°çš„.
å½“æŸä¸ªå­ç»„ä»¶éœ€è¦çš„æ—¶å€™å°±ç›´æ¥å»é‚£ä¸ªåœ°æ–¹æ‹¿å°±å¥½äº†, è€Œä¸éœ€è¦ä¸€å±‚å±‚åœ°é€šè¿‡ props æ¥è·å–.
ä¸ç®¡ç»„ä»¶æ ‘çš„å±‚æ¬¡æœ‰å¤šæ·±, ä»»ä½•ä¸€ä¸ªç»„ä»¶éƒ½å¯ä»¥ç›´æ¥åˆ°è¿™ä¸ªå…¬å…±çš„åœ°æ–¹æå– themeColor çŠ¶æ€.

React.js çš„ context å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªä¸œè¥¿, æŸä¸ªç»„ä»¶åªè¦å¾€è‡ªå·±çš„ context é‡Œé¢æ”¾äº†æŸäº›çŠ¶æ€,
è¿™ä¸ªç»„ä»¶ä¹‹ä¸‹çš„æ‰€æœ‰å­ç»„ä»¶éƒ½ç›´æ¥è®¿é—®è¿™ä¸ªçŠ¶æ€è€Œä¸éœ€è¦é€šè¿‡ä¸­é—´ç»„ä»¶çš„ä¼ é€’.
ä¸€ä¸ªç»„ä»¶çš„ context åªæœ‰å®ƒçš„å­ç»„ä»¶èƒ½å¤Ÿè®¿é—®, å®ƒçš„çˆ¶ç»„ä»¶æ˜¯ä¸èƒ½è®¿é—®åˆ°çš„,
ä½ å¯ä»¥ç†è§£æ¯ä¸ªç»„ä»¶çš„ context å°±æ˜¯ç€‘å¸ƒçš„æºå¤´, åªèƒ½å¾€ä¸‹æµä¸èƒ½å¾€ä¸Šé£.

æˆ‘ä»¬çœ‹çœ‹ React.js çš„ context ä»£ç æ€ä¹ˆå†™, æˆ‘ä»¬å…ˆæŠŠæ•´ä½“çš„ç»„ä»¶æ ‘æ­å»ºèµ·æ¥, è¿™é‡Œä¸æ¶‰åŠåˆ° context ç›¸å…³çš„å†…å®¹:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Index extends Component {
  render () {
    return (
      <div>
        <Header />
        <Main />
      </div>
    )
  }
}

class Header extends Component {
  render () {
    return (
      <div>
        <h2>This is header</h2>
        <Title />
      </div>
    )
  }
}

class Main extends Component {
  render () {
    return (
      <div>
        <h2>This is main</h2>
        <Content />
      </div>
    )
  }
}

class Title extends Component {
  render () {
    return (
      <h1>React.js å°ä¹¦æ ‡é¢˜</h1>
    )
  }
}

class Content extends Component {
  render () {
    return (
      <div>
        <h2>React.js å°ä¹¦å†…å®¹</h2>
      </div>
    )
  }
}

ReactDOM.render(
  <Index />,
  document.getElementById('root')
)
#+END_SRC

ä»£ç å¾ˆé•¿ä½†æ˜¯å¾ˆç®€å•, è¿™é‡Œå°±ä¸è§£é‡Šäº†.

ç°åœ¨æˆ‘ä»¬ä¿®æ”¹ Index, è®©å®ƒå¾€è‡ªå·±çš„ context é‡Œé¢æ”¾ä¸€ä¸ª themeColor:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Index extends Component {
  static childContextTypes = {
    themeColor: PropTypes.string
  }

  constructor () {
    super()
    this.state = { themeColor: 'red' }
  }

  getChildContext () {
    return { themeColor: this.state.themeColor }
  }

  render () {
    return (
      <div>
        <Header />
        <Main />
      </div>
    )
  }
}
#+END_SRC

æ„é€ å‡½æ•°é‡Œé¢çš„å†…å®¹å…¶å®å°±å¾ˆå¥½ç†è§£, å°±æ˜¯å¾€ state é‡Œé¢åˆå§‹åŒ–ä¸€ä¸ª themeColor çŠ¶æ€.
getChildContext è¿™ä¸ªæ–¹æ³•å°±æ˜¯è®¾ç½® context çš„è¿‡ç¨‹, å®ƒè¿”å›çš„å¯¹è±¡å°±æ˜¯ context(ä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­å¤„äºä¸­é—´çš„æ–¹å—), æ‰€æœ‰çš„å­ç»„ä»¶éƒ½å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªå¯¹è±¡.
æˆ‘ä»¬ç”¨ this.state.themeColor æ¥è®¾ç½®äº† context é‡Œé¢çš„ themeColor.

è¿˜æœ‰ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆå¯æ€•çš„ childContextTypes, å®ƒçš„ä½œç”¨å…¶å® propsType éªŒè¯ç»„ä»¶ props å‚æ•°çš„ä½œç”¨ç±»ä¼¼.
ä¸è¿‡å®ƒæ˜¯éªŒè¯ getChildContext è¿”å›çš„å¯¹è±¡.
ä¸ºä»€ä¹ˆè¦éªŒè¯ context, å› ä¸º context æ˜¯ä¸€ä¸ªå±é™©çš„ç‰¹æ€§, æŒ‰ç…§ React.js å›¢é˜Ÿçš„æƒ³æ³•å°±æ˜¯, æŠŠå±é™©çš„äº‹æƒ…æå¤æ‚ä¸€äº›, æé«˜ä½¿ç”¨é—¨æ§›äººä»¬å°±ä¸ä¼šå»ç”¨äº†.
å¦‚æœä½ è¦ç»™ç»„ä»¶è®¾ç½® context, é‚£ä¹ˆ childContextTypes æ˜¯å¿…å†™çš„.

ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº† Index å¾€ context é‡Œé¢æ”¾ç½®çŠ¶æ€çš„å·¥ä½œäº†, æ¥ä¸‹æ¥æˆ‘ä»¬è¦çœ‹çœ‹å­ç»„ä»¶æ€ä¹ˆè·å–è¿™ä¸ªçŠ¶æ€, ä¿®æ”¹ Index çš„å­™å­ç»„ä»¶ Title:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Title extends Component {
  static contextTypes = {
    themeColor: PropTypes.string
  }

  render () {
    return (
      <h1 style={{ color: this.context.themeColor }}>React.js å°ä¹¦æ ‡é¢˜</h1>
    )
  }
}
#+END_SRC

å­ç»„ä»¶è¦è·å– context é‡Œé¢çš„å†…å®¹çš„è¯, å°±å¿…é¡»å†™ contextTypes æ¥å£°æ˜å’ŒéªŒè¯ä½ éœ€è¦è·å–çš„çŠ¶æ€çš„ç±»å‹, å®ƒä¹Ÿæ˜¯å¿…å†™çš„, å¦‚æœä½ ä¸å†™å°±æ— æ³•è·å– context é‡Œé¢çš„çŠ¶æ€.
Title æƒ³è·å– themeColor, å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸², æˆ‘ä»¬å°±åœ¨ contextTypes é‡Œé¢è¿›è¡Œå£°æ˜.

/*å£°æ˜ä»¥åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ this.context.themeColor è·å–åˆ°åœ¨ Index æ”¾ç½®çš„å€¼ä¸º red çš„ themeColor*/, ç„¶åè®¾ç½® h1 çš„æ ·å¼, æ‰€ä»¥ä½ ä¼šçœ‹åˆ°é¡µé¢ä¸Šçš„å­—ä½“æ˜¯çº¢è‰²çš„:

[[file:./static/React.js å°ä¹¦/B8D755FF-79CC-4D1F-960D-7ABBF7775AF1.png]]

å¦‚æœæˆ‘ä»¬è¦æ”¹é¢œè‰², åªéœ€è¦åœ¨ Index é‡Œé¢ setState å°±å¯ä»¥äº†, å­ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“, æ¸²æŸ“çš„æ—¶å€™ä¼šé‡æ–°å– context çš„å†…å®¹, ä¾‹å¦‚æˆ‘ä»¬ç»™ Index è°ƒæ•´ä¸€ä¸‹é¢œè‰²:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
    componentWillMount () {
      this.setState({ themeColor: 'green' })
    }
...
#+END_SRC

é‚£ä¹ˆ Title é‡Œé¢çš„å­—ä½“å°±ä¼šæ˜¾ç¤ºç»¿è‰².
æˆ‘ä»¬å¯ä»¥å¦‚æ³•ç‚®åˆ¶å­™å­ç»„ä»¶ Content, æˆ–è€…ä»»æ„çš„ Index ä¸‹é¢çš„å­ç»„ä»¶.
è®©å®ƒä»¬å¯ä»¥ä¸ç»è¿‡ä¸­é—´ props çš„ä¼ é€’è·å°±å¯ä»¥è·å–åˆ°ç”± Index è®¾å®šçš„ context å†…å®¹.

** æ€»ç»“
 ä¸€ä¸ªç»„ä»¶å¯ä»¥é€šè¿‡ getChildContext æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡, è¿™ä¸ªå¯¹è±¡å°±æ˜¯å­æ ‘çš„ context, æä¾› context çš„ç»„ä»¶å¿…é¡»æä¾› childContextTypes ä½œä¸º context çš„å£°æ˜å’ŒéªŒè¯.

 å¦‚æœä¸€ä¸ªç»„ä»¶è®¾ç½®äº† context, é‚£ä¹ˆå®ƒçš„å­ç»„ä»¶éƒ½å¯ä»¥ç›´æ¥è®¿é—®åˆ°é‡Œé¢çš„å†…å®¹, å®ƒå°±åƒè¿™ä¸ªç»„ä»¶ä¸ºæ ¹çš„å­æ ‘çš„å…¨å±€å˜é‡. ä»»æ„æ·±åº¦çš„å­ç»„ä»¶éƒ½å¯ä»¥é€šè¿‡ contextTypes æ¥å£°æ˜ä½ æƒ³è¦çš„ context é‡Œé¢çš„å“ªäº›çŠ¶æ€, ç„¶åå¯ä»¥é€šè¿‡ this.context è®¿é—®åˆ°é‚£äº›çŠ¶æ€.

 context æ‰“ç ´äº†ç»„ä»¶å’Œç»„ä»¶ä¹‹é—´é€šè¿‡ props ä¼ é€’æ•°æ®çš„è§„èŒƒ, æå¤§åœ°å¢å¼ºäº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§.
 è€Œä¸”, å°±å¦‚å…¨å±€å˜é‡ä¸€æ ·,context é‡Œé¢çš„æ•°æ®èƒ½è¢«éšæ„æ¥è§¦å°±èƒ½è¢«éšæ„ä¿®æ”¹, æ¯ä¸ªç»„ä»¶éƒ½èƒ½å¤Ÿæ”¹ context é‡Œé¢çš„å†…å®¹ä¼šå¯¼è‡´ç¨‹åºçš„è¿è¡Œä¸å¯é¢„æ–™.

 ä½†æ˜¯è¿™ç§æœºåˆ¶å¯¹äºå‰ç«¯åº”ç”¨çŠ¶æ€ç®¡ç†æ¥è¯´æ˜¯å¾ˆæœ‰å¸®åŠ©çš„, å› ä¸ºæ¯•ç«Ÿå¾ˆå¤šçŠ¶æ€éƒ½ä¼šåœ¨ç»„ä»¶ä¹‹é—´è¿›è¡Œå…±äº«,context ä¼šç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤§çš„æ–¹ä¾¿.
 ä¸€äº›ç¬¬ä¸‰æ–¹çš„å‰ç«¯åº”ç”¨çŠ¶æ€ç®¡ç†çš„åº“(ä¾‹å¦‚ Redux) å°±æ˜¯å……åˆ†åœ°åˆ©ç”¨äº†è¿™ç§æœºåˆ¶ç»™æˆ‘ä»¬æä¾›ä¾¿åˆ©çš„çŠ¶æ€ç®¡ç†æœåŠ¡.
 ä½†æˆ‘ä»¬ä¸€èˆ¬ä¸éœ€è¦æ‰‹åŠ¨å†™ context, ä¹Ÿä¸è¦ç”¨å®ƒ, åªéœ€è¦ç”¨å¥½è¿™äº›ç¬¬ä¸‰æ–¹çš„åº”ç”¨çŠ¶æ€ç®¡ç†åº“å°±è¡Œäº†.
* åŠ¨æ‰‹å®ç° Redux(ä¸€): ä¼˜é›…åœ°ä¿®æ”¹å…±äº«çŠ¶æ€
ä»è¿™èŠ‚èµ·æˆ‘ä»¬å¼€å§‹å­¦ä¹  Redux, ä¸€ç§æ–°å‹çš„å‰ç«¯" æ¶æ„æ¨¡å¼". ç»å¸¸å’Œ React.js ä¸€å¹¶æå‡º, ä½ è¦ç”¨ React.js åŸºæœ¬éƒ½è¦ä¼´éšç€ Redux å’Œ React.js ç»“åˆçš„åº“ React-redux.

è¦æ³¨æ„çš„æ˜¯,Redux å’Œ React-redux å¹¶ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿.
Redux æ˜¯ä¸€ç§æ¶æ„æ¨¡å¼(Flux æ¶æ„çš„ä¸€ç§å˜ç§), å®ƒä¸å…³æ³¨ä½ åˆ°åº•ç”¨ä»€ä¹ˆåº“, ä½ å¯ä»¥æŠŠå®ƒåº”ç”¨åˆ° React å’Œ Vue, ç”šè‡³è·Ÿ jQuery ç»“åˆéƒ½æ²¡æœ‰é—®é¢˜.
è€Œ React-redux å°±æ˜¯æŠŠ Redux è¿™ç§æ¶æ„æ¨¡å¼å’Œ React.js ç»“åˆèµ·æ¥çš„ä¸€ä¸ªåº“, å°±æ˜¯ Redux æ¶æ„åœ¨ React.js ä¸­çš„ä½“ç°.

å¦‚æœæŠŠ Redux çš„ç”¨æ³•é‡æ–°ä»‹ç»ä¸€éé‚£ä¹ˆè¿™æœ¬ä¹¦çš„ä»·å€¼å°±ä¸å¤§äº†, æˆ‘å¤§å¯æŠŠå®˜ç½‘çš„ Reducers,Actions,Store çš„ç”¨æ³•,API, å…³ç³»é‡å¤ä¸€é, ç”»å‡ ä¸ªå›¾, è¯´ä¸¤å¥å¾ˆç„ä¹çš„è¯.
ä½†æ˜¯è¿™æ ·å¯¹å¤§å®¶ç†è§£å’Œä½¿ç”¨ Redux éƒ½æ²¡ä»€ä¹ˆå¥½å¤„, æœ¬ä¹¦åˆè¡·è¿˜æ˜¯è·Ÿå¼€å¤´æ‰€è¯´çš„ä¸€æ ·: å¸Œæœ›å¤§å®¶å¯¹é—®é¢˜çš„æ ¹æºæœ‰æ‰€äº†è§£, äº†è§£è¿™äº›å·¥å…·åˆ°åº•è§£å†³ä»€ä¹ˆé—®é¢˜, æ€ä¹ˆè§£å†³çš„.

ç°åœ¨è®©æˆ‘ä»¬å¿˜æ‰ React.js,Redux è¿™äº›è¯, ä»ä¸€ä¸ªä¾‹å­çš„ä»£ç  + é—®é¢˜å¼€å§‹æ¨æ¼”.

ç”¨ create-react-app æ–°å»ºä¸€ä¸ªé¡¹ç›® make-redux, ä¿®æ”¹ public/index.html é‡Œé¢çš„ body ç»“æ„ä¸º:

#+BEGIN_SRC html :results values list :exports no-eval
<body>
    <div id='title'></div>
    <div id='content'></div>
</body>
#+END_SRC

åˆ é™¤ src/index.js é‡Œé¢æ‰€æœ‰çš„ä»£ç , æ·»åŠ ä¸‹é¢ä»£ç , ä»£è¡¨æˆ‘ä»¬åº”ç”¨çš„çŠ¶æ€:

#+BEGIN_SRC javascript :results values list :exports no-eval
const appState = {
  title: {
    text: 'React.js å°ä¹¦',
    color: 'red'
  },
  content: {
    text: 'React.js å°ä¹¦å†…å®¹',
    color: 'blue'
  }
}
#+END_SRC

æˆ‘ä»¬æ–°å¢å‡ ä¸ªæ¸²æŸ“å‡½æ•°, å®ƒä¼šæŠŠä¸Šé¢çŠ¶æ€çš„æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸Š:

#+CAPTION: renderApp
#+BEGIN_SRC javascript :results values list :exports no-eval
function renderApp (appState) {
  renderTitle(appState.title)
  renderContent(appState.content)
}

function renderTitle (title) {
  const titleDOM = document.getElementById('title')
  titleDOM.innerHTML = title.text
  titleDOM.style.color = title.color
}

function renderContent (content) {
  const contentDOM = document.getElementById('content')
  contentDOM.innerHTML = content.text
  contentDOM.style.color = content.color
}
#+END_SRC
<<renderApp>>

å¾ˆç®€å•,renderApp ä¼šè°ƒç”¨ rendeTitle å’Œ renderContent, è€Œè¿™ä¸¤è€…ä¼šæŠŠ appState é‡Œé¢çš„æ•°æ®é€šè¿‡åŸå§‹çš„ DOM æ“ä½œæ›´æ–°åˆ°é¡µé¢ä¸Š, è°ƒç”¨:

#+BEGIN_SRC javascript :results values list :exports no-eval
renderApp(appState)
#+END_SRC

ä½ ä¼šåœ¨é¡µé¢ä¸Šçœ‹åˆ°:

#+DOWNLOADED: http://huzidaha.github.io/static/assets/img/posts/DA9A892E-4495-479A-A7B9-3A5D8B7926AD.png @ 2019-06-23 22:22:26
[[file:./static/React.js å°ä¹¦/DA9A892E-4495-479A-A7B9-3A5D8B7926AD_2019-06-23_22-22-26.png]]

è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ App, ä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªé‡å¤§çš„éšæ‚£, æˆ‘ä»¬æ¸²æŸ“æ•°æ®çš„æ—¶å€™, ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå…±äº«çŠ¶æ€ appState, æ¯ä¸ªäººéƒ½å¯ä»¥ä¿®æ”¹å®ƒ. å¦‚æœæˆ‘åœ¨æ¸²æŸ“ä¹‹å‰åšäº†ä¸€ç³»åˆ—å…¶ä»–æ“ä½œ:

#+BEGIN_SRC javascript :results values list :exports no-eval
loadDataFromServer()
doSomethingUnexpected()
doSomthingMore()
// ...
renderApp(appState)
renderApp(appState)
#+END_SRC

ä¹‹å‰æ‰§è¡Œäº†ä¸€å¤§å †å‡½æ•°æ“ä½œ, ä½ æ ¹æœ¬ä¸çŸ¥é“å®ƒä»¬ä¼šå¯¹ appState åšä»€ä¹ˆäº‹æƒ…,renderApp(appState) çš„ç»“æœæ ¹æœ¬æ²¡æ³•å¾—åˆ°ä¿éšœ.
ä¸€ä¸ªå¯ä»¥è¢«ä¸åŒæ¨¡å—ä»»æ„ä¿®æ”¹å…±äº«çš„æ•°æ®çŠ¶æ€å°±æ˜¯é­”é¬¼, ä¸€æ—¦æ•°æ®å¯ä»¥ä»»æ„ä¿®æ”¹, æ‰€æœ‰å¯¹å…±äº«çŠ¶æ€çš„æ“ä½œéƒ½æ˜¯ä¸å¯é¢„æ–™çš„(æŸä¸ªæ¨¡å— appState.title = null ä½ ä¸€ç‚¹æ„è§éƒ½æ²¡æœ‰), å‡ºç°é—®é¢˜çš„æ—¶å€™ debug èµ·æ¥å°±éå¸¸å›°éš¾, è¿™å°±æ˜¯è€ç”Ÿå¸¸è°ˆçš„å°½é‡é¿å…å…¨å±€å˜é‡.

ä½ å¯èƒ½ä¼šè¯´æˆ‘å»çœ‹ä¸€ä¸‹å®ƒä»¬å‡½æ•°çš„å®ç°å°±çŸ¥é“äº†å®ƒä»¬ä¿®æ”¹äº†ä»€ä¹ˆ, åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œé¢è¿˜ç®—æ¯”è¾ƒç®€å•, ä½†æ˜¯çœŸå®é¡¹ç›®å½“ä¸­çš„å‡½æ•°è°ƒç”¨å’Œæ•°æ®åˆå§‹åŒ–æ“ä½œéå¸¸å¤æ‚, æ·±å±‚æ¬¡çš„å‡½æ•°è°ƒç”¨ä¿®æ”¹äº†çŠ¶æ€æ˜¯å¾ˆéš¾è°ƒè¯•çš„.

ä½†ä¸åŒçš„æ¨¡å—(ç»„ä»¶) ä¹‹é—´ç¡®å®éœ€è¦å…±äº«æ•°æ®, è¿™äº›æ¨¡å—(ç»„ä»¶) è¿˜å¯èƒ½éœ€è¦ä¿®æ”¹è¿™äº›å…±äº«æ•°æ®, å°±åƒä¸Šä¸€èŠ‚çš„" ä¸»é¢˜è‰²" çŠ¶æ€(themeColor).
è¿™é‡Œçš„çŸ›ç›¾å°±æ˜¯:" æ¨¡å—(ç»„ä»¶) ä¹‹é—´éœ€è¦å…±äº«æ•°æ®", å’Œ" æ•°æ®å¯èƒ½è¢«ä»»æ„ä¿®æ”¹å¯¼è‡´ä¸å¯é¢„æ–™çš„ç»“æœ" ä¹‹é—´çš„çŸ›ç›¾.

è®©æˆ‘ä»¬æ¥æƒ³åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜, æˆ‘ä»¬å¯ä»¥å­¦ä¹  React.js å›¢é˜Ÿçš„åšæ³•, æŠŠäº‹æƒ…æå¤æ‚ä¸€äº›, æé«˜æ•°æ®ä¿®æ”¹çš„é—¨æ§›: æ¨¡å—(ç»„ä»¶) ä¹‹é—´å¯ä»¥å…±äº«æ•°æ®, ä¹Ÿå¯ä»¥æ”¹æ•°æ®.
ä½†æ˜¯æˆ‘ä»¬çº¦å®š, è¿™ä¸ªæ•°æ®å¹¶ä¸èƒ½ç›´æ¥æ”¹, ä½ åªèƒ½æ‰§è¡ŒæŸäº›æˆ‘å…è®¸çš„æŸäº›ä¿®æ”¹, è€Œä¸”ä½ ä¿®æ”¹çš„å¿…é¡»å¤§å¼ æ——é¼“åœ°å‘Šè¯‰æˆ‘.

æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°, å« dispatch, å®ƒä¸“é—¨è´Ÿè´£æ•°æ®çš„ä¿®æ”¹:

#+BEGIN_SRC javascript :results values list :exports no-eval
function dispatch (action) {
  switch (action.type) {
    case 'UPDATE_TITLE_TEXT':
      appState.title.text = action.text
      break
    case 'UPDATE_TITLE_COLOR':
      appState.title.color = action.color
      break
    default:
      break
  }
}
#+END_SRC

æ‰€æœ‰å¯¹æ•°æ®çš„æ“ä½œå¿…é¡»é€šè¿‡ dispatch å‡½æ•°.
å®ƒæ¥å—ä¸€ä¸ªå‚æ•° action, è¿™ä¸ª action æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡, é‡Œé¢å¿…é¡»åŒ…å«ä¸€ä¸ª type å­—æ®µæ¥å£°æ˜ä½ åˆ°åº•æƒ³å¹²ä»€ä¹ˆ.
dispatch åœ¨ swtich é‡Œé¢ä¼šè¯†åˆ«è¿™ä¸ª type å­—æ®µ, èƒ½å¤Ÿè¯†åˆ«å‡ºæ¥çš„æ“ä½œæ‰ä¼šæ‰§è¡Œå¯¹ appState çš„ä¿®æ”¹.

ä¸Šé¢çš„ dispatch å®ƒåªèƒ½è¯†åˆ«ä¸¤ç§æ“ä½œ, ä¸€ç§æ˜¯ UPDATE_TITLE_TEXT å®ƒä¼šç”¨ action çš„ text å­—æ®µå»æ›´æ–° appState.title.text,
ä¸€ç§æ˜¯ UPDATE_TITLE_COLOR, å®ƒä¼šç”¨ action çš„ color å­—æ®µå»æ›´æ–° appState.title.color.
å¯ä»¥çœ‹åˆ°,action é‡Œé¢é™¤äº† type å­—æ®µæ˜¯å¿…é¡»çš„ä»¥å¤–, å…¶ä»–å­—æ®µéƒ½æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„.

ä»»ä½•çš„æ¨¡å—å¦‚æœæƒ³è¦ä¿®æ”¹ appState.title.text, å¿…é¡»å¤§å¼ æ——é¼“åœ°è°ƒç”¨ dispatch:

#+BEGIN_SRC javascript :results values list :exports no-eval
dispatch({ type: 'UPDATE_TITLE_TEXT', text: 'ã€ŠReact.js å°ä¹¦ã€‹' }) // ä¿®æ”¹æ ‡é¢˜æ–‡æœ¬
dispatch({ type: 'UPDATE_TITLE_COLOR', color: 'blue' }) // ä¿®æ”¹æ ‡é¢˜é¢œè‰²
#+END_SRC

æˆ‘ä»¬æ¥çœ‹çœ‹æœ‰ä»€ä¹ˆå¥½å¤„:

#+BEGIN_SRC javascript :results values list :exports no-eval
loadDataFromServer() // => é‡Œé¢å¯èƒ½é€šè¿‡ dispatch ä¿®æ”¹æ ‡é¢˜æ–‡æœ¬
doSomethingUnexpected()
doSomthingMore() // => é‡Œé¢å¯èƒ½é€šè¿‡ dispatch ä¿®æ”¹æ ‡é¢˜é¢œè‰²
// ...
renderApp(appState)
#+END_SRC

æˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒ renderApp(appState) ä¹‹å‰çš„é‚£å †å‡½æ•°æ“ä½œä¼šå¹²ä»€ä¹ˆå¥‡å¥‡æ€ªæ€ªå¾—äº‹æƒ…, å› ä¸ºæˆ‘ä»¬è§„å®šä¸èƒ½ç›´æ¥ä¿®æ”¹ appState, å®ƒä»¬å¯¹ appState çš„ä¿®æ”¹å¿…é¡»åªèƒ½é€šè¿‡ dispatch.
è€Œæˆ‘ä»¬çœ‹çœ‹ dispatch çš„å®ç°å¯ä»¥çŸ¥é“, ä½ åªèƒ½ä¿®æ”¹ title.text å’Œ title.color.

å¦‚æœæŸä¸ªå‡½æ•°ä¿®æ”¹äº† title.text ä½†æ˜¯æˆ‘å¹¶ä¸æƒ³è¦å®ƒè¿™ä¹ˆå¹², æˆ‘éœ€è¦ debug å‡ºæ¥æ˜¯å“ªä¸ªå‡½æ•°ä¿®æ”¹äº†, æˆ‘åªéœ€è¦åœ¨ dispatch çš„ switch çš„ç¬¬ä¸€ä¸ª case å†…éƒ¨æ‰“ä¸ªæ–­ç‚¹å°±å¯ä»¥è°ƒè¯•å‡ºæ¥äº†.

åŸæ¥æ¨¡å—(ç»„ä»¶) ä¿®æ”¹å…±äº«æ•°æ®æ˜¯ç›´æ¥æ”¹çš„:

#+DOWNLOADED: http://huzidaha.github.io/static/assets/img/posts/CA34AC20-F3C0-438F-AD64-66C5E0986669.png @ 2019-06-23 22:51:06
[[file:./static/React.js å°ä¹¦/CA34AC20-F3C0-438F-AD64-66C5E0986669_2019-06-23_22-51-06.png]]

æˆ‘ä»¬å¾ˆéš¾æŠŠæ§æ¯ä¸€æ ¹æŒ‡å‘ appState çš„ç®­å¤´,appState é‡Œé¢çš„ä¸œè¥¿å°±æ— æ³•æŠŠæ§.
ä½†ç°åœ¨æˆ‘ä»¬å¿…é¡»é€šè¿‡ä¸€ä¸ª" ä¸­é—´äºº" â€”â€” dispatch, æ‰€æœ‰çš„æ•°æ®ä¿®æ”¹å¿…é¡»é€šè¿‡å®ƒ, å¹¶ä¸”ä½ å¿…é¡»ç”¨ action æ¥å¤§å£°å‘Šè¯‰å®ƒè¦ä¿®æ”¹ä»€ä¹ˆ, åªæœ‰å®ƒå…è®¸çš„æ‰èƒ½ä¿®æ”¹:

#+DOWNLOADED: http://huzidaha.github.io/static/assets/img/posts/7536BBF9-6563-4FD5-8359-28D3A5254EE7.png @ 2019-06-23 22:51:50
[[file:./static/React.js å°ä¹¦/7536BBF9-6563-4FD5-8359-28D3A5254EE7_2019-06-23_22-51-50.png]]

æˆ‘ä»¬å†ä¹Ÿä¸ç”¨æ‹…å¿ƒå…±äº«æ•°æ®çŠ¶æ€çš„ä¿®æ”¹çš„é—®é¢˜, æˆ‘ä»¬åªè¦æŠŠæ§äº† dispatch, æ‰€æœ‰çš„å¯¹ appState çš„ä¿®æ”¹å°±æ— æ‰€éå½¢, æ¯•ç«Ÿåªæœ‰ä¸€æ ¹ç®­å¤´æŒ‡å‘ appState äº†.

æœ¬èŠ‚å®Œæ•´çš„ä»£ç å¦‚ä¸‹:

#+BEGIN_SRC javascript :results values list :exports no-eval
let appState = {
  title: {
    text: 'React.js å°ä¹¦',
    color: 'red'
  },
  content: {
    text: 'React.js å°ä¹¦å†…å®¹',
    color: 'blue'
  }
}

function dispatch (action) {
  switch (action.type) {
    case 'UPDATE_TITLE_TEXT':
      appState.title.text = action.text
      break
    case 'UPDATE_TITLE_COLOR':
      appState.title.color = action.color
      break
    default:
      break
  }
}

function renderApp (appState) {
  renderTitle(appState.title)
  renderContent(appState.content)
}

function renderTitle (title) {
  const titleDOM = document.getElementById('title')
  titleDOM.innerHTML = title.text
  titleDOM.style.color = title.color
}

function renderContent (content) {
  const contentDOM = document.getElementById('content')
  contentDOM.innerHTML = content.text
  contentDOM.style.color = content.color
}

renderApp(appState) // é¦–æ¬¡æ¸²æŸ“é¡µé¢
dispatch({ type: 'UPDATE_TITLE_TEXT', text: 'ã€ŠReact.js å°ä¹¦ã€‹' }) // ä¿®æ”¹æ ‡é¢˜æ–‡æœ¬
dispatch({ type: 'UPDATE_TITLE_COLOR', color: 'blue' }) // ä¿®æ”¹æ ‡é¢˜é¢œè‰²
renderApp(appState) // æŠŠæ–°çš„æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸Š
#+END_SRC

ä¸‹ä¸€èŠ‚æˆ‘ä»¬ä¼šæŠŠè¿™ç§ dispatch çš„æ¨¡å¼æŠ½ç¦»å‡ºæ¥, è®©å®ƒå˜å¾—æ›´åŠ é€šç”¨.
* åŠ¨æ‰‹å®ç° Redux(äºŒ): æŠ½ç¦» store å’Œç›‘æ§æ•°æ®å˜åŒ–
ä¸Šä¸€èŠ‚ çš„æˆ‘ä»¬æœ‰äº† appState å’Œ dispatch:

#+BEGIN_SRC javascript :results values list :exports no-eval
let appState = {
  title: {
    text: 'React.js å°ä¹¦',
    color: 'red'
  },
  content: {
    text: 'React.js å°ä¹¦å†…å®¹',
    color: 'blue'
  }
}

function dispatch (action) {
  switch (action.type) {
    case 'UPDATE_TITLE_TEXT':
      appState.title.text = action.text
      break
    case 'UPDATE_TITLE_COLOR':
      appState.title.color = action.color
      break
    default:
      break
  }
}
#+END_SRC

ç°åœ¨æˆ‘ä»¬æŠŠå®ƒä»¬é›†ä¸­åˆ°ä¸€ä¸ªåœ°æ–¹, ç»™è¿™ä¸ªåœ°æ–¹èµ·ä¸ªåå­—å«åš store, ç„¶åæ„å»ºä¸€ä¸ª/*å‡½æ•° createStore*/,
ç”¨æ¥ä¸“é—¨ç”Ÿäº§è¿™ç§ state å’Œ dispatch çš„é›†åˆ, è¿™æ ·åˆ«çš„ App ä¹Ÿå¯ä»¥ç”¨è¿™ç§æ¨¡å¼äº†:

#+BEGIN_SRC javascript :results values list :exports no-eval
function createStore (state, stateChanger) {
  const getState = () => state
  const dispatch = (action) => stateChanger(state, action)
  return { getState, dispatch }
}
#+END_SRC

createStore æ¥å—ä¸¤ä¸ªå‚æ•°, ä¸€ä¸ªæ˜¯è¡¨ç¤ºåº”ç”¨ç¨‹åºçŠ¶æ€çš„ state,
å¦å¤–ä¸€ä¸ªæ˜¯ stateChanger, å®ƒæ¥æè¿°åº”ç”¨ç¨‹åºçŠ¶æ€ä¼šæ ¹æ® action å‘ç”Ÿä»€ä¹ˆå˜åŒ–, å…¶å®å°±æ˜¯ç›¸å½“äºæœ¬èŠ‚å¼€å¤´çš„ dispatch ä»£ç é‡Œé¢çš„å†…å®¹.

createStore ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡, è¿™ä¸ªå¯¹è±¡åŒ…å«ä¸¤ä¸ªæ–¹æ³• getState å’Œ dispatch.
getState ç”¨äºè·å– state æ•°æ®, å…¶å®å°±æ˜¯ç®€å•åœ°æŠŠ state å‚æ•°è¿”å›.

dispatch ç”¨äºä¿®æ”¹æ•°æ®, å’Œä»¥å‰ä¸€æ ·ä¼šæ¥å— action, ç„¶åå®ƒä¼šæŠŠ state å’Œ action ä¸€å¹¶ä¼ ç»™ stateChanger,
é‚£ä¹ˆ stateChanger å°±å¯ä»¥æ ¹æ® action æ¥ä¿®æ”¹ state äº†.

ç°åœ¨æœ‰äº† createStore, æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆä¿®æ”¹åŸæ¥çš„ä»£ç , ä¿ç•™åŸæ¥æ‰€æœ‰çš„æ¸²æŸ“å‡½æ•°ä¸å˜, ä¿®æ”¹æ•°æ®ç”Ÿæˆçš„æ–¹å¼:

#+CAPTION: stateChanger
#+BEGIN_SRC javascript :results values list :exports no-eval
let appState = {
  title: {
    text: 'React.js å°ä¹¦',
    color: 'red'
  },
  content: {
    text: 'React.js å°ä¹¦å†…å®¹',
    color: 'blue'
  }
}

function stateChanger (state, action) {
  switch (action.type) {
    case 'UPDATE_TITLE_TEXT':
      state.title.text = action.text
      break
    case 'UPDATE_TITLE_COLOR':
      state.title.color = action.color
      break
    default:
      break
  }
}

const store = createStore(appState, stateChanger)

renderApp(store.getState()) // é¦–æ¬¡æ¸²æŸ“é¡µé¢
store.dispatch({ type: 'UPDATE_TITLE_TEXT', text: 'ã€ŠReact.js å°ä¹¦ã€‹' }) // ä¿®æ”¹æ ‡é¢˜æ–‡æœ¬
store.dispatch({ type: 'UPDATE_TITLE_COLOR', color: 'blue' }) // ä¿®æ”¹æ ‡é¢˜é¢œè‰²
renderApp(store.getState()) // æŠŠæ–°çš„æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸Š
#+END_SRC
<<stateChanger>>

é’ˆå¯¹æ¯ä¸ªä¸åŒçš„ App, æˆ‘ä»¬å¯ä»¥ç»™ createStore ä¼ å…¥åˆå§‹çš„æ•°æ® appState, å’Œä¸€ä¸ªæè¿°æ•°æ®å˜åŒ–çš„å‡½æ•° stateChanger, ç„¶åç”Ÿæˆä¸€ä¸ª store.
éœ€è¦ä¿®æ”¹æ•°æ®çš„æ—¶å€™é€šè¿‡ store.dispatch, éœ€è¦è·å–æ•°æ®çš„æ—¶å€™é€šè¿‡ store.getState.

** ç›‘æ§æ•°æ®å˜åŒ–
 ä¸Šé¢çš„ä»£ç æœ‰ä¸€ä¸ªé—®é¢˜, æˆ‘ä»¬æ¯æ¬¡é€šè¿‡ dispatch ä¿®æ”¹æ•°æ®çš„æ—¶å€™, å…¶å®åªæ˜¯æ•°æ®å‘ç”Ÿäº†å˜åŒ–, å¦‚æœæˆ‘ä»¬ä¸æ‰‹åŠ¨è°ƒç”¨ renderApp, é¡µé¢ä¸Šçš„å†…å®¹æ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„.
 ä½†æ˜¯æˆ‘ä»¬æ€»ä¸èƒ½æ¯æ¬¡ dispatch çš„æ—¶å€™éƒ½æ‰‹åŠ¨è°ƒç”¨ä¸€ä¸‹ renderApp, æˆ‘ä»¬è‚¯å®šå¸Œæœ›æ•°æ®å˜åŒ–çš„æ—¶å€™ç¨‹åºèƒ½å¤Ÿæ™ºèƒ½ä¸€ç‚¹åœ°è‡ªåŠ¨é‡æ–°æ¸²æŸ“æ•°æ®, è€Œä¸æ˜¯æ‰‹åŠ¨è°ƒç”¨.

 ä½ è¯´è¿™å¥½åŠ, å¾€ dispatch é‡Œé¢åŠ  renderApp å°±å¥½äº†, ä½†æ˜¯è¿™æ · createStore å°±ä¸å¤Ÿé€šç”¨äº†.
 æˆ‘ä»¬å¸Œæœ›ç”¨ä¸€ç§é€šç”¨çš„æ–¹å¼" ç›‘å¬" æ•°æ®å˜åŒ–, ç„¶åé‡æ–°æ¸²æŸ“é¡µé¢, è¿™é‡Œè¦ç”¨åˆ°è§‚å¯Ÿè€…æ¨¡å¼. ä¿®æ”¹ createStore:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 function createStore (state, stateChanger) {
   const listeners = []
   const subscribe = (listener) => listeners.push(listener)
   const getState = () => state
   const dispatch = (action) => {
     stateChanger(state, action)
     listeners.forEach((listener) => listener())
   }
   return { getState, dispatch, subscribe }
 }
 #+END_SRC

 æˆ‘ä»¬åœ¨ createStore é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªæ•°ç»„ listeners, è¿˜æœ‰ä¸€ä¸ªæ–°çš„æ–¹æ³• subscribe,
 å¯ä»¥é€šè¿‡ store.subscribe(listener) çš„æ–¹å¼ç»™ subscribe ä¼ å…¥ä¸€ä¸ªç›‘å¬å‡½æ•°, è¿™ä¸ªå‡½æ•°ä¼šè¢« push åˆ°æ•°ç»„å½“ä¸­.

 æˆ‘ä»¬ä¿®æ”¹äº† dispatch, æ¯æ¬¡å½“å®ƒè¢«è°ƒç”¨çš„æ—¶å€™, é™¤äº†ä¼šè°ƒç”¨ stateChanger è¿›è¡Œæ•°æ®çš„ä¿®æ”¹,
 è¿˜ä¼šéå† listeners æ•°ç»„é‡Œé¢çš„å‡½æ•°, ç„¶åä¸€ä¸ªä¸ªåœ°å»è°ƒç”¨.
 ç›¸å½“äºæˆ‘ä»¬å¯ä»¥é€šè¿‡ subscribe ä¼ å…¥æ•°æ®å˜åŒ–çš„ç›‘å¬å‡½æ•°, æ¯å½“ dispatch çš„æ—¶å€™, ç›‘å¬å‡½æ•°å°±ä¼šè¢«è°ƒç”¨,

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const store = createStore(appState, stateChanger)
 store.subscribe(() => renderApp(store.getState()))

 renderApp(store.getState()) // é¦–æ¬¡æ¸²æŸ“é¡µé¢
 store.dispatch({ type: 'UPDATE_TITLE_TEXT', text: 'ã€ŠReact.js å°ä¹¦ã€‹' }) // ä¿®æ”¹æ ‡é¢˜æ–‡æœ¬
 store.dispatch({ type: 'UPDATE_TITLE_COLOR', color: 'blue' }) // ä¿®æ”¹æ ‡é¢˜é¢œè‰²

 // ... åé¢ä¸ç®¡å¦‚ä½• store.dispatch, éƒ½ä¸éœ€è¦é‡æ–°è°ƒç”¨ renderApp
 #+END_SRC

 å¯¹è§‚å¯Ÿè€…æ¨¡å¼ä¸ç†Ÿæ‚‰çš„æœ‹å‹å¯èƒ½ä¼šåœ¨è¿™é‡Œæ™•å¤´è½¬å‘, å»ºè®®äº†è§£ä¸€ä¸‹è¿™ä¸ªè®¾è®¡æ¨¡å¼çš„ç›¸å…³èµ„æ–™, ç„¶åè¿›è¡Œç»ƒä¹ : [[https://scriptoj.com/problems/36][å®ç°ä¸€ä¸ª EventEmitter]] å†è¿›è¡Œé˜…è¯».

 æˆ‘ä»¬åªéœ€è¦ subscribe ä¸€æ¬¡, åé¢ä¸ç®¡å¦‚ä½• dispatch è¿›è¡Œä¿®æ”¹æ•°æ®,renderApp å‡½æ•°éƒ½ä¼šè¢«é‡æ–°è°ƒç”¨, [[renderApp][See: renderApp]] é¡µé¢å°±ä¼šè¢«é‡æ–°æ¸²æŸ“.
 è¿™æ ·çš„è®¢é˜…æ¨¡å¼è¿˜æœ‰å¥½å¤„å°±æ˜¯, ä»¥åæˆ‘ä»¬è¿˜å¯ä»¥æ‹¿åŒä¸€å—æ•°æ®æ¥æ¸²æŸ“åˆ«çš„é¡µé¢, è¿™æ—¶ dispatch å¯¼è‡´çš„å˜åŒ–ä¹Ÿä¼šè®©æ¯ä¸ªé¡µé¢éƒ½é‡æ–°æ¸²æŸ“:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const store = createStore(appState, stateChanger)
 store.subscribe(() => renderApp(store.getState()))
 store.subscribe(() => renderApp2(store.getState()))
 store.subscribe(() => renderApp3(store.getState()))
 ...

 #+END_SRC

 æœ¬èŠ‚çš„å®Œæ•´ä»£ç :

 #+BEGIN_SRC javascript :results values list :exports no-eval
 function createStore (state, stateChanger) {
   const listeners = []
   const subscribe = (listener) => listeners.push(listener)
   const getState = () => state
   const dispatch = (action) => {
     stateChanger(state, action)
     listeners.forEach((listener) => listener())
   }
   return { getState, dispatch, subscribe }
 }

 function renderApp (appState) {
   renderTitle(appState.title)
   renderContent(appState.content)
 }

 function renderTitle (title) {
   const titleDOM = document.getElementById('title')
   titleDOM.innerHTML = title.text
   titleDOM.style.color = title.color
 }

 function renderContent (content) {
   const contentDOM = document.getElementById('content')
   contentDOM.innerHTML = content.text
   contentDOM.style.color = content.color
 }

 let appState = {
   title: {
     text: 'React.js å°ä¹¦',
     color: 'red'
   },
   content: {
     text: 'React.js å°ä¹¦å†…å®¹',
     color: 'blue'
   }
 }

 function stateChanger (state, action) {
   switch (action.type) {
     case 'UPDATE_TITLE_TEXT':
       state.title.text = action.text
       break
     case 'UPDATE_TITLE_COLOR':
       state.title.color = action.color
       break
     default:
       break
   }
 }

 const store = createStore(appState, stateChanger)
 store.subscribe(() => renderApp(store.getState())) // ç›‘å¬æ•°æ®å˜åŒ–

 renderApp(store.getState()) // é¦–æ¬¡æ¸²æŸ“é¡µé¢
 store.dispatch({ type: 'UPDATE_TITLE_TEXT', text: 'ã€ŠReact.js å°ä¹¦ã€‹' }) // ä¿®æ”¹æ ‡é¢˜æ–‡æœ¬
 store.dispatch({ type: 'UPDATE_TITLE_COLOR', color: 'blue' }) // ä¿®æ”¹æ ‡é¢˜é¢œè‰²
 #+END_SRC

** æ€»ç»“
 ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ createStore, å®ƒå¯ä»¥äº§ç”Ÿä¸€ç§æˆ‘ä»¬æ–°å®šä¹‰çš„æ•°æ®ç±»å‹ store, é€šè¿‡ store.getState æˆ‘ä»¬è·å–å…±äº«çŠ¶æ€,
 è€Œä¸”æˆ‘ä»¬çº¦å®šåªèƒ½é€šè¿‡ store.dispatch ä¿®æ”¹å…±äº«çŠ¶æ€.
 store ä¹Ÿå…è®¸æˆ‘ä»¬é€šè¿‡ store.subscribe ç›‘å¬æ•°æ®æ•°æ®çŠ¶æ€è¢«ä¿®æ”¹äº†, å¹¶ä¸”è¿›è¡Œåç»­çš„ä¾‹å¦‚é‡æ–°æ¸²æŸ“é¡µé¢çš„æ“ä½œ.
* åŠ¨æ‰‹å®ç° Redux(ä¸‰): çº¯å‡½æ•°(Pure Function) ç®€ä»‹
æˆ‘ä»¬æ¥ä¸‹æ¥ä¼šç»§ç»­ä¼˜åŒ–æˆ‘ä»¬çš„ createStore çš„æ¨¡å¼, è®©å®ƒä½¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè·å¾—æ›´å¥½çš„æ€§èƒ½.

ä½†åœ¨å¼€å§‹ä¹‹å‰, æˆ‘ä»¬å…ˆç”¨ä¸€èŠ‚çš„è¯¾ç¨‹æ¥ä»‹ç»ä¸€ä¸‹ä¸€ä¸ªå‡½æ•°å¼ç¼–ç¨‹é‡Œé¢éå¸¸é‡è¦çš„æ¦‚å¿µ â€”â€” çº¯å‡½æ•°(Pure Function).

ç®€å•æ¥è¯´, ä¸€ä¸ªå‡½æ•°çš„è¿”å›ç»“æœåªä¾èµ–äºå®ƒçš„å‚æ•°, å¹¶ä¸”åœ¨æ‰§è¡Œè¿‡ç¨‹é‡Œé¢æ²¡æœ‰å‰¯ä½œç”¨, æˆ‘ä»¬å°±æŠŠè¿™ä¸ªå‡½æ•°å«åšçº¯å‡½æ•°. è¿™ä¹ˆè¯´è‚¯å®šæ¯”è¾ƒæŠ½è±¡, æˆ‘ä»¬æŠŠå®ƒæ°å¼€æ¥çœ‹:
- å‡½æ•°çš„è¿”å›ç»“æœåªä¾èµ–äºå®ƒçš„å‚æ•°.
- å‡½æ•°æ‰§è¡Œè¿‡ç¨‹é‡Œé¢æ²¡æœ‰å‰¯ä½œç”¨.

** å‡½æ•°çš„è¿”å›ç»“æœåªä¾èµ–äºå®ƒçš„å‚æ•°

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const a = 1
 const foo = (b) => a + b
 foo(2) // => 3
 #+END_SRC

 foo å‡½æ•°ä¸æ˜¯ä¸€ä¸ªçº¯å‡½æ•°, å› ä¸ºå®ƒè¿”å›çš„ç»“æœä¾èµ–äºå¤–éƒ¨å˜é‡ a, æˆ‘ä»¬åœ¨ä¸çŸ¥é“ a çš„å€¼çš„æƒ…å†µä¸‹, å¹¶ä¸èƒ½ä¿è¯ foo(2) çš„è¿”å›å€¼æ˜¯ 3.
 è™½ç„¶ foo å‡½æ•°çš„ä»£ç å®ç°å¹¶æ²¡æœ‰å˜åŒ–, ä¼ å…¥çš„å‚æ•°ä¹Ÿæ²¡æœ‰å˜åŒ–, ä½†å®ƒçš„è¿”å›å€¼å´æ˜¯ä¸å¯é¢„æ–™çš„, ç°åœ¨ foo(2) æ˜¯ 3, å¯èƒ½è¿‡äº†ä¸€ä¼šå°±æ˜¯ 4 äº†, å› ä¸º a å¯èƒ½å‘ç”Ÿäº†å˜åŒ–å˜æˆäº† 2.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const a = 1
 const foo = (x, b) => x + b
 foo(1, 2) // => 3
 #+END_SRC

 ç°åœ¨ foo çš„è¿”å›ç»“æœåªä¾èµ–äºå®ƒçš„å‚æ•° x å’Œ b,foo(1, 2) æ°¸è¿œæ˜¯ 3.
 ä»Šå¤©æ˜¯ 3, æ˜å¤©ä¹Ÿæ˜¯ 3, åœ¨æœåŠ¡å™¨è·‘æ˜¯ 3, åœ¨å®¢æˆ·ç«¯è·‘ä¹Ÿ 3, ä¸ç®¡ä½ å¤–éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–,foo(1, 2) æ°¸è¿œæ˜¯ 3.
 åªè¦ foo ä»£ç ä¸æ”¹å˜, ä½ ä¼ å…¥çš„å‚æ•°æ˜¯ç¡®å®šçš„, é‚£ä¹ˆ foo(1, 2) çš„å€¼æ°¸è¿œæ˜¯å¯é¢„æ–™çš„.

 è¿™å°±æ˜¯çº¯å‡½æ•°çš„ç¬¬ä¸€ä¸ªæ¡ä»¶: ä¸€ä¸ªå‡½æ•°çš„è¿”å›ç»“æœåªä¾èµ–äºå®ƒçš„å‚æ•°.

** å‡½æ•°æ‰§è¡Œè¿‡ç¨‹æ²¡æœ‰å‰¯ä½œç”¨
 ä¸€ä¸ªå‡½æ•°æ‰§è¡Œè¿‡ç¨‹å¯¹äº§ç”Ÿäº†å¤–éƒ¨å¯è§‚å¯Ÿçš„å˜åŒ–é‚£ä¹ˆå°±è¯´è¿™ä¸ªå‡½æ•°æ˜¯æœ‰å‰¯ä½œç”¨çš„.

 æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ foo:


 #+BEGIN_SRC javascript :results values list :exports no-eval
 const a = 1
 const foo = (obj, b) => {
   return obj.x + b
 }
 const counter = { x: 1 }
 foo(counter, 2) // => 3
 counter.x // => 1
 #+END_SRC

 æˆ‘ä»¬æŠŠåŸæ¥çš„ x æ¢æˆäº† obj, æˆ‘ç°åœ¨å¯ä»¥å¾€é‡Œé¢ä¼ ä¸€ä¸ªå¯¹è±¡è¿›è¡Œè®¡ç®—, è®¡ç®—çš„è¿‡ç¨‹é‡Œé¢å¹¶ä¸ä¼šå¯¹ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œä¿®æ”¹, è®¡ç®—å‰åçš„ counter ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–, è®¡ç®—å‰æ˜¯ 1, è®¡ç®—åä¹Ÿæ˜¯ 1, å®ƒç°åœ¨æ˜¯çº¯çš„.
 ä½†æ˜¯æˆ‘å†ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å®ƒ:


 #+BEGIN_SRC javascript :results values list :exports no-eval
 const a = 1
 const foo = (obj, b) => {
   obj.x = 2
   return obj.x + b
 }
 const counter = { x: 1 }
 foo(counter, 2) // => 4
 counter.x // => 2
 #+END_SRC

 ç°åœ¨æƒ…å†µå‘ç”Ÿäº†å˜åŒ–, æˆ‘åœ¨ foo å†…éƒ¨åŠ äº†ä¸€å¥ obj.x = 2, è®¡ç®—å‰ counter.x æ˜¯ 1, ä½†æ˜¯è®¡ç®—ä»¥å counter.x æ˜¯ 2.
 foo å‡½æ•°çš„æ‰§è¡Œå¯¹å¤–éƒ¨çš„ counter äº§ç”Ÿäº†å½±å“, å®ƒäº§ç”Ÿäº†å‰¯ä½œç”¨, å› ä¸ºå®ƒä¿®æ”¹äº†å¤–éƒ¨ä¼ è¿›æ¥çš„å¯¹è±¡, ç°åœ¨å®ƒæ˜¯ä¸çº¯çš„.

 ä½†æ˜¯ä½ åœ¨å‡½æ•°å†…éƒ¨æ„å»ºçš„å˜é‡, ç„¶åè¿›è¡Œæ•°æ®çš„ä¿®æ”¹ä¸æ˜¯å‰¯ä½œç”¨:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const foo = (b) => {
   const obj = { x: 1 }
   obj.x = 2
   return obj.x + b
 }
 #+END_SRC

 è™½ç„¶ foo å‡½æ•°å†…éƒ¨ä¿®æ”¹äº† obj, ä½†æ˜¯ obj æ˜¯å†…éƒ¨å˜é‡, å¤–éƒ¨ç¨‹åºæ ¹æœ¬è§‚å¯Ÿä¸åˆ°, ä¿®æ”¹ obj å¹¶ä¸ä¼šäº§ç”Ÿå¤–éƒ¨å¯è§‚å¯Ÿçš„å˜åŒ–, è¿™ä¸ªå‡½æ•°æ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„, å› æ­¤å®ƒæ˜¯ä¸€ä¸ªçº¯å‡½æ•°.

 é™¤äº†ä¿®æ”¹å¤–éƒ¨çš„å˜é‡, ä¸€ä¸ªå‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¿˜æœ‰å¾ˆå¤šæ–¹å¼äº§ç”Ÿå¤–éƒ¨å¯è§‚å¯Ÿçš„å˜åŒ–,
 æ¯”å¦‚è¯´è°ƒç”¨ DOM API ä¿®æ”¹é¡µé¢, æˆ–è€…ä½ å‘é€äº† Ajax è¯·æ±‚, è¿˜æœ‰è°ƒç”¨ window.reload åˆ·æ–°æµè§ˆå™¨, ç”šè‡³æ˜¯ console.log å¾€æ§åˆ¶å°æ‰“å°æ•°æ®ä¹Ÿæ˜¯å‰¯ä½œç”¨.

 çº¯å‡½æ•°å¾ˆä¸¥æ ¼, ä¹Ÿå°±æ˜¯è¯´ä½ å‡ ä¹é™¤äº†è®¡ç®—æ•°æ®ä»¥å¤–ä»€ä¹ˆéƒ½ä¸èƒ½å¹², è®¡ç®—çš„æ—¶å€™è¿˜ä¸èƒ½ä¾èµ–é™¤äº†å‡½æ•°å‚æ•°ä»¥å¤–çš„æ•°æ®.

** æ€»ç»“
 ä¸€ä¸ªå‡½æ•°çš„è¿”å›ç»“æœåªä¾èµ–äºå®ƒçš„å‚æ•°, å¹¶ä¸”åœ¨æ‰§è¡Œè¿‡ç¨‹é‡Œé¢æ²¡æœ‰å‰¯ä½œç”¨, æˆ‘ä»¬å°±æŠŠè¿™ä¸ªå‡½æ•°å«åšçº¯å‡½æ•°.

 ä¸ºä»€ä¹ˆè¦ç…è´¹è‹¦å¿ƒåœ°æ„å»ºçº¯å‡½æ•°? å› ä¸ºçº¯å‡½æ•°éå¸¸" é è°±", æ‰§è¡Œä¸€ä¸ªçº¯å‡½æ•°ä½ ä¸ç”¨æ‹…å¿ƒå®ƒä¼šå¹²ä»€ä¹ˆåäº‹, å®ƒä¸ä¼šäº§ç”Ÿä¸å¯é¢„æ–™çš„è¡Œä¸º, ä¹Ÿä¸ä¼šå¯¹å¤–éƒ¨äº§ç”Ÿå½±å“. ä¸ç®¡ä½•æ—¶ä½•åœ°, ä½ ç»™å®ƒä»€ä¹ˆå®ƒå°±ä¼šä¹–ä¹–åœ°åå‡ºä»€ä¹ˆ. å¦‚æœä½ çš„åº”ç”¨ç¨‹åºå¤§å¤šæ•°å‡½æ•°éƒ½æ˜¯ç”±çº¯å‡½æ•°ç»„æˆ, é‚£ä¹ˆä½ çš„ç¨‹åºæµ‹è¯•, è°ƒè¯•èµ·æ¥ä¼šéå¸¸æ–¹ä¾¿.
* åŠ¨æ‰‹å®ç° Redux(å››): å…±äº«ç»“æ„çš„å¯¹è±¡æé«˜æ€§èƒ½
æ¥ä¸‹æ¥ä¸¤èŠ‚æŸäº›åœ°æ–¹å¯èƒ½ä¼šç¨å¾®æœ‰ä¸€ç‚¹ç‚¹æŠ½è±¡, ä½†æ˜¯æˆ‘ä¼šå°½å¯èƒ½ç”¨ç®€å•çš„æ–¹å¼è¿›è¡Œè®²è§£.
å¦‚æœä½ è§‰å¾—ç†è§£èµ·æ¥æœ‰ç‚¹å›°éš¾, å¯ä»¥æŠŠè¿™å‡ èŠ‚å¤šè¯»å¤šç†è§£å‡ é, å…¶å®æˆ‘ä»¬ä¸€è·¯èµ°æ¥éƒ½æ˜¯ç¬¦åˆ" é€»è¾‘" çš„, éƒ½æ˜¯å‘ç°é—®é¢˜, æ€è€ƒé—®é¢˜, ä¼˜åŒ–ä»£ç çš„è¿‡ç¨‹.
æ‰€ä»¥æœ€å¥½èƒ½å¤Ÿç”¨å¿ƒç•™æ„, æ€è€ƒæˆ‘ä»¬æ¯ä¸€ä¸ªæå‡ºæ¥çš„é—®é¢˜.

ç»†å¿ƒçš„æœ‹å‹å¯ä»¥å‘ç°, å…¶å®æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­å½“ä¸­æ˜¯æœ‰æ¯”è¾ƒä¸¥é‡çš„æ€§èƒ½é—®é¢˜çš„. æˆ‘ä»¬åœ¨æ¯ä¸ªæ¸²æŸ“å‡½æ•°çš„å¼€å¤´æ‰“ä¸€äº› Log çœ‹çœ‹:

#+BEGIN_SRC javascript :results values list :exports no-eval
function renderApp (appState) {
  console.log('render app...')
  renderTitle(appState.title)
  renderContent(appState.content)
}

function renderTitle (title) {
  console.log('render title...')
  const titleDOM = document.getElementById('title')
  titleDOM.innerHTML = title.text
  titleDOM.style.color = title.color
}

function renderContent (content) {
  console.log('render content...')
  const contentDOM = document.getElementById('content')
  contentDOM.innerHTML = content.text
  contentDOM.style.color = content.color
}
#+END_SRC

ä¾æ—§æ‰§è¡Œä¸€æ¬¡åˆå§‹åŒ–æ¸²æŸ“, å’Œä¸¤æ¬¡æ›´æ–°, è¿™é‡Œä»£ç ä¿æŒä¸å˜:

#+BEGIN_SRC javascript :results values list :exports no-eval
const store = createStore(appState, stateChanger)
store.subscribe(() => renderApp(store.getState())) // ç›‘å¬æ•°æ®å˜åŒ–

renderApp(store.getState()) // é¦–æ¬¡æ¸²æŸ“é¡µé¢
store.dispatch({ type: 'UPDATE_TITLE_TEXT', text: 'ã€ŠReact.js å°ä¹¦ã€‹' }) // ä¿®æ”¹æ ‡é¢˜æ–‡æœ¬
store.dispatch({ type: 'UPDATE_TITLE_COLOR', color: 'blue' }) // ä¿®æ”¹æ ‡é¢˜é¢œè‰²
#+END_SRC

å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°:

#+DOWNLOADED: http://huzidaha.github.io/static/assets/img/posts/39AC7FAA-0332-448E-8B00-7A1719F048DE.png @ 2019-06-24 12:48:05
[[file:./static/React.js å°ä¹¦/39AC7FAA-0332-448E-8B00-7A1719F048DE_2019-06-24_12-48-05.png]]

å‰ä¸‰ä¸ªæ¯«æ— ç–‘é—®æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“æ‰“å°å‡ºæ¥çš„. ä¸­é—´ä¸‰ä¸ªæ˜¯ç¬¬ä¸€æ¬¡ store.dispatch å¯¼è‡´çš„, æœ€åä¸‰ä¸ªæ˜¯ç¬¬äºŒæ¬¡ store.dispatch å¯¼è‡´çš„.
å¯ä»¥çœ‹åˆ°é—®é¢˜å°±æ˜¯, æ¯å½“æ›´æ–°æ•°æ®å°±é‡æ–°æ¸²æŸ“æ•´ä¸ª App, ä½†å…¶å®æˆ‘ä»¬ä¸¤æ¬¡æ›´æ–°éƒ½æ²¡æœ‰åŠ¨åˆ° appState é‡Œé¢çš„ content å­—æ®µçš„å¯¹è±¡, è€ŒåŠ¨çš„æ˜¯ title å­—æ®µ.
å…¶å®å¹¶ä¸éœ€è¦é‡æ–° renderContent, å®ƒæ˜¯ä¸€ä¸ªå¤šä½™çš„æ›´æ–°æ“ä½œ, ç°åœ¨æˆ‘ä»¬éœ€è¦ä¼˜åŒ–å®ƒ.

è¿™é‡Œæå‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯, åœ¨æ¯ä¸ªæ¸²æŸ“å‡½æ•°æ‰§è¡Œæ¸²æŸ“æ“ä½œä¹‹å‰å…ˆåšä¸ªåˆ¤æ–­, åˆ¤æ–­ä¼ å…¥çš„æ–°æ•°æ®å’Œæ—§çš„æ•°æ®æ˜¯ä¸æ˜¯ç›¸åŒ, ç›¸åŒçš„è¯å°±ä¸æ¸²æŸ“äº†.

#+CAPTION: åˆ¤æ–­æ–°æ—§æ•°æ®çš„ renderApp
#+BEGIN_SRC javascript :results values list :exports no-eval
function renderApp (newAppState, oldAppState = {}) { // é˜²æ­¢ oldAppState æ²¡æœ‰ä¼ å…¥, æ‰€ä»¥åŠ äº†é»˜è®¤å‚æ•° oldAppState = {}
  if (newAppState === oldAppState) return // æ•°æ®æ²¡æœ‰å˜åŒ–å°±ä¸æ¸²æŸ“äº†
  console.log('render app...')
  renderTitle(newAppState.title, oldAppState.title)
  renderContent(newAppState.content, oldAppState.content)
}

function renderTitle (newTitle, oldTitle = {}) {
  if (newTitle === oldTitle) return // æ•°æ®æ²¡æœ‰å˜åŒ–å°±ä¸æ¸²æŸ“äº†
  console.log('render title...')
  const titleDOM = document.getElementById('title')
  titleDOM.innerHTML = newTitle.text
  titleDOM.style.color = newTitle.color
}

function renderContent (newContent, oldContent = {}) {
  if (newContent === oldContent) return // æ•°æ®æ²¡æœ‰å˜åŒ–å°±ä¸æ¸²æŸ“äº†
  console.log('render content...')
  const contentDOM = document.getElementById('content')
  contentDOM.innerHTML = newContent.text
  contentDOM.style.color = newContent.color
}
#+END_SRC
<<åˆ¤æ–­æ–°æ—§æ•°æ®çš„ renderApp>>

ç„¶åæˆ‘ä»¬ç”¨ä¸€ä¸ª oldState å˜é‡ä¿å­˜æ—§çš„åº”ç”¨çŠ¶æ€, åœ¨éœ€è¦é‡æ–°æ¸²æŸ“çš„æ—¶å€™æŠŠæ–°æ—§æ•°æ®ä¼ è¿›å…¥å»:

#+BEGIN_SRC javascript :results values list :exports no-eval
const store = createStore(appState, stateChanger)
let oldState = store.getState() // ç¼“å­˜æ—§çš„ state
store.subscribe(() => {
  const newState = store.getState() // æ•°æ®å¯èƒ½å˜åŒ–, è·å–æ–°çš„ state
  renderApp(newState, oldState) // æŠŠæ–°æ—§çš„ state ä¼ è¿›å»æ¸²æŸ“
  oldState = newState // æ¸²æŸ“å®Œä»¥å, æ–°çš„ newState å˜æˆäº†æ—§çš„ oldState, ç­‰å¾…ä¸‹ä¸€æ¬¡æ•°æ®å˜åŒ–é‡æ–°æ¸²æŸ“
})
...
#+END_SRC

å¸Œæœ›åˆ°è¿™é‡Œæ²¡æœ‰æŠŠå¤§å®¶å¿½æ‚ åˆ°, ä¸Šé¢çš„ä»£ç æ ¹æœ¬ä¸ä¼šè¾¾åˆ°æˆ‘ä»¬çš„æ•ˆæœ. çœ‹çœ‹æˆ‘ä»¬çš„ stateChanger:

#+BEGIN_SRC javascript :results values list :exports no-eval
function stateChanger (state, action) {
  switch (action.type) {
    case 'UPDATE_TITLE_TEXT':
      state.title.text = action.text
      break
    case 'UPDATE_TITLE_COLOR':
      state.title.color = action.color
      break
    default:
      break
  }
}
#+END_SRC

å³ä½¿ä½ ä¿®æ”¹äº† state.title.text, ä½†æ˜¯ state è¿˜æ˜¯åŸæ¥é‚£ä¸ª state,
state.title è¿˜æ˜¯åŸæ¥çš„ state.title, è¿™äº›å¼•ç”¨æŒ‡å‘çš„è¿˜æ˜¯åŸæ¥çš„å¯¹è±¡, åªæ˜¯å¯¹è±¡å†…çš„å†…å®¹å‘ç”Ÿäº†æ”¹å˜.
æ‰€ä»¥å³ä½¿ä½ åœ¨æ¯ä¸ªæ¸²æŸ“å‡½æ•°å¼€å¤´åŠ äº†é‚£ä¸ªåˆ¤æ–­åˆä»€ä¹ˆç”¨? è¿™å°±åƒæ˜¯ä¸‹é¢çš„ä»£ç é‚£æ ·è‡ªæ¬ºæ¬ºäºº:

#+BEGIN_SRC javascript :results values list :exports no-eval
let appState = {
  title: {
    text: 'React.js å°ä¹¦',
    color: 'red',
  },
  content: {
    text: 'React.js å°ä¹¦å†…å®¹',
    color: 'blue'
  }
}
const oldState = appState
appState.title.text = 'ã€ŠReact.js å°ä¹¦ã€‹'
oldState !== appState // false, å…¶å®ä¸¤ä¸ªå¼•ç”¨æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡, æˆ‘ä»¬å´å¸Œæœ›å®ƒä»¬ä¸åŒ.
#+END_SRC

ä½†æ˜¯, æˆ‘ä»¬æ¥ä¸‹æ¥å°±è¦è®©è¿™ç§äº‹æƒ…å˜æˆå¯èƒ½.

** å…±äº«ç»“æ„çš„å¯¹è±¡
 å¸Œæœ›å¤§å®¶éƒ½çŸ¥é“è¿™ç§ ES6 çš„è¯­æ³•:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const obj = { a: 1, b: 2}
 const obj2 = { ...obj } // => { a: 1, b: 2 }
 #+END_SRC

 const obj2 = { ...obj } å…¶å®å°±æ˜¯æ–°å»ºä¸€ä¸ªå¯¹è±¡ obj2, ç„¶åæŠŠ obj æ‰€æœ‰çš„å±æ€§éƒ½å¤åˆ¶åˆ° obj2 é‡Œé¢, ç›¸å½“äºå¯¹è±¡çš„æµ…å¤åˆ¶.
 ä¸Šé¢çš„ obj é‡Œé¢çš„å†…å®¹å’Œ obj2 æ˜¯å®Œå…¨ä¸€æ ·çš„, ä½†æ˜¯å´æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡. é™¤äº†æµ…å¤åˆ¶å¯¹è±¡, è¿˜å¯ä»¥è¦†ç›–, æ‹“å±•å¯¹è±¡å±æ€§:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 const obj = { a: 1, b: 2 }
 const obj2 = { ...obj, b: 3, c: 4 } // => { a: 1, b: 3, c: 4 }, è¦†ç›–äº† b, æ–°å¢äº† c
 #+END_SRC

 æˆ‘ä»¬å¯ä»¥æŠŠè¿™ç§ç‰¹æ€§åº”ç”¨åœ¨ state çš„æ›´æ–°ä¸Š, æˆ‘ä»¬ç¦æ­¢ç›´æ¥ä¿®æ”¹åŸæ¥çš„å¯¹è±¡, ä¸€æ—¦ä½ è¦ä¿®æ”¹æŸäº›ä¸œè¥¿, ä½ å°±å¾—æŠŠä¿®æ”¹è·¯å¾„ä¸Šçš„æ‰€æœ‰å¯¹è±¡å¤åˆ¶ä¸€é, ä¾‹å¦‚, æˆ‘ä»¬ä¸å†™ä¸‹é¢çš„ä¿®æ”¹ä»£ç :

 #+BEGIN_SRC javascript :results values list :exports no-eval
 appState.title.text = 'ã€ŠReact.js å°ä¹¦ã€‹'
 #+END_SRC

 å–è€Œä»£ä¹‹çš„æ˜¯, æˆ‘ä»¬æ–°å»ºä¸€ä¸ª appState, æ–°å»º appState.title, æ–°å»º appState.title.text:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 let newAppState = { // æ–°å»ºä¸€ä¸ª newAppState
   ...appState, // å¤åˆ¶ appState é‡Œé¢çš„å†…å®¹
   title: { // ç”¨ä¸€ä¸ªæ–°çš„å¯¹è±¡è¦†ç›–åŸæ¥çš„ title å±æ€§
     ...appState.title, // å¤åˆ¶åŸæ¥ title å¯¹è±¡é‡Œé¢çš„å†…å®¹
     text: 'ã€ŠReact.js å°ä¹¦ã€‹' // è¦†ç›– text å±æ€§
   }
 }
 #+END_SRC

 å¦‚æœæˆ‘ä»¬ç”¨ä¸€ä¸ªæ ‘çŠ¶çš„ç»“æ„æ¥è¡¨ç¤ºå¯¹è±¡ç»“æ„çš„è¯:

 #+DOWNLOADED: http://huzidaha.github.io/static/assets/img/posts/C8A1EB09-2D4E-442E-AD6D-E4997B4AF1C1.png @ 2019-06-24 13:07:07
 [[file:./static/React.js å°ä¹¦/C8A1EB09-2D4E-442E-AD6D-E4997B4AF1C1_2019-06-24_13-07-07.png]]

 appState å’Œ newAppState å…¶å®æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡, å› ä¸ºå¯¹è±¡æµ…å¤åˆ¶çš„ç¼˜æ•…, å…¶å®å®ƒä»¬é‡Œé¢çš„å±æ€§ content æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡,
 ä½†æ˜¯å› ä¸º title è¢«ä¸€ä¸ªæ–°çš„å¯¹è±¡è¦†ç›–äº†, æ‰€ä»¥å®ƒä»¬çš„ title å±æ€§æŒ‡å‘çš„å¯¹è±¡æ˜¯ä¸åŒçš„. åŒæ ·åœ°, ä¿®æ”¹ appState.title.color:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 let newAppState1 = { // æ–°å»ºä¸€ä¸ª newAppState1
   ...newAppState, // å¤åˆ¶ newAppState1 é‡Œé¢çš„å†…å®¹
   title: { // ç”¨ä¸€ä¸ªæ–°çš„å¯¹è±¡è¦†ç›–åŸæ¥çš„ title å±æ€§
     ...newAppState.title, // å¤åˆ¶åŸæ¥ title å¯¹è±¡é‡Œé¢çš„å†…å®¹
     color: 'blue' // è¦†ç›– color å±æ€§
   }
 }
 #+END_SRC

 #+DOWNLOADED: http://huzidaha.github.io/static/assets/img/posts/4E4E9324-4659-4791-8957-137566C3A929.png @ 2019-06-24 13:08:38
 [[file:./static/React.js å°ä¹¦/4E4E9324-4659-4791-8957-137566C3A929_2019-06-24_13-08-38.png]]

 æˆ‘ä»¬æ¯æ¬¡ä¿®æ”¹æŸäº›æ•°æ®çš„æ—¶å€™, éƒ½ä¸ä¼šç¢°åŸæ¥çš„æ•°æ®, è€Œæ˜¯æŠŠéœ€è¦ä¿®æ”¹æ•°æ®è·¯å¾„ä¸Šçš„å¯¹è±¡éƒ½ copy ä¸€ä¸ªå‡ºæ¥.
 è¿™æ ·æœ‰ä»€ä¹ˆå¥½å¤„? çœ‹çœ‹æˆ‘ä»¬çš„ç›®çš„è¾¾åˆ°äº†:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 appState !== newAppState // true, ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨ä¸åŒ, æ•°æ®å˜åŒ–äº†, é‡æ–°æ¸²æŸ“
 appState.title !== newAppState.title // true, ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨ä¸åŒ, æ•°æ®å˜åŒ–äº†, é‡æ–°æ¸²æŸ“
 appState.content !== appState.content // false, ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨ç›¸åŒ, æ•°æ®æ²¡æœ‰å˜åŒ–, ä¸éœ€è¦é‡æ–°æ¸²æŸ“
 #+END_SRC

 ä¿®æ”¹æ•°æ®çš„æ—¶å€™å°±æŠŠä¿®æ”¹è·¯å¾„éƒ½å¤åˆ¶ä¸€é, ä½†æ˜¯ä¿æŒå…¶ä»–å†…å®¹ä¸å˜, æœ€åçš„æ‰€æœ‰å¯¹è±¡å…·æœ‰æŸäº›ä¸å˜å…±äº«çš„ç»“æ„(ä¾‹å¦‚ä¸Šé¢ä¸‰ä¸ªå¯¹è±¡éƒ½å…±äº« content å¯¹è±¡).
 å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä¿æŒ 50% ä»¥ä¸Šçš„å†…å®¹å…·æœ‰å…±äº«ç»“æ„, è¿™ç§æ“ä½œå…·æœ‰éå¸¸ä¼˜è‰¯çš„ç‰¹æ€§, æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥ä¼˜åŒ–ä¸Šé¢çš„æ¸²æŸ“æ€§èƒ½.

** ä¼˜åŒ–æ€§èƒ½
 æˆ‘ä»¬ä¿®æ”¹ stateChanger, è®©å®ƒä¿®æ”¹æ•°æ®çš„æ—¶å€™, å¹¶ä¸ä¼šç›´æ¥ä¿®æ”¹åŸæ¥çš„æ•°æ® state, è€Œæ˜¯äº§ç”Ÿä¸Šè¿°çš„å…±äº«ç»“æ„çš„å¯¹è±¡:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 function stateChanger (state, action) {
   switch (action.type) {
     case 'UPDATE_TITLE_TEXT':
       return { // æ„å»ºæ–°çš„å¯¹è±¡å¹¶ä¸”è¿”å›
         ...state,
         title: {
           ...state.title,
           text: action.text
         }
       }
     case 'UPDATE_TITLE_COLOR':
       return { // æ„å»ºæ–°çš„å¯¹è±¡å¹¶ä¸”è¿”å›
         ...state,
         title: {
           ...state.title,
           color: action.color
         }
       }
     default:
       return state // æ²¡æœ‰ä¿®æ”¹, è¿”å›åŸæ¥çš„å¯¹è±¡
   }
 }
 #+END_SRC

 ä»£ç ç¨å¾®æ¯”åŸæ¥é•¿äº†ä¸€ç‚¹, ä½†æ˜¯æ˜¯å€¼å¾—çš„. æ¯æ¬¡éœ€è¦ä¿®æ”¹çš„æ—¶å€™éƒ½ä¼šäº§ç”Ÿæ–°çš„å¯¹è±¡, å¹¶ä¸”è¿”å›. è€Œå¦‚æœæ²¡æœ‰ä¿®æ”¹(åœ¨ default è¯­å¥ä¸­) åˆ™è¿”å›åŸæ¥çš„ state å¯¹è±¡.

 å› ä¸º stateChanger ä¸ä¼šä¿®æ”¹åŸæ¥å¯¹è±¡äº†, è€Œæ˜¯è¿”å›å¯¹è±¡, æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹ createStore.
 è®©å®ƒç”¨æ¯æ¬¡ stateChanger(state, action) çš„è°ƒç”¨ç»“æœè¦†ç›–åŸæ¥çš„ state:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 function createStore (state, stateChanger) {
   const listeners = []
   const subscribe = (listener) => listeners.push(listener)
   const getState = () => state
   const dispatch = (action) => {
     state = stateChanger(state, action) // è¦†ç›–åŸå¯¹è±¡
     listeners.forEach((listener) => listener())
   }
   return { getState, dispatch, subscribe }
 }
 #+END_SRC

 ä¿æŒä¸Šé¢çš„æ¸²æŸ“å‡½æ•°å¼€å¤´çš„å¯¹è±¡åˆ¤æ–­ä¸å˜, å†çœ‹çœ‹æ§åˆ¶å°:

 [[file:./static/React.js å°ä¹¦/B7386556-7007-4AAB-9E7D-D977DD98CD44_2019-06-24_13-12-13.png]]

 å‰ä¸‰ä¸ªæ˜¯é¦–æ¬¡æ¸²æŸ“. åé¢çš„ store.dispatch å¯¼è‡´çš„é‡æ–°æ¸²æŸ“éƒ½æ²¡æœ‰å…³äº content çš„ Log äº†.
 å› ä¸ºäº§ç”Ÿå…±äº«ç»“æ„çš„å¯¹è±¡, æ–°æ—§å¯¹è±¡çš„ content å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡æ˜¯ä¸€æ ·çš„, æ‰€ä»¥è§¦å‘äº† renderContent å‡½æ•°å¼€å¤´çš„:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 ...
  if (newContent === oldContent) return
 ...
 #+END_SRC

 æˆ‘ä»¬æˆåŠŸåœ°æŠŠä¸å¿…è¦çš„é¡µé¢æ¸²æŸ“ä¼˜åŒ–æ‰äº†, é—®é¢˜è§£å†³. å¦å¤–, å¹¶ä¸éœ€è¦æ‹…å¿ƒæ¯æ¬¡ä¿®æ”¹éƒ½æ–°å»ºå…±äº«ç»“æ„å¯¹è±¡ä¼šæœ‰æ€§èƒ½, å†…å­˜é—®é¢˜, å› ä¸ºæ„å»ºå¯¹è±¡çš„æˆæœ¬éå¸¸ä½, è€Œä¸”æˆ‘ä»¬æœ€å¤šä¿å­˜ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨(oldState å’Œ newState), å…¶ä½™æ—§çš„å¯¹è±¡éƒ½ä¼šè¢«åƒåœ¾å›æ”¶æ‰.

 æœ¬èŠ‚å®Œæ•´ä»£ç :

 #+BEGIN_SRC javascript :results values list :exports no-eval
 function createStore (state, stateChanger) {
   const listeners = []
   const subscribe = (listener) => listeners.push(listener)
   const getState = () => state
   const dispatch = (action) => {
     state = stateChanger(state, action) // è¦†ç›–åŸå¯¹è±¡
     listeners.forEach((listener) => listener())
   }
   return { getState, dispatch, subscribe }
 }

 function renderApp (newAppState, oldAppState = {}) { // é˜²æ­¢ oldAppState æ²¡æœ‰ä¼ å…¥, æ‰€ä»¥åŠ äº†é»˜è®¤å‚æ•° oldAppState = {}
   if (newAppState === oldAppState) return // æ•°æ®æ²¡æœ‰å˜åŒ–å°±ä¸æ¸²æŸ“äº†
   console.log('render app...')
   renderTitle(newAppState.title, oldAppState.title)
   renderContent(newAppState.content, oldAppState.content)
 }

 function renderTitle (newTitle, oldTitle = {}) {
   if (newTitle === oldTitle) return // æ•°æ®æ²¡æœ‰å˜åŒ–å°±ä¸æ¸²æŸ“äº†
   console.log('render title...')
   const titleDOM = document.getElementById('title')
   titleDOM.innerHTML = newTitle.text
   titleDOM.style.color = newTitle.color
 }

 function renderContent (newContent, oldContent = {}) {
   if (newContent === oldContent) return // æ•°æ®æ²¡æœ‰å˜åŒ–å°±ä¸æ¸²æŸ“äº†
   console.log('render content...')
   const contentDOM = document.getElementById('content')
   contentDOM.innerHTML = newContent.text
   contentDOM.style.color = newContent.color
 }

 let appState = {
   title: {
     text: 'React.js å°ä¹¦',
     color: 'red'
   },
   content: {
     text: 'React.js å°ä¹¦å†…å®¹',
     color: 'blue'
   }
 }

 function stateChanger (state, action) {
   switch (action.type) {
     case 'UPDATE_TITLE_TEXT':
       return { // æ„å»ºæ–°çš„å¯¹è±¡å¹¶ä¸”è¿”å›
         ...state,
         title: {
           ...state.title,
           text: action.text
         }
       }
     case 'UPDATE_TITLE_COLOR':
       return { // æ„å»ºæ–°çš„å¯¹è±¡å¹¶ä¸”è¿”å›
         ...state,
         title: {
           ...state.title,
           color: action.color
         }
       }
     default:
       return state // æ²¡æœ‰ä¿®æ”¹, è¿”å›åŸæ¥çš„å¯¹è±¡
   }
 }

 const store = createStore(appState, stateChanger)
 let oldState = store.getState() // ç¼“å­˜æ—§çš„ state
 store.subscribe(() => {
   const newState = store.getState() // æ•°æ®å¯èƒ½å˜åŒ–, è·å–æ–°çš„ state
   renderApp(newState, oldState) // æŠŠæ–°æ—§çš„ state ä¼ è¿›å»æ¸²æŸ“
   oldState = newState // æ¸²æŸ“å®Œä»¥å, æ–°çš„ newState å˜æˆäº†æ—§çš„ oldState, ç­‰å¾…ä¸‹ä¸€æ¬¡æ•°æ®å˜åŒ–é‡æ–°æ¸²æŸ“
 })

 renderApp(store.getState()) // é¦–æ¬¡æ¸²æŸ“é¡µé¢
 store.dispatch({ type: 'UPDATE_TITLE_TEXT', text: 'ã€ŠReact.js å°ä¹¦ã€‹' }) // ä¿®æ”¹æ ‡é¢˜æ–‡æœ¬
 store.dispatch({ type: 'UPDATE_TITLE_COLOR', color: 'blue' }) // ä¿®æ”¹æ ‡é¢˜é¢œè‰²
 #+END_SRC

* åŠ¨æ‰‹å®ç° Redux(äº”): ä¸è¦é—®ä¸ºä»€ä¹ˆçš„ reducer
ç»è¿‡äº†è¿™ä¹ˆå¤šèŠ‚çš„ä¼˜åŒ–, æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå¾ˆé€šç”¨çš„ createStore:

#+BEGIN_SRC javascript :results values list :exports no-eval
function createStore (state, stateChanger) {
  const listeners = []
  const subscribe = (listener) => listeners.push(listener)
  const getState = () => state
  const dispatch = (action) => {
    state = stateChanger(state, action) // è¦†ç›–åŸå¯¹è±¡
    listeners.forEach((listener) => listener())
  }
  return { getState, dispatch, subscribe }
}
#+END_SRC

å®ƒçš„ä½¿ç”¨æ–¹å¼æ˜¯:

#+BEGIN_SRC javascript :results values list :exports no-eval
let appState = {
  title: {
    text: 'React.js å°ä¹¦',
    color: 'red',
  },
  content: {
    text: 'React.js å°ä¹¦å†…å®¹',
    color: 'blue'
  }
}

function stateChanger (state, action) {
  switch (action.type) {
    case 'UPDATE_TITLE_TEXT':
      return {
        ...state,
        title: {
          ...state.title,
          text: action.text
        }
      }
    case 'UPDATE_TITLE_COLOR':
      return {
        ...state,
        title: {
          ...state.title,
          color: action.color
        }
      }
    default:
      return state
  }
}

const store = createStore(appState, stateChanger)
...
#+END_SRC

æˆ‘ä»¬å†ä¼˜åŒ–ä¸€ä¸‹, å…¶å® appState å’Œ stateChanger å¯ä»¥åˆå¹¶åˆ°ä¸€èµ·å»:

#+CAPTION: åˆå§‹åŒ–çŠ¶æ€çš„ stateChanger
#+BEGIN_SRC javascript :results values list :exports no-eval
function stateChanger (state, action) {
  if (!state) {
    return {
      title: {
        text: 'React.js å°ä¹¦',
        color: 'red'
      },
      content: {
        text: 'React.js å°ä¹¦å†…å®¹',
        color: 'blue'
      }
    }
  }
  switch (action.type) {
    case 'UPDATE_TITLE_TEXT':
      return {
        ...state,
        title: {
          ...state.title,
          text: action.text
        }
      }
    case 'UPDATE_TITLE_COLOR':
      return {
        ...state,
        title: {
          ...state.title,
          color: action.color
        }
      }
    default:
      return state
  }
}
#+END_SRC
<<åˆå§‹åŒ–çŠ¶æ€çš„ stateChanger>>

stateChanger ç°åœ¨æ—¢å……å½“äº†è·å–åˆå§‹åŒ–æ•°æ®çš„åŠŸèƒ½, ä¹Ÿå……å½“äº†ç”Ÿæˆæ›´æ–°æ•°æ®çš„åŠŸèƒ½.
å¦‚æœæœ‰ä¼ å…¥ state å°±ç”Ÿæˆæ›´æ–°æ•°æ®, å¦åˆ™å°±æ˜¯åˆå§‹åŒ–æ•°æ®.
è¿™æ ·æˆ‘ä»¬å¯ä»¥ä¼˜åŒ– createStore æˆä¸€ä¸ªå‚æ•°, å› ä¸º state å’Œ stateChanger åˆå¹¶åˆ°ä¸€èµ·äº†:

#+BEGIN_SRC javascript :results values list :exports no-eval
function createStore (stateChanger) {
  let state = null
  const listeners = []
  const subscribe = (listener) => listeners.push(listener)
  const getState = () => state
  const dispatch = (action) => {
    state = stateChanger(state, action)
    listeners.forEach((listener) => listener())
  }
  dispatch({}) // åˆå§‹åŒ– state
  return { getState, dispatch, subscribe }
}
#+END_SRC

createStore å†…éƒ¨çš„ state ä¸å†é€šè¿‡å‚æ•°ä¼ å…¥, è€Œæ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ let state = null.
createStore çš„æœ€åä¼šæ‰‹åŠ¨è°ƒç”¨ä¸€æ¬¡ dispatch({}), dispatch å†…éƒ¨ä¼šè°ƒç”¨ stateChanger, è¿™æ—¶å€™çš„ state æ˜¯ null, æ‰€ä»¥è¿™æ¬¡çš„ dispatch å…¶å®å°±æ˜¯åˆå§‹åŒ–æ•°æ®äº†.
createStore å†…éƒ¨ç¬¬ä¸€æ¬¡çš„ dispatch å¯¼è‡´ state åˆå§‹åŒ–å®Œæˆ, åç»­å¤–éƒ¨çš„ dispatch å°±æ˜¯ä¿®æ”¹æ•°æ®çš„è¡Œä¸ºäº†.

æˆ‘ä»¬ç»™ stateChanger è¿™ä¸ªç©æ„èµ·ä¸€ä¸ªé€šç”¨çš„åå­—:reducer, ä¸è¦é—®ä¸ºä»€ä¹ˆ, å®ƒå°±æ˜¯ä¸ªåå­—è€Œå·², ä¿®æ”¹ createStore çš„å‚æ•°åå­—:

#+CAPTION: æœ€ç»ˆå½¢æ€çš„ createStore
#+BEGIN_SRC javascript :results values list :exports no-eval
function createStore (reducer) {
  let state = null
  const listeners = []
  const subscribe = (listener) => listeners.push(listener)
  const getState = () => state
  const dispatch = (action) => {
    state = reducer(state, action)
    listeners.forEach((listener) => listener())
  }
  dispatch({}) // åˆå§‹åŒ– state
  return { getState, dispatch, subscribe }
}
#+END_SRC
<<æœ€ç»ˆå½¢æ€çš„ createStore>>

è¿™æ˜¯ä¸€ä¸ªæœ€ç»ˆå½¢æ€çš„ createStore, å®ƒæ¥å—çš„å‚æ•°å« reducer,reducer æ˜¯ä¸€ä¸ªå‡½æ•°, ç»†å¿ƒçš„æœ‹å‹ä¼šå‘ç°, å®ƒå…¶å®æ˜¯ä¸€ä¸ªçº¯å‡½æ•°(Pure Function).

** reducer
 createStore æ¥å—ä¸€ä¸ªå« reducer çš„å‡½æ•°ä½œä¸ºå‚æ•°, è¿™ä¸ªå‡½æ•°è§„å®šæ˜¯ä¸€ä¸ªçº¯å‡½æ•°, å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°, ä¸€ä¸ªæ˜¯ state, ä¸€ä¸ªæ˜¯ action.

 å¦‚æœæ²¡æœ‰ä¼ å…¥ state æˆ–è€… state æ˜¯ null, é‚£ä¹ˆå®ƒå°±ä¼šè¿”å›ä¸€ä¸ªåˆå§‹åŒ–çš„æ•°æ®.
 å¦‚æœæœ‰ä¼ å…¥ state çš„è¯, å°±ä¼šæ ¹æ® action æ¥" ä¿®æ”¹" æ•°æ®, ä½†å…¶å®å®ƒæ²¡æœ‰, ä¹Ÿè§„å®šä¸èƒ½ä¿®æ”¹ state,
 è€Œæ˜¯è¦é€šè¿‡ä¸ŠèŠ‚æ‰€è¯´çš„æŠŠä¿®æ”¹è·¯å¾„çš„å¯¹è±¡éƒ½å¤åˆ¶ä¸€é, ç„¶åäº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡è¿”å›.
 å¦‚æœå®ƒä¸èƒ½è¯†åˆ«ä½ çš„ action, å®ƒå°±ä¸ä¼šäº§ç”Ÿæ–°çš„æ•°æ®, è€Œæ˜¯(åœ¨ default å†…éƒ¨) æŠŠ state åŸå°ä¸åŠ¨åœ°è¿”å›.

 /*reducer æ˜¯ä¸å…è®¸æœ‰å‰¯ä½œç”¨çš„. ä½ ä¸èƒ½åœ¨é‡Œé¢æ“ä½œ DOM, ä¹Ÿä¸èƒ½å‘ Ajax è¯·æ±‚, æ›´ä¸èƒ½ç›´æ¥ä¿®æ”¹ state, å®ƒè¦åšçš„ä»…ä»…æ˜¯ â€”â€” åˆå§‹åŒ–å’Œè®¡ç®—æ–°çš„ state.*/

 ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ª createStore æ¥æ„å»ºä¸åŒçš„ store äº†, åªè¦ç»™å®ƒä¼ å…¥ç¬¦åˆä¸Šè¿°çš„å®šä¹‰çš„ reducer å³å¯:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 function themeReducer (state, action) {
   if (!state) return {
     themeName: 'Red Theme',
     themeColor: 'red'
   }
   switch (action.type) {
     case 'UPATE_THEME_NAME':
       return { ...state, themeName: action.themeName }
     case 'UPATE_THEME_COLOR':
       return { ...state, themeColor: action.themeColor }
     default:
       return state
   }
 }

 const store = createStore(themeReducer)
 ...
 #+END_SRC

* åŠ¨æ‰‹å®ç° Redux(å…­):Redux æ€»ç»“
ä¸çŸ¥ä¸è§‰åœ°, åˆ°è¿™é‡Œå¤§å®¶ä¸ä»…ä»…å·²ç»æŒæ¡äº† Redux, è€Œä¸”è¿˜è‡ªå·±åŠ¨æ‰‹å†™äº†ä¸€ä¸ª Redux.
æˆ‘ä»¬ä»ä¸€ä¸ªéå¸¸åŸå§‹çš„ä»£ç å¼€å§‹, ä¸åœåœ°åœ¨å‘ç°é—®é¢˜, è§£å†³é—®é¢˜, ä¼˜åŒ–ä»£ç çš„è¿‡ç¨‹ä¸­è¿›è¡Œæ¨æ¼”, æœ€åæŠŠ Redux æ¨¡å¼è‡ªå·±æ€»ç»“å‡ºæ¥äº†.
è¿™å°±æ˜¯æ‰€è°“çš„ Redux æ¨¡å¼, æˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹è¿™å‡ èŠ‚æˆ‘ä»¬åˆ°åº•å¹²äº†ä»€ä¹ˆäº‹æƒ….

æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­çš„ä»£ç ä¸­å‘ç°äº†å…±äº«çš„çŠ¶æ€å¦‚æœå¯ä»¥è¢«ä»»æ„ä¿®æ”¹çš„è¯, é‚£ä¹ˆç¨‹åºçš„è¡Œä¸ºå°†éå¸¸ä¸å¯é¢„æ–™, æ‰€ä»¥æˆ‘ä»¬æé«˜äº†ä¿®æ”¹æ•°æ®çš„é—¨æ§›:
ä½ å¿…é¡»é€šè¿‡ dispatch æ‰§è¡ŒæŸäº›å…è®¸çš„ä¿®æ”¹æ“ä½œ, è€Œä¸”å¿…é¡»å¤§å¼ æ——é¼“çš„åœ¨ action é‡Œé¢å£°æ˜.

è¿™ç§æ¨¡å¼æŒºå¥½ç”¨çš„, æˆ‘ä»¬å°±æŠŠå®ƒæŠ½è±¡å‡ºæ¥ä¸€ä¸ª createStore, å®ƒå¯ä»¥äº§ç”Ÿ store, é‡Œé¢åŒ…å« getState å’Œ dispatch å‡½æ•°, æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨.

åæ¥å‘ç°æ¯æ¬¡ä¿®æ”¹æ•°æ®éƒ½éœ€è¦æ‰‹åŠ¨é‡æ–°æ¸²æŸ“éå¸¸éº»çƒ¦, æˆ‘ä»¬å¸Œæœ›è‡ªåŠ¨é‡æ–°æ¸²æŸ“è§†å›¾.
æ‰€ä»¥åæ¥åŠ å…¥äº†è®¢é˜…è€…æ¨¡å¼, å¯ä»¥é€šè¿‡ store.subscribe è®¢é˜…æ•°æ®ä¿®æ”¹äº‹ä»¶, æ¯æ¬¡æ•°æ®æ›´æ–°çš„æ—¶å€™è‡ªåŠ¨é‡æ–°æ¸²æŸ“è§†å›¾.

æ¥ä¸‹æ¥æˆ‘ä»¬å‘ç°äº†åŸæ¥çš„" é‡æ–°æ¸²æŸ“è§†å›¾" æœ‰æ¯”è¾ƒä¸¥é‡çš„æ€§èƒ½é—®é¢˜, æˆ‘ä»¬å¼•å…¥äº†" å…±äº«ç»“æ„çš„å¯¹è±¡" æ¥å¸®æˆ‘ä»¬è§£å†³é—®é¢˜, è¿™æ ·å°±å¯ä»¥åœ¨æ¯ä¸ªæ¸²æŸ“å‡½æ•°çš„å¼€å¤´è¿›è¡Œç®€å•çš„åˆ¤æ–­é¿å…æ²¡æœ‰è¢«ä¿®æ”¹è¿‡çš„æ•°æ®é‡æ–°æ¸²æŸ“.

æˆ‘ä»¬ä¼˜åŒ–äº† stateChanger ä¸º reducer, å®šä¹‰äº† reducer åªèƒ½æ˜¯çº¯å‡½æ•°, åŠŸèƒ½å°±æ˜¯è´Ÿè´£åˆå§‹ state, å’Œæ ¹æ® state å’Œ action è®¡ç®—å…·æœ‰å…±äº«ç»“æ„çš„æ–°çš„ state.

createStore ç°åœ¨å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨äº†, å¥—è·¯å°±æ˜¯:

#+BEGIN_SRC javascript :results values list :exports no-eval
// å®šä¸€ä¸ª reducer
function reducer (state, action) {
  /* åˆå§‹åŒ– state å’Œ switch case */
}

// ç”Ÿæˆ store
const store = createStore(reducer)

// ç›‘å¬æ•°æ®å˜åŒ–é‡æ–°æ¸²æŸ“é¡µé¢
store.subscribe(() => renderApp(store.getState()))

// é¦–æ¬¡æ¸²æŸ“é¡µé¢
renderApp(store.getState())

// åé¢å¯ä»¥éšæ„ dispatch äº†, é¡µé¢è‡ªåŠ¨æ›´æ–°
store.dispatch(...)
#+END_SRC

ç°åœ¨çš„ä»£ç è·Ÿ React.js ä¸€ç‚¹å…³ç³»éƒ½æ²¡æœ‰, æ¥ä¸‹æ¥æˆ‘ä»¬è¦æŠŠ React.js å’Œ Redux ç»“åˆèµ·æ¥, ç”¨ Redux æ¨¡å¼å¸®åŠ©ç®¡ç† React.js çš„åº”ç”¨çŠ¶æ€.

* åŠ¨æ‰‹å®ç° React-redux(ä¸€): åˆå§‹åŒ–å·¥ç¨‹
å¯ä»¥çœ‹åˆ° Redux å¹¶ä¸å¤æ‚, å®ƒé‚£äº›çœ‹èµ·æ¥åŒªå¤·æ‰€æ€çš„è®¾å®šå…¶å®éƒ½æ˜¯ä¸ºäº†è§£å†³ç‰¹å®šçš„é—®é¢˜è€Œå­˜åœ¨çš„, æˆ‘ä»¬æŠŠé—®é¢˜æƒ³æ¸…æ¥šä»¥åå°±ä¸éš¾ç†è§£å®ƒçš„é‚£äº›å¥‡æ€ªçš„è®¾å®šäº†.
è¿™èŠ‚å¼€å§‹æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æŠŠ Redux å’Œ React.js ç»“åˆèµ·æ¥, ä½ ä¼šå‘ç°å…¶å®å®ƒä»¬ä¹Ÿå¹¶ä¸å¤æ‚.

å›é¡¾ä¸€ä¸‹, æˆ‘ä»¬åœ¨ [[çŠ¶æ€æå‡][See: çŠ¶æ€æå‡]] ä¸­æè¿‡, å‰ç«¯ä¸­åº”ç”¨çš„çŠ¶æ€å­˜åœ¨çš„é—®é¢˜: ä¸€ä¸ªçŠ¶æ€å¯èƒ½è¢«å¤šä¸ªç»„ä»¶ä¾èµ–æˆ–è€…å½±å“, è€Œ React.js å¹¶æ²¡æœ‰æä¾›å¥½çš„è§£å†³æ–¹æ¡ˆ,
æˆ‘ä»¬åªèƒ½æŠŠçŠ¶æ€æå‡åˆ°ä¾èµ–æˆ–è€…å½±å“è¿™ä¸ªçŠ¶æ€çš„æ‰€æœ‰ç»„ä»¶çš„å…¬å…±çˆ¶ç»„ä»¶ä¸Š, æˆ‘ä»¬æŠŠè¿™ç§è¡Œä¸ºå«åšçŠ¶æ€æå‡.
ä½†æ˜¯éœ€æ±‚ä¸åœå˜åŒ–, å…±äº«çŠ¶æ€æ²¡å®Œæ²¡äº†åœ°æå‡ä¹Ÿä¸æ˜¯åŠæ³•.

åæ¥æˆ‘ä»¬åœ¨ React.js çš„ context ä¸­æå‡º, æˆ‘ä»¬å¯ç”¨æŠŠå…±äº«çŠ¶æ€æ”¾åˆ°çˆ¶ç»„ä»¶çš„ context ä¸Š, è¿™ä¸ªçˆ¶ç»„ä»¶ä¸‹æ‰€æœ‰çš„ç»„ä»¶éƒ½å¯ä»¥ä» context ä¸­ç›´æ¥è·å–åˆ°çŠ¶æ€è€Œä¸éœ€è¦ä¸€å±‚å±‚åœ°è¿›è¡Œä¼ é€’äº†.
ä½†æ˜¯ç›´æ¥ä» context é‡Œé¢å­˜æ”¾, è·å–æ•°æ®å¢å¼ºäº†ç»„ä»¶çš„è€¦åˆæ€§, å¹¶ä¸”æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä¿®æ”¹ context é‡Œé¢çš„çŠ¶æ€å°±åƒè°éƒ½å¯ä»¥ä¿®æ”¹å…±äº«çŠ¶æ€ä¸€æ ·, å¯¼è‡´ç¨‹åºè¿è¡Œçš„ä¸å¯é¢„æ–™.

æ—¢ç„¶è¿™æ ·, ä¸ºä»€ä¹ˆä¸æŠŠ context å’Œ store ç»“åˆèµ·æ¥?
æ¯•ç«Ÿ store çš„æ•°æ®ä¸æ˜¯è°éƒ½èƒ½ä¿®æ”¹, è€Œæ˜¯çº¦å®šåªèƒ½é€šè¿‡ dispatch æ¥è¿›è¡Œä¿®æ”¹, è¿™æ ·çš„è¯æ¯ä¸ªç»„ä»¶æ—¢å¯ä»¥å» context é‡Œé¢è·å– store ä»è€Œè·å–çŠ¶æ€, åˆä¸ç”¨æ‹…å¿ƒå®ƒä»¬ä¹±æ”¹æ•°æ®äº†.

å¬èµ·æ¥ä¸é”™, æˆ‘ä»¬åŠ¨æ‰‹è¯•ä¸€ä¸‹. æˆ‘ä»¬è¿˜æ˜¯æ‹¿" ä¸»é¢˜è‰²" è¿™ä¸ªä¾‹å­åšè®²è§£, å‡è®¾æˆ‘ä»¬ç°åœ¨éœ€è¦åšä¸‹é¢è¿™æ ·çš„ç»„ä»¶æ ‘:

#+DOWNLOADED: https://huzidaha.github.io/static/assets/img/posts/9271BF94-6599-4F73-A814-0DDA20B634D9.png @ 2019-06-25 18:18:47
[[file:./static/React.js å°ä¹¦/9271BF94-6599-4F73-A814-0DDA20B634D9_2019-06-25_18-18-47.png]]

Header å’Œ Content çš„ç»„ä»¶çš„æ–‡æœ¬å†…å®¹ä¼šéšç€ä¸»é¢˜è‰²çš„å˜åŒ–è€Œå˜åŒ–, è€Œ Content ä¸‹çš„å­ç»„ä»¶ ThemeSwitch æœ‰ä¸¤ä¸ªæŒ‰é’®, å¯ä»¥åˆ‡æ¢çº¢è‰²å’Œè“è‰²ä¸¤ç§ä¸»é¢˜,
æŒ‰é’®çš„é¢œè‰²ä¹Ÿä¼šéšç€ä¸»é¢˜è‰²çš„å˜åŒ–è€Œå˜åŒ–.

ç”¨ create-react-app æ–°å»ºä¸€ä¸ªå·¥ç¨‹, ç„¶åå®‰è£…ä¸€ä¸ª React æä¾›çš„ç¬¬ä¸‰æ–¹åº“ prop-types:

#+BEGIN_SRC javascript :results values list :exports no-eval
npm install --save prop-types
#+END_SRC

å®‰è£…å¥½ååœ¨ src/ ç›®å½•ä¸‹æ–°å¢ä¸‰ä¸ªæ–‡ä»¶:Header.js,Content.js,ThemeSwitch.js.

ä¿®æ”¹ src/Header.js:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'

class Header extends Component {
  render () {
    return (
      <h1>React.js å°ä¹¦</h1>
    )
  }
}

export default Header
#+END_SRC

ä¿®æ”¹ src/ThemeSwitch.js:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'

class ThemeSwitch extends Component {
  render () {
    return (
      <div>
        <button>Red</button>
        <button>Blue</button>
      </div>
    )
  }
}

export default ThemeSwitch
#+END_SRC

ä¿®æ”¹ src/Content.js:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'
import ThemeSwitch from './ThemeSwitch'

class Content extends Component {
  render () {
    return (
      <div>
        <p>React.js å°ä¹¦å†…å®¹</p>
        <ThemeSwitch />
      </div>
    )
  }
}

export default Content
#+END_SRC

ä¿®æ”¹ src/index.js:


#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'
import ReactDOM from 'react-dom'
import Header from './Header'
import Content from './Content'
import './index.css'

class Index extends Component {
  render () {
    return (
      <div>
        <Header />
        <Content />
      </div>
    )
  }
}

ReactDOM.render(
  <Index />,
  document.getElementById('root')
)
#+END_SRC

è¿™æ ·æˆ‘ä»¬å°±ç®€å•åœ°æŠŠæ•´ä¸ªç»„ä»¶æ ‘æ­å»ºèµ·æ¥äº†, ç”¨ npm start å¯åŠ¨å·¥ç¨‹, ç„¶åå¯ä»¥çœ‹åˆ°é¡µé¢ä¸Šæ˜¾ç¤º:

#+DOWNLOADED: https://huzidaha.github.io/static/assets/img/posts/6BF5EA6C-4B5E-48C8-96CF-F8B858AE6AB4.png @ 2019-06-25 18:22:39
[[file:./static/React.js å°ä¹¦/6BF5EA6C-4B5E-48C8-96CF-F8B858AE6AB4_2019-06-25_18-22-39.png]]

å½“ç„¶ç°åœ¨æ–‡æœ¬éƒ½æ²¡æœ‰é¢œè‰², è€Œä¸”ç‚¹å‡»æŒ‰é’®ä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆååº”, æˆ‘ä»¬è¿˜æ²¡æœ‰åŠ å…¥è¡¨ç¤ºä¸»é¢˜è‰²çš„çŠ¶æ€å’Œç›¸å…³çš„ä¸šåŠ¡é€»è¾‘, ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°±æŠŠç›¸å…³çš„é€»è¾‘åŠ è¿›å».

* åŠ¨æ‰‹å®ç° React-redux(äºŒ): ç»“åˆ context å’Œ store
æ—¢ç„¶è¦æŠŠ store å’Œ context ç»“åˆèµ·æ¥, æˆ‘ä»¬å°±å…ˆæ„å»º store.
åœ¨ src/index.js åŠ å…¥ä¹‹å‰åˆ›å»ºçš„ createStore å‡½æ•°, å¹¶ä¸”æ„å»ºä¸€ä¸ª themeReducer æ¥ç”Ÿæˆä¸€ä¸ª store:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'
import ReactDOM from 'react-dom'
import Header from './Header'
import Content from './Content'
import './index.css'

function createStore (reducer) {
  let state = null
  const listeners = []
  const subscribe = (listener) => listeners.push(listener)
  const getState = () => state
  const dispatch = (action) => {
    state = reducer(state, action)
    listeners.forEach((listener) => listener())
  }
  dispatch({}) // åˆå§‹åŒ– state
  return { getState, dispatch, subscribe }
}

const themeReducer = (state, action) => {
  if (!state) return {
    themeColor: 'red'
  }
  switch (action.type) {
    case 'CHANGE_COLOR':
      return { ...state, themeColor: action.themeColor }
    default:
      return state
  }
}

const store = createStore(themeReducer)
...
#+END_SRC

themeReducer å®šä¹‰äº†ä¸€ä¸ªè¡¨ç¤ºä¸»é¢˜è‰²çš„çŠ¶æ€ themeColor, å¹¶ä¸”è§„å®šäº†ä¸€ç§æ“ä½œ CHNAGE_COLOR, åªèƒ½é€šè¿‡è¿™ç§æ“ä½œä¿®æ”¹é¢œè‰².
ç°åœ¨æˆ‘ä»¬æŠŠ store æ”¾åˆ° Index çš„ context é‡Œé¢, è¿™æ ·æ¯ä¸ªå­ç»„ä»¶éƒ½å¯ä»¥è·å–åˆ° store äº†, ä¿®æ”¹ src/index.js é‡Œé¢çš„ Index:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Index extends Component {
  static childContextTypes = {
    store: PropTypes.object
  }

  getChildContext () {
    return { store }
  }

  render () {
    return (
      <div>
        <Header />
        <Content />
      </div>
    )
  }
}
#+END_SRC

å¦‚æœæœ‰äº›åŒå­¦å·²ç»å¿˜è®°äº† context çš„ç”¨æ³•, å¯ä»¥å‚è€ƒä¹‹å‰çš„ç« èŠ‚:React.js çš„ [[context][See: context]].

ç„¶åä¿®æ”¹ src/Header.js, è®©å®ƒä» Index çš„ context é‡Œé¢è·å– store, å¹¶ä¸”è·å–é‡Œé¢çš„ themeColor çŠ¶æ€æ¥è®¾ç½®è‡ªå·±çš„é¢œè‰²:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Header extends Component {
  static contextTypes = {
    store: PropTypes.object
  }

  constructor () {
    super()
    this.state = { themeColor: '' }
  }

  componentWillMount () {
    this._updateThemeColor()
  }

  _updateThemeColor () {
    const { store } = this.context
    const state = store.getState()
    this.setState({ themeColor: state.themeColor })
  }

  render () {
    return (
      <h1 style={{ color: this.state.themeColor }}>React.js å°ä¹¦</h1>
    )
  }
}
#+END_SRC

å…¶å®ä¹Ÿå¾ˆç®€å•, æˆ‘ä»¬åœ¨ constructor é‡Œé¢åˆå§‹åŒ–äº†ç»„ä»¶è‡ªå·±çš„ themeColor çŠ¶æ€.
ç„¶ååœ¨ç”Ÿå‘½å‘¨æœŸä¸­ componentWillMount è°ƒç”¨ _updateThemeColor,
_updateThemeColor ä¼šä» context é‡Œé¢æŠŠ store å–å‡ºæ¥, ç„¶åé€šè¿‡ store.getState() è·å–çŠ¶æ€å¯¹è±¡,
å¹¶ä¸”ç”¨é‡Œé¢çš„ themeColor å­—æ®µè®¾ç½®ç»„ä»¶çš„ state.themeColor.

ç„¶ååœ¨ render å‡½æ•°é‡Œé¢è·å–äº† state.themeColor æ¥è®¾ç½®æ ‡é¢˜çš„æ ·å¼, é¡µé¢ä¸Šå°±ä¼šæ˜¾ç¤º:

#+DOWNLOADED: https://huzidaha.github.io/static/assets/img/posts/6AFDE773-1A0B-476B-B5CB-E11767607EE4.png @ 2019-06-25 18:36:24
[[file:./static/React.js å°ä¹¦/6AFDE773-1A0B-476B-B5CB-E11767607EE4_2019-06-25_18-36-24.png]]

å¦‚æ³•ç‚®åˆ¶ Content.js:

#+BEGIN_SRC javascript :results values list :exports no-eval
class Content extends Component {
  static contextTypes = {
    store: PropTypes.object
  }

  constructor () {
    super()
    this.state = { themeColor: '' }
  }

  componentWillMount () {
    this._updateThemeColor()
  }

  _updateThemeColor () {
    const { store } = this.context
    const state = store.getState()
    this.setState({ themeColor: state.themeColor })
  }

  render () {
    return (
      <div>
        <p style={{ color: this.state.themeColor }}>React.js å°ä¹¦å†…å®¹</p>
        <ThemeSwitch />
      </div>
    )
  }
}
#+END_SRC

è¿˜æœ‰ src/ThemeSwitch.js:

#+BEGIN_SRC javascript :results values list :exports no-eval
class ThemeSwitch extends Component {
  static contextTypes = {
    store: PropTypes.object
  }

  constructor () {
    super()
    this.state = { themeColor: '' }
  }

  componentWillMount () {
    this._updateThemeColor()
  }

  _updateThemeColor () {
    const { store } = this.context
    const state = store.getState()
    this.setState({ themeColor: state.themeColor })
  }

  render () {
    return (
      <div>
        <button style={{ color: this.state.themeColor }}>Red</button>
        <button style={{ color: this.state.themeColor }}>Blue</button>
      </div>
    )
  }
}
#+END_SRC

è¿™æ—¶å€™, ä¸»é¢˜å·²ç»å®Œå…¨ç”Ÿæ•ˆäº†, æ•´ä¸ªé¡µé¢éƒ½æ˜¯çº¢è‰²çš„:

#+DOWNLOADED: https://huzidaha.github.io/static/assets/img/posts/8821A86C-BFC2-47AE-9B93-88F577D44715.png @ 2019-06-25 18:37:58
[[file:./static/React.js å°ä¹¦/8821A86C-BFC2-47AE-9B93-88F577D44715_2019-06-25_18-37-58.png]]

å½“ç„¶ç°åœ¨ç‚¹æŒ‰é’®è¿˜æ˜¯æ²¡ä»€ä¹ˆæ•ˆæœ, æˆ‘ä»¬æ¥ä¸‹æ¥ç»™æŒ‰é’®æ·»åŠ äº‹ä»¶. å…¶å®ä¹Ÿå¾ˆç®€å•,
ç›‘å¬ onClick äº‹ä»¶ç„¶å store.dispatch ä¸€ä¸ª action å°±å¥½äº†, ä¿®æ”¹ src/ThemeSwitch.js:

#+BEGIN_SRC javascript :results values list :exports no-eval
class ThemeSwitch extends Component {
  static contextTypes = {
    store: PropTypes.object
  }

  constructor () {
    super()
    this.state = { themeColor: '' }
  }

  componentWillMount () {
    this._updateThemeColor()
  }

  _updateThemeColor () {
    const { store } = this.context
    const state = store.getState()
    this.setState({ themeColor: state.themeColor })
  }

  // dispatch action å»æ”¹å˜é¢œè‰²
  handleSwitchColor (color) {
    const { store } = this.context
    store.dispatch({
      type: 'CHANGE_COLOR',
      themeColor: color
    })
  }

  render () {
    return (
      <div>
        <button
          style={{ color: this.state.themeColor }}
          onClick={this.handleSwitchColor.bind(this, 'red')}>Red</button>
        <button
          style={{ color: this.state.themeColor }}
          onClick={this.handleSwitchColor.bind(this, 'blue')}>Blue</button>
      </div>
    )
  }
}
#+END_SRC

æˆ‘ä»¬ç»™ä¸¤ä¸ªæŒ‰é’®éƒ½åŠ ä¸Šäº† onClick äº‹ä»¶ç›‘å¬, å¹¶ç»‘å®šåˆ°äº† handleSwitchColor æ–¹æ³•ä¸Š, ä¸¤ä¸ªæŒ‰é’®åˆ†åˆ«ç»™è¿™ä¸ªæ–¹æ³•ä¼ å…¥ä¸åŒçš„é¢œè‰² red å’Œ blue,
handleSwitchColor ä¼šæ ¹æ®ä¼ å…¥çš„é¢œè‰² store.dispatch ä¸€ä¸ª action å»ä¿®æ”¹é¢œè‰².

å½“ç„¶ä½ ç°åœ¨ç‚¹å‡»æŒ‰é’®è¿˜æ˜¯æ²¡æœ‰ååº”çš„.
å› ä¸ºç‚¹å‡»æŒ‰é’®çš„æ—¶å€™, åªæ˜¯æ›´æ–° store é‡Œé¢çš„ state, è€Œå¹¶æ²¡æœ‰åœ¨ store.state æ›´æ–°ä»¥åå»é‡æ–°æ¸²æŸ“æ•°æ®, æˆ‘ä»¬å…¶å®å°±æ˜¯å¿˜äº† store.subscribe äº†.

ç»™ Header.js, Content.js, ThemeSwitch.js çš„ componentWillMount ç”Ÿå‘½å‘¨æœŸéƒ½åŠ ä¸Šç›‘å¬æ•°æ®å˜åŒ–é‡æ–°æ¸²æŸ“çš„ä»£ç :

#+BEGIN_SRC javascript :results values list :exports no-eval
...
 componentWillMount () {
   const { store } = this.context
   this._updateThemeColor()
   store.subscribe(() => this._updateThemeColor())
 }
...
#+END_SRC

é€šè¿‡ store.subscribe, åœ¨æ•°æ®å˜åŒ–çš„æ—¶å€™é‡æ–°è°ƒç”¨ _updateThemeColor, è€Œ _updateThemeColor ä¼šå» store é‡Œé¢å–æœ€æ–°çš„ themeColor ç„¶åé€šè¿‡ setState é‡æ–°æ¸²æŸ“ç»„ä»¶, è¿™æ—¶å€™ç»„ä»¶å°±æ›´æ–°äº†.
ç°åœ¨å¯ä»¥è‡ªç”±åˆ‡æ¢ä¸»é¢˜è‰²äº†:

#+DOWNLOADED: https://huzidaha.github.io/static/assets/img/posts/F102EAC1-409F-40E5-8134-B37F401E6883.png @ 2019-06-25 18:47:06
[[file:./static/React.js å°ä¹¦/F102EAC1-409F-40E5-8134-B37F401E6883_2019-06-25_18-47-06.png]]

æˆ‘ä»¬é¡ºåˆ©åœ°æŠŠ store å’Œ context ç»“åˆèµ·æ¥, è¿™æ˜¯ Redux å’Œ React.js çš„ç¬¬ä¸€æ¬¡èƒœåˆ©ä¼šå¸ˆ, å½“ç„¶è¿˜æœ‰å¾ˆå¤šéœ€è¦ä¼˜åŒ–çš„åœ°æ–¹.
* åŠ¨æ‰‹å®ç° React-redux(ä¸‰):connect å’Œ mapStateToProps
æˆ‘ä»¬æ¥è§‚å¯Ÿä¸€ä¸‹åˆšå†™ä¸‹çš„è¿™å‡ ä¸ªç»„ä»¶, å¯ä»¥è½»æ˜“åœ°å‘ç°å®ƒä»¬æœ‰ä¸¤ä¸ªé‡å¤§çš„é—®é¢˜:

æœ‰å¤§é‡é‡å¤çš„é€»è¾‘: å®ƒä»¬åŸºæœ¬çš„é€»è¾‘éƒ½æ˜¯, å–å‡º context, å–å‡ºé‡Œé¢çš„ store, ç„¶åç”¨é‡Œé¢çš„çŠ¶æ€è®¾ç½®è‡ªå·±çš„çŠ¶æ€, è¿™äº›ä»£ç é€»è¾‘å…¶å®éƒ½æ˜¯ç›¸åŒçš„.
å¯¹ context ä¾èµ–æ€§è¿‡å¼º: è¿™äº›ç»„ä»¶éƒ½è¦ä¾èµ– context æ¥å–æ•°æ®, ä½¿å¾—è¿™ä¸ªç»„ä»¶å¤ç”¨æ€§åŸºæœ¬ä¸ºé›¶.
æƒ³ä¸€ä¸‹, å¦‚æœåˆ«äººéœ€è¦ç”¨åˆ°é‡Œé¢çš„ ThemeSwitch ç»„ä»¶, ä½†æ˜¯ä»–ä»¬çš„ç»„ä»¶æ ‘å¹¶æ²¡æœ‰ context ä¹Ÿæ²¡æœ‰ store, ä»–ä»¬æ²¡æ³•ç”¨è¿™ä¸ªç»„ä»¶äº†.
å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜, æˆ‘ä»¬åœ¨ [[é«˜é˜¶ç»„ä»¶][See: é«˜é˜¶ç»„ä»¶]] çš„ç« èŠ‚è¯´è¿‡, å¯ä»¥æŠŠä¸€äº›å¯å¤ç”¨çš„é€»è¾‘æ”¾åœ¨é«˜é˜¶ç»„ä»¶å½“ä¸­, é«˜é˜¶ç»„ä»¶åŒ…è£…çš„æ–°ç»„ä»¶å’ŒåŸæ¥ç»„ä»¶ä¹‹é—´é€šè¿‡ props ä¼ é€’ä¿¡æ¯, å‡å°‘ä»£ç çš„é‡å¤ç¨‹åº¦.

å¯¹äºç¬¬äºŒä¸ªé—®é¢˜, æˆ‘ä»¬å¾—å¼„æ¸…æ¥šä¸€ä»¶äº‹æƒ…, åˆ°åº•ä»€ä¹ˆæ ·çš„ç»„ä»¶æ‰å«å¤ç”¨æ€§å¼ºçš„ç»„ä»¶.
å¦‚æœä¸€ä¸ªç»„ä»¶å¯¹å¤–ç•Œçš„ä¾èµ–è¿‡äºå¼º, é‚£ä¹ˆè¿™ä¸ªç»„ä»¶çš„ç§»æ¤æ€§ä¼šå¾ˆå·®, å°±åƒè¿™äº›ä¸¥é‡ä¾èµ– context çš„ç»„ä»¶ä¸€æ ·.

å¦‚æœä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“åªä¾èµ–äºå¤–ç•Œä¼ è¿›å»çš„ props å’Œè‡ªå·±çš„ state, è€Œå¹¶ä¸ä¾èµ–äºå…¶ä»–çš„å¤–ç•Œçš„ä»»ä½•æ•°æ®, ä¹Ÿå°±æ˜¯è¯´åƒçº¯å‡½æ•°ä¸€æ ·, ç»™å®ƒä»€ä¹ˆ, å®ƒå°±åå‡º(æ¸²æŸ“) ä»€ä¹ˆå‡ºæ¥.
è¿™ç§ç»„ä»¶çš„å¤ç”¨æ€§æ˜¯æœ€å¼ºçš„, åˆ«äººä½¿ç”¨çš„æ—¶å€™æ ¹æœ¬ä¸ç”¨æ‹…å¿ƒä»»ä½•äº‹æƒ…, åªè¦çœ‹çœ‹ PropTypes å®ƒèƒ½æ¥å—ä»€ä¹ˆå‚æ•°, ç„¶åæŠŠå‚æ•°ä¼ è¿›å»æ§åˆ¶å®ƒå°±è¡Œäº†.

æˆ‘ä»¬æŠŠè¿™ç§ç»„ä»¶å«åš Pure Component, å› ä¸ºå®ƒå°±åƒçº¯å‡½æ•°ä¸€æ ·, å¯é¢„æµ‹æ€§éå¸¸å¼º, å¯¹å‚æ•°(props) ä»¥å¤–çš„æ•°æ®é›¶ä¾èµ–, ä¹Ÿä¸äº§ç”Ÿå‰¯ä½œç”¨.
è¿™ç§ç»„ä»¶ä¹Ÿå« /*Dumb Component*/, å› ä¸ºå®ƒä»¬å‘†å‘†çš„, è®©å®ƒå¹²å•¥å°±å¹²å•¥. å†™ç»„ä»¶çš„æ—¶å€™å°½é‡å†™ Dumb Component ä¼šæé«˜æˆ‘ä»¬çš„ç»„ä»¶çš„å¯å¤ç”¨æ€§.

åˆ°è¿™é‡Œæ€è·¯æ…¢æ…¢åœ°å˜å¾—æ¸…æ™°äº†, æˆ‘ä»¬éœ€è¦é«˜é˜¶ç»„ä»¶å¸®åŠ©æˆ‘ä»¬ä» context å–æ•°æ®, æˆ‘ä»¬ä¹Ÿéœ€è¦å†™ Dumb ç»„ä»¶å¸®åŠ©æˆ‘ä»¬æé«˜ç»„ä»¶çš„å¤ç”¨æ€§.
æ‰€ä»¥æˆ‘ä»¬å°½é‡å¤šåœ°å†™ Dumb ç»„ä»¶, ç„¶åç”¨é«˜é˜¶ç»„ä»¶æŠŠå®ƒä»¬åŒ…è£…ä¸€å±‚, é«˜é˜¶ç»„ä»¶å’Œ context æ‰“äº¤é“, æŠŠé‡Œé¢æ•°æ®å–å‡ºæ¥é€šè¿‡ props ä¼ ç»™ Dumb ç»„ä»¶.

#+DOWNLOADED: https://huzidaha.github.io/static/assets/img/posts/ED7B72E6-73BE-429F-AE3C-F9C15C3BE35E.png @ 2019-06-25 19:06:41
[[file:./static/React.js å°ä¹¦/ED7B72E6-73BE-429F-AE3C-F9C15C3BE35E_2019-06-25_19-06-41.png]]

æˆ‘ä»¬æŠŠè¿™ä¸ªé«˜é˜¶ç»„ä»¶èµ·åå­—å« connect, å› ä¸ºå®ƒæŠŠ Dumb ç»„ä»¶å’Œ context è¿æ¥(connect) èµ·æ¥äº†:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'

export connect = (WrappedComponent) => {
  class Connect extends Component {
    static contextTypes = {
      store: PropTypes.object
    }

    // TODO: å¦‚ä½•ä» store å–æ•°æ®?

    render () {
      return <WrappedComponent />
    }
  }

  return Connect
}
#+END_SRC

connect å‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ WrappedComponent ä½œä¸ºå‚æ•°, æŠŠè¿™ä¸ªç»„ä»¶åŒ…å«åœ¨ä¸€ä¸ªæ–°çš„ç»„ä»¶ Connect é‡Œé¢,Connect ä¼šå» context é‡Œé¢å–å‡º store.
ç°åœ¨è¦æŠŠ store é‡Œé¢çš„æ•°æ®å–å‡ºæ¥é€šè¿‡ props ä¼ ç»™ WrappedComponent.

ä½†æ˜¯æ¯ä¸ªä¼ è¿›å»çš„ç»„ä»¶éœ€è¦ store é‡Œé¢çš„æ•°æ®éƒ½ä¸ä¸€æ ·çš„, æ‰€ä»¥é™¤äº†ç»™é«˜é˜¶ç»„ä»¶ä¼ å…¥ Dumb ç»„ä»¶ä»¥å¤–, è¿˜éœ€è¦å‘Šè¯‰é«˜çº§ç»„ä»¶æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ•°æ®, é«˜é˜¶ç»„ä»¶æ‰èƒ½æ­£ç¡®åœ°å»å–æ•°æ®.
ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, æˆ‘ä»¬å¯ä»¥ç»™é«˜é˜¶ç»„ä»¶ä¼ å…¥ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„å‡½æ•°:

#+BEGIN_SRC javascript :results values list :exports no-eval
const mapStateToProps = (state) => {
  return {
    themeColor: state.themeColor,
    themeName: state.themeName,
    fullName: `${state.firstName} ${state.lastName}`
    ...
  }
}
#+END_SRC

è¿™ä¸ªå‡½æ•°ä¼šæ¥å— store.getState() çš„ç»“æœä½œä¸ºå‚æ•°, ç„¶åè¿”å›ä¸€ä¸ªå¯¹è±¡, è¿™ä¸ªå¯¹è±¡æ˜¯æ ¹æ® state ç”Ÿæˆçš„.
mapStateTopProps ç›¸å½“äºå‘ŠçŸ¥äº† Connect åº”è¯¥å¦‚ä½•å» store é‡Œé¢å–æ•°æ®, ç„¶åå¯ä»¥æŠŠè¿™ä¸ªå‡½æ•°çš„è¿”å›ç»“æœä¼ ç»™è¢«åŒ…è£…çš„ç»„ä»¶:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'

export const connect = (mapStateToProps) => (WrappedComponent) => {
  class Connect extends Component {
    static contextTypes = {
      store: PropTypes.object
    }

    render () {
      const { store } = this.context
      let stateProps = mapStateToProps(store.getState())
      // {...stateProps} æ„æ€æ˜¯æŠŠè¿™ä¸ªå¯¹è±¡é‡Œé¢çš„å±æ€§å…¨éƒ¨é€šè¿‡ `props` æ–¹å¼ä¼ é€’è¿›å»
      return <WrappedComponent {...stateProps} />
    }
  }

  return Connect
}
#+END_SRC

connect ç°åœ¨æ˜¯æ¥å—ä¸€ä¸ªå‚æ•° mapStateToProps, ç„¶åè¿”å›ä¸€ä¸ªå‡½æ•°, è¿™ä¸ªè¿”å›çš„å‡½æ•°æ‰æ˜¯é«˜é˜¶ç»„ä»¶.
å®ƒä¼šæ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°, ç„¶åç”¨ Connect æŠŠç»„ä»¶åŒ…è£…ä»¥åå†è¿”å›.connect çš„ç”¨æ³•æ˜¯:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
 const mapStateToProps = (state) => {
   return {
     themeColor: state.themeColor
   }
 }
Header = connect(mapStateToProps)(Header)
...
#+END_SRC

#+BEGIN_QUOTE
æœ‰äº›æœ‹å‹å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆä¸ç›´æ¥ const connect = (mapStateToProps, WrappedComponent), è€Œæ˜¯è¦é¢å¤–è¿”å›ä¸€ä¸ªå‡½æ•°.
è¿™æ˜¯å› ä¸º React-redux å°±æ˜¯è¿™ä¹ˆè®¾è®¡çš„, è€Œä¸ªäººè§‚ç‚¹è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ª React-redux è®¾è®¡ä¸Šçš„ç¼ºé™·, è¿™é‡Œæœ‰æœºä¼šä¼šåœ¨å…³äºå‡½æ•°ç¼–ç¨‹çš„ç« èŠ‚å†ç»™å¤§å®¶ç§‘æ™®, è¿™é‡Œæš‚æ—¶ä¸æ·±ç©¶äº†.
#+END_QUOTE

æˆ‘ä»¬æŠŠä¸Šé¢ connect çš„å‡½æ•°ä»£ç å•ç‹¬åˆ†ç¦»åˆ°ä¸€ä¸ªæ¨¡å—å½“ä¸­, åœ¨ src/ ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª react-redux.js, æŠŠä¸Šé¢çš„ connect å‡½æ•°çš„ä»£ç å¤åˆ¶è¿›å», ç„¶åå°±å¯ä»¥åœ¨ src/Header.js é‡Œé¢ä½¿ç”¨äº†:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'
import { connect } from './react-redux'

class Header extends Component {
  static propTypes = {
    themeColor: PropTypes.string
  }

  render () {
    return (
      <h1 style={{ color: this.props.themeColor }}>React.js å°ä¹¦</h1>
    )
  }
}

const mapStateToProps = (state) => {
  return {
    themeColor: state.themeColor
  }
}
Header = connect(mapStateToProps)(Header)

export default Header
#+END_SRC

å¯ä»¥çœ‹åˆ° Header åˆ æ‰äº†å¤§éƒ¨åˆ†å…³äº context çš„ä»£ç , å®ƒé™¤äº† props ä»€ä¹ˆä¹Ÿä¸ä¾èµ–, å®ƒæ˜¯ä¸€ä¸ª Pure Component, ç„¶åé€šè¿‡ connect å–å¾—æ•°æ®.
æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“ connect æ˜¯æ€ä¹ˆå’Œ context æ‰“äº¤é“çš„, åªè¦ä¼ ä¸€ä¸ª mapStateToProps å‘Šè¯‰å®ƒåº”è¯¥æ€ä¹ˆå–æ•°æ®å°±å¯ä»¥äº†. åŒæ ·çš„æ–¹å¼ä¿®æ”¹ src/Content.js:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'
import ThemeSwitch from './ThemeSwitch'
import { connect } from './react-redux'

class Content extends Component {
  static propTypes = {
    themeColor: PropTypes.string
  }

  render () {
    return (
      <div>
        <p style={{ color: this.props.themeColor }}>React.js å°ä¹¦å†…å®¹</p>
        <ThemeSwitch />
      </div>
    )
  }
}

const mapStateToProps = (state) => {
  return {
    themeColor: state.themeColor
  }
}
Content = connect(mapStateToProps)(Content)

export default Content
#+END_SRC

connect è¿˜æ²¡æœ‰ç›‘å¬æ•°æ®å˜åŒ–ç„¶åé‡æ–°æ¸²æŸ“, æ‰€ä»¥ç°åœ¨ç‚¹å‡»æŒ‰é’®åªæœ‰æŒ‰é’®ä¼šå˜é¢œè‰².
æˆ‘ä»¬ç»™ connect çš„é«˜é˜¶ç»„ä»¶å¢åŠ ç›‘å¬æ•°æ®å˜åŒ–é‡æ–°æ¸²æŸ“çš„é€»è¾‘, ç¨å¾®é‡æ„ä¸€ä¸‹ connect:

#+BEGIN_SRC javascript :results values list :exports no-eval
export const connect = (mapStateToProps) => (WrappedComponent) => {
  class Connect extends Component {
    static contextTypes = {
      store: PropTypes.object
    }

    constructor () {
      super()
      this.state = { allProps: {} }
    }

    componentWillMount () {
      const { store } = this.context
      this._updateProps()
      store.subscribe(() => this._updateProps())
    }

    _updateProps () {
      const { store } = this.context
      let stateProps = mapStateToProps(store.getState(), this.props) // é¢å¤–ä¼ å…¥ props, è®©è·å–æ•°æ®æ›´åŠ çµæ´»æ–¹ä¾¿
      this.setState({
        allProps: { // æ•´åˆæ™®é€šçš„ props å’Œä» state ç”Ÿæˆçš„ props
          ...stateProps,
          ...this.props
        }
      })
    }

    render () {
      return <WrappedComponent {...this.state.allProps} />
    }
  }

  return Connect
}
#+END_SRC

æˆ‘ä»¬åœ¨ Connect ç»„ä»¶çš„ constructor é‡Œé¢åˆå§‹åŒ–äº† state.allProps, å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡, ç”¨æ¥ä¿å­˜éœ€è¦ä¼ ç»™è¢«åŒ…è£…ç»„ä»¶çš„æ‰€æœ‰çš„å‚æ•°.
ç”Ÿå‘½å‘¨æœŸ componentWillMount ä¼šè°ƒç”¨è°ƒç”¨ _updateProps è¿›è¡Œåˆå§‹åŒ–, ç„¶åé€šè¿‡ store.subscribe ç›‘å¬æ•°æ®å˜åŒ–é‡æ–°è°ƒç”¨ _updateProps.

ä¸ºäº†è®© connect è¿”å›æ–°ç»„ä»¶å’Œè¢«åŒ…è£…çš„ç»„ä»¶ä½¿ç”¨å‚æ•°ä¿æŒä¸€è‡´, æˆ‘ä»¬ä¼šæŠŠæ‰€æœ‰ä¼ ç»™ Connect çš„ props åŸå°ä¸åŠ¨åœ°ä¼ ç»™ WrappedComponent.
æ‰€ä»¥åœ¨ _updateProps é‡Œé¢ä¼šæŠŠ stateProps å’Œ this.props åˆå¹¶åˆ° this.state.allProps é‡Œé¢, å†é€šè¿‡ render æ–¹æ³•æŠŠæ‰€æœ‰å‚æ•°éƒ½ä¼ ç»™ WrappedComponent.

mapStateToProps ä¹Ÿå‘ç”Ÿç‚¹å˜åŒ–, å®ƒç°åœ¨å¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°äº†, æˆ‘ä»¬ä¼šæŠŠä¼ ç»™ Connect ç»„ä»¶çš„ props å‚æ•°ä¹Ÿä¼ ç»™å®ƒ, é‚£ä¹ˆå®ƒç”Ÿæˆçš„å¯¹è±¡é…ç½®æ€§å°±æ›´å¼ºäº†,
æˆ‘ä»¬å¯ä»¥æ ¹æ® store é‡Œé¢çš„ state å’Œå¤–ç•Œä¼ å…¥çš„ props ç”Ÿæˆæˆ‘ä»¬æƒ³ä¼ ç»™è¢«åŒ…è£…ç»„ä»¶çš„å‚æ•°.

ç°åœ¨å·²ç»å¾ˆä¸é”™äº†,Header.js å’Œ Content.js çš„ä»£ç éƒ½å¤§å¤§å‡å°‘äº†, å¹¶ä¸”è¿™ä¸¤ä¸ªç»„ä»¶ connect ä¹‹å‰éƒ½æ˜¯ Dumb ç»„ä»¶. æ¥ä¸‹æ¥ä¼šç»§ç»­é‡æ„ ThemeSwitch.

* åŠ¨æ‰‹å®ç° React-redux(å››):mapDispatchToProps
åœ¨é‡æ„ ThemeSwitch çš„æ—¶å€™æˆ‘ä»¬å‘ç°, ThemeSwitch é™¤äº†éœ€è¦ store é‡Œé¢çš„æ•°æ®ä»¥å¤–, è¿˜éœ€è¦ store æ¥ dispatch:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
 // dispatch action å»æ”¹å˜é¢œè‰²
 handleSwitchColor (color) {
   const { store } = this.context
   store.dispatch({
     type: 'CHANGE_COLOR',
     themeColor: color
   })
 }
...
#+END_SRC

ç›®å‰ç‰ˆæœ¬çš„ connect æ˜¯è¾¾ä¸åˆ°è¿™ä¸ªæ•ˆæœçš„, æˆ‘ä»¬éœ€è¦æ”¹è¿›å®ƒ.

æƒ³ä¸€ä¸‹, æ—¢ç„¶å¯ä»¥é€šè¿‡ç»™ connect å‡½æ•°ä¼ å…¥ mapStateToProps æ¥å‘Šè¯‰å®ƒå¦‚ä½•è·å–, æ•´åˆçŠ¶æ€, æˆ‘ä»¬ä¹Ÿå¯ä»¥æƒ³åˆ°, å¯ä»¥ç»™å®ƒä¼ å…¥å¦å¤–ä¸€ä¸ªå‚æ•°æ¥å‘Šè¯‰å®ƒæˆ‘ä»¬çš„ç»„ä»¶éœ€è¦å¦‚ä½•è§¦å‘ dispatch. æˆ‘ä»¬æŠŠè¿™ä¸ªå‚æ•°å« mapDispatchToProps:

#+BEGIN_SRC javascript :results values list :exports no-eval
const mapDispatchToProps = (dispatch) => {
  return {
    onSwitchColor: (color) => {
      dispatch({ type: 'CHANGE_COLOR', themeColor: color })
    }
  }
}
#+END_SRC

å’Œ mapStateToProps ä¸€æ ·, å®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡, è¿™ä¸ªå¯¹è±¡å†…å®¹ä¼šåŒæ ·è¢« connect å½“ä½œæ˜¯ props å‚æ•°ä¼ ç»™è¢«åŒ…è£…çš„ç»„ä»¶.
ä¸ä¸€æ ·çš„æ˜¯, è¿™ä¸ªå‡½æ•°ä¸æ˜¯æ¥å— state ä½œä¸ºå‚æ•°, è€Œæ˜¯ dispatch, ä½ å¯ä»¥åœ¨è¿”å›çš„å¯¹è±¡å†…éƒ¨å®šä¹‰ä¸€äº›å‡½æ•°, è¿™äº›å‡½æ•°ä¼šç”¨åˆ° dispatch æ¥è§¦å‘ç‰¹å®šçš„ action.

è°ƒæ•´ connect è®©å®ƒèƒ½æ¥å—è¿™æ ·çš„ mapDispatchToProps:

#+CAPTION: connect
#+BEGIN_SRC javascript :results values list :exports no-eval
export const connect = (mapStateToProps, mapDispatchToProps) => (WrappedComponent) => {
  class Connect extends Component {
    static contextTypes = {
      store: PropTypes.object
    }

    constructor () {
      super()
      this.state = {
        allProps: {}
      }
    }

    componentWillMount () {
      const { store } = this.context
      this._updateProps()
      store.subscribe(() => this._updateProps())
    }

    _updateProps () {
      const { store } = this.context
      let stateProps = mapStateToProps
        ? mapStateToProps(store.getState(), this.props)
        : {} // é˜²æ­¢ mapStateToProps æ²¡æœ‰ä¼ å…¥
      let dispatchProps = mapDispatchToProps
        ? mapDispatchToProps(store.dispatch, this.props)
        : {} // é˜²æ­¢ mapDispatchToProps æ²¡æœ‰ä¼ å…¥
      this.setState({
        allProps: {
          ...stateProps,
          ...dispatchProps,
          ...this.props
        }
      })
    }

    render () {
      return <WrappedComponent {...this.state.allProps} />
    }
  }
  return Connect
}
#+END_SRC
<<connect>>

åœ¨ _updateProps å†…éƒ¨, æˆ‘ä»¬æŠŠ store.dispatch ä½œä¸ºå‚æ•°ä¼ ç»™ mapDispatchToProps, å®ƒä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ dispatchProps.
æ¥ç€æŠŠ stateProps, dispatchProps, this.props ä¸‰è€…åˆå¹¶åˆ° this.state.allProps é‡Œé¢å», è¿™ä¸‰è€…çš„å†…å®¹éƒ½ä¼šåœ¨ render å‡½æ•°å†…å…¨éƒ¨ä¼ ç»™è¢«åŒ…è£…çš„ç»„ä»¶.

å¦å¤–, æˆ‘ä»¬ç¨å¾®è°ƒæ•´äº†ä¸€ä¸‹, åœ¨è°ƒç”¨ mapStateToProps å’Œ mapDispatchToProps ä¹‹å‰åšåˆ¤æ–­, è®©è¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¯ä»¥ç¼ºçœçš„, è¿™æ ·å³ä½¿ä¸ä¼ è¿™ä¸¤ä¸ªå‚æ•°ç¨‹åºä¹Ÿä¸ä¼šæŠ¥é”™.

è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é‡æ„ ThemeSwitch, è®©å®ƒæ‘†è„± store.dispatch:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'
import { connect } from './react-redux'

class ThemeSwitch extends Component {
  static propTypes = {
    themeColor: PropTypes.string,
    onSwitchColor: PropTypes.func
  }

  handleSwitchColor (color) {
    if (this.props.onSwitchColor) {
      this.props.onSwitchColor(color)
    }
  }

  render () {
    return (
      <div>
        <button
          style={{ color: this.props.themeColor }}
          onClick={this.handleSwitchColor.bind(this, 'red')}>Red</button>
        <button
          style={{ color: this.props.themeColor }}
          onClick={this.handleSwitchColor.bind(this, 'blue')}>Blue</button>
      </div>
    )
  }
}

const mapStateToProps = (state) => {
  return {
    themeColor: state.themeColor
  }
}
const mapDispatchToProps = (dispatch) => {
  return {
    onSwitchColor: (color) => {
      dispatch({ type: 'CHANGE_COLOR', themeColor: color })
    }
  }
}

ThemeSwitch = connect(mapStateToProps, mapDispatchToProps)(ThemeSwitch)

export default ThemeSwitch
#+END_SRC

å…‰çœ‹ ThemeSwitch å†…éƒ¨, æ˜¯éå¸¸æ¸…çˆ½å¹²å‡€çš„, åªä¾èµ–å¤–ç•Œä¼ è¿›æ¥çš„ themeColor å’Œ onSwitchColor.
ä½†æ˜¯ ThemeSwitch å†…éƒ¨å¹¶ä¸çŸ¥é“è¿™ä¸¤ä¸ªå‚æ•°å…¶å®éƒ½æ˜¯æˆ‘ä»¬å» store é‡Œé¢å–çš„, å®ƒæ˜¯ Dumb çš„.
è¿™æ—¶å€™è¿™ä¸‰ä¸ªç»„ä»¶çš„é‡æ„éƒ½å·²ç»å®Œæˆäº†, ä»£ç å¤§å¤§å‡å°‘, ä¸ä¾èµ– context, å¹¶ä¸”åŠŸèƒ½å’ŒåŸæ¥ä¸€æ ·.

* åŠ¨æ‰‹å®ç° React-redux(äº”):Provider
æˆ‘ä»¬è¦æŠŠ context ç›¸å…³çš„ä»£ç ä»æ‰€æœ‰ä¸šåŠ¡ç»„ä»¶ä¸­æ¸…é™¤å‡ºå», ç°åœ¨çš„ä»£ç é‡Œé¢è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹æ˜¯è¢«æ±¡æŸ“çš„. é‚£å°±æ˜¯ src/index.js é‡Œé¢çš„ Index:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
 class Index extends Component {
   static childContextTypes = {
     store: PropTypes.object
   }

   getChildContext () {
     return { store }
   }

   render () {
     return (
       <div>
         <Header />
         <Content />
       </div>
     )
   }
 }
...
#+END_SRC

å…¶å®å®ƒè¦ç”¨ context å°±æ˜¯å› ä¸ºè¦æŠŠ store å­˜æ”¾åˆ°é‡Œé¢, å¥½è®©å­ç»„ä»¶ connect çš„æ—¶å€™èƒ½å¤Ÿå–åˆ° store.
æˆ‘ä»¬å¯ä»¥é¢å¤–æ„å»ºä¸€ä¸ªç»„ä»¶æ¥åšè¿™ç§è„æ´», ç„¶åè®©è¿™ä¸ªç»„ä»¶æˆä¸ºç»„ä»¶æ ‘çš„æ ¹èŠ‚ç‚¹, é‚£ä¹ˆå®ƒçš„å­ç»„ä»¶éƒ½å¯ä»¥è·å–åˆ° context äº†.

æˆ‘ä»¬æŠŠè¿™ä¸ªç»„ä»¶å« Provider, å› ä¸ºå®ƒæä¾›(provide) äº† store:

[[file:./static/React.js å°ä¹¦/687474703a2f2f68757a69646168612e6769746875622e696f2f7374617469632f6173736574732f696d672f706f7374732f42354444304238352d363131392d344243332d393632362d3539453536344234353237352e706e67.png]]

åœ¨ src/react-redux.js æ–°å¢ä»£ç :

#+CAPTION: Provider
#+BEGIN_SRC javascript :results values list :exports no-eval
export class Provider extends Component {
  static propTypes = {
    store: PropTypes.object,
    children: PropTypes.any
  }

  static childContextTypes = {
    store: PropTypes.object
  }

  getChildContext () {
    return {
      store: this.props.store
    }
  }

  render () {
    return (
      <div>{this.props.children}</div>
    )
  }
}
#+END_SRC
<<Provider>>

Provider åšçš„äº‹æƒ…ä¹Ÿå¾ˆç®€å•, å®ƒå°±æ˜¯ä¸€ä¸ªå®¹å™¨ç»„ä»¶, ä¼šæŠŠåµŒå¥—çš„å†…å®¹åŸå°ä¸åŠ¨ä½œä¸ºè‡ªå·±çš„å­ç»„ä»¶æ¸²æŸ“å‡ºæ¥.
å®ƒè¿˜ä¼šæŠŠå¤–ç•Œä¼ ç»™å®ƒçš„ props.store æ”¾åˆ° context, è¿™æ ·å­ç»„ä»¶ connect çš„æ—¶å€™éƒ½å¯ä»¥è·å–åˆ°.

å¯ä»¥ç”¨å®ƒæ¥é‡æ„æˆ‘ä»¬çš„ src/index.js:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
 // å¤´éƒ¨å¼•å…¥ Provider
 import { Provider } from './react-redux'
...

 // åˆ é™¤ Index é‡Œé¢æ‰€æœ‰å…³äº context çš„ä»£ç 
class Index extends Component {
 render () {
   return (
     <div>
       <Header />
       <Content />
     </div>
   )
 }
}

// æŠŠ Provider ä½œä¸ºç»„ä»¶æ ‘çš„æ ¹èŠ‚ç‚¹
ReactDOM.render(
  <Provider store={store}>
    <Index />
  </Provider>,
  document.getElementById('root')
)
#+END_SRC

è¿™æ ·æˆ‘ä»¬å°±æŠŠæ‰€æœ‰å…³äº context çš„ä»£ç ä»ç»„ä»¶é‡Œé¢åˆ é™¤äº†.

* åŠ¨æ‰‹å®ç° React-redux(å…­):React-redux æ€»ç»“
åˆ°è¿™é‡Œå¤§å®¶å·²ç»æŒæ¡äº† React-redux çš„åŸºæœ¬ç”¨æ³•å’Œæ¦‚å¿µ, å¹¶ä¸”è‡ªå·±åŠ¨æ‰‹å®ç°äº†ä¸€ä¸ª React-redux, æˆ‘ä»¬å›é¡¾ä¸€ä¸‹è¿™å‡ èŠ‚éƒ½å¹²äº†ä»€ä¹ˆäº‹æƒ….

React.js é™¤äº†çŠ¶æ€æå‡ä»¥å¤–å¹¶æ²¡æœ‰æ›´å¥½çš„åŠæ³•å¸®æˆ‘ä»¬è§£å†³ç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€çš„é—®é¢˜, è€Œä½¿ç”¨ context å…¨å±€å˜é‡è®©ç¨‹åºä¸å¯é¢„æµ‹.
é€šè¿‡ Redux çš„ç« èŠ‚, æˆ‘ä»¬çŸ¥é“ store é‡Œé¢çš„å†…å®¹æ˜¯ä¸å¯ä»¥éšæ„ä¿®æ”¹çš„, è€Œæ˜¯é€šè¿‡ dispatch æ‰èƒ½å˜æ›´é‡Œé¢çš„ state.
æ‰€ä»¥æˆ‘ä»¬å°è¯•æŠŠ store å’Œ context ç»“åˆèµ·æ¥ä½¿ç”¨, å¯ä»¥å…¼é¡¾ç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€é—®é¢˜å’Œå…±äº«çŠ¶æ€å¯èƒ½è¢«ä»»æ„ä¿®æ”¹çš„é—®é¢˜.

ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„ store å’Œ context ç»“åˆæœ‰è¯¸å¤šç¼ºé™·, æœ‰å¤§é‡çš„é‡å¤é€»è¾‘å’Œå¯¹ context çš„ä¾èµ–æ€§è¿‡å¼º.
æˆ‘ä»¬å°è¯•é€šè¿‡æ„å»ºä¸€ä¸ªé«˜é˜¶ç»„ä»¶ connect å‡½æ•°çš„æ–¹å¼, æŠŠæ‰€æœ‰çš„é‡å¤é€»è¾‘å’Œå¯¹ context çš„ä¾èµ–æ”¾åœ¨é‡Œé¢ connect å‡½æ•°é‡Œé¢, è€Œå…¶ä»–ç»„ä»¶ä¿æŒ Pure(Dumb) çš„çŠ¶æ€,
è®© connect è·Ÿ context æ‰“äº¤é“, ç„¶åé€šè¿‡ props æŠŠå‚æ•°ä¼ ç»™æ™®é€šçš„ç»„ä»¶.

è€Œæ¯ä¸ªç»„ä»¶éœ€è¦çš„æ•°æ®å’Œéœ€è¦è§¦å‘çš„ action éƒ½ä¸ä¸€æ ·, æ‰€ä»¥è°ƒæ•´ connect, è®©å®ƒå¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•° mapStateToProps å’Œ mapDispatchToProps,
åˆ†åˆ«ç”¨äºå‘Šè¯‰ connect è¿™ä¸ªç»„ä»¶éœ€è¦ä»€ä¹ˆæ•°æ®å’Œéœ€è¦è§¦å‘ä»€ä¹ˆ action.

æœ€åä¸ºäº†æŠŠæ‰€æœ‰å…³äº context çš„ä»£ç å®Œå…¨ä»æˆ‘ä»¬ä¸šåŠ¡é€»è¾‘é‡Œé¢æ¸…é™¤æ‰, æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ª Provider ç»„ä»¶.
Provider ä½œä¸ºæ‰€æœ‰ç»„ä»¶æ ‘çš„æ ¹èŠ‚ç‚¹, å¤–ç•Œå¯ä»¥é€šè¿‡ props ç»™å®ƒæä¾› store, å®ƒä¼šæŠŠ store æ”¾åˆ°è‡ªå·±çš„ context é‡Œé¢, å¥½è®©å­ç»„ä»¶ connect çš„æ—¶å€™éƒ½èƒ½å¤Ÿè·å–åˆ°.

è¿™å‡ èŠ‚çš„æˆæœå°±æ˜¯ react-redux.js è¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„ä¸¤ä¸ªå†…å®¹:connect å‡½æ•°å’Œ Provider å®¹å™¨ç»„ä»¶.
è¿™å°±æ˜¯ React-redux çš„åŸºæœ¬å†…å®¹, å½“ç„¶å®ƒæ˜¯ä¸€ä¸ªæ®‹ç–¾ç‰ˆæœ¬çš„ React-redux, å¾ˆå¤šåœ°æ–¹éœ€è¦å®Œå–„.
ä¾‹å¦‚ä¸Šå‡ èŠ‚æåˆ°çš„æ€§èƒ½é—®é¢˜, ç°åœ¨ä¸ç›¸å…³çš„æ•°æ®å˜åŒ–çš„æ—¶å€™å…¶å®æ‰€æœ‰ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“çš„, è¿™ä¸ªæ€§èƒ½ä¼˜åŒ–ç•™ç»™è¯»è€…åšç»ƒä¹ .

é€šè¿‡è¿™ç§æ–¹å¼å¤§å®¶ä¸ä»…ä»…çŸ¥é“äº† React-redux çš„åŸºç¡€æ¦‚å¿µå’Œç”¨æ³•, è€Œä¸”è¿˜çŸ¥é“è¿™äº›æ¦‚å¿µåˆ°åº•æ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜, ä¸ºä»€ä¹ˆ React-redux è¿™ä¹ˆå¥‡æ€ª,
ä¸ºä»€ä¹ˆè¦ connect, ä¸ºä»€ä¹ˆè¦ mapStateToProps å’Œ mapDispatchToProps, ä»€ä¹ˆæ˜¯ Provider, æˆ‘ä»¬é€šè¿‡è§£å†³ä¸€ä¸ªä¸ªé—®é¢˜å°±çŸ¥é“å®ƒä»¬åˆ°åº•ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡çš„äº†.
* ä½¿ç”¨çœŸæ­£çš„ Redux å’Œ React-redux
ç°åœ¨ make-react-redux å·¥ç¨‹ä»£ç ä¸­çš„ Redux å’Œ React-redux éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„, ç°åœ¨è®©æˆ‘ä»¬æ¥ä½¿ç”¨çœŸæ­£çš„å®˜æ–¹ç‰ˆæœ¬çš„ Redux å’Œ React-redux.

åœ¨å·¥ç¨‹ç›®å½•ä¸‹ä½¿ç”¨ npm å®‰è£… Redux å’Œ React-redux æ¨¡å—:

#+BEGIN_SRC javascript :results values list :exports no-eval
npm install redux react-redux --save
#+END_SRC

æŠŠ src/ ç›®å½•ä¸‹ Header.js,ThemeSwitch.js,Content.js çš„æ¨¡å—å¯¼å…¥ä¸­çš„:

#+BEGIN_SRC javascript :results values list :exports no-eval
import { connect } from './react-redux'
#+END_SRC

æ”¹æˆ:

#+BEGIN_SRC javascript :results values list :exports no-eval
import { connect } from 'react-redux'
#+END_SRC

ä¹Ÿå°±æ˜¯æœ¬æ¥ä»æœ¬åœ° ./react-redux å¯¼å…¥çš„ connect æ”¹æˆä»ç¬¬ä¸‰æ–¹ react-redux æ¨¡å—ä¸­å¯¼å…¥.

ä¿®æ”¹ src/index.js, æŠŠå‰é¢éƒ¨åˆ†çš„ä»£ç è°ƒæ•´ä¸º:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import ReactDOM from 'react-dom'
import { createStore } from 'redux'
import { Provider } from 'react-redux'
import Header from './Header'
import Content from './Content'
import './index.css'

const themeReducer = (state, action) => {
  if (!state) return {
    themeColor: 'red'
  }
  switch (action.type) {
    case 'CHANGE_COLOR':
      return { ...state, themeColor: action.themeColor }
    default:
      return state
  }
}

const store = createStore(themeReducer)

...
#+END_SRC

æˆ‘ä»¬åˆ é™¤äº†è‡ªå·±å†™çš„ createStore, æ”¹æˆä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å— redux çš„ createStore,Provider æœ¬æ¥ä»æœ¬åœ°çš„ ./react-redux å¼•å…¥,
æ”¹æˆä»ç¬¬ä¸‰æ–¹ react-redux æ¨¡å—ä¸­å¼•å…¥. å…¶ä½™ä»£ç ä¿æŒä¸å˜.

æ¥ç€åˆ é™¤ src/react-redux.js, å®ƒçš„å·²ç»ç”¨å¤„ä¸å¤§äº†. æœ€åå¯åŠ¨å·¥ç¨‹ npm start:

#+DOWNLOADED: https://huzidaha.github.io/static/assets/img/posts/A6103C15-A0C3-4540-9147-67ABC24FCD48.png @ 2019-06-25 21:56:56
[[file:./static/React.js å°ä¹¦/A6103C15-A0C3-4540-9147-67ABC24FCD48_2019-06-25_21-56-56.png]]

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åŸæ¥çš„ä¸šåŠ¡ä»£ç å…¶å®éƒ½æ²¡æœ‰å¤ªå¤šçš„æ”¹åŠ¨, å®é™…ä¸Šæˆ‘ä»¬å®ç°çš„ redux å’Œ react-redux å’Œå®˜æ–¹ç‰ˆæœ¬åœ¨è¯¥åœºæ™¯çš„ç”¨æ³•ä¸Šæ˜¯å…¼å®¹çš„.
æ¥ä¸‹æ¥çš„ç« èŠ‚æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨å®˜æ–¹ç‰ˆæœ¬çš„ redux å’Œ react-redux.
* Smart ç»„ä»¶ vs Dumb ç»„ä»¶
å¤§å®¶å·²ç»çŸ¥é“, åªä¼šæ¥å— props å¹¶ä¸”æ¸²æŸ“ç¡®å®šç»“æœçš„ç»„ä»¶æˆ‘ä»¬æŠŠå®ƒå«åš Dumb ç»„ä»¶, è¿™ç§ç»„ä»¶åªå…³å¿ƒä¸€ä»¶äº‹æƒ… â€”â€” æ ¹æ® props è¿›è¡Œæ¸²æŸ“.

Dumb ç»„ä»¶æœ€å¥½ä¸è¦ä¾èµ–é™¤äº† React.js å’Œ Dumb ç»„ä»¶ä»¥å¤–çš„å†…å®¹.
å®ƒä»¬ä¸è¦ä¾èµ– Redux ä¸è¦ä¾èµ– React-redux. è¿™æ ·çš„ç»„ä»¶çš„å¯å¤ç”¨æ€§æ˜¯æœ€å¥½çš„, å…¶ä»–äººå¯ä»¥å®‰å¿ƒåœ°ä½¿ç”¨è€Œä¸ç”¨æ€•ä¼šå¼•å…¥ä»€ä¹ˆå¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿.

å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªéœ€æ±‚å¼€å§‹åˆ’åˆ†ç»„ä»¶çš„æ—¶å€™, è¦è®¤çœŸè€ƒè™‘æ¯ä¸ªè¢«åˆ’åˆ†æˆç»„ä»¶çš„å•å…ƒåˆ°åº•ä¼šä¸ä¼šè¢«å¤ç”¨. å¦‚æœè¿™ä¸ªç»„ä»¶å¯èƒ½ä¼šåœ¨å¤šå¤„è¢«ä½¿ç”¨åˆ°, é‚£ä¹ˆæˆ‘ä»¬å°±æŠŠå®ƒåšæˆ Dumb ç»„ä»¶.

æˆ‘ä»¬å¯èƒ½æ‹†åˆ†äº†ä¸€å † Dumb ç»„ä»¶å‡ºæ¥. ä½†æ˜¯å•çº¯é  Dumb æ˜¯æ²¡æœ‰åŠæ³•æ„å»ºåº”ç”¨ç¨‹åºçš„, å› ä¸ºå®ƒä»¬å®åœ¨å¤ª" ç¬¨" äº†, å¯¹æ•°æ®çš„åŠ›é‡ä¸€æ— æ‰€çŸ¥.
æ‰€ä»¥è¿˜æœ‰ä¸€ç§ç»„ä»¶, å®ƒä»¬éå¸¸èªæ˜(smart), åŸåºœå¾ˆæ·±ç²¾é€šç®—è®¡, æˆ‘ä»¬å«å®ƒä»¬ Smart ç»„ä»¶.
å®ƒä»¬ä¸“é—¨åšæ•°æ®ç›¸å…³çš„åº”ç”¨é€»è¾‘, å’Œå„ç§æ•°æ®æ‰“äº¤é“, å’Œ Ajax æ‰“äº¤é“, ç„¶åæŠŠæ•°æ®é€šè¿‡ props ä¼ é€’ç»™ Dumb, å®ƒä»¬å¸¦é¢†ç€ Dumb ç»„ä»¶å®Œæˆäº†å¤æ‚çš„åº”ç”¨ç¨‹åºé€»è¾‘.

#+DOWNLOADED: https://huzidaha.github.io/static/assets/img/posts/25608378-BE07-4050-88B1-72025085875A.png @ 2019-06-25 22:04:57
[[file:./static/React.js å°ä¹¦/25608378-BE07-4050-88B1-72025085875A.png]]

Smart ç»„ä»¶ä¸ç”¨è€ƒè™‘å¤ªå¤šå¤ç”¨æ€§é—®é¢˜, å®ƒä»¬å°±æ˜¯ç”¨æ¥æ‰§è¡Œç‰¹å®šåº”ç”¨é€»è¾‘çš„.Smart ç»„ä»¶å¯èƒ½ç»„åˆäº† Smart ç»„ä»¶å’Œ Dumb ç»„ä»¶, ä½†æ˜¯ Dumb ç»„ä»¶å°½é‡ä¸è¦ä¾èµ– Smart ç»„ä»¶. å› ä¸º Dumb ç»„ä»¶ç›®çš„ä¹‹ä¸€æ˜¯ä¸ºäº†å¤ç”¨, ä¸€æ—¦å®ƒå¼•ç”¨äº† Smart ç»„ä»¶å°±ç›¸å½“äºå¸¦å…¥äº†ä¸€å †åº”ç”¨é€»è¾‘, å¯¼è‡´å®ƒæ— æ³•æ— ç”¨, æ‰€ä»¥å°½é‡ä¸è¦å¹²è¿™ç§äº‹æƒ…. ä¸€æ—¦ä¸€ä¸ªå¯å¤ç”¨çš„ Dumb ç»„ä»¶ä¹‹ä¸‹å¼•ç”¨äº†ä¸€ä¸ª Smart ç»„ä»¶, å°±ç›¸å½“äºæ±¡æŸ“äº†è¿™ä¸ª Dumb ç»„ä»¶æ ‘. å¦‚æœä¸€ä¸ªç»„ä»¶æ˜¯ Dumb çš„, é‚£ä¹ˆå®ƒçš„å­ç»„ä»¶ä»¬éƒ½åº”è¯¥æ˜¯ Dumb çš„æ‰å¯¹.

** åˆ’åˆ† Smart å’Œ Dumb ç»„ä»¶
 çŸ¥é“äº†ç»„ä»¶æœ‰è¿™ä¸¤ç§åˆ†ç±»ä»¥å, æˆ‘ä»¬æ¥é‡æ–°å®¡è§†ä¸€ä¸‹ä¹‹å‰çš„ make-react-redux å·¥ç¨‹é‡Œé¢çš„ç»„ä»¶, ä¾‹å¦‚ src/Header.js:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'
 import PropTypes from 'prop-types'
 import { connect } from 'react-redux'

 class Header extends Component {
   static propTypes = {
     themeColor: PropTypes.string
   }

   render () {
     return (
       <h1 style={{ color: this.props.themeColor }}>React.js å°ä¹¦</h1>
     )
   }
 }

 const mapStateToProps = (state) => {
   return {
     themeColor: state.themeColor
   }
 }

 Header = connect(mapStateToProps)(Header)

 export default Header
 #+END_SRC

 è¿™ä¸ªç»„ä»¶åˆ°åº•æ˜¯ Smart è¿˜æ˜¯ Dumb ç»„ä»¶? è¿™ä¸ªæ–‡ä»¶å…¶å®ä¾èµ–äº† react-redux, åˆ«äººä½¿ç”¨çš„æ—¶å€™å…¶å®ä¼šå¸¦ä¸Šè¿™ä¸ªä¾èµ–, æ‰€ä»¥è¿™ä¸ªç»„ä»¶ä¸èƒ½å« Dumb ç»„ä»¶.
 ä½†æ˜¯ä½ è§‚å¯Ÿä¸€ä¸‹, è¿™ä¸ªç»„ä»¶åœ¨ connect ä¹‹å‰å®ƒå´æ˜¯ Dumb çš„, å°±æ˜¯å› ä¸º connect äº†å¯¼è‡´å®ƒå’Œ context æ‰¯ä¸Šäº†å…³ç³», å¯¼è‡´å®ƒå˜ Smart äº†, ä¹Ÿä½¿å¾—è¿™ä¸ªç»„ä»¶æ²¡æœ‰äº†å¾ˆå¥½çš„å¤ç”¨æ€§.

 ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, æˆ‘ä»¬æŠŠ Smart å’Œ Dumb ç»„ä»¶åˆ†å¼€åˆ°ä¸¤ä¸ªä¸åŒçš„ç›®å½•, ä¸å†åœ¨ Dumb ç»„ä»¶å†…éƒ¨è¿›è¡Œ connect,
 åœ¨ src/ ç›®å½•ä¸‹æ–°å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹ components/ å’Œ containers/:

 #+BEGIN_SRC
 src/
    components/
    containers/
 #+END_SRC

 æˆ‘ä»¬è§„å®š: æ‰€æœ‰çš„ Dumb ç»„ä»¶éƒ½æ”¾åœ¨ components/ ç›®å½•ä¸‹, æ‰€æœ‰çš„ Smart çš„ç»„ä»¶éƒ½æ”¾åœ¨ containers/ ç›®å½•ä¸‹, è¿™æ˜¯ä¸€ç§çº¦å®šä¿—æˆçš„è§„åˆ™.

 åˆ é™¤ src/Header.js, æ–°å¢ src/components/Header.js:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'
 import PropTypes from 'prop-types'

 export default class Header extends Component {
   static propTypes = {
     themeColor: PropTypes.string
   }

   render () {
     return (
       <h1 style={{ color: this.props.themeColor }}>React.js å°ä¹¦</h1>
     )
   }
 }
 #+END_SRC

 ç°åœ¨ src/components/Header.js æ¯«æ— ç–‘é—®æ˜¯ä¸€ä¸ª Dumb ç»„ä»¶, å®ƒé™¤äº†ä¾èµ– React.js ä»€ä¹ˆéƒ½ä¸ä¾èµ–.
 æˆ‘ä»¬æ–°å»º src/container/Header.js, è¿™æ˜¯ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„ Smart ç»„ä»¶:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import { connect } from 'react-redux'
 import Header from '../components/Header'

 const mapStateToProps = (state) => {
   return {
     themeColor: state.themeColor
   }
 }
 export default connect(mapStateToProps)(Header)
 #+END_SRC

 å®ƒä¼šä»å¯¼å…¥ Dumb çš„ Header.js ç»„ä»¶, è¿›è¡Œ connect ä¸€ç•ªå˜æˆ Smart ç»„ä»¶, ç„¶åæŠŠå®ƒå¯¼å‡ºæ¨¡å—.

 è¿™æ ·æˆ‘ä»¬å°±æŠŠ Dumb ç»„ä»¶æŠ½ç¦»å‡ºæ¥äº†, ç°åœ¨ src/components/Header.js å¯å¤ç”¨æ€§éå¸¸å¼º, åˆ«çš„åŒäº‹å¯ä»¥éšæ„ç”¨å®ƒ.
 è€Œ src/containers/Header.js åˆ™æ˜¯è·Ÿä¸šåŠ¡ç›¸å…³çš„, æˆ‘ä»¬åªç”¨åœ¨ç‰¹å®šçš„åº”ç”¨åœºæ™¯ä¸‹. æˆ‘ä»¬å¯ä»¥ç»§ç»­ç”¨è¿™ç§æ–¹å¼æ¥é‡æ„å…¶ä»–ç»„ä»¶.

** ç»„ä»¶åˆ’åˆ†åŸåˆ™
 æ¥ä¸‹æ¥çš„æƒ…å†µå°±æœ‰ç‚¹æ„æ€äº†, å¯ä»¥è¶æœºç»™å¤§å®¶è®²è§£ä¸€ä¸‹ç»„ä»¶åˆ’åˆ†çš„ä¸€äº›åŸåˆ™. æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªåº”ç”¨åŸæ¥çš„ç»„ä»¶æ ‘:

 [[file:./static/React.js å°ä¹¦/9271BF94-6599-4F73-A814-0DDA20B634D9.png]]

 å¯¹äº Content è¿™ä¸ªç»„ä»¶, å¯ä»¥çœ‹åˆ°å®ƒæ˜¯ä¾èµ– ThemeSwitch ç»„ä»¶çš„, è¿™å°±éœ€è¦å¥½å¥½æ€è€ƒä¸€ä¸‹äº†.
 æˆ‘ä»¬åˆ†ä¸¤ç§æƒ…å†µæ¥è®¨è®º:Content ä¸å¤ç”¨å’Œå¯å¤ç”¨.

*** Content ä¸å¤ç”¨
  å¦‚æœäº§å“åœºæ™¯å¹¶æ²¡æœ‰è¦æ±‚è¯´ Content éœ€è¦å¤ç”¨, å®ƒåªæ˜¯åœ¨ç‰¹å®šä¸šåŠ¡éœ€è¦è€Œå·².
  é‚£ä¹ˆæ²¡æœ‰å¿…è¦æŠŠ Content åšæˆ Dumb ç»„ä»¶äº†, å°±è®©å®ƒæˆä¸ºä¸€ä¸ª Smart ç»„ä»¶.
  å› ä¸º Smart ç»„ä»¶æ˜¯å¯ä»¥ä½¿ç”¨ Smart ç»„ä»¶çš„, æ‰€ä»¥ Content å¯ä»¥ä½¿ç”¨ Dumb çš„ ThemeSwitch ç»„ä»¶ connect çš„ç»“æœ.

  æ–°å»ºä¸€ä¸ª src/components/ThemeSwitch.js:

  #+BEGIN_SRC javascript :results values list :exports no-eval
  import React, { Component } from 'react'
  import PropTypes from 'prop-types'

  export default class ThemeSwitch extends Component {
    static propTypes = {
      themeColor: PropTypes.string,
      onSwitchColor: PropTypes.func
    }

    handleSwitchColor (color) {
      if (this.props.onSwitchColor) {
        this.props.onSwitchColor(color)
      }
    }

    render () {
      return (
        <div>
          <button
            style={{ color: this.props.themeColor }}
            onClick={this.handleSwitchColor.bind(this, 'red')}>Red</button>
          <button
            style={{ color: this.props.themeColor }}
            onClick={this.handleSwitchColor.bind(this, 'blue')}>Blue</button>
        </div>
      )
    }
  }
  #+END_SRC

  è¿™æ˜¯ä¸€ä¸ª Dumb çš„ ThemeSwitch.
  æ–°å»ºä¸€ä¸ª src/containers/ThemeSwitch.js:

  #+BEGIN_SRC javascript :results values list :exports no-eval
  import { connect } from 'react-redux'
  import ThemeSwitch from '../components/ThemeSwitch'

  const mapStateToProps = (state) => {
    return {
      themeColor: state.themeColor
    }
  }

  const mapDispatchToProps = (dispatch) => {
    return {
      onSwitchColor: (color) => {
        dispatch({ type: 'CHANGE_COLOR', themeColor: color })
      }
    }
  }

  export default connect(mapStateToProps, mapDispatchToProps)(ThemeSwitch)
  #+END_SRC

  è¿™æ˜¯ä¸€ä¸ª Smart çš„ ThemeSwitch. ç„¶åç”¨ä¸€ä¸ª Smart çš„ Content å»ä½¿ç”¨å®ƒ, æ–°å»º src/containers/Content.js:

  #+BEGIN_SRC javascript :results values list :exports no-eval
  import React, { Component } from 'react'
  import PropTypes from 'prop-types'
  import ThemeSwitch from './ThemeSwitch'
  import { connect } from 'react-redux'

  class Content extends Component {
    static propTypes = {
      themeColor: PropTypes.string
    }

    render () {
      return (
        <div>
          <p style={{ color: this.props.themeColor }}>React.js å°ä¹¦å†…å®¹</p>
          <ThemeSwitch />
        </div>
      )
    }
  }

  const mapStateToProps = (state) => {
    return {
      themeColor: state.themeColor
    }
  }

  export default connect(mapStateToProps)(Content)
  #+END_SRC

  åˆ é™¤ src/ThemeSwitch.js å’Œ src/Content.js, åœ¨ src/index.js ä¸­ç›´æ¥ä½¿ç”¨ Smart ç»„ä»¶:

  #+BEGIN_SRC javascript :results values list :exports no-eval
  ...
  import Header from './containers/Header'
  import Content from './containers/Content'
  ...
  #+END_SRC

  è¿™æ ·å°±æŠŠè¿™ç§ä¸šåŠ¡åœºæ™¯ä¸‹çš„ Smart å’Œ Dumb ç»„ä»¶åˆ†ç¦»å¼€æ¥äº†:

  #+BEGIN_SRC
  src
   â”œâ”€â”€ components
   â”‚   â”œâ”€â”€ Header.js
   â”‚   â””â”€â”€ ThemeSwitch.js
   â”œâ”€â”€ containers
   â”‚   â”œâ”€â”€ Content.js
   â”‚   â”œâ”€â”€ Header.js
   â”‚   â””â”€â”€ ThemeSwitch.js
   â””â”€â”€ index.js
  #+END_SRC

*** Content å¯å¤ç”¨
  å¦‚æœäº§å“åœºæ™¯è¦æ±‚ Content å¯èƒ½ä¼šè¢«å¤ç”¨, é‚£ä¹ˆ Content å°±è¦æ˜¯ Dumb çš„.
  é‚£ä¹ˆ Content çš„ä¹‹ä¸‹çš„å­ç»„ä»¶ ThemeSwitch å°±ä¸€å®šè¦æ˜¯ Dumb, å¦åˆ™ Content å°±æ²¡æ³•å¤ç”¨äº†.
  è¿™å°±æ„å‘³ç€ ThemeSwitch ä¸èƒ½ connect, å³ä½¿ä½  connect äº†,Content ä¹Ÿä¸èƒ½ä½¿ç”¨ä½  connect çš„ç»“æœ, å› ä¸º connect çš„ç»“æœæ˜¯ä¸ª Smart ç»„ä»¶.

  è¿™æ—¶å€™ ThemeSwitch çš„æ•°æ®,onSwitchColor å‡½æ•°åªèƒ½é€šè¿‡å®ƒçš„çˆ¶ç»„ä»¶ä¼ è¿›æ¥, è€Œä¸æ˜¯é€šè¿‡ connect è·å¾—.
  æ‰€ä»¥åªèƒ½è®© Content ç»„ä»¶å» connect, ç„¶åè®©å®ƒæŠŠæ•°æ®, å‡½æ•°ä¼ ç»™ ThemeSwitch.

  è¿™ç§åœºæ™¯ä¸‹çš„æ”¹é€ ç•™ç»™å¤§å®¶åšç»ƒä¹ , æœ€åçš„ç»“æœåº”è¯¥æ˜¯:

  #+BEGIN_SRC
  src
    â”œâ”€â”€ components
    â”‚   â”œâ”€â”€ Header.js
    â”‚   â”œâ”€â”€ Content.js
    â”‚   â””â”€â”€ ThemeSwitch.js
    â”œâ”€â”€ containers
    â”‚   â”œâ”€â”€ Header.js
    â”‚   â””â”€â”€ Content.js
    â””â”€â”€ index.js
  #+END_SRC

  å¯ä»¥çœ‹åˆ°å¯¹å¤ç”¨æ€§çš„éœ€æ±‚ä¸åŒ, ä¼šå¯¼è‡´æˆ‘ä»¬åˆ’åˆ†ç»„ä»¶çš„æ–¹å¼ä¸åŒ.

*** æ€»ç»“
  æ ¹æ®æ˜¯å¦éœ€è¦é«˜åº¦çš„å¤ç”¨æ€§, æŠŠç»„ä»¶åˆ’åˆ†ä¸º Dumb å’Œ Smart ç»„ä»¶, çº¦å®šä¿—æˆåœ°æŠŠå®ƒä»¬åˆ†åˆ«æ”¾åˆ° components å’Œ containers ç›®å½•ä¸‹.

  Dumb åŸºæœ¬åªåšä¸€ä»¶äº‹æƒ… â€”â€” æ ¹æ® props è¿›è¡Œæ¸²æŸ“.
  è€Œ Smart åˆ™æ˜¯è´Ÿè´£åº”ç”¨çš„é€»è¾‘, æ•°æ®, æŠŠæ‰€æœ‰ç›¸å…³çš„ Dumb(Smart) ç»„ä»¶ç»„åˆèµ·æ¥, é€šè¿‡ props æ§åˆ¶å®ƒä»¬.

  /*Smart ç»„ä»¶å¯ä»¥ä½¿ç”¨ Smart,Dumb ç»„ä»¶, è€Œ Dumb ç»„ä»¶æœ€å¥½åªä½¿ç”¨ Dumb ç»„ä»¶, å¦åˆ™å®ƒçš„å¤ç”¨æ€§å°±ä¼šä¸§å¤±.*/

  è¦æ ¹æ®åº”ç”¨åœºæ™¯ä¸åŒåˆ’åˆ†ç»„ä»¶, å¦‚æœä¸€ä¸ªç»„ä»¶å¹¶ä¸éœ€è¦å¤ªå¼ºçš„å¤ç”¨æ€§, ç›´æ¥è®©å®ƒæˆä¸º Smart å³å¯, å¦åˆ™å°±è®©å®ƒæˆä¸º Dumb ç»„ä»¶.

  è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„,Smart ç»„ä»¶å¹¶ä¸æ„å‘³ç€å®Œå…¨ä¸èƒ½å¤ç”¨,Smart ç»„ä»¶çš„å¤ç”¨æ€§æ˜¯ä¾èµ–åœºæ™¯çš„, åœ¨ç‰¹å®šçš„åº”ç”¨åœºæ™¯ä¸‹æ˜¯å½“ç„¶æ˜¯å¯ä»¥å¤ç”¨ Smart çš„.
  è€Œ Dumb åˆ™æ˜¯å¯ä»¥è·¨åº”ç”¨åœºæ™¯å¤ç”¨,Smart å’Œ Dumb éƒ½å¯ä»¥å¤ç”¨, åªæ˜¯ç¨‹åº¦, åœºæ™¯ä¸ä¸€æ ·.

* å®æˆ˜åˆ†æ: è¯„è®ºåŠŸèƒ½(ä¸ƒ)
ä»æœ¬èŠ‚å¼€å§‹, æˆ‘ä»¬å¼€å§‹ç”¨ Redux,React-redux æ¥é‡æ„ç¬¬äºŒé˜¶æ®µçš„è¯„è®ºåŠŸèƒ½.
äº§å“éœ€æ±‚è·Ÿä¹‹å‰ä¸€æ ·, ä½†æ˜¯ä¼šç”¨ Redux,React-redux æ¥å¸®åŠ©ç®¡ç†åº”ç”¨çŠ¶æ€, è€Œä¸æ˜¯" çŠ¶æ€æå‡".
è®©æ•´ä¸ªåº”ç”¨æ›´åŠ æ¥è¿‘çœŸå®çš„å·¥ç¨‹.

å¤§å®¶å¯ä»¥åœ¨ç¬¬äºŒé˜¶æ®µçš„ä»£ç ä¸Šè¿›è¡Œä¿®æ”¹ comment-app2(éé«˜é˜¶ç»„ä»¶ç‰ˆæœ¬). å¦‚æœå·²ç»å¿˜äº†ç¬¬äºŒé˜¶æ®µè¯„è®ºåŠŸèƒ½çš„åŒå­¦å¯ä»¥å…ˆç®€å•å›é¡¾ä¸€ä¸‹å®ƒçš„åŠŸèƒ½éœ€æ±‚, å®æˆ˜åˆ†æ: è¯„è®ºåŠŸèƒ½(å››). ç¬¬ä¸€, äºŒ, ä¸‰é˜¶æ®µçš„å®æˆ˜ä»£ç éƒ½å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:react-naive-book-examples.

æˆ‘ä»¬é¦–å…ˆå®‰è£…å¥½ä¾èµ–, ç°åœ¨ comment-app2 éœ€è¦ä¾èµ– Redux,React-redux äº†, è¿›å…¥å·¥ç¨‹ç›®å½•æ‰§è¡Œå‘½ä»¤å®‰è£…ä¾èµ–:

#+BEGIN_SRC javascript :results values list :exports no-eval
npm install redux react-redux --save
#+END_SRC

ç„¶åæˆ‘ä»¬äºŒè¯ä¸è¯´å…ˆåœ¨ src ä¸‹å»ºç«‹ä¸‰ä¸ªç©ºç›®å½•:components,containers,reducers.

** æ„å»ºè¯„è®ºçš„ reducer
 æˆ‘ä»¬ä¹‹å‰çš„ reducer éƒ½æ˜¯ç›´æ¥å†™åœ¨ src/index.js æ–‡ä»¶é‡Œé¢, è¿™æ˜¯ä¸€ä¸ªä¸å¥½çš„åšæ³•.
 å› ä¸ºéšç€åº”ç”¨è¶Šæ¥è¶Šå¤æ‚, å¯èƒ½éœ€è¦æ›´å¤šçš„ reducer æ¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†åº”ç”¨(è¿™é‡Œåé¢çš„ç« èŠ‚ä¼šæœ‰æ‰€æåŠ).
 æ‰€ä»¥æœ€å¥½è¿˜æ˜¯æŠŠæ‰€æœ‰ reducer æŠ½å‡ºæ¥æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ src/reducers.

 å¯¹äºè¯„è®ºåŠŸèƒ½å…¶å®è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„, å›é¡¾ä¸€ä¸‹æˆ‘ä»¬åœ¨çŠ¶æ€æå‡ç« èŠ‚é‡Œé¢ä¸æ–­æå‡çš„çŠ¶æ€æ˜¯ä»€ä¹ˆ?
 å…¶å®è¯„è®ºåŠŸèƒ½çš„ç»„ä»¶ä¹‹é—´å…±äº«çš„çŠ¶æ€åªæœ‰ comments. æˆ‘ä»¬å¯ä»¥ç›´æ¥åªåœ¨ src/reducers æ–°å»ºä¸€ä¸ª reducer comments.js æ¥å¯¹å®ƒè¿›è¡Œç®¡ç†.

 æ€è€ƒä¸€ä¸‹è¯„è®ºåŠŸèƒ½å¯¹äºè¯„è®ºæœ‰ä»€ä¹ˆæ“ä½œ? æƒ³æ¸…æ¥šæˆ‘ä»¬æ‰èƒ½å†™å¥½ reducer, å› ä¸º reducer å°±æ˜¯ç”¨æ¥æè¿°æ•°æ®çš„å½¢æ€å’Œç›¸åº”çš„å˜æ›´.
 æ–°å¢å’Œåˆ é™¤è¯„è®ºè¿™ä¸¤ä¸ªæ“ä½œæ˜¯æœ€æ˜æ˜¾çš„, å¤§å®¶åº”è¯¥éƒ½èƒ½å¤Ÿè½»æ˜“æƒ³åˆ°.
 è¿˜æœ‰ä¸€ä¸ª, æˆ‘ä»¬çš„è¯„è®ºåŠŸèƒ½å…¶å®ä¼šä» LocalStorage è¯»å–æ•°æ®, è¯»å–æ•°æ®ä»¥åå…¶å®éœ€è¦ä¿å­˜åˆ°åº”ç”¨çŠ¶æ€ä¸­. æ‰€ä»¥æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªåˆå§‹åŒ–è¯„è®ºçš„æ“ä½œ.
 æ‰€ä»¥ç›®å‰èƒ½æƒ³åˆ°çš„å°±æ˜¯ä¸‰ä¸ªæ“ä½œ:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 // action types
 const INIT_COMMENTS = 'INIT_COMMENTS'
 const ADD_COMMENT = 'ADD_COMMENT'
 const DELETE_COMMENT = 'DELETE_COMMENT'

 #+END_SRC
 æˆ‘ä»¬ç”¨ä¸‰ä¸ªå¸¸é‡æ¥å­˜å‚¨ action.type çš„ç±»å‹, è¿™æ ·ä»¥åæˆ‘ä»¬ä¿®æ”¹èµ·æ¥å°±ä¼šæ›´æ–¹ä¾¿ä¸€äº›. æ ¹æ®è¿™ä¸‰ä¸ªæ“ä½œç¼–å†™ reducer:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 // reducer
 export default function (state, action) {
   if (!state) {
     state = { comments: [] }
   }
   switch (action.type) {
     case INIT_COMMENTS:
       // åˆå§‹åŒ–è¯„è®º
       return { comments: action.comments }
     case ADD_COMMENT:
       // æ–°å¢è¯„è®º
       return {
         comments: [...state.comments, action.comment]
       }
     case DELETE_COMMENT:
       // åˆ é™¤è¯„è®º
       return {
         comments: [
           ...state.comments.slice(0, action.commentIndex),
           ...state.comments.slice(action.commentIndex + 1)
         ]
       }
     default:
       return state
   }
 }
 #+END_SRC

 æˆ‘ä»¬åªå­˜å‚¨äº†ä¸€ä¸ª comments çš„çŠ¶æ€, åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„.
 å½“é‡åˆ° INIT_COMMENTS çš„ action çš„æ—¶å€™, ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡, ç„¶åç”¨ action.comments è¦†ç›–é‡Œé¢çš„ comments å±æ€§. è¿™å°±æ˜¯åˆå§‹åŒ–è¯„è®ºæ“ä½œ.

 åŒæ ·æ–°å»ºè¯„è®ºæ“ä½œ ADD_COMMENT ä¹Ÿä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡, ç„¶åæ–°å»ºä¸€ä¸ªæ•°ç»„, æ¥ç€æŠŠåŸæ¥ state.comments é‡Œé¢çš„å†…å®¹å…¨éƒ¨æ‹·è´åˆ°æ–°çš„æ•°ç»„å½“ä¸­, æœ€ååœ¨æ–°çš„æ•°ç»„åé¢è¿½åŠ  action.comment.
 è¿™æ ·å°±ç›¸å½“æ–°çš„æ•°ç»„ä¼šæ¯”åŸæ¥çš„å¤šä¸€æ¡è¯„è®º.(è¿™é‡Œä¸è¦æ‹…å¿ƒæ•°ç»„æ‹·è´çš„æ€§èƒ½é—®é¢˜,[...state.comments] æ˜¯æµ…æ‹·è´, å®ƒä»¬æ‹·è´çš„éƒ½æ˜¯å¯¹è±¡å¼•ç”¨è€Œå·².)

 å¯¹äºåˆ é™¤è¯„è®º, å…¶å®æˆ‘ä»¬éœ€è¦åšçš„æ˜¯æ–°å»ºä¸€ä¸ªåˆ é™¤äº†ç‰¹å®šä¸‹æ ‡çš„å†…å®¹çš„æ•°ç»„. æˆ‘ä»¬çŸ¥é“æ•°ç»„ slice(from, to) ä¼šæ ¹æ®ä½ ä¼ è¿›å»çš„ä¸‹æ ‡æ‹·è´ç‰¹å®šèŒƒå›´çš„å†…å®¹æ”¾åˆ°æ–°æ•°ç»„é‡Œé¢. æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ slice æŠŠåŸæ¥è¯„è®ºæ•°ç»„ä¸­ action.commentIndex ä¸‹æ ‡ä¹‹å‰çš„å†…å®¹æ‹·è´åˆ°ä¸€ä¸ªæ•°ç»„å½“ä¸­, æŠŠ action.commentIndex åæ ‡ä¹‹ååˆ°å†…å®¹æ‹·è´åˆ°å¦å¤–ä¸€ä¸ªæ•°ç»„å½“ä¸­. ç„¶åæŠŠä¸¤ä¸ªæ•°ç»„åˆå¹¶èµ·, å°±ç›¸å½“äº" åˆ é™¤" äº† action.commentIndex çš„è¯„è®ºäº†.

 è¿™æ ·å°±å†™å¥½äº†è¯„è®ºç›¸å…³çš„ reducer.

** action creators
 ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨ dispatch çš„æ—¶å€™, éƒ½æ˜¯ç›´æ¥æ‰‹åŠ¨æ„å»ºå¯¹è±¡:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 dispatch({ type: 'INIT_COMMENTS', comments })
 #+END_SRC

 æ¯æ¬¡éƒ½è¦å†™ type å…¶å®æŒºéº»çƒ¦çš„, è€Œä¸”è¿˜è¦å»è®°å¿† action type çš„åå­—ä¹Ÿæ˜¯ä¸€ç§è´Ÿæ‹….
 æˆ‘ä»¬å¯ä»¥æŠŠ action å°è£…åˆ°ä¸€ç§å‡½æ•°é‡Œé¢, è®©å®ƒä»¬å»å¸®åŠ©æˆ‘ä»¬å»æ„å»ºè¿™ç§ action, æˆ‘ä»¬æŠŠå®ƒå«åš action creators.

 #+BEGIN_SRC javascript :results values list :exports no-eval
 // action creators
 export const initComments = (comments) => {
   return { type: INIT_COMMENTS, comments }
 }

 export const addComment = (comment) => {
   return { type: ADD_COMMENT, comment }
 }

 export const deleteComment = (commentIndex) => {
   return { type: DELETE_COMMENT, commentIndex }
 }
 #+END_SRC

 æ‰€è°“ action creators å…¶å®å°±æ˜¯è¿”å› action çš„å‡½æ•°, è¿™æ ·æˆ‘ä»¬ dispatch çš„æ—¶å€™åªéœ€è¦ä¼ å…¥æ•°æ®å°±å¯ä»¥äº†:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 dispatch(initComments(comments))
 #+END_SRC

 action creators è¿˜æœ‰é¢å¤–å¥½å¤„å°±æ˜¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹ä¼ å…¥çš„æ•°æ®åšç»Ÿä¸€çš„å¤„ç†, è€Œä¸”æœ‰äº† action creators, ä»£ç æµ‹è¯•èµ·æ¥ä¼šæ›´æ–¹ä¾¿ä¸€äº›.
 è¿™äº›å†…å®¹å¤§å®¶å¯ä»¥åç»­åœ¨å®é™…é¡¹ç›®å½“ä¸­è¿›è¡Œä½“ä¼š.

 æ•´ä¸ª src/reducers/comments.js çš„ä»£ç å°±æ˜¯:

 #+CAPTION: commentList reducer
 #+BEGIN_SRC javascript :results values list :exports no-eval
 // action types
 const INIT_COMMENTS = 'INIT_COMMENTS'
 const ADD_COMMENT = 'ADD_COMMENT'
 const DELETE_COMMENT = 'DELETE_COMMENT'

 // reducer
 export default function (state, action) {
   if (!state) {
     state = { comments: [] }
   }
   switch (action.type) {
     case INIT_COMMENTS:
       // åˆå§‹åŒ–è¯„è®º
       return { comments: action.comments }
     case ADD_COMMENT:
       // æ–°å¢è¯„è®º
       return {
         comments: [...state.comments, action.comment]
       }
     case DELETE_COMMENT:
       // åˆ é™¤è¯„è®º
       return {
         comments: [
           ...state.comments.slice(0, action.commentIndex),
           ...state.comments.slice(action.commentIndex + 1)
         ]
       }
     default:
       return state
   }
 }

 // action creators
 export const initComments = (comments) => {
   return { type: INIT_COMMENTS, comments }
 }

 export const addComment = (comment) => {
   return { type: ADD_COMMENT, comment }
 }

 export const deleteComment = (commentIndex) => {
   return { type: DELETE_COMMENT, commentIndex }
 }
 #+END_SRC
 <<commentList reducer>>

 #+BEGIN_QUOTE
 æœ‰äº›æœ‹å‹å¯èƒ½ä¼šå‘ç°æˆ‘ä»¬çš„ reducer è·Ÿç½‘ä¸Šå…¶ä»–çš„ reducer çš„ä¾‹å­ä¸å¤§ä¸€æ ·.
 æœ‰äº›äººå–œæ¬¢æŠŠ action å•ç‹¬åˆ‡å‡ºå»ä¸€ä¸ªç›®å½• actions, è®© action å’Œ reducer åˆ†å¼€.
 ä¸ªäººè§‚ç‚¹è§‰å¾—è¿™ç§åšæ³•å¯èƒ½æœ‰ç‚¹è¿‡åº¦ä¼˜åŒ–äº†, å…¶å®å¤šæ•°æƒ…å†µä¸‹ç‰¹å®šçš„ action åªä¼šå½±å“ç‰¹å®šçš„ reducer, ç›´æ¥æ”¾åˆ°ä¸€èµ·å¯ä»¥æ›´åŠ æ¸…æ™°åœ°çŸ¥é“è¿™ä¸ª action å…¶å®åªæ˜¯ä¼šå½±å“åˆ°ä»€ä¹ˆæ ·çš„ reducer.
 è€Œåˆ†å¼€ä¼šç»™æˆ‘ä»¬ç»´æŠ¤å’Œç†è§£ä»£ç å¸¦æ¥é¢å¤–ä¸å¿…è¦çš„è´Ÿæ‹…, è¿™æœ‰ç§çŸ«æ‰è¿‡æ­£çš„æ„å‘³.
 ä½†æ˜¯è¿™é‡Œæ²¡æœ‰æ”¾ä¹‹å››æµ·çš†å‡†çš„è§„åˆ™, å¤§å®¶å¯ä»¥å¤šå‚è€ƒ, å¤šå°è¯•, æ‰¾åˆ°é€‚åˆé¡¹ç›®éœ€æ±‚çš„æ–¹æ¡ˆ.
 #+END_QUOTE

 ä¸ªäººå†™ reducer æ–‡ä»¶çš„ä¹ æƒ¯, ä»…ä¾›å‚è€ƒ:
 - å®šä¹‰ action types
 - ç¼–å†™ reducer
 - è·Ÿè¿™ä¸ª reducer ç›¸å…³çš„ action creators

* å®æˆ˜åˆ†æ: è¯„è®ºåŠŸèƒ½(å…«)
æ¥ä¸‹å¯ä»¥é‡æ„ç»„ä»¶éƒ¨åˆ†çš„å†…å®¹äº†. å…ˆå›é¡¾ä¸€ä¸‹ä¹‹å‰æˆ‘ä»¬æ˜¯æ€ä¹ˆåˆ’åˆ†ç»„ä»¶çš„:

[[file:./static/React.js å°ä¹¦/1122.png]]

ç»„ä»¶æ ‘:

[[file:./static/React.js å°ä¹¦/DAFA784B-6AD3-474B-9A87-316E5741DED6.png]]

è¿™æ ·åˆ’åˆ†æ–¹å¼å½“ç„¶æ˜¯æ²¡é”™çš„. ä½†æ˜¯åœ¨ç»„ä»¶çš„å®ç°ä¸Šæœ‰äº›é—®é¢˜, æˆ‘ä»¬ä¹‹å‰å¹¶æ²¡æœ‰å¤ªå¤šåœ°è€ƒè™‘å¤ç”¨æ€§é—®é¢˜.
æ‰€ä»¥ç°åœ¨å¯ä»¥çœ‹çœ‹ comment-app2 çš„ CommentInput ç»„ä»¶, ä½ ä¼šå‘ç°å®ƒé‡Œé¢æœ‰ä¸€äº› LocalStorage æ“ä½œ:

#+BEGIN_SRC javascript :results values list :exports no-eval
...
 _loadUsername () {
   const username = localStorage.getItem('username')
   if (username) {
     this.setState({ username })
   }
 }

_saveUsername (username) {
  localStorage.setItem('username', username)
}

handleUsernameBlur (event) {
  this._saveUsername(event.target.value)
}

handleUsernameChange (event) {
  this.setState({
    username: event.target.value
  })
}
...
#+END_SRC

å®ƒæ˜¯ä¸€ä¸ªä¾èµ– LocalStorage æ•°æ®çš„ Smart ç»„ä»¶.
å¦‚æœåˆ«çš„åœ°æ–¹æƒ³ä½¿ç”¨è¿™ä¸ªç»„ä»¶, ä½†æ˜¯æ•°æ®å´ä¸æ˜¯ä» LocalStorage é‡Œé¢å–çš„, è€Œæ˜¯ä»æœåŠ¡å™¨å–çš„, é‚£ä¹ˆè¿™ä¸ªç»„ä»¶å°±æ²¡æ³•å¤ç”¨äº†.

æ‰€ä»¥ç°åœ¨éœ€è¦ä»å¤ç”¨æ€§è§’åº¦é‡æ–°æ€è€ƒå¦‚ä½•å®ç°å’Œç»„ç»‡è¿™äº›ç»„ä»¶.
å‡å®šåœ¨ç›®å‰çš„åœºæ™¯ä¸‹,CommentInput,CommentList,Comment ç»„ä»¶éƒ½æ˜¯éœ€è¦å¤ç”¨çš„, æˆ‘ä»¬å°±è¦æŠŠå®ƒä»¬åšæˆ Dumb ç»„ä»¶.

å¹¸è¿çš„æ˜¯, æˆ‘ä»¬å‘ç°å…¶å® CommentList å’Œ Comment æœ¬æ¥å°±æ˜¯ Dumb ç»„ä»¶, ç›´æ¥æŠŠå®ƒä»¬ä¿©ç§»åŠ¨åˆ° components ç›®å½•ä¸‹å³å¯.
è€Œ CommentInput å°±éœ€è¦å¥½å¥½é‡æ„ä¸€ä¸‹äº†.
æˆ‘ä»¬æŠŠå®ƒé‡Œé¢å’Œ LocalStorage æ“ä½œç›¸å…³çš„ä»£ç å…¨éƒ¨åˆ é™¤, è®©å®ƒä» props è·å–æ•°æ®, å˜æˆä¸€ä¸ª Dumb ç»„ä»¶, ç„¶åç§»åŠ¨åˆ° src/components/CommentInput.js æ–‡ä»¶å†…:

#+BEGIN_SRC javascript :results values list :exports no-eval
import React, { Component } from 'react'
import PropTypes from 'prop-types'

export default class CommentInput extends Component {
  static propTypes = {
    username: PropTypes.any,
    onSubmit: PropTypes.func,
    onUserNameInputBlur: PropTypes.func
  }

  static defaultProps = {
    username: ''
  }

  constructor (props) {
    super(props)
    this.state = {
      username: props.username, // ä» props ä¸Šå– username å­—æ®µ
      content: ''
    }
  }

  componentDidMount () {
    this.textarea.focus()
  }

  handleUsernameBlur (event) {
    if (this.props.onUserNameInputBlur) {
      this.props.onUserNameInputBlur(event.target.value)
    }
  }

  handleUsernameChange (event) {
    this.setState({
      username: event.target.value
    })
  }

  handleContentChange (event) {
    this.setState({
      content: event.target.value
    })
  }

  handleSubmit () {
    if (this.props.onSubmit) {
      this.props.onSubmit({
        username: this.state.username,
        content: this.state.content,
        createdTime: +new Date()
      })
    }
    this.setState({ content: '' })
  }

  render () {
     // render æ–¹æ³•ä¿æŒä¸å˜
     // ...
  }
}
#+END_SRC

å…¶å®æ”¹åŠ¨ä¸å¤š.
åŸæ¥ CommentInput éœ€è¦ä» LocalStorage ä¸­è·å– username å­—æ®µ, ç°åœ¨è®©å®ƒä» props é‡Œé¢å»å–, è€ŒåŸæ¥ç”¨æˆ·åçš„è¾“å…¥æ¡† blur çš„æ—¶å€™éœ€è¦ä¿å­˜ username åˆ° LocalStorage çš„è¡Œä¸ºä¹Ÿé€šè¿‡ props.onUserNameInputBlur ä¼ é€’åˆ°ä¸Šå±‚å»åš.
ç°åœ¨ CommentInput æ˜¯ä¸€ä¸ª Dumb ç»„ä»¶äº†, å®ƒçš„æ‰€æœ‰æ¸²æŸ“æ“ä½œéƒ½åªä¾èµ–äº props æ¥å®Œæˆ.

ç°åœ¨ä¸‰ä¸ª Dumb ç»„ä»¶ CommentInput,CommentList,Comment éƒ½å·²ç»å°±ä½äº†.
ä½†æ˜¯å•é  Dumb ç»„ä»¶æ˜¯æ²¡åŠæ³•å®Œæˆåº”ç”¨é€»è¾‘çš„, æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ„å»º Smart ç»„ä»¶æ¥å¸¦é¢†å®ƒä»¬å®Œæˆä»»åŠ¡.

* å®æˆ˜åˆ†æ: è¯„è®ºåŠŸèƒ½(ä¹)
ç°åœ¨æˆ‘ä»¬æœ‰ä¸‰ä¸ª Dumb ç»„ä»¶, ä¸€ä¸ªæ§åˆ¶è¯„è®ºçš„ reducer.
æˆ‘ä»¬è¿˜ç¼ºä»€ä¹ˆ? éœ€è¦æœ‰äººå» LocalStorage åŠ è½½æ•°æ®, å»æ§åˆ¶æ–°å¢, åˆ é™¤è¯„è®º, å»æŠŠæ•°æ®ä¿å­˜åˆ° LocalStorage é‡Œé¢.
ä¹‹å‰è¿™äº›é€»è¾‘æˆ‘ä»¬éƒ½æ˜¯é›¶æ•£åœ°æ”¾åœ¨å„ä¸ªç»„ä»¶é‡Œé¢çš„(ä¸»è¦æ˜¯ CommentApp ç»„ä»¶),
é‚£æ˜¯å› ä¸ºå½“æ—¶æˆ‘ä»¬è¿˜æ²¡å¯¹ Dumb å’Œ Smart ç»„ä»¶ç±»å‹åˆ’åˆ†çš„è®¤çŸ¥, çŠ¶æ€å’Œè§†å›¾ä¹‹é—´ä¹Ÿæ²¡æœ‰è¿™ä¹ˆæ³¾æ¸­åˆ†æ˜.

è€Œç°åœ¨æˆ‘ä»¬çŸ¥é“, è¿™äº›é€»è¾‘æ˜¯åº”è¯¥æ”¾åœ¨ Smart ç»„ä»¶é‡Œé¢çš„:

[[file:./static/React.js å°ä¹¦/6F7A1EE0-9AF4-4AB3-B554-A01E9074FC3C.png]]

äº†è§£ MVC,MVP æ¶æ„æ¨¡å¼çš„åŒå­¦åº”è¯¥å¯ä»¥ç±»æ¯”è¿‡å»,Dumb ç»„ä»¶å°±æ˜¯ View(è´Ÿè´£æ¸²æŸ“),Smart ç»„ä»¶å°±æ˜¯ Controller(Presenter),State å…¶å®å°±æœ‰ç‚¹ç±»ä¼¼ Model.
å…¶å®ä¸èƒ½å®Œå…¨ç±»æ¯”è¿‡å», å®ƒä»¬è¿˜æ˜¯æœ‰ä¸å°‘å·®åˆ«çš„.
ä½†æ˜¯æœ¬è´¨ä¸Šå…œå…œè½¬è½¬è¿˜æ˜¯æŠŠä¸œè¥¿åˆ†æˆäº†ä¸‰å±‚, æ‰€ä»¥è¯´å‰ç«¯å¾ˆå–œæ¬¢ç‚’åˆ«äººæ—©å°±ç©çƒ‚çš„æ¦‚å¿µ, è¿™è¯æœç„¶ä¸å‡.
åºŸè¯ä¸å¤šè¯´, æˆ‘ä»¬ç°åœ¨å°±æŠŠè¿™äº›åº”ç”¨é€»è¾‘æŠ½ç¦»åˆ° Smart ç»„ä»¶é‡Œé¢.

** Smart CommentList
 å¯¹äº CommentList ç»„ä»¶, å¯ä»¥çœ‹åˆ°å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°:comments å’Œ onDeleteComment.
 è¯´æ˜éœ€è¦ä¸€ä¸ª Smart ç»„ä»¶æ¥è´Ÿè´£æŠŠ comments æ•°æ®ä¼ ç»™å®ƒ, å¹¶ä¸”è¿˜å¾—å“åº”å®ƒåˆ é™¤è¯„è®ºçš„è¯·æ±‚.
 æˆ‘ä»¬æ–°å»ºä¸€ä¸ª Smart ç»„ä»¶ src/containers/CommentList.js æ¥å¹²è¿™äº›äº‹æƒ…:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'
 import PropTypes from 'prop-types'
 import { connect } from 'react-redux'
 import CommentList from '../components/CommentList'
 import { initComments, deleteComment } from '../reducers/comments'

 // CommentListContainer
 // ä¸€ä¸ª Smart ç»„ä»¶, è´Ÿè´£è¯„è®ºåˆ—è¡¨æ•°æ®çš„åŠ è½½, åˆå§‹åŒ–, åˆ é™¤è¯„è®º
 // æ²Ÿé€š CommentList å’Œ state
 class CommentListContainer extends Component {
  static propTypes = {
    comments: PropTypes.array,
    initComments: PropTypes.func,
    onDeleteComment: PropTypes.func
  }

  componentWillMount () {
    // componentWillMount ç”Ÿå‘½å‘¨æœŸä¸­åˆå§‹åŒ–è¯„è®º
    this._loadComments()
  }

  _loadComments () {
    // ä» LocalStorage ä¸­åŠ è½½è¯„è®º
    let comments = localStorage.getItem('comments')
    comments = comments ? JSON.parse(comments) : []
    // this.props.initComments æ˜¯ connect ä¼ è¿›æ¥çš„
    // å¯ä»¥å¸®æˆ‘ä»¬æŠŠæ•°æ®åˆå§‹åŒ–åˆ° state é‡Œé¢å»
    this.props.initComments(comments)
  }

  handleDeleteComment (index) {
    const { comments } = this.props
    // props æ˜¯ä¸èƒ½å˜çš„, æ‰€ä»¥è¿™é‡Œæ–°å»ºä¸€ä¸ªåˆ é™¤äº†ç‰¹å®šä¸‹æ ‡çš„è¯„è®ºåˆ—è¡¨
    const newComments = [
      ...comments.slice(0, index),
      ...comments.slice(index + 1)
    ]
    // ä¿å­˜æœ€æ–°çš„è¯„è®ºåˆ—è¡¨åˆ° LocalStorage
    localStorage.setItem('comments', JSON.stringify(newComments))
    if (this.props.onDeleteComment) {
      // this.props.onDeleteComment æ˜¯ connect ä¼ è¿›æ¥çš„
      // ä¼š dispatch ä¸€ä¸ª action å»åˆ é™¤è¯„è®º
      this.props.onDeleteComment(index)
    }
  }

  render () {
    return (
      <CommentList
        comments={this.props.comments}
        onDeleteComment={this.handleDeleteComment.bind(this)} />
    )
  }
 }

 // è¯„è®ºåˆ—è¡¨ä» state.comments ä¸­è·å–
 const mapStateToProps = (state) => {
  return {
    comments: state.comments
  }
 }

 const mapDispatchToProps = (dispatch) => {
  return {
    // æä¾›ç»™ CommentListContainer
    // å½“ä» LocalStorage åŠ è½½è¯„è®ºåˆ—è¡¨ä»¥åå°±ä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•
    // æŠŠè¯„è®ºåˆ—è¡¨åˆå§‹åŒ–åˆ° state å½“ä¸­
    initComments: (comments) => {
      dispatch(initComments(comments))
    },
    // åˆ é™¤è¯„è®º
    onDeleteComment: (commentIndex) => {
      dispatch(deleteComment(commentIndex))
    }
  }
 }

 // å°† CommentListContainer connect åˆ° store
 // ä¼šæŠŠ comments,initComments,onDeleteComment ä¼ ç»™ CommentListContainer
 export default connect(
  mapStateToProps,
  mapDispatchToProps
 )(CommentListContainer)
 #+END_SRC

 ä»£ç æœ‰ç‚¹é•¿, å¤§å®¶é€šè¿‡æ³¨é‡Šåº”è¯¥äº†è§£è¿™ä¸ªç»„ä»¶çš„åŸºæœ¬é€»è¾‘.
 /*æœ‰ä¸€ç‚¹è¦é¢å¤–è¯´æ˜çš„æ˜¯, æˆ‘ä»¬ä¸€å¼€å§‹ä¼ ç»™ CommentListContainer çš„ props.comments å…¶å®æ˜¯ reducer é‡Œé¢åˆå§‹åŒ–çš„ç©ºçš„ comments æ•°ç»„, å› ä¸ºè¿˜æ²¡æœ‰ä» LocalStorage é‡Œé¢å–æ•°æ®.*/
 [[æœ€ç»ˆå½¢æ€çš„ createStore][See: æœ€ç»ˆå½¢æ€çš„ createStore]]
 [[commentList reducer][See: commentList reducer]]
 [[connect][See: connect]]

 è€Œ CommentListContainer å†…éƒ¨ä» LocalStorage åŠ è½½ comments æ•°æ®,
 ç„¶åè°ƒç”¨ this.props.initComments(comments) ä¼šå¯¼è‡´ dispatch,
 ä»è€Œä½¿å¾—çœŸæ­£ä» LocalStorage åŠ è½½çš„ comments åˆå§‹åŒ–åˆ° state é‡Œé¢å».

 /*å› ä¸º dispatch äº†å¯¼è‡´ connect é‡Œé¢çš„ Connect åŒ…è£…ç»„ä»¶å» state é‡Œé¢å–æœ€æ–°çš„ comments ç„¶åé‡æ–°æ¸²æŸ“,
 è¿™æ—¶å€™ CommentListContainer æ‰è·å¾—äº†æœ‰æ•°æ®çš„ props.comments.*/

 è¿™é‡Œçš„é€»è¾‘æœ‰ç‚¹ç»•, å¤§å®¶å¯ä»¥å›é¡¾ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰å®ç°çš„ react-redux.js æ¥ä½“ä¼šä¸€ä¸‹.

** Smart CommentInput
 å¯¹äº CommentInput ç»„ä»¶, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæœ‰ä¸‰ä¸ªå‚æ•°:username,onSubmit,onUserNameInputBlur.
 æˆ‘ä»¬éœ€è¦ä¸€ä¸ª Smart çš„ç»„ä»¶æ¥ç®¡ç†ç”¨æˆ·ååœ¨ LocalStorage çš„åŠ è½½, ä¿å­˜, ç”¨æˆ·è¿˜å¯èƒ½ç‚¹å‡»" å‘å¸ƒ" æŒ‰é’®, æ‰€ä»¥è¿˜éœ€è¦å¤„ç†è¯„è®ºå‘å¸ƒçš„é€»è¾‘.
 æˆ‘ä»¬æ–°å»ºä¸€ä¸ª Smart ç»„ä»¶ src/containers/CommentInput.js æ¥å¹²è¿™äº›äº‹æƒ…:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'
 import PropTypes from 'prop-types'
 import { connect } from 'react-redux'
 import CommentInput from '../components/CommentInput'
 import { addComment } from '../reducers/comments'

 // CommentInputContainer
 // è´Ÿè´£ç”¨æˆ·åçš„åŠ è½½, ä¿å­˜, è¯„è®ºçš„å‘å¸ƒ
 class CommentInputContainer extends Component {
  static propTypes = {
    comments: PropTypes.array,
    onSubmit: PropTypes.func
  }

  constructor () {
    super()
    this.state = { username: '' }
  }

  componentWillMount () {
    // componentWillMount ç”Ÿå‘½å‘¨æœŸä¸­åˆå§‹åŒ–ç”¨æˆ·å
    this._loadUsername()
  }

  _loadUsername () {
    // ä» LocalStorage åŠ è½½ username
    // ç„¶åå¯ä»¥åœ¨ render æ–¹æ³•ä¸­ä¼ ç»™ CommentInput
    const username = localStorage.getItem('username')
    if (username) {
      this.setState({ username })
    }
  }

  _saveUsername (username) {
    // çœ‹çœ‹ render æ–¹æ³•çš„ onUserNameInputBlur
    // è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ç”¨æˆ·åè¾“å…¥æ¡† blur çš„æ—¶å€™çš„è¢«è°ƒç”¨, ä¿å­˜ç”¨æˆ·å
    localStorage.setItem('username', username)
  }

  handleSubmitComment (comment) {
    // è¯„è®ºæ•°æ®çš„éªŒè¯
    if (!comment) return
    if (!comment.username) return alert('è¯·è¾“å…¥ç”¨æˆ·å')
    if (!comment.content) return alert('è¯·è¾“å…¥è¯„è®ºå†…å®¹')
    // æ–°å¢è¯„è®ºä¿å­˜åˆ° LocalStorage ä¸­
    const { comments } = this.props
    const newComments = [...comments, comment]
    localStorage.setItem('comments', JSON.stringify(newComments))
    // this.props.onSubmit æ˜¯ connect ä¼ è¿›æ¥çš„
    // ä¼š dispatch ä¸€ä¸ª action å»æ–°å¢è¯„è®º
    if (this.props.onSubmit) {
      this.props.onSubmit(comment)
    }
  }

  render () {
    return (
      <CommentInput
        username={this.state.username}
        onUserNameInputBlur={this._saveUsername.bind(this)}
        onSubmit={this.handleSubmitComment.bind(this)} />
    )
  }
 }

 const mapStateToProps = (state) => {
  return {
    comments: state.comments
  }
 }

 const mapDispatchToProps = (dispatch) => {
  return {
    onSubmit: (comment) => {
      dispatch(addComment(comment))
    }
  }
 }

 export default connect(
  mapStateToProps,
  mapDispatchToProps
 )(CommentInputContainer)
 #+END_SRC

 åŒæ ·åœ°, å¯¹ä»£ç çš„è§£é‡Šéƒ½æ”¾åœ¨äº†æ³¨é‡Šå½“ä¸­. è¿™æ ·å°±æ„å»ºäº†ä¸€ä¸ª Smart çš„ CommentInput.

** Smart CommentApp
 æ¥ä¸‹æ¥çš„äº‹æƒ…éƒ½æ˜¯å¾ˆç®€å•, æˆ‘ä»¬ç”¨ CommentApp æŠŠè¿™ä¸¤ä¸ª Smart çš„ç»„ä»¶ç»„åˆèµ·æ¥,
 æŠŠ src/CommentApp.js ç§»åŠ¨åˆ° src/containers/CommentApp.js, æŠŠé‡Œé¢çš„å†…å®¹æ›¿æ¢ä¸º:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React, { Component } from 'react'
 import CommentInput from './CommentInput'
 import CommentList from './CommentList'

 export default class CommentApp extends Component {
   render () {
     return (
       <div className='wrapper'>
         <CommentInput />
         <CommentList />
       </div>
     )
   }
 }
 #+END_SRC

 åŸæœ¬å¾ˆå¤æ‚çš„ CommentApp ç°åœ¨å˜å¾—å¼‚å¸¸ç®€å•, å› ä¸ºå®ƒçš„é€»è¾‘éƒ½åˆ†ç¦»åˆ°äº†ä¸¤ä¸ª Smart ç»„ä»¶é‡Œé¢å»äº†.
 åŸæ¥çš„ CommentApp ç¡®å®æ‰¿è½½äº†å¤ªå¤šå®ƒä¸åº”è¯¥æ‰¿æ‹…çš„è´£ä»». åˆ†ç¦»è¿™äº›é€»è¾‘å¯¹æˆ‘ä»¬ä»£ç çš„ç»´æŠ¤å’Œç®¡ç†ä¹Ÿä¼šå¸¦æ¥å¥½å¤„.

 æœ€åä¸€æ­¥, ä¿®æ”¹ src/index.js:

 #+BEGIN_SRC javascript :results values list :exports no-eval
 import React from 'react'
 import ReactDOM from 'react-dom'
 import { createStore } from 'redux'
 import { Provider } from 'react-redux'
 import CommentApp from './containers/CommentApp'
 import commentsReducer from './reducers/comments'
 import './index.css'

 const store = createStore(commentsReducer)

 ReactDOM.render(
   <Provider store={store}>
     <CommentApp />
   </Provider>,
   document.getElementById('root')
 )
 #+END_SRC

 é€šè¿‡ commentsReducer æ„å»ºä¸€ä¸ª store, ç„¶åè®© Provider æŠŠå®ƒä¼ é€’ä¸‹å», è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†æœ€åçš„é‡æ„.

 æˆ‘ä»¬æœ€åçš„ç»„ä»¶æ ‘æ˜¯è¿™æ ·çš„:

 [[file:./static/React.js å°ä¹¦/170B1159-C690-4DDA-9118-95AF810D40C6.png]]

 æ–‡ä»¶ç›®å½•:

 #+BEGIN_SRC
 src
 â”œâ”€â”€ components
 â”‚   â”œâ”€â”€ Comment.js
 â”‚   â”œâ”€â”€ CommentInput.js
 â”‚   â””â”€â”€ CommentList.js
 â”œâ”€â”€ containers
 â”‚   â”œâ”€â”€ CommentApp.js
 â”‚   â”œâ”€â”€ CommentInput.js
 â”‚   â””â”€â”€ CommentList.js
 â”‚   reducers
 â”‚     â””â”€â”€ comments.js
 â”œâ”€â”€ index.css
 â””â”€â”€ index.js
 #+END_SRC

 æ‰€æœ‰ä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:[[https://github.com/huzidaha/react-naive-book-examples/tree/master/comment-app3/src][comment-app3]].
